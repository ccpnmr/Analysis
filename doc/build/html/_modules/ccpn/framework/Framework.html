<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.framework.Framework &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.framework.Framework</h1><div class="highlight"><pre>
<span></span><span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2019&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Ed Brooksbank, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Skinner, S.P., Fogh, R.H., Boucher, W., Ragan, T.J., Mureddu, L.G., &amp; Vuister, G.W.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;CcpNmr AnalysisAssign: a flexible platform for integrated NMR analysis&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;J.Biomol.Nmr (2016), 66, 111-124, http://doi.org/10.1007/s10858-016-0060-y&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Wayne Boucher $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:32:36 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b5 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">ccpn.core.IntegralList</span> <span class="kn">import</span> <span class="n">IntegralList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.MultipletList</span> <span class="kn">import</span> <span class="n">MultipletList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation</span> <span class="kn">import</span> <span class="n">Io</span> <span class="k">as</span> <span class="n">coreIo</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib</span> <span class="kn">import</span> <span class="n">CcpnNefIo</span><span class="p">,</span> <span class="n">CcpnSparkyIo</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Notifiers</span> <span class="kn">import</span> <span class="n">NotifierBase</span><span class="p">,</span> <span class="n">Notifier</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Pid</span> <span class="kn">import</span> <span class="n">Pid</span>
<span class="kn">from</span> <span class="nn">ccpn.framework</span> <span class="kn">import</span> <span class="n">Version</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Current</span> <span class="kn">import</span> <span class="n">Current</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.lib.Pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">languages</span><span class="p">,</span> <span class="n">defaultLanguage</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">translator</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">userPreferencesPath</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">userPreferencesDirectory</span>
<span class="kn">from</span> <span class="nn">ccpn.ui</span> <span class="kn">import</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">defaultInterface</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.CcpnModule</span> <span class="kn">import</span> <span class="n">CcpnModule</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.MacroEditor</span> <span class="kn">import</span> <span class="n">MacroEditor</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets</span> <span class="kn">import</span> <span class="n">MessageDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.FileDialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.GuiSpectrumView</span> <span class="kn">import</span> <span class="n">_createdSpectrumView</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Logging</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">ccpn.util.AttrDict</span> <span class="kn">import</span> <span class="n">AttrDict</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Common</span> <span class="kn">import</span> <span class="n">uniquify</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.Gui</span> <span class="kn">import</span> <span class="n">Gui</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.memops</span> <span class="kn">import</span> <span class="n">Implementation</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Api</span> <span class="k">as</span> <span class="n">apiIo</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Formats</span> <span class="k">as</span> <span class="n">ioFormats</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>
<span class="kn">from</span> <span class="nn">ccpn.util.decorators</span> <span class="kn">import</span> <span class="n">logCommand</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">catchExceptions</span>


<span class="c1"># from functools import partial</span>

<span class="n">_DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># componentNames = (&#39;Assignment&#39;, &#39;Screening&#39;, &#39;Structure&#39;)</span>

<span class="n">AnalysisAssign</span> <span class="o">=</span> <span class="s1">&#39;AnalysisAssign&#39;</span>
<span class="n">AnalysisScreen</span> <span class="o">=</span> <span class="s1">&#39;AnalysisScreen&#39;</span>
<span class="n">AnalysisMetabolomics</span> <span class="o">=</span> <span class="s1">&#39;AnalysisMetabolomics&#39;</span>
<span class="n">AnalysisStructure</span> <span class="o">=</span> <span class="s1">&#39;AnalysisStructure&#39;</span>
<span class="n">ApplicationNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">AnalysisAssign</span><span class="p">,</span> <span class="n">AnalysisScreen</span><span class="p">,</span> <span class="n">AnalysisMetabolomics</span><span class="p">,</span> <span class="n">AnalysisStructure</span><span class="p">]</span>
<span class="n">interfaceNames</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NoUi&#39;</span><span class="p">,</span> <span class="s1">&#39;Gui&#39;</span><span class="p">)</span>
<span class="n">DataDirName</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
<span class="n">SpectraDirName</span> <span class="o">=</span> <span class="s1">&#39;spectra&#39;</span>
<span class="n">PluginDataDirName</span> <span class="o">=</span> <span class="s1">&#39;pluginData&#39;</span>
<span class="n">ScriptsDirName</span> <span class="o">=</span> <span class="s1">&#39;scripts&#39;</span>
<span class="n">MacrosDirName</span> <span class="o">=</span> <span class="s1">&#39;macros&#39;</span>


<span class="k">def</span> <span class="nf">_ccpnExceptionhook</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tback</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This because PyQT raises and catches exceptions,</span>
<span class="sd">    but doesn&#39;t pass them along instead makes the program crashing miserably.&#39;&#39;&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tback</span><span class="p">)</span>


<span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">_ccpnExceptionhook</span>


<div class="viewcode-block" id="printCreditsText"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.printCreditsText">[docs]</a><span class="k">def</span> <span class="nf">printCreditsText</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initial text to terminal &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnLicenceUrl</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># ejb</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># lines.append(&quot;%s&quot; % __copyright__[0:__copyright__.index(&#39;-&#39;)] + &#39;- 2016&#39;)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__copyright__</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CCPN licence. See </span><span class="si">%s</span><span class="s2">. Not to be distributed without prior consent!&quot;</span> <span class="o">%</span> <span class="n">ccpnLicenceUrl</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__credits__</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Developed by: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__credits__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__credits__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Developed by: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__credits__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">crLine</span> <span class="ow">in</span> <span class="n">__credits__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">crLine</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__reference__</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Please cite:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__reference__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__reference__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Please cite:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__reference__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">refLine</span> <span class="ow">in</span> <span class="n">__reference__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">refLine</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DISCLAIMER:   This program is offered &#39;as-is&#39;. Under no circumstances will the authors, CCPN,&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              the Department of Molecular and Cell Biology, or the University of Leicester be&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              liable of any damage, loss of data, loss of revenue or any other undesired&quot;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              consequences originating from the usage of this software.&quot;</span><span class="p">)</span>

    <span class="c1"># print with aligning &#39;|&#39;s</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">lines</span><span class="p">))</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;|   </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;  |</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)))</span></div>


<div class="viewcode-block" id="defineProgramArguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.defineProgramArguments">[docs]</a><span class="k">def</span> <span class="nf">defineProgramArguments</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Define the arguments of the program</span>
<span class="sd">    return argparse instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process startup arguments&#39;</span><span class="p">)</span>
    <span class="c1"># for component in componentNames:</span>
    <span class="c1">#   parser.add_argument(&#39;--&#39;+component.lower(), dest=&#39;include&#39;+component, action=&#39;store_true&#39;,</span>
    <span class="c1">#                                               help=&#39;Show %s component&#39; % component.lower())</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--language&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Language for menus, etc.; valid options = (</span><span class="si">%s</span><span class="s1">); default=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">languages</span><span class="p">),</span> <span class="n">defaultLanguage</span><span class="p">)))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--interface&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;User interface, to use; one of  = (</span><span class="si">%s</span><span class="s1">); default=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interfaces</span><span class="p">),</span> <span class="n">defaultInterface</span><span class="p">)),</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">defaultInterface</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--skip-user-preferences&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;skipUserPreferences&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Skip loading user preferences&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dark&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;darkColourScheme&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Use dark colour scheme&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--light&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;lightColourScheme&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Use dark colour scheme&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--nologging&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nologging&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not log information to a file&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set logging level to debug&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug1&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set logging level to debug1 (=debug)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug2&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug2&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set logging level to debug2&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug3&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug3&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set logging level to debug3&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;projectPath&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Project path&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="Arguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Arguments">[docs]</a><span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class for setting FrameWork input arguments directly&quot;&quot;&quot;</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">defaultLanguage</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="s1">&#39;NoUi&#39;</span>
    <span class="n">nologging</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">debug2</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">debug3</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">skipUserPreferences</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>

        <span class="c1"># Dummy values</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">ApplicationNames</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span> <span class="o">+</span> <span class="n">component</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span> <span class="o">=</span> <span class="n">projectPath</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="createFramework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.createFramework">[docs]</a><span class="k">def</span> <span class="nf">createFramework</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Arguments</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="n">projectPath</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Framework</span><span class="p">(</span><span class="s1">&#39;CcpNmr&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>


<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>


<div class="viewcode-block" id="AutoBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.AutoBackup">[docs]</a><span class="k">class</span> <span class="nc">AutoBackup</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">backupFunction</span><span class="p">,</span> <span class="n">sleepTime</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span> <span class="o">=</span> <span class="n">backupFunction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="AutoBackup.run"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.AutoBackup.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                <span class="n">waitTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">waitTime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">waitTime</span> <span class="o">==</span> <span class="s1">&#39;kill&#39;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">waitTime</span><span class="p">:</span>
                <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Framework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework">[docs]</a><span class="k">class</span> <span class="nc">Framework</span><span class="p">(</span><span class="n">NotifierBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Framework class is the base class for all applications.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">Arguments</span><span class="p">()):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="n">applicationName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span> <span class="o">=</span> <span class="n">applicationVersion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="n">revision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Hack for now, how should we store these?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ccpnModules</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">printCreditsText</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">)</span>

        <span class="c1"># self.setupComponents(args)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nologging</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">debug3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG3</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">debug2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self._getUserPrefs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self._getUserLayout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self.getStyleSheet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self.getStyleSheet</span>

        <span class="c1"># Necessary as attribute is queried during initialisation:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># This is needed to make project available in NoUi (if nothing else)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># Blocking level for command echo and logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># NEF reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span> <span class="o">=</span> <span class="n">CcpnNefIo</span><span class="o">.</span><span class="n">CcpnNefReader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># SPARKY reader - ejb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparkyReader</span> <span class="o">=</span> <span class="n">CcpnSparkyIo</span><span class="o">.</span><span class="n">CcpnSparkyReader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># NBNB TODO The following block should maybe be moved into _getUi</span>
        <span class="c1"># Assure that .ccpn exists</span>
        <span class="n">ccpnDir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">aPath</span><span class="p">(</span><span class="n">userPreferencesDirectory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ccpnDir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">ccpnDir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getUserPrefs</span><span class="p">()</span>

        <span class="c1"># set the preferences if added from the commandline</span>
        <span class="c1"># if self.args.darkColourScheme:</span>
        <span class="c1">#     self.preferences.general.colourScheme = &#39;dark&#39;</span>
        <span class="c1"># elif self.args.lightColourScheme:</span>
        <span class="c1">#     self.preferences.general.colourScheme = &#39;light&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setLanguage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getUI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupMenus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_isInDebugMode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return True if either of the debug flags has been set</span>
<span class="sd">        CCPNINTERNAL: used throughout to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hasGui</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="s2">&quot;Return True if application has a gui&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">Gui</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_testShortcuts0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; Testing shortcuts0&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_testShortcuts1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; Testing shortcuts1&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.start"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start the program execution&quot;&quot;&quot;</span>

        <span class="c1"># register the programme for later</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.Application</span> <span class="kn">import</span> <span class="n">ApplicationContainer</span>

        <span class="n">container</span> <span class="o">=</span> <span class="n">ApplicationContainer</span><span class="p">()</span>
        <span class="n">container</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Load / create project</span>
        <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">projectPath</span>
        <span class="k">if</span> <span class="n">projectPath</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectPath</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateCheckableMenuItems</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">_checkRegistration</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># if not self.ui._checkUpdates():</span>
        <span class="c1">#   return</span>

        <span class="c1"># Needed in case project load failed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; No project, aborting ...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateAutoBackup</span><span class="p">()</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Done, </span><span class="si">%s</span><span class="s1"> is starting</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span><span class="p">)</span>

        <span class="c1"># self.project = project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.updateAutoBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.updateAutoBackup">[docs]</a>    <span class="k">def</span> <span class="nf">updateAutoBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoBackupEnabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoBackupFrequency</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.setAutoBackupTime"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.setAutoBackupTime">[docs]</a>    <span class="k">def</span> <span class="nf">setAutoBackupTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="c1"># TODO: Need to add logging...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">full</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="o">=</span> <span class="n">AutoBackup</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="p">,</span>
                                               <span class="n">backupFunction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="s1">&#39;kill&#39;</span><span class="p">)</span>
        <span class="c1"># project._resetUndo(debug=_DEBUG)</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Framework.backupProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.backupProject">[docs]</a>    <span class="k">def</span> <span class="nf">backupProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">apiIo</span><span class="o">.</span><span class="n">backupProject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">backupPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">backupPath</span>

        <span class="n">backupStatePath</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">Layout</span><span class="o">.</span><span class="n">StateDirName</span><span class="p">)</span>

        <span class="n">copy_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statePath</span><span class="p">,</span> <span class="n">backupStatePath</span><span class="p">)</span>
        <span class="n">layoutFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backupStatePath</span><span class="p">,</span> <span class="n">Layout</span><span class="o">.</span><span class="n">DefaultLayoutFileName</span><span class="p">)</span>
        <span class="n">Layout</span><span class="o">.</span><span class="n">saveLayoutToJson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">layoutFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">_dumpStateToFile</span><span class="p">(</span><span class="n">backupStatePath</span><span class="p">)</span>

        <span class="c1">#Spectra should not be copied over. Dangerous for disk space</span>
        <span class="c1"># backupDataPath = Path.fetchDir(backupPath, DataDirName)</span>

        <span class="c1">#   TODO add other files inside this dirs</span>
        <span class="n">backupScriptsPath</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">ScriptsDirName</span><span class="p">)</span>
        <span class="n">backupLogsPath</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="n">backupPath</span><span class="p">,</span> <span class="n">ScriptsDirName</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_initialiseProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialise project and set up links and objects that involve it&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

        <span class="c1"># Pass an instance of framework to project so the UI instantiation can happen</span>
        <span class="n">project</span><span class="o">.</span><span class="n">_appBase</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Set up current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">Current</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>

        <span class="c1"># This wraps the underlying data, including the wrapped graphics data</span>
        <span class="c1">#  - the project is now ready to use</span>

        <span class="n">project</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">()</span>

        <span class="c1"># Adapt project to preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyPreferences</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

        <span class="c1"># init application directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scriptsPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pymolScriptsPath</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scriptsPath</span><span class="p">,</span> <span class="s1">&#39;pymol&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statePath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipelinePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipelinePath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginDataPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginDataPath</span>

        <span class="c1"># restore current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">_restoreStateFromFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statePath</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_mainWindow&#39;</span><span class="p">):</span>
            <span class="n">Logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;framework._initialiseProject&#39;</span><span class="p">)</span>

            <span class="n">project</span><span class="o">.</span><span class="n">_blockSideBar</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span>
            <span class="n">project</span><span class="o">.</span><span class="n">_blockSideBar</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c1"># Get the mainWindow out of the application top level once it&#39;s been transferred to ui</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The NoUi version has no mainWindow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refreshAfterSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refresh user interface after project save (which may have caused project rename)&quot;&quot;&quot;</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="n">mainWindow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># mainWindow.sideBar.setProjectName(self.project)</span>
            <span class="n">mainWindow</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">setProjectName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="s1">&#39;Gui&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStyleSheet</span><span class="p">()</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.Gui</span> <span class="kn">import</span> <span class="n">Gui</span>

            <span class="n">ui</span> <span class="o">=</span> <span class="n">Gui</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">ui</span><span class="o">.</span><span class="n">qtApp</span><span class="o">.</span><span class="n">_ccpnApplication</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="c1"># ui.mainWindow is None upon initialization: gets filled later</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ui</span><span class="p">,</span> <span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.Ui</span> <span class="kn">import</span> <span class="n">NoUi</span>

            <span class="n">ui</span> <span class="o">=</span> <span class="n">NoUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Connect UI classes for chosen ui</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ui</span>

<div class="viewcode-block" id="Framework.getStyleSheet"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getStyleSheet">[docs]</a>    <span class="k">def</span> <span class="nf">getStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return Stylesheet as determined by arguments --dark, --light or preferences</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">darkColourScheme</span><span class="p">:</span>
            <span class="n">colourScheme</span> <span class="o">=</span> <span class="s1">&#39;dark&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">lightColourScheme</span><span class="p">:</span>
            <span class="n">colourScheme</span> <span class="o">=</span> <span class="s1">&#39;light&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span>

        <span class="k">if</span> <span class="n">colourScheme</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;invalid colourScheme&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">=</span> <span class="n">colourScheme</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s1">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                               <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">StyleSheet.qss&#39;</span> <span class="o">%</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">upperFirst</span><span class="p">(</span><span class="n">colourScheme</span><span class="p">)))</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">styleSheet</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s1">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                                   <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">AdditionsLinux.qss&#39;</span> <span class="o">%</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">upperFirst</span><span class="p">(</span><span class="n">colourScheme</span><span class="p">)))</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">additions</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">styleSheet</span> <span class="o">+=</span> <span class="n">additions</span>
        <span class="k">return</span> <span class="n">styleSheet</span></div>

    <span class="k">def</span> <span class="nf">_getUserPrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># user preferences</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Getting user preferences</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">getPreferences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_savePreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Save the preferences to file&quot;</span>
        <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error saving preferences; &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">):</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prefFile</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_getUserLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;defines the application.layout dictionary.</span>
<span class="sd">        For a saved project: uses the auto-generated during the saving process, if a user specified json file is given then</span>
<span class="sd">        is used that one instead.</span>
<span class="sd">        For a new project, it is used the default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># try:</span>
        <span class="k">if</span> <span class="n">userPath</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">userPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># opens the autogenerated if an existing project</span>
            <span class="n">savedLayoutPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAutogeneratedLayoutFile</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">savedLayoutPath</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savedLayoutPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">layout</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># opens the default</span>
                <span class="n">Layout</span><span class="o">.</span><span class="n">_createLayoutFile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_getUserLayout</span><span class="p">()</span>
        <span class="c1"># except Exception as e:</span>
        <span class="c1">#   getLogger().warning(&#39;No layout found. %s&#39; %e)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span>

<div class="viewcode-block" id="Framework.saveLayout"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveLayout">[docs]</a>    <span class="k">def</span> <span class="nf">saveLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Layout</span><span class="o">.</span><span class="n">updateSavedLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.saveLayoutAs"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveLayoutAs">[docs]</a>    <span class="k">def</span> <span class="nf">saveLayoutAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSaveLayoutPath</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Layout</span><span class="o">.</span><span class="n">saveLayoutToJson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">jsonFilePath</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Impossible to save layout. </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.restoreLastSavedLayout"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.restoreLastSavedLayout">[docs]</a>    <span class="k">def</span> <span class="nf">restoreLastSavedLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">_closeAll</span><span class="p">()</span>
        <span class="n">Layout</span><span class="o">.</span><span class="n">restoreLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.restoreLayoutFromFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.restoreLayoutFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">restoreLayoutFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonFilePath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">jsonFilePath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1">#asks with a dialog</span>
            <span class="n">jsonFilePath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSavedLayoutPath</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">jsonFilePath</span><span class="p">):</span>
                <span class="n">again</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showOkCancelWarning</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;File Does not exist&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Try again?&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">again</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">restoreLayoutFromFile</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">_closeAll</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getUserLayout</span><span class="p">(</span><span class="n">jsonFilePath</span><span class="p">)</span>
            <span class="n">Layout</span><span class="o">.</span><span class="n">restoreLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Impossible to restore layout. </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getAutogeneratedLayoutFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
            <span class="n">layoutFile</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">getLayoutFile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">layoutFile</span>

    <span class="k">def</span> <span class="nf">_setLanguage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Language, check for command line override, or use preferences</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
            <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
            <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">language</span> <span class="o">=</span> <span class="n">defaultLanguage</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">setLanguage</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="c1"># translator.setDebug(True)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Language set to &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">translator</span><span class="o">.</span><span class="n">_language</span><span class="p">)</span>

    <span class="c1"># def _isRegistered(self):</span>
    <span class="c1">#   &quot;&quot;&quot;return True if registered&quot;&quot;&quot;</span>
    <span class="c1">#   self._registrationDict = Register.loadDict()</span>
    <span class="c1">#   return not Register.isNewRegistration(self._registrationDict)</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># def _checkRegistration(self):</span>
    <span class="c1">#   &quot;&quot;&quot;</span>
    <span class="c1">#   Display registration popup if there is a gui</span>
    <span class="c1">#   return True if ok</span>
    <span class="c1">#   return False on error</span>
    <span class="c1">#   &quot;&quot;&quot;</span>
    <span class="c1">#   from ccpn.ui.gui.popups.RegisterPopup import RegisterPopup</span>
    <span class="c1">#</span>
    <span class="c1">#   if self.ui:</span>
    <span class="c1">#     if not self._isRegistered():</span>
    <span class="c1">#       self.ui.mainWindow.show()</span>
    <span class="c1">#       QtWidgets.QApplication.processEvents()</span>
    <span class="c1">#       popup = RegisterPopup(self.ui.mainWindow, version=self.applicationVersion, modal=True)</span>
    <span class="c1">#       QtWidgets.QApplication.processEvents()</span>
    <span class="c1">#       popup.show()</span>
    <span class="c1">#       # popup.raise_()</span>
    <span class="c1">#       popup.exec_()</span>
    <span class="c1">#</span>
    <span class="c1">#   if not self._isRegistered():</span>
    <span class="c1">#     return False</span>
    <span class="c1">#</span>
    <span class="c1">#   Register.updateServer(self._registrationDict, self.applicationVersion)</span>
    <span class="c1">#   return True</span>

<div class="viewcode-block" id="Framework.applyPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.applyPreferences">[docs]</a>    <span class="k">def</span> <span class="nf">applyPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply user preferences</span>

<span class="sd">        NBNB project should be impliclt rather than a parameter (once reorganisation is finished)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Reset remoteData DataStores to match preferences setting</span>
        <span class="n">dataPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">dataPath</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dataPath</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dataPath</span><span class="p">):</span>
            <span class="n">dataPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
        <span class="n">memopsRoot</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span>
        <span class="n">dataUrl</span> <span class="o">=</span> <span class="n">memopsRoot</span><span class="o">.</span><span class="n">findFirstDataLocationStore</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findFirstDataUrl</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;remoteData&#39;</span>
                <span class="p">)</span>
        <span class="n">dataUrl</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Implementation</span><span class="o">.</span><span class="n">Url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">dataPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.correctColours"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.correctColours">[docs]</a>    <span class="k">def</span> <span class="nf">correctColours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Autocorrect all colours that are too close to the background colour</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.guiSettings</span> <span class="kn">import</span> <span class="n">autoCorrectHexColour</span><span class="p">,</span> <span class="n">getColours</span><span class="p">,</span> <span class="n">CCPNGLWIDGET_HEXBACKGROUND</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoCorrectColours</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

            <span class="c1"># change spectrum colours</span>
            <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">spectrum</span><span class="o">.</span><span class="n">positiveContourColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">positiveContourColour</span><span class="p">,</span>
                                                                          <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>
                    <span class="n">spectrum</span><span class="o">.</span><span class="n">negativeContourColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">negativeContourColour</span><span class="p">,</span>
                                                                          <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spectrum</span><span class="o">.</span><span class="n">sliceColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">sliceColour</span><span class="p">,</span>
                                                                <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>

            <span class="c1"># change peakList colours</span>
            <span class="k">for</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">textColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">textColour</span><span class="p">,</span>
                                                          <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span><span class="p">,</span>
                                                            <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>

            <span class="c1"># change integralList colours</span>
            <span class="k">for</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">integralLists</span><span class="p">:</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">textColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">textColour</span><span class="p">,</span>
                                                          <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span><span class="p">,</span>
                                                            <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>

            <span class="c1"># change multipletList colours</span>
            <span class="k">for</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">multipletLists</span><span class="p">:</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">textColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">textColour</span><span class="p">,</span>
                                                          <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>
                <span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">objList</span><span class="o">.</span><span class="n">symbolColour</span><span class="p">,</span>
                                                            <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">marks</span><span class="p">:</span>
                <span class="n">mark</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="n">autoCorrectHexColour</span><span class="p">(</span><span class="n">mark</span><span class="o">.</span><span class="n">colour</span><span class="p">,</span>
                                                   <span class="n">getColours</span><span class="p">()[</span><span class="n">CCPNGLWIDGET_HEXBACKGROUND</span><span class="p">])</span></div>

<div class="viewcode-block" id="Framework.initGraphics"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.initGraphics">[docs]</a>    <span class="k">def</span> <span class="nf">initGraphics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set up graphics system after loading&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib</span> <span class="kn">import</span> <span class="n">GuiStrip</span>

        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">restoreLayoutOnOpening</span><span class="p">:</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getUserLayout</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">layout</span><span class="p">:</span>
                    <span class="n">Layout</span><span class="o">.</span><span class="n">restoreLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">,</span> <span class="n">layout</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Impossible to restore Layout </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

        <span class="c1"># Initialise displays</span>
        <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">windows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>  <span class="c1"># there is exactly one window</span>
            <span class="k">pass</span>  <span class="c1"># GWV: poor solution; removed the routine spectrumDisplay._resetRemoveStripAction()</span>

        <span class="c1"># initialise any colour changes before generating gui strips</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctColours</span><span class="p">()</span>

        <span class="c1"># Initialise strips</span>
        <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
            <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_setupGuiStrip</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">strip</span><span class="o">.</span><span class="n">_wrappedData</span><span class="p">)</span>

            <span class="c1"># if isinstance(strip, GuiStripNd) and not strip.haveSetupZWidgets:</span>
            <span class="c1">#   strip.setZWidgets()</span>

        <span class="c1"># Initialise SpectrumViews</span>
        <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>

            <span class="n">strips</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">orderedStrips</span>
            <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">strip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strips</span><span class="p">):</span>

                <span class="c1"># move to the correct place in the widget</span>
                <span class="n">stripIndex</span> <span class="o">=</span> <span class="n">strips</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">strip</span><span class="p">)</span>
                <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">stripFrame</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">si</span><span class="p">)</span>  <span class="c1">#stripIndex)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">isGrouped</span><span class="p">:</span>

                    <span class="c1"># spectra are not grouped</span>
                    <span class="n">specViews</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span>
                    <span class="c1"># for iSV, spectrumView in enumerate(strip.orderedSpectrumViews(includeDeleted=False)):</span>

                    <span class="k">for</span> <span class="n">iSV</span><span class="p">,</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">orderedSpectrumViews</span><span class="p">(</span><span class="n">specViews</span><span class="p">)):</span>
                        <span class="n">_createdSpectrumView</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">spectrumView</span><span class="p">})</span>
                        <span class="c1"># for peakList in spectrumView.spectrum.peakLists:</span>
                        <span class="c1">#     strip.showPeaks(peakList)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># spectra are grouped</span>
                    <span class="n">specViews</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span>

                    <span class="k">for</span> <span class="n">iSV</span><span class="p">,</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">orderedSpectrumViews</span><span class="p">(</span><span class="n">specViews</span><span class="p">)):</span>
                        <span class="n">_createdSpectrumView</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">spectrumView</span><span class="p">})</span>

                    <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumToolBar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
                    <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumGroupToolBar</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                    <span class="n">_spectrumGroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_getSpectrumGroups</span><span class="p">()]</span>

                    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">_spectrumGroups</span><span class="p">:</span>
                        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumGroupToolBar</span><span class="o">.</span><span class="n">_forceAddAction</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

            <span class="c1"># some of the strips may not be instantiated at this point</span>
            <span class="c1"># resize the stripFrame to the spectrumDisplay - ready for first resize event</span>
            <span class="c1"># spectrumDisplay.stripFrame.resize(spectrumDisplay.width() - 2, spectrumDisplay.stripFrame.height())</span>
            <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">showAxes</span><span class="p">(</span><span class="n">stretchValue</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">minimumWidth</span><span class="o">=</span><span class="n">GuiStrip</span><span class="o">.</span><span class="n">STRIPMINIMUMWIDTH</span><span class="p">)</span>

        <span class="c1">#~~~~~~~~~~~~~~~~</span>
        <span class="c1">#</span>
        <span class="c1"># # Initialise SpectrumDisplays, SpectrumViews</span>
        <span class="c1"># for spectrumDisplay in project.spectrumDisplays:</span>
        <span class="c1">#</span>
        <span class="c1">#   # self.moduleArea.addModule(spectrumDisplay, position=&#39;right&#39;)</span>
        <span class="c1">#   strips = spectrumDisplay.strips</span>
        <span class="c1">#   for strip in strips:</span>
        <span class="c1">#</span>
        <span class="c1">#     # move to the correct place in the widget</span>
        <span class="c1">#     stripIndex = strips.index(strip)</span>
        <span class="c1">#     spectrumDisplay.stripFrame.layout().addWidget(strip, 0, stripIndex)</span>
        <span class="c1">#</span>
        <span class="c1">#     specViews = strip.spectrumViews</span>
        <span class="c1">#     # for iSV, spectrumView in enumerate(spectrumDisplay.orderedSpectrumViews(specViews)):</span>
        <span class="c1">#     for iSV, spectrumView in enumerate(specViews):</span>
        <span class="c1">#</span>
        <span class="c1">#       # set up the Z widgets and add new toolbar button</span>
        <span class="c1">#       spectrumDisplay._createdSpectrumView({Notifier.OBJECT: spectrumView})  #iSV)</span>
        <span class="c1">#</span>
        <span class="c1">#       for peakList in spectrumView.spectrum.peakLists:</span>
        <span class="c1">#         strip.showPeaks(peakList)</span>
        <span class="c1">#</span>
        <span class="c1">#   # some of the strips may no be instantiated at this point</span>
        <span class="c1">#   spectrumDisplay.showAxes()</span>
        <span class="c1">#   spectrumDisplay.setColumnStretches(True)</span>
        <span class="c1">#</span>
        <span class="c1">#~~~~~~~~~~~~~~~~</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Framework.get"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;General method to obtain object (either gui or data) from identifier (pid, gid, obj-string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">identifier</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected str or Pid, got &quot;None&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Pid</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected str or Pid, got &quot;</span><span class="si">%s</span><span class="s1">&quot; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">identifier</span><span class="p">)))</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected str or Pid, got zero-length identifier&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">and</span> <span class="n">identifier</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.getByPid"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getByPid">[docs]</a>    <span class="k">def</span> <span class="nf">getByPid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="s2">&quot;Convenience&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.getByGid"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getByGid">[docs]</a>    <span class="k">def</span> <span class="nf">getByGid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
        <span class="s2">&quot;Convenience&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">getByGid</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span></div>

    <span class="c1"># def _startCommandBlock(self, command: str, quiet: bool = False, **objectParameters):</span>
    <span class="c1">#     &quot;&quot;&quot;Start block for command echoing, set undo waypoint, and echo command to ui and logger</span>
    <span class="c1">#</span>
    <span class="c1">#     MUST be paired with _endCommandBlock call - use try ... finally to ensure both are called</span>
    <span class="c1">#</span>
    <span class="c1">#     Set keyword:value objectParameters to point to the relevant objects in setup commands,</span>
    <span class="c1">#     and pass setup commands and command proper to ui for echoing</span>
    <span class="c1">#</span>
    <span class="c1">#     Example calls:</span>
    <span class="c1">#</span>
    <span class="c1">#     _startCommandBlock(&quot;application.createSpectrumDisplay(spectrum)&quot;, spectrum=spectrumOrPid)</span>
    <span class="c1">#</span>
    <span class="c1">#     _startCommandBlock(</span>
    <span class="c1">#        &quot;newAssignment = peak.assignDimension(axisCode=%s, value=[newNmrAtom]&quot; % axisCode,</span>
    <span class="c1">#        peak=peakOrPid)&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     undo = self.project._undo</span>
    <span class="c1">#     if undo is not None:  # ejb - changed from if undo:</span>
    <span class="c1">#         # set undo step</span>
    <span class="c1">#         undo.newWaypoint()  # DO NOT CHANGE</span>
    <span class="c1">#</span>
    <span class="c1">#         # _blockedSideBar is a project override</span>
    <span class="c1">#         if not self.project._blockSideBar and not undo._blocked:</span>
    <span class="c1">#             if undo._waypointBlockingLevel &lt; 1 and self.ui and self.ui.mainWindow:</span>
    <span class="c1">#                 self.ui.mainWindow.sideBar._saveExpandedState()</span>
    <span class="c1">#</span>
    <span class="c1">#         undo.increaseWaypointBlocking()</span>
    <span class="c1">#</span>
    <span class="c1">#     if not self._echoBlocking:</span>
    <span class="c1">#         self.project.suspendNotification()</span>
    <span class="c1">#</span>
    <span class="c1">#         # Get list of command strings</span>
    <span class="c1">#         commands = []</span>
    <span class="c1">#         for parameter, value in sorted(objectParameters.items()):</span>
    <span class="c1">#             if value is not None:</span>
    <span class="c1">#                 if not isinstance(value, str):</span>
    <span class="c1">#                     value = value.pid</span>
    <span class="c1">#                 commands.append(&quot;%s = project.getByPid(%s)\n&quot; % (parameter, repr(value)))</span>
    <span class="c1">#         commands.append(command)  # ED: newLine NOT needed here</span>
    <span class="c1">#</span>
    <span class="c1">#         # echo command strings</span>
    <span class="c1">#         # added &#39;quiet&#39; mode to keep full functionality to &#39;startCommandEchoBLock&#39;</span>
    <span class="c1">#         # but without the screen output</span>
    <span class="c1">#         if not quiet:</span>
    <span class="c1">#             self.ui.echoCommands(commands)</span>
    <span class="c1">#</span>
    <span class="c1">#     self._increaseNotificationBlocking()</span>
    <span class="c1">#     getLogger().debug2(&#39;command=%s, echoBlocking=%s, undo.blocking=%s&#39;</span>
    <span class="c1">#                        % (command, self._echoBlocking, undo.blocking))</span>

    <span class="c1"># #TODO:TJ: Why is this a private method; it is and should be used all over the code?</span>
    <span class="c1"># def _endCommandBlock(self):</span>
    <span class="c1">#     &quot;&quot;&quot;End block for command echoing,</span>
    <span class="c1">#</span>
    <span class="c1">#     MUST be paired with _startCommandBlock call - use try ... finally to ensure both are called&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     getLogger().debug2(&#39;echoBlocking=%s&#39; % self._echoBlocking)</span>
    <span class="c1">#     undo = self.project._undo</span>
    <span class="c1">#</span>
    <span class="c1">#     # if self._echoBlocking &gt; 0:</span>
    <span class="c1">#     #     self._echoBlocking -= 1</span>
    <span class="c1">#     self._decreaseNotificationBlocking()</span>
    <span class="c1">#</span>
    <span class="c1">#     if not self._echoBlocking:</span>
    <span class="c1">#         self.project.resumeNotification()</span>
    <span class="c1">#</span>
    <span class="c1">#     if undo is not None:  # ejb - changed from if undo:</span>
    <span class="c1">#         undo.decreaseWaypointBlocking()</span>
    <span class="c1">#</span>
    <span class="c1">#         if not self.project._blockSideBar and not undo._blocked:</span>
    <span class="c1">#             if undo._waypointBlockingLevel &lt; 1 and self.ui and self.ui.mainWindow:</span>
    <span class="c1">#                 self.ui.mainWindow.sideBar._restoreExpandedState()</span>
    <span class="c1">#</span>
    <span class="c1">#     # if self._echoBlocking &gt; 0:</span>
    <span class="c1">#     #   # If statement should always be True, but to avoid weird behaviour in error situations we check</span>
    <span class="c1">#     #   self._echoBlocking -= 1</span>
    <span class="c1">#     # # self.project.resumeNotification()</span>

<div class="viewcode-block" id="Framework.addApplicationMenuSpec"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addApplicationMenuSpec">[docs]</a>    <span class="k">def</span> <span class="nf">addApplicationMenuSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an entirely new menu at specified position&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.addApplicationMenuItem"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addApplicationMenuItem">[docs]</a>    <span class="k">def</span> <span class="nf">addApplicationMenuItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menuName</span><span class="p">,</span> <span class="n">menuItem</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new item to an existing menu at specified position&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">menuName</span><span class="p">:</span>
                <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">menuItem</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No menu with name </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">menuName</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.addApplicationMenuItems"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addApplicationMenuItems">[docs]</a>    <span class="k">def</span> <span class="nf">addApplicationMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menuName</span><span class="p">,</span> <span class="n">menuItems</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a new items to an existing menu starting at specified position&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">menuItem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">menuItems</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addApplicationMenuItem</span><span class="p">(</span><span class="n">menuName</span><span class="p">,</span> <span class="n">menuItem</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span></div>

    <span class="c1">#########################################    Create sub dirs   ########################################################</span>

    <span class="c1">## dirs are created with decorators because the project path can change dynamically.</span>
    <span class="c1">##  When a project is saved in a new location, all the dirs get refreshed automatically&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">statePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statePath</span>

    <span class="nd">@statePath.getter</span>
    <span class="k">def</span> <span class="nf">statePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">Layout</span><span class="o">.</span><span class="n">StateDirName</span><span class="p">)</span>

    <span class="nd">@statePath.setter</span>
    <span class="k">def</span> <span class="nf">statePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statePath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pipelinePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipelinePath</span>

    <span class="nd">@pipelinePath.getter</span>
    <span class="k">def</span> <span class="nf">pipelinePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statePath</span><span class="p">,</span> <span class="n">Pipeline</span><span class="o">.</span><span class="n">className</span><span class="p">)</span>

    <span class="nd">@pipelinePath.setter</span>
    <span class="k">def</span> <span class="nf">pipelinePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipelinePath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataPath</span>

    <span class="nd">@dataPath.getter</span>
    <span class="k">def</span> <span class="nf">dataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">DataDirName</span><span class="p">)</span>

    <span class="nd">@dataPath.setter</span>
    <span class="k">def</span> <span class="nf">dataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataPath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spectraPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spectraPath</span>

    <span class="nd">@spectraPath.getter</span>
    <span class="k">def</span> <span class="nf">spectraPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPath</span><span class="p">,</span> <span class="n">SpectraDirName</span><span class="p">)</span>

    <span class="nd">@spectraPath.setter</span>
    <span class="k">def</span> <span class="nf">spectraPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectraPath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pluginDataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pluginDataPath</span>

    <span class="nd">@pluginDataPath.getter</span>
    <span class="k">def</span> <span class="nf">pluginDataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPath</span><span class="p">,</span> <span class="n">PluginDataDirName</span><span class="p">)</span>

    <span class="nd">@pluginDataPath.setter</span>
    <span class="k">def</span> <span class="nf">pluginDataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pluginDataPath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tempMacrosPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempMacrosPath</span>

    <span class="nd">@tempMacrosPath.getter</span>
    <span class="k">def</span> <span class="nf">tempMacrosPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="n">userPreferencesDirectory</span><span class="p">,</span> <span class="n">MacrosDirName</span><span class="p">)</span>

    <span class="nd">@tempMacrosPath.setter</span>
    <span class="k">def</span> <span class="nf">tempMacrosPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempMacrosPath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scriptsPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scriptsPath</span>

    <span class="nd">@scriptsPath.getter</span>
    <span class="k">def</span> <span class="nf">scriptsPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">fetchDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">ScriptsDirName</span><span class="p">)</span>

    <span class="nd">@scriptsPath.setter</span>
    <span class="k">def</span> <span class="nf">scriptsPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scriptsPath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="c1">#########################################    Start setup Menus      ############################</span>

    <span class="k">def</span> <span class="nf">_updateCheckableMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This has to be kept in sync with menu items below which are checkable,</span>
        <span class="c1"># and also with MODULE_DICT keys</span>
        <span class="c1"># The code is terrible because Qt has no easy way to get hold of menus / actions</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="n">mainWindow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># We have a UI with no mainWindow - nothing to do.</span>
            <span class="k">return</span>

        <span class="n">topMenu</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">topActionDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">topAction</span> <span class="ow">in</span> <span class="n">topMenu</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
            <span class="n">mainActionDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">mainAction</span> <span class="ow">in</span> <span class="n">topAction</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
                <span class="n">mainActionDict</span><span class="p">[</span><span class="n">mainAction</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">mainAction</span>
            <span class="n">topActionDict</span><span class="p">[</span><span class="n">topAction</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">mainActionDict</span>

        <span class="n">openModuleKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">topActionText</span><span class="p">,</span> <span class="n">mainActionText</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;SEQUENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;Molecules&#39;</span><span class="p">,</span> <span class="s1">&#39;Show Sequence&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s1">&#39;PYTHON CONSOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;Python Console&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">openModuleKeys</span><span class="p">:</span>
                <span class="n">mainActionDict</span> <span class="o">=</span> <span class="n">topActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topActionText</span><span class="p">)</span>  <span class="c1"># should always exist but play safe</span>
                <span class="k">if</span> <span class="n">mainActionDict</span><span class="p">:</span>
                    <span class="n">mainAction</span> <span class="o">=</span> <span class="n">mainActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mainActionText</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mainAction</span><span class="p">:</span>
                        <span class="n">mainAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.setupMenus"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.setupMenus">[docs]</a>    <span class="k">def</span> <span class="nf">setupMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup the menu specification.</span>

<span class="sd">        The menus are specified by a list of lists (actually, an iterable of iterables, but the term</span>
<span class="sd">        ‘list’ will be used here to mean any iterable).  Framework provides 7 menus: Project, Spectrum,</span>
<span class="sd">        Molecules, View, Macro, Plugins, Help.  If you want to create your own menu in a subclass of</span>
<span class="sd">        Framework, you need to create a list in the style described below, then call</span>
<span class="sd">        self.addApplicationMenuSpec and pass in your menu specification list.</span>

<span class="sd">        Menu specification lists are composed of two items, the first being a string which is the menu’s</span>
<span class="sd">        title, the second is a list of sub-menu items.  Each item can be zero, two or three items long.</span>
<span class="sd">        A zero-length list indicates a separator.  If the list is length two and the second item is a</span>
<span class="sd">        list, then it specifies a sub-menu in a recursive manner.  If the list is length two and the</span>
<span class="sd">        second item is callable, it specifies a menu action with the first item specifying the label</span>
<span class="sd">        and the second the callable that is triggered when the menu item is selected.  If the list is</span>
<span class="sd">        length three, it is treated as a menu item specification, with the third item a list of keyword,</span>
<span class="sd">        value pairs.</span>

<span class="sd">        The examples below may make this more clear…</span>

<span class="sd">        Create a menu called ‘Test’ with two items and a separator:</span>

<span class="sd">        | - Test</span>
<span class="sd">        |   | - Item One</span>
<span class="sd">        |   | - ------</span>
<span class="sd">        |   | - Item Two</span>

<span class="sd">        Where clicking on ‘Item One’ calls method self.itemOneMethod and clicking on ‘Item Two’</span>
<span class="sd">        calls self.itemTwoMethod</span>

<span class="sd">        |    def setupMenus(self):</span>
<span class="sd">        |      menuSpec = (‘Test’, [(‘Item One’, self.itemOneMethod),</span>
<span class="sd">        |                           (),</span>
<span class="sd">        |                           (‘Item Two’, self.itemTwoMethod),</span>
<span class="sd">        |                          ]</span>
<span class="sd">        |      self.addApplicationMenuSpec(menuSpec)</span>



<span class="sd">        More complicated menus are possible.  For example, to create the following menu</span>

<span class="sd">        | - Test</span>
<span class="sd">        |   | - Item A     ia</span>
<span class="sd">        |   | - ------</span>
<span class="sd">        |   | - Submenu B</span>
<span class="sd">        |      | - Item B1</span>
<span class="sd">        |      | - Item B2</span>
<span class="sd">        |   | - Item C     id</span>

<span class="sd">        where Item A can be activated using the two-key shortcut ‘ia’,</span>
<span class="sd">        Submenu B contains two static menu items, B1 and B2</span>
<span class="sd">        Submenu item B2 is checkable, but not checked by default</span>
<span class="sd">        Item C is disabled by default and has a shortcut of ‘ic’</span>

<span class="sd">        |   def setupMenus(self):</span>
<span class="sd">        |     subMenuSpecB = [(‘Item B1’, self.itemB1),</span>
<span class="sd">        |                     (‘Item B2’, self.itemB2, [(‘checkable’, True),</span>
<span class="sd">        |                                               (‘checked’, False)])</span>
<span class="sd">        |                    ]</span>
<span class="sd">        |</span>
<span class="sd">        |     menuSpec = (‘Test’, [(‘Item A’, self.itemA, [(‘shortcut’, ‘ia’)]),</span>
<span class="sd">        |                          (),</span>
<span class="sd">        |                          (‘Submenu B’, subMenuB),</span>
<span class="sd">        |                          (‘Item C’, self.itemA, [(‘shortcut’, ‘ic’),</span>
<span class="sd">        |                                                  (‘enabled’, False)]),</span>
<span class="sd">        |                         ]</span>
<span class="sd">        |     self.addApplicationMenuSpec(menuSpec)</span>


<span class="sd">        If we’re using the PyQt GUI, we can get the Qt action representing Item B2 somewhere in our code</span>
<span class="sd">        (for example, to change the checked status,) via:</span>

<span class="sd">        |   action = application.ui.mainWindow.getMenuAction(‘Test-&gt;Submenu B-&gt;Item B2’)</span>
<span class="sd">        |   action.setChecked(True)</span>

<span class="sd">        To see how to add items dynamically, see clearRecentProjects in this class and</span>
<span class="sd">        _fillRecentProjectsMenu in GuiMainWindow</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;New&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createNewProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃n&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">(</span><span class="s2">&quot;Open...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃o&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">(</span><span class="s2">&quot;Open Recent&quot;</span><span class="p">,</span> <span class="p">()),</span>

            <span class="c1">#      (&quot;Load Spectrum...&quot;, lambda: self.loadData(text=&#39;Load Spectrum&#39;), [(&#39;shortcut&#39;, &#39;ls&#39;)]),</span>
            <span class="p">(</span><span class="s2">&quot;Load Data...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ld&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃s&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">(</span><span class="s2">&quot;Save As...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sa&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;NEF&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s2">&quot;Import Nef File&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_importNef</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)]),</span>
                     <span class="p">(</span><span class="s2">&quot;Export Nef File&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exportNEF</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ex&#39;</span><span class="p">)])</span>
                     <span class="p">)),</span>
            <span class="p">(),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Layout&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveLayout</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
                        <span class="p">(</span><span class="s2">&quot;Save as...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveLayoutAs</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
                        <span class="p">(</span><span class="s2">&quot;Restore last&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreLastSavedLayout</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
                        <span class="p">(</span><span class="s2">&quot;Restore from file...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreLayoutFromFile</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
                        <span class="p">(),</span>
                        <span class="p">(</span><span class="s2">&quot;Open pre-defined...&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>

                        <span class="p">)),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Undo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃z&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">(</span><span class="s2">&quot;Redo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redo</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃y&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Summary&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayProjectSummary</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Archive&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">archiveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Restore From Archive...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreFromArchive</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Preferences...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showApplicationPreferences</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃,&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Quit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closeEvent</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃q&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="p">]</span>
                   <span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Load Spectrum...&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadDataFromMenu</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load Spectrum&#39;</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ls&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Spectrum Groups...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSpectrumGroupsPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ss&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Set Experiment Types...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showExperimentTypePopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;et&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Validate Paths...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showValidateSpectraPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;vp&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Pick Peaks&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s2">&quot;Pick 1D Peaks...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakPick1DPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;p1&#39;</span><span class="p">)]),</span>
                            <span class="p">(</span><span class="s2">&quot;Pick ND Peaks...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakPickNDPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)])</span>
                            <span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;Copy PeakList...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCopyPeakListPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;cl&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Copy Peaks...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCopyPeaks</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Make Strip Plot...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeStripPlotPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sp&#39;</span><span class="p">)]),</span>

            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Make Projection...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showProjectionPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pj&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Print to File...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPrintSpectrumDisplayPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃p&#39;</span><span class="p">)]),</span>
            <span class="p">]</span>
                   <span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Molecules&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Chain from FASTA...&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadDataFromMenu</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load FASTA&#39;</span><span class="p">)),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Generate Chain...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCreateChainPopup</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Inspect...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspectMolecule</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Residue Information&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showResidueInformation</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ri&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Reference Chemical Shifts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showRefChemicalShifts</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rc&#39;</span><span class="p">)]),</span>
            <span class="p">]</span>
                   <span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Chemical Shift Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showChemicalShiftTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ct&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;NmrResidue Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showNmrResidueTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;nt&#39;</span><span class="p">)]),</span>
            <span class="c1"># (&quot;Structure Table&quot;, partial(self.showStructureTable, selectFirstItem=True), [(&#39;shortcut&#39;, &#39;st&#39;)]),</span>
            <span class="p">(</span><span class="s2">&quot;Residue Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showResidueTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;Peak Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showPeakTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;lt&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Integral Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showIntegralTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;it&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Multiplet Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showMultipletTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;mt&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Restraint Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showRestraintTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Structure Table&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showStructureTable</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;st&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Chemical Shift Mapping&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showChemicalShiftMapping</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Notes Editor&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showNotesEditor</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">)]),</span>
            <span class="p">(),</span>
            <span class="c1"># (),</span>
            <span class="c1">###(&quot;Sequence Graph&quot;, self.showSequenceGraph, [(&#39;shortcut&#39;, &#39;sg&#39;)]),</span>
            <span class="c1">###(&quot;Atom Selector&quot;, self.showAtomSelector, [(&#39;shortcut&#39;, &#39;as&#39;)]),</span>
            <span class="c1">###(),</span>

            <span class="c1"># sequenceModule has been incorporated into sequence graph</span>
            <span class="c1"># (&quot;Show Sequence&quot;, self.toggleSequenceModule, [(&#39;shortcut&#39;, &#39;sq&#39;),</span>
            <span class="c1">#                                               (&#39;checkable&#39;, True),</span>
            <span class="c1">#                                               (&#39;checked&#39;, False)</span>
            <span class="c1">#                                               ]),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s2">&quot;Show/Hide Toolbar&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleToolbar</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;tb&#39;</span><span class="p">)]),</span>
                         <span class="p">(</span><span class="s2">&quot;Show/Hide Phasing Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pc&#39;</span><span class="p">)]),</span>
                         <span class="p">(),</span>
                         <span class="p">(</span><span class="s2">&quot;Set Zoom...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setZoomPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sz&#39;</span><span class="p">)]),</span>
                         <span class="p">(</span><span class="s2">&quot;Reset Zoom&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">)]),</span>
                         <span class="p">(),</span>
                         <span class="p">(</span><span class="s2">&quot;New SpectrumDisplay with strip&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyStrip</span><span class="p">,</span> <span class="p">[]),</span>
                         <span class="p">(</span><span class="s2">&quot;Flip X-Y Axis&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipXYAxis</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">)]),</span>
                         <span class="p">(</span><span class="s2">&quot;Flip X-Z Axis&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipXZAxis</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;xz&#39;</span><span class="p">)]),</span>
                         <span class="p">(</span><span class="s2">&quot;Flip Y-Z Axis&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipYZAxis</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;yz&#39;</span><span class="p">)])</span>
                         <span class="p">)),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Show/hide Modules&quot;</span><span class="p">,</span> <span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span>
                <span class="p">])),</span>
            <span class="p">(</span><span class="s2">&quot;Python Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toggleConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span>
            <span class="p">]</span>
                   <span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Macro&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;New Macro Editor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showMacroEditor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;New from Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newMacroFromConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>  <span class="c1">#Not available yet</span>
            <span class="p">(</span><span class="s2">&quot;New from Log&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>  <span class="c1">#Not available yet</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Open...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openMacroOnEditor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Run...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Run Recent&quot;</span><span class="p">,</span> <span class="p">()),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Define User Shortcuts...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defineUserShortcuts</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;du&#39;</span><span class="p">)])</span>
            <span class="p">]</span>
                   <span class="p">))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Plugins&#39;</span><span class="p">,</span> <span class="p">()))</span>

        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Help&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Tutorials&quot;</span><span class="p">,</span> <span class="p">([</span>
                <span class="c1"># Submenu</span>
                <span class="p">(</span><span class="s2">&quot;Beginners Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBeginnersTutorial</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Backbone Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBackboneTutorial</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;CSP Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCSPtutorial</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;More...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showTutorials</span><span class="p">)</span>
                <span class="p">])),</span>
            <span class="p">(</span><span class="s2">&quot;Show Shortcuts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showShortcuts</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Show CcpNmr V3 Documentation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showVersion3Documentation</span><span class="p">),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;About CcpNmr V3...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutPopup</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;About CCPN...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutCcpn</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Show License...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCcpnLicense</span><span class="p">),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Inspect Code...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCodeInspectionPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;gv&#39;</span><span class="p">),</span>
                                                               <span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;Show Issues...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showIssuesList</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Check for Updates...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showUpdatePopup</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Register...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showRegisterPopup</span><span class="p">),</span>
            <span class="p">(),</span>
            <span class="p">(</span><span class="s2">&quot;Submit Feedback...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFeedbackPopup</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Submit Macro...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSubmitMacroPopup</span><span class="p">)</span>
            <span class="p">]</span>
                   <span class="p">))</span></div>

    <span class="c1">###################################################################################################################</span>
    <span class="c1">## These will eventually move to gui (probably via a set of lambda functions.</span>
    <span class="c1">###################################################################################################################</span>
    <span class="c1">###################################################################################################################</span>
    <span class="c1">## MENU callbacks:  Project</span>
    <span class="c1">###################################################################################################################</span>

    <span class="k">def</span> <span class="nf">_loadDataFromMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call loadData from the menu and trap errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isInDebugMode</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">es</span>

<div class="viewcode-block" id="Framework.createNewProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.createNewProject">[docs]</a>    <span class="k">def</span> <span class="nf">createNewProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Callback for creating new project&quot;</span>
        <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error creating new project:&#39;</span><span class="p">):</span>
            <span class="n">okToContinue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_queryCloseProject</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;New Project&#39;</span><span class="p">,</span>
                                                                 <span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;create a new&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">okToContinue</span><span class="p">:</span>
                <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to create new project&#39;</span><span class="p">)</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_mainWindow</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setActiveWindow</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.newProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newProject">[docs]</a>    <span class="k">def</span> <span class="nf">newProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new, empty project; return Project instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># NB _closeProject includes a gui cleanup call</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>

        <span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Creating new, empty project</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">newName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[^0-9a-zA-Z]+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newName</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Removing whitespace from name: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">newName</span><span class="p">,</span> <span class="n">useFileLogger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="n">project</span><span class="o">.</span><span class="n">_isNew</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Needs to know this for restoring the GuiSpectrum Module. Could be removed after decoupling Gui and Data!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">project</span></div>

<div class="viewcode-block" id="Framework.openProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.openProject">[docs]</a>    <span class="k">def</span> <span class="nf">openProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectDir</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_mainWindow</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setActiveWindow</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error opening project:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">project</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="Framework.loadProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadProject">[docs]</a>    <span class="k">def</span> <span class="nf">loadProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           Load project from path</span>
<span class="sd">           If not path then opens a file dialog box and loads project from selected file.</span>

<span class="sd">           ReturnsProject instance or None on error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load Project&#39;</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="n">dataType</span><span class="p">,</span> <span class="n">subType</span><span class="p">,</span> <span class="n">usePath</span> <span class="o">=</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">analyseUrl</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataType</span> <span class="o">==</span> <span class="s1">&#39;Project&#39;</span> <span class="ow">and</span> <span class="n">subType</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ioFormats</span><span class="o">.</span><span class="n">CCPN</span><span class="p">,</span>
                                                 <span class="n">ioFormats</span><span class="o">.</span><span class="n">NEF</span><span class="p">,</span>
                                                 <span class="n">ioFormats</span><span class="o">.</span><span class="n">NMRSTAR</span><span class="p">,</span>
                                                 <span class="n">ioFormats</span><span class="o">.</span><span class="n">SPARKY</span><span class="p">):</span>

            <span class="c1"># if subType != ioFormats.NEF:    # ejb - only reset project for CCPN files</span>
            <span class="c1">#   if self.project is not None:</span>
            <span class="c1">#     self._closeProject()</span>

            <span class="k">if</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">CCPN</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># always close for Ccpn</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
                <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">useFileLogger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">NEF</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> NEF project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
                <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadNefFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># RHF - new by default</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">NMRSTAR</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> NMRStar project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
                <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadNMRStarFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># RHF - new by default</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">SPARKY</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> Sparky project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
                <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadSparkyProject</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># RHF - new by default</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">DEBUG2</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">project</span>

        <span class="c1"># elif dataType == &#39;NefFile&#39; and subType in (ioFormats.NEF):</span>
        <span class="c1"># # ejb - testing - 24/6/17 hopefully this will insert into project</span>
        <span class="c1"># #                 is caught by the test above</span>
        <span class="c1"># #                 need to deciode whether it is a &#39;project&#39; or &#39;NefFile&#39; load</span>
        <span class="c1">#</span>
        <span class="c1">#   sys.stderr.write(&#39;==&gt; Loading %s NefFile &quot;%s&quot;\n&#39; % (subType, path))</span>
        <span class="c1">#   project = self._loadNefFile(path, makeNewProject=False)</span>
        <span class="c1">#   project._resetUndo(debug=_DEBUG)</span>
        <span class="c1">#</span>
        <span class="c1">#   return project</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Could not recognise &quot;</span><span class="si">%s</span><span class="s1">&quot; as a project; loading into default project</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span></div>

    <span class="k">def</span> <span class="nf">_loadNefFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load Project from NEF file at path, and do necessary setup&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">undoBlock</span><span class="p">,</span> <span class="n">notificationEchoBlocking</span>

        <span class="n">dataBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">getNefData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">makeNewProject</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">dataBlock</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># with suspendSideBarNotifications(project=self.project):</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">notificationEchoBlocking</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error loading Nef file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">importNewProject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">dataBlock</span><span class="p">)</span>
                <span class="c1"># try:</span>
                <span class="c1">#     self.nefReader.importNewProject(self.project, dataBlock)</span>
                <span class="c1"># except Exception as es:</span>
                <span class="c1">#     getLogger().warning(&#39;Error loading Nef file: %s&#39; % str(es))</span>
                <span class="c1">#     if self._isInDebugMode:</span>
                <span class="c1">#         raise es</span>
                <span class="c1"># # finally:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;==&gt; Loaded NEF file: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

    <span class="k">def</span> <span class="nf">_loadNMRStarFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load Project from NEF file at path, and do necessary setup&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">undoBlock</span><span class="p">,</span> <span class="n">notificationEchoBlocking</span>

        <span class="n">dataBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">getNMRStarData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">makeNewProject</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">dataBlock</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># with suspendSideBarNotifications(project=self.project):</span>
        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">notificationEchoBlocking</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error loading NMRStar file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">importNewProject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">dataBlock</span><span class="p">)</span>

        <span class="c1"># with undoBlock():</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         self.nefReader.importNewNMRStarProject(self.project, dataBlock)</span>
        <span class="c1">#     except Exception as es:</span>
        <span class="c1">#         getLogger().warning(&#39;Error loading NMRStar file: %s&#39; % str(es))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;==&gt; Loaded NmrStar file: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

    <span class="k">def</span> <span class="nf">_loadSparkyProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load Project from Sparky file at path, and do necessary setup&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">undoBlock</span><span class="p">,</span> <span class="n">notificationEchoBlocking</span>

        <span class="c1"># read data files</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.lib.CcpnSparkyIo</span> <span class="kn">import</span> <span class="n">SPARKY_NAME</span>

        <span class="n">dataBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparkyReader</span><span class="o">.</span><span class="n">parseSparkyFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sparkyName</span> <span class="o">=</span> <span class="n">dataBlock</span><span class="o">.</span><span class="n">getDataValues</span><span class="p">(</span><span class="n">SPARKY_NAME</span><span class="p">,</span> <span class="n">firstOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">makeNewProject</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dataBlock</span><span class="o">.</span><span class="n">getDataValues</span><span class="p">(</span><span class="s1">&#39;sparky&#39;</span><span class="p">,</span> <span class="n">firstOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;project file&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">sparkyName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># with suspendSideBarNotifications(project=self.project):</span>
        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">notificationEchoBlocking</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error loading Sparky file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sparkyReader</span><span class="o">.</span><span class="n">importSparkyProject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">dataBlock</span><span class="p">)</span>

        <span class="c1"># with undoBlock():</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         # insert file into project</span>
        <span class="c1">#</span>
        <span class="c1">#         self.sparkyReader.importSparkyProject(self.project, dataBlock)</span>
        <span class="c1">#         sys.stderr.write(&#39;==&gt; Loaded Sparky project files: &quot;%s&quot;, building project\n&#39; % (path,))</span>
        <span class="c1">#     except Exception as es:</span>
        <span class="c1">#         getLogger().warning(&#39;Error loading Sparky file: %s&#39; % str(es))</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;==&gt; Loaded Sparky project files: &quot;</span><span class="si">%s</span><span class="s1">&quot;, building project&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

<div class="viewcode-block" id="Framework.clearRecentProjects"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentProjects">[docs]</a>    <span class="k">def</span> <span class="nf">clearRecentProjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.clearRecentMacros"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentMacros">[docs]</a>    <span class="k">def</span> <span class="nf">clearRecentMacros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentMacrosMenu</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.loadData"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadData">[docs]</a>    <span class="k">def</span> <span class="nf">loadData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a file dialog box and loads data from selected file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Load Data&#39;</span>

        <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1">#TODO:LIST-AS-ISSUE: This fails for native file dialogs on OSX when trying to select a project (i.e. a directory)</span>
            <span class="c1"># NBNB TBD I assume here that path is either a string or a list lf string paths.</span>
            <span class="c1"># NBNB #FIXME if incorrect</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_cloneSpectraToProjectDir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Keep a copy of spectra inside the project directory &quot;myproject.ccpn/data/spectra&quot;.</span>
<span class="sd">        This is useful when saving the project in an external driver and want to keep the spectra together with the project.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
                <span class="n">oldPath</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">filePath</span>
                <span class="c1"># For Bruker need to keep all the tree structure.</span>
                <span class="c1"># Uses the fact that there is a folder called &quot;pdata&quot; and start to copy from the dir before.</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">oldPath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;pdata&#39;</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
                    <span class="n">brukerDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="o">*</span><span class="n">ss</span><span class="p">[:</span><span class="n">ss</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;pdata&#39;</span><span class="p">)])</span>
                    <span class="n">brukerName</span> <span class="o">=</span> <span class="n">brukerDir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span><span class="p">,</span> <span class="n">brukerName</span><span class="p">))</span>
                    <span class="n">destinationPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span><span class="p">,</span> <span class="n">brukerName</span><span class="p">)</span>
                    <span class="n">copy_tree</span><span class="p">(</span><span class="n">brukerDir</span><span class="p">,</span> <span class="n">destinationPath</span><span class="p">)</span>
                    <span class="n">clonedPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destinationPath</span><span class="p">,</span> <span class="o">*</span><span class="n">ss</span><span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;pdata&#39;</span><span class="p">):])</span>
                    <span class="c1"># needs to repoint the path but doesn&#39;t seem to work!! troubles with $INSIDE!!</span>
                    <span class="c1"># spectrum.filePath = clonedPath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># copy the file and or other files containing params</span>
                    <span class="kn">from</span> <span class="nn">ntpath</span> <span class="kn">import</span> <span class="n">basename</span>

                    <span class="n">pathWithoutFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="o">*</span><span class="n">ss</span><span class="p">[:</span><span class="n">ss</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">oldPath</span><span class="p">))])</span>
                    <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pathWithoutFileName</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">oldPath</span><span class="p">))</span>
                    <span class="kn">import</span> <span class="nn">glob</span>

                    <span class="n">otherFilesWithSameName</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fullpath</span> <span class="o">+</span> <span class="s2">&quot;.*&quot;</span><span class="p">)</span>
                    <span class="n">clonedPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">oldPath</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">otherFileTocopy</span> <span class="ow">in</span> <span class="n">otherFilesWithSameName</span><span class="p">:</span>
                        <span class="n">otherFilePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectraPath</span><span class="p">,</span> <span class="n">basename</span><span class="p">(</span><span class="n">otherFileTocopy</span><span class="p">))</span>
                        <span class="n">copyfile</span><span class="p">(</span><span class="n">otherFileTocopy</span><span class="p">,</span> <span class="n">otherFilePath</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">oldPath</span> <span class="o">!=</span> <span class="n">clonedPath</span><span class="p">:</span>
                        <span class="n">copyfile</span><span class="p">(</span><span class="n">oldPath</span><span class="p">,</span> <span class="n">clonedPath</span><span class="p">)</span>
                        <span class="c1"># needs to repoint the path but doesn&#39;t seem to work!! troubles with $INSIDE!!</span>
                        <span class="c1"># spectrum.filePath = clonedPath</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_saveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteExisting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save project to newPath and return True if successful&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">keepSpectraInsideProject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cloneSpectraToProjectDir</span><span class="p">()</span>

        <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="n">createFallback</span><span class="p">,</span>
                                       <span class="n">overwriteExisting</span><span class="o">=</span><span class="n">overwriteExisting</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
            <span class="n">failMessage</span> <span class="o">=</span> <span class="s1">&#39;==&gt; Project save failed</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">failMessage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">failMessage</span><span class="p">)</span>
            <span class="c1"># NBNB TODO Gui should pre-check newPath and/or pop up something in case of failure</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">successMessage</span> <span class="o">=</span> <span class="s1">&#39;==&gt; Project successfully saved</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_updateWindowTitle</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">successMessage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Archive&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>
            <span class="c1"># self._createApplicationPaths()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">_dumpStateToFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statePath</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoSaveLayoutOnQuit</span><span class="p">:</span>
                    <span class="n">Layout</span><span class="o">.</span><span class="n">saveLayoutToJson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Impossible to save Layout </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

            <span class="c1"># saveIconPath = os.path.join(Path.getPathToImport(&#39;ccpn.ui.gui.widgets&#39;), &#39;icons&#39;, &#39;save.png&#39;)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">successMessage</span><span class="p">)</span>
            <span class="c1"># MessageDialog.showMessage(&#39;Project saved&#39;, &#39;Project successfully saved!&#39;,</span>
            <span class="c1">#                            iconPath=saveIconPath)</span>

        <span class="k">return</span> <span class="n">successful</span>

    <span class="k">def</span> <span class="nf">_importNef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TODO:ED add import routine here, dangerous so add warnings</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showOkCancelWarning</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;Importing Nef file will merge the Nef file with&#39;</span>
                                               <span class="s1">&#39; the current project. This can cause conflicts with&#39;</span>
                                               <span class="s1">&#39; existing objects. USE WITH CAUTION&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Import Nef File into Project&#39;</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s1">&#39;*.nef&#39;</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="k">with</span> <span class="n">catchExceptions</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">errorStringTemplate</span><span class="o">=</span><span class="s1">&#39;Error Importing Nef File: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_loadNefFile</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">makeNewProject</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="c1"># try:</span>
            <span class="c1">#     for path in paths:</span>
            <span class="c1">#         self._loadNefFile(path=path, makeNewProject=False)</span>
            <span class="c1"># except Exception as es:</span>
            <span class="c1">#     getLogger().warning(&#39;Error Importing Nef File: %s&#39; % str(es))</span>
            <span class="c1">#     if self._isInDebugMode:</span>
            <span class="c1">#         raise es</span>

    <span class="k">def</span> <span class="nf">_exportNEF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the current project as a Nef file</span>
<span class="sd">        Temporary routine because I don&#39;t know how else to do it yet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ExportNefPopup</span> <span class="kn">import</span> <span class="n">ExportNefPopup</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ExportNefPopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span>
                                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Export to Nef File&quot;</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">,</span>
                                <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                                <span class="n">selectFile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.nef&#39;</span><span class="p">,</span>  <span class="c1"># new flag to populate dialog,</span>
                                <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.nef&#39;</span><span class="p">)</span>

        <span class="c1"># an exclusion list comes out of the dialog as it</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">nefPath</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">]</span>
        <span class="n">pidList</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;pidList&#39;</span><span class="p">]</span>

        <span class="c1"># flags are skipPrefixes, expandSelection</span>
        <span class="n">skipPrefixes</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="s1">&#39;skipPrefixes&#39;</span><span class="p">]</span>
        <span class="n">expandSelection</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[</span><span class="s1">&#39;expandSelection&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">exportNef</span><span class="p">(</span><span class="n">nefPath</span><span class="p">,</span>
                               <span class="n">overwriteExisting</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">skipPrefixes</span><span class="o">=</span><span class="n">skipPrefixes</span><span class="p">,</span>
                               <span class="n">expandSelection</span><span class="o">=</span><span class="n">expandSelection</span><span class="p">,</span>
                               <span class="n">pidList</span><span class="o">=</span><span class="n">pidList</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.saveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProject">[docs]</a>    <span class="k">def</span> <span class="nf">saveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteExisting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save project to newPath and return True if successful&quot;&quot;&quot;</span>
        <span class="c1"># TODO: convert this to a save and call self.project.save()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveProject</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="n">createFallback</span><span class="p">,</span>
                                     <span class="n">overwriteExisting</span><span class="o">=</span><span class="n">overwriteExisting</span><span class="p">)</span></div>

    <span class="c1"># GWV: This routine should not be used as it calls the graphics mainWindow routine</span>
    <span class="c1"># Instead: The graphics part now calls _getRecentFiles</span>
    <span class="c1">#</span>
    <span class="c1"># def _updateRecentFiles(self, oldPath=None):</span>
    <span class="c1">#   project = self.project</span>
    <span class="c1">#   path = project.path</span>
    <span class="c1">#   recentFiles = self.preferences.recentFiles</span>
    <span class="c1">#   mainWindow = self.ui.mainWindow or self._mainWindow</span>
    <span class="c1">#</span>
    <span class="c1">#   if not hasattr(project._wrappedData.root, &#39;_temporaryDirectory&#39;):</span>
    <span class="c1">#     if path in recentFiles:</span>
    <span class="c1">#       recentFiles.remove(path)</span>
    <span class="c1">#     elif oldPath in recentFiles:</span>
    <span class="c1">#       recentFiles.remove(oldPath)</span>
    <span class="c1">#     elif len(recentFiles) &gt;= 10:</span>
    <span class="c1">#       recentFiles.pop()</span>
    <span class="c1">#     recentFiles.insert(0, path)</span>
    <span class="c1">#   recentFiles = uniquify(recentFiles)</span>
    <span class="c1">#   mainWindow._fillRecentProjectsMenu()</span>
    <span class="c1">#   self.preferences.recentFiles = recentFiles</span>

    <span class="k">def</span> <span class="nf">_getRecentFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldPath</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get and return a list of recent files, setting reference to</span>
<span class="sd">           self as first element, unless it is a temp project</span>
<span class="sd">           update the preferences with the new list</span>

<span class="sd">           CCPN INTERNAL: called by MainWindow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">path</span>
        <span class="n">recentFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span>

        <span class="c1">#TODO:RASMUS: replace by new function on project: isTemporary()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">recentFiles</span><span class="p">:</span>
                <span class="n">recentFiles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">oldPath</span> <span class="ow">in</span> <span class="n">recentFiles</span><span class="p">:</span>
                <span class="n">recentFiles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recentFiles</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">recentFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">recentFiles</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">recentFiles</span> <span class="o">=</span> <span class="n">uniquify</span><span class="p">(</span><span class="n">recentFiles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="n">recentFiles</span>
        <span class="k">return</span> <span class="n">recentFiles</span>

<div class="viewcode-block" id="Framework.saveProjectAs"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProjectAs">[docs]</a>    <span class="k">def</span> <span class="nf">saveProjectAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and saves project to path specified in the file dialog.&quot;&quot;&quot;</span>
        <span class="n">oldPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">getSaveDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>
            <span class="c1"># Next line unnecessary, but does not hurt</span>
            <span class="n">newProjectPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveProject</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newProjectPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Saving project to </span><span class="si">%s</span><span class="s2"> aborted&quot;</span> <span class="o">%</span> <span class="n">newProjectPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Project not saved - no valid destination selected&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_getRecentFiles</span><span class="p">(</span><span class="n">oldPath</span><span class="o">=</span><span class="n">oldPath</span><span class="p">)</span>  <span class="c1"># this will also update the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>  <span class="c1"># Update the menu</span>

        <span class="k">return</span> <span class="n">successful</span></div>

        <span class="c1"># NBNB TODO Consider appropriate failure handling. Is this OK?</span>

    <span class="nd">@logCommand</span><span class="p">(</span><span class="s1">&#39;application.&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.undo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.undo">[docs]</a>    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">canUndo</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">progressManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="s1">&#39;performing undo&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;nothing to undo&#39;</span><span class="p">)</span></div>

    <span class="nd">@logCommand</span><span class="p">(</span><span class="s1">&#39;application.&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.redo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.redo">[docs]</a>    <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">canRedo</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">progressManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="s1">&#39;performing redo&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;nothing to redo.&#39;</span><span class="p">)</span></div>

    <span class="c1"># def undo(self):</span>
    <span class="c1">#     if self.project._undo.canUndo():</span>
    <span class="c1">#         with MessageDialog.progressManager(self.ui.mainWindow, &#39;performing Undo&#39;):</span>
    <span class="c1">#</span>
    <span class="c1">#             self.ui.echoCommands([&#39;application.undo()&#39;])</span>
    <span class="c1">#             self._echoBlocking += 1</span>
    <span class="c1">#</span>
    <span class="c1">#             self.ui.mainWindow.sideBar._saveExpandedState()</span>
    <span class="c1">#             self.project._undo.undo()</span>
    <span class="c1">#             self.ui.mainWindow.sideBar._restoreExpandedState()</span>
    <span class="c1">#</span>
    <span class="c1">#             # TODO:ED this is a hack until guiNotifiers are working</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 self.ui.mainWindow.moduleArea.repopulateModules()</span>
    <span class="c1">#             except:</span>
    <span class="c1">#                 getLogger().info(&#39;application has no Gui&#39;)</span>
    <span class="c1">#</span>
    <span class="c1">#             self._echoBlocking -= 1</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         getLogger().warning(&#39;nothing to undo&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># def redo(self):</span>
    <span class="c1">#     if self.project._undo.canRedo():</span>
    <span class="c1">#         with MessageDialog.progressManager(self.ui.mainWindow, &#39;performing Redo&#39;):</span>
    <span class="c1">#             self.ui.echoCommands([&#39;application.redo()&#39;])</span>
    <span class="c1">#             self._echoBlocking += 1</span>
    <span class="c1">#</span>
    <span class="c1">#             self.ui.mainWindow.sideBar._saveExpandedState()</span>
    <span class="c1">#             self.project._undo.redo()</span>
    <span class="c1">#             self.ui.mainWindow.sideBar._restoreExpandedState()</span>
    <span class="c1">#</span>
    <span class="c1">#             # TODO:ED this is a hack until guiNotifiers are working</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 self.ui.mainWindow.moduleArea.repopulateModules()</span>
    <span class="c1">#             except:</span>
    <span class="c1">#                 getLogger().info(&#39;application has no Gui&#39;)</span>
    <span class="c1">#</span>
    <span class="c1">#             self._echoBlocking -= 1</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         getLogger().warning(&#39;nothing to redo.&#39;)</span>

    <span class="k">def</span> <span class="nf">_getUndo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error: undefined project&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_increaseNotificationBlocking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_decreaseNotificationBlocking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error: decreaseNotificationBlocking, already at 0&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.saveLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveLogFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.clearLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearLogFile">[docs]</a>    <span class="k">def</span> <span class="nf">clearLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.displayProjectSummary"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.displayProjectSummary">[docs]</a>    <span class="k">def</span> <span class="nf">displayProjectSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays Project summary module on left of main window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ProjectSummaryPopup</span> <span class="kn">import</span> <span class="n">ProjectSummaryPopup</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">ProjectSummaryPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.archiveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.archiveProject">[docs]</a>    <span class="k">def</span> <span class="nf">archiveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
        <span class="n">apiProject</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">packageProject</span><span class="p">(</span><span class="n">apiProject</span><span class="p">,</span> <span class="n">includeBackups</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">includeLogs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                        <span class="n">includeArchives</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">includeSummaries</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Project Archived&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Project archived to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">,</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_updateRestoreArchiveMenu</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_archivePaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">archivesDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_ARCHIVES_DIRECTORY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">):</span>
            <span class="n">fileNames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">)</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span> <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">fileNames</span> <span class="k">if</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tgz&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">paths</span>

<div class="viewcode-block" id="Framework.restoreFromArchive"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.restoreFromArchive">[docs]</a>    <span class="k">def</span> <span class="nf">restoreFromArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archivePath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">archivePath</span><span class="p">:</span>
            <span class="n">archivesDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_ARCHIVES_DIRECTORY</span><span class="p">)</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">ExistingFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Select Archive&quot;</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                                <span class="n">directory</span><span class="o">=</span><span class="n">archivesDirectory</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.tgz&#39;</span><span class="p">)</span>
            <span class="n">archivePath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">archivePath</span><span class="p">:</span>
            <span class="n">directoryPrefix</span> <span class="o">=</span> <span class="n">archivePath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># -4 removes the .tgz</span>
            <span class="n">outputPath</span><span class="p">,</span> <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpackCcpnTarfile</span><span class="p">(</span><span class="n">archivePath</span><span class="p">,</span> <span class="n">outputPath</span><span class="o">=</span><span class="n">directoryPrefix</span><span class="p">)</span>
            <span class="n">pythonExe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_PYTHON</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">pythonExe</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outputPath</span><span class="p">]</span>
            <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span>

            <span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_unpackCcpnTarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tarfilePath</span><span class="p">,</span> <span class="n">outputPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">directoryPrefix</span><span class="o">=</span><span class="s1">&#39;CcpnProject_&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # CCPN INTERNAL - called in loadData method of Project</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">outputPath</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputPath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
            <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">directoryPrefix</span><span class="p">)</span>
            <span class="n">outputPath</span> <span class="o">=</span> <span class="n">temporaryDirectory</span><span class="o">.</span><span class="n">name</span>

        <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarfilePath</span><span class="p">)</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>

            <span class="c1"># look for a directory inside and assume the first found is the project directory (there should be exactly one)</span>
            <span class="n">relfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">relfile</span> <span class="ow">in</span> <span class="n">relfiles</span><span class="p">:</span>
                <span class="n">fullfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">relfile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fullfile</span><span class="p">):</span>
                    <span class="n">outputPath</span> <span class="o">=</span> <span class="n">fullfile</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find project directory in tarfile&#39;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">temporaryDirectory</span>

<div class="viewcode-block" id="Framework.showApplicationPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showApplicationPreferences">[docs]</a>    <span class="k">def</span> <span class="nf">showApplicationPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays Application Preferences Popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PreferencesPopup</span> <span class="kn">import</span> <span class="n">PreferencesPopup</span>

        <span class="n">PreferencesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.getSavedLayoutPath"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getSavedLayoutPath">[docs]</a>    <span class="k">def</span> <span class="nf">getSavedLayoutPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens a saved Layout as dialog box and gets directory specified in the file dialog.&quot;&quot;&quot;</span>

        <span class="n">fType</span> <span class="o">=</span> <span class="s1">&#39;JSON (*.json)&#39;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Open Saved Layout&#39;</span><span class="p">,</span>
                            <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">fType</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span></div>

<div class="viewcode-block" id="Framework.getSaveLayoutPath"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getSaveLayoutPath">[docs]</a>    <span class="k">def</span> <span class="nf">getSaveLayoutPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens save Layout as dialog box and gets directory specified in the file dialog.&quot;&quot;&quot;</span>
        <span class="n">jsonType</span> <span class="o">=</span> <span class="s1">&#39;.json&#39;</span>
        <span class="n">fType</span> <span class="o">=</span> <span class="s1">&#39;JSON (*.json)&#39;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Save Layout As&#39;</span><span class="p">,</span>
                            <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">fType</span><span class="p">)</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newPath</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newPath</span><span class="p">):</span>
                <span class="c1"># should not really need to check the second and third condition above, only</span>
                <span class="c1"># the Qt dialog stupidly insists a directory exists before you can select it</span>
                <span class="c1"># so if it exists but is empty then don&#39;t bother asking the question</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Overwrite path&#39;</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Path &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists, continue?&#39;</span> <span class="o">%</span> <span class="n">newPath</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showYesNo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
                    <span class="n">newPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newPath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">jsonType</span><span class="p">):</span>
                <span class="n">newPath</span> <span class="o">+=</span> <span class="n">jsonType</span>
            <span class="k">return</span> <span class="n">newPath</span></div>

    <span class="k">def</span> <span class="nf">_closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves application preferences. Displays message box asking user to save project or not.</span>
<span class="sd">        Closes Application.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_closeEvent</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># prefPath = os.path.expanduser(&quot;~/.ccpn/v3settings.json&quot;)</span>
        <span class="c1"># directory = os.path.dirname(prefPath)</span>
        <span class="c1"># if not os.path.exists(directory):</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         os.makedirs(directory)</span>
        <span class="c1">#     except Exception as e:</span>
        <span class="c1">#         getLogger().warning(&#39;Preferences not saved: %s&#39; % (directory, e))</span>
        <span class="c1">#         return</span>
        <span class="c1">#</span>
        <span class="c1"># prefFile = open(prefPath, &#39;w+&#39;)</span>
        <span class="c1"># json.dump(self.preferences, prefFile, sort_keys=True, indent=4, separators=(&#39;,&#39;, &#39;: &#39;))</span>
        <span class="c1"># prefFile.close()</span>
        <span class="c1">#</span>
        <span class="c1"># reply = MessageDialog.showMulti(&quot;Quit Program&quot;, &quot;Do you want to save changes before quitting?&quot;,</span>
        <span class="c1">#                                 [&#39;Save and Quit&#39;, &#39;Quit without Saving&#39;, &#39;Cancel&#39;])  # ejb</span>
        <span class="c1"># if reply == &#39;Save and Quit&#39;:</span>
        <span class="c1">#     if event:</span>
        <span class="c1">#         event.accept()</span>
        <span class="c1">#     prefFile = open(prefPath, &#39;w+&#39;)</span>
        <span class="c1">#     json.dump(self.preferences, prefFile, sort_keys=True, indent=4, separators=(&#39;,&#39;, &#39;: &#39;))</span>
        <span class="c1">#     prefFile.close()</span>
        <span class="c1">#</span>
        <span class="c1">#     success = self.saveProject()</span>
        <span class="c1">#     if success is True:</span>
        <span class="c1">#         # Close and clean up project</span>
        <span class="c1">#         self._closeProject()</span>
        <span class="c1">#         QtWidgets.QApplication.quit()</span>
        <span class="c1">#         os._exit(0)</span>
        <span class="c1">#</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         if event:  # ejb - don&#39;t close the project</span>
        <span class="c1">#             event.ignore()</span>
        <span class="c1">#</span>
        <span class="c1"># elif reply == &#39;Quit without Saving&#39;:</span>
        <span class="c1">#     if event:</span>
        <span class="c1">#         event.accept()</span>
        <span class="c1">#     prefFile = open(prefPath, &#39;w+&#39;)</span>
        <span class="c1">#     json.dump(self.preferences, prefFile, sort_keys=True, indent=4, separators=(&#39;,&#39;, &#39;: &#39;))</span>
        <span class="c1">#     prefFile.close()</span>
        <span class="c1">#     self._closeProject()</span>
        <span class="c1">#</span>
        <span class="c1">#     QtWidgets.QApplication.quit()</span>
        <span class="c1">#     os._exit(0)</span>
        <span class="c1">#</span>
        <span class="c1"># else:</span>
        <span class="c1">#     if event:</span>
        <span class="c1">#         event.ignore()</span>

    <span class="k">def</span> <span class="nf">_closeMainWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tempModules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">ccpnModules</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempModules</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tempModule</span> <span class="ow">in</span> <span class="n">tempModules</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;closing module: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tempModule</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tempModule</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># wrapped C/C++ object of type StripDisplay1d has been deleted</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_closeExtraWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tempAreas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">tempAreas</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempAreas</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tempArea</span> <span class="ow">in</span> <span class="n">tempAreas</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;closing external module: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tempArea</span><span class="o">.</span><span class="n">window</span><span class="p">())</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tempArea</span><span class="o">.</span><span class="n">window</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># wrapped C/C++ object of type StripDisplay1d has been deleted</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_closeProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close project and clean up - when opening another or quitting application&quot;&quot;&quot;</span>

        <span class="c1"># NB: this function must clean up both wrapper and ui/gui</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deleteAllNotifiers</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">:</span>
            <span class="c1"># ui/gui cleanup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closeMainWindows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closeExtraWindows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">clearSideBar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">_unregisterNotifiers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Cleans up wrapper project, including graphics data objects (Window, Strip, etc.)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># self.ui.mainWindow = None</span>
        <span class="c1"># self.project = None</span>

    <span class="c1">###################################################################################################################</span>
    <span class="c1">## MENU callbacks:  Spectrum</span>
    <span class="c1">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.showSpectrumGroupsPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSpectrumGroupsPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showSpectrumGroupsPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Project has no Specta. Spectrum groups cannot be displayed&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project contains no spectra.&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum groups cannot be displayed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumGroupEditor</span> <span class="kn">import</span> <span class="n">SpectrumGroupEditor</span>

            <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">editMode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showProjectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showProjectionPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showProjectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Project has no Specta. Make Projection Popup cannot be displayed&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project contains no spectra.&#39;</span><span class="p">,</span> <span class="s1">&#39;Make Projection Popup cannot be displayed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumProjectionPopup</span> <span class="kn">import</span> <span class="n">SpectrumProjectionPopup</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumProjectionPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showExperimentTypePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showExperimentTypePopup">[docs]</a>    <span class="k">def</span> <span class="nf">showExperimentTypePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays experiment type popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Experiment Type Selection: Project has no Specta.&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Experiment Type Selection&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no Spectra.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ExperimentTypePopup</span> <span class="kn">import</span> <span class="n">ExperimentTypePopup</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">ExperimentTypePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showValidateSpectraPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showValidateSpectraPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showValidateSpectraPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">defaultSelected</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays validate spectra popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Validate Spectrum Paths Selection: Project has no Specta.&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Validate Spectrum Paths Selection&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no Spectra.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ValidateSpectraPopup</span> <span class="kn">import</span> <span class="n">ValidateSpectraPopup</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">ValidateSpectraPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra</span><span class="p">,</span> <span class="n">defaultSelected</span><span class="o">=</span><span class="n">defaultSelected</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showPeakPick1DPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakPick1DPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showPeakPick1DPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays Peak Picking 1D Popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Peak Picking: Project has no Specta.&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Peak Picking&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no Spectra.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">spec</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">dimensionCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PickPeaks1DPopup</span> <span class="kn">import</span> <span class="n">PickPeak1DPopup</span>

                <span class="n">popup</span> <span class="o">=</span> <span class="n">PickPeak1DPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
                <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Peak Picking: Project has no 1d Specta.&#39;</span><span class="p">)</span>
                <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Peak Picking&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no 1d Spectra.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showPeakPickNDPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakPickNDPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showPeakPickNDPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays Peak Picking ND Popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Peak Picking: Project has no Specta.&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Peak Picking&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no Spectra.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">spec</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">dimensionCount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PeakFind</span> <span class="kn">import</span> <span class="n">PeakFindPopup</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">PeakFindPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Pick Nd Peaks, no strip selected&#39;</span><span class="p">)</span>
                    <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Pick Nd Peaks&#39;</span><span class="p">,</span> <span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Peak Picking: Project has no Nd Specta.&#39;</span><span class="p">)</span>
                <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Peak Picking&#39;</span><span class="p">,</span> <span class="s1">&#39;Project has no Nd Spectra.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCopyPeakListPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCopyPeakListPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showCopyPeakListPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists. Peak Lists cannot be copied&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak Lists cannot be copied&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CopyPeakListPopup</span> <span class="kn">import</span> <span class="n">CopyPeakListPopup</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">CopyPeakListPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showCopyPeaks"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCopyPeaks">[docs]</a>    <span class="k">def</span> <span class="nf">showCopyPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists. Peak Lists cannot be copied&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak Lists cannot be copied&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CopyPeaksPopup</span> <span class="kn">import</span> <span class="n">CopyPeaks</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">CopyPeaks</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">peaks</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">_selectPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="k">exec</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.makeStripPlotPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.makeStripPlotPopup">[docs]</a>    <span class="k">def</span> <span class="nf">makeStripPlotPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">includePeakLists</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">includeNmrChains</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">includeNmrChainPullSelection</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peaks</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">nmrResidues</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">nmrChains</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Cannot make strip plot, nothing to display&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Cannot make strip plot,&#39;</span><span class="p">,</span> <span class="s1">&#39;nothing to display&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.StripPlotPopup</span> <span class="kn">import</span> <span class="n">StripPlotPopup</span>

            <span class="n">popup</span> <span class="o">=</span> <span class="n">StripPlotPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                   <span class="n">spectrumDisplay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="p">,</span>
                                   <span class="n">includePeakLists</span><span class="o">=</span><span class="n">includePeakLists</span><span class="p">,</span> <span class="n">includeNmrChains</span><span class="o">=</span><span class="n">includeNmrChains</span><span class="p">,</span>
                                   <span class="n">includeNmrChainPullSelection</span><span class="o">=</span><span class="n">includeNmrChainPullSelection</span><span class="p">,</span> <span class="n">includeSpectrumTable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

    <span class="c1">################################################################################################</span>
    <span class="c1">## MENU callbacks:  Molecule</span>
    <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Framework.showCreateChainPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCreateChainPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showCreateChainPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays sequence creation popup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CreateChainPopup</span> <span class="kn">import</span> <span class="n">CreateChainPopup</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showCreateChainPopup()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showCreateChainPopup()&quot;</span><span class="p">)</span>
        <span class="n">popup</span> <span class="o">=</span> <span class="n">CreateChainPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.toggleSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleSequenceModule">[docs]</a>    <span class="k">def</span> <span class="nf">toggleSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggles whether Sequence Module is displayed or not&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.SequenceModule</span> <span class="kn">import</span> <span class="n">SequenceModule</span>

        <span class="c1"># openList = [m for m in SequenceModule.getInstances()]</span>
        <span class="c1"># if openList:</span>
        <span class="c1">#   openList[0].close()</span>
        <span class="c1">#   # SequenceModule._alreadyOpened = False</span>
        <span class="c1"># # if SequenceModule._alreadyOpened is True:</span>
        <span class="c1"># #   if SequenceModule._currentModule is not None:</span>
        <span class="c1"># #     SequenceModule._currentModule.close()</span>
        <span class="c1"># #     SequenceModule._alreadyOpened = False</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showSequenceModule</span><span class="p">()</span>

        <span class="c1"># if hasattr(self, &#39;sequenceModule&#39;):</span>
        <span class="c1">#   if self.sequenceModule.isVisible():</span>
        <span class="c1">#     self.hideSequenceModule()</span>
        <span class="c1"># else:</span>
        <span class="c1">#   self.showSequenceModule()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSequenceModule">[docs]</a>    <span class="k">def</span> <span class="nf">showSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays Sequence Module at the top of the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.SequenceModule</span> <span class="kn">import</span> <span class="n">SequenceModule</span>

        <span class="c1"># if not hasattr(self, &#39;sequenceModule&#39;):</span>

        <span class="k">if</span> <span class="n">SequenceModule</span><span class="o">.</span><span class="n">_alreadyOpened</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span> <span class="o">=</span> <span class="n">SequenceModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="p">,</span>
                                            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findMenuAction</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;Show Sequence&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">action</span><span class="p">:</span>  <span class="c1"># should be True</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="c1"># set the colours of the currently highlighted chain in open sequenceGraph</span>
            <span class="c1"># should really be in the class, but doesn&#39;t fire correctly during __init__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">populateFromSequenceGraphs</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span></div>

<div class="viewcode-block" id="Framework.hideSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.hideSequenceModule">[docs]</a>    <span class="k">def</span> <span class="nf">hideSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hides sequence module&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sequenceModule&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sequenceModule&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.inspectMolecule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.inspectMolecule">[docs]</a>    <span class="k">def</span> <span class="nf">inspectMolecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.showResidueInformation"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showResidueInformation">[docs]</a>    <span class="k">def</span> <span class="nf">showResidueInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Residue Information module.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ResidueInformation</span> <span class="kn">import</span> <span class="n">ResidueInformation</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">residues</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No Residues in project. Residue Information Module requires Residues in the project to launch.&#39;</span><span class="p">)</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;No Residues in project.&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;Residue Information Module requires Residues in the project to launch.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>  <span class="c1"># ejb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residueModule</span> <span class="o">=</span> <span class="n">ResidueInformation</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residueModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showResidueInformation()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showResidueInformation()&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showRefChemicalShifts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRefChemicalShifts">[docs]</a>    <span class="k">def</span> <span class="nf">showRefChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Reference Chemical Shifts module.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ReferenceChemicalShifts</span> <span class="kn">import</span> <span class="n">ReferenceChemicalShifts</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refChemShifts</span> <span class="o">=</span> <span class="n">ReferenceChemicalShifts</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refChemShifts</span><span class="p">)</span></div>

    <span class="c1">###################################################################################################################</span>
    <span class="c1">## MENU callbacks:  VIEW</span>
    <span class="c1">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.showChemicalShiftTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showChemicalShiftTable">[docs]</a>    <span class="k">def</span> <span class="nf">showChemicalShiftTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                               <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                               <span class="n">chemicalShiftList</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Chemical Shift table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ChemicalShiftTable</span> <span class="kn">import</span> <span class="n">ChemicalShiftTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftTableModule</span> <span class="o">=</span> <span class="n">ChemicalShiftTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                                 <span class="n">chemicalShiftList</span><span class="o">=</span><span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftTableModule</span></div>

<div class="viewcode-block" id="Framework.showNmrResidueTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showNmrResidueTable">[docs]</a>    <span class="k">def</span> <span class="nf">showNmrResidueTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">nmrChain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Nmr Residue Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.NmrResidueTable</span> <span class="kn">import</span> <span class="n">NmrResidueTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmrResidueTableModule</span> <span class="o">=</span> <span class="n">NmrResidueTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                           <span class="n">nmrChain</span><span class="o">=</span><span class="n">nmrChain</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmrResidueTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrResidueTableModule</span></div>

<div class="viewcode-block" id="Framework.showResidueTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showResidueTable">[docs]</a>    <span class="k">def</span> <span class="nf">showResidueTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">chain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays  Residue Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ResidueTable</span> <span class="kn">import</span> <span class="n">ResidueTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residueTableModule</span> <span class="o">=</span> <span class="n">ResidueTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                     <span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residueTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showResidueTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showResidueTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">residueTableModule</span></div>

    <span class="c1"># def showStructureTable(self, position=&#39;bottom&#39;, relativeTo=None,</span>
    <span class="c1">#                         structureEnsemble=None, selectFirstItem=False):</span>
    <span class="c1">#   &quot;&quot;&quot;Displays Structure Table</span>
    <span class="c1">#   &quot;&quot;&quot;</span>
    <span class="c1">#   from ccpn.ui.gui.modules.StructureTable import StructureTableModule</span>
    <span class="c1">#</span>
    <span class="c1">#   mainWindow = self.ui.mainWindow</span>
    <span class="c1">#   if not relativeTo:</span>
    <span class="c1">#     relativeTo = mainWindow.moduleArea</span>
    <span class="c1">#   self.structureTableModule = StructureTableModule(mainWindow=mainWindow,</span>
    <span class="c1">#                                               structureEnsemble=structureEnsemble, selectFirstItem=selectFirstItem)</span>
    <span class="c1">#   mainWindow.moduleArea.addModule(self.structureTableModule, position=position, relativeTo=relativeTo)</span>
    <span class="c1">#</span>
    <span class="c1">#   mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showStructureTable()&quot;)</span>
    <span class="c1">#   logger.info(&quot;application.showStructureTable()&quot;)</span>
    <span class="c1">#   return self.structureTableModule</span>
    <span class="c1">#</span>
<div class="viewcode-block" id="Framework.showPeakTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakTable">[docs]</a>    <span class="k">def</span> <span class="nf">showPeakTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                      <span class="n">peakList</span><span class="p">:</span> <span class="n">PeakList</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Peak table on left of main window with specified list selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.PeakTable</span> <span class="kn">import</span> <span class="n">PeakTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peakTableModule</span> <span class="o">=</span> <span class="n">PeakTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span>
                                               <span class="n">peakList</span><span class="o">=</span><span class="n">peakList</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showPeakTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showPeakTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakTableModule</span></div>

<div class="viewcode-block" id="Framework.showMultipletTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMultipletTable">[docs]</a>    <span class="k">def</span> <span class="nf">showMultipletTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="n">multipletList</span><span class="p">:</span> <span class="n">MultipletList</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays multipletList table on left of main window with specified list selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.MultipletListTable</span> <span class="kn">import</span> <span class="n">MultipletTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multipletTableModule</span> <span class="o">=</span> <span class="n">MultipletTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span>
                                                         <span class="n">multipletList</span><span class="o">=</span><span class="n">multipletList</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multipletTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showMultipletTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showMultipletTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipletTableModule</span></div>

<div class="viewcode-block" id="Framework.showIntegralTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showIntegralTable">[docs]</a>    <span class="k">def</span> <span class="nf">showIntegralTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">integralList</span><span class="p">:</span> <span class="n">IntegralList</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays integral table on left of main window with specified list selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.IntegralTable</span> <span class="kn">import</span> <span class="n">IntegralTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integralTableModule</span> <span class="o">=</span> <span class="n">IntegralTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                       <span class="n">integralList</span><span class="o">=</span><span class="n">integralList</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integralTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showIntegralTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showIntegralTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integralTableModule</span></div>

<div class="viewcode-block" id="Framework.showRestraintTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRestraintTable">[docs]</a>    <span class="k">def</span> <span class="nf">showRestraintTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                           <span class="n">restraintList</span><span class="p">:</span> <span class="n">PeakList</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Peak table on left of main window with specified list selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.RestraintTable</span> <span class="kn">import</span> <span class="n">RestraintTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restraintTableModule</span> <span class="o">=</span> <span class="n">RestraintTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                         <span class="n">restraintList</span><span class="o">=</span><span class="n">restraintList</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restraintTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showRestraintTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showRestraintTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restraintTableModule</span></div>

<div class="viewcode-block" id="Framework.showStructureTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showStructureTable">[docs]</a>    <span class="k">def</span> <span class="nf">showStructureTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">structureEnsemble</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Structure Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.StructureTable</span> <span class="kn">import</span> <span class="n">StructureTableModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structureTableModule</span> <span class="o">=</span> <span class="n">StructureTableModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                         <span class="n">structureEnsemble</span><span class="o">=</span><span class="n">structureEnsemble</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structureTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showStructureTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showStructureTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">structureTableModule</span></div>

<div class="viewcode-block" id="Framework.showNotesEditor"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showNotesEditor">[docs]</a>    <span class="k">def</span> <span class="nf">showNotesEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span> <span class="n">CcpnModule</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                        <span class="n">note</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays Notes Editing Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.NotesEditor</span> <span class="kn">import</span> <span class="n">NotesEditorModule</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notesEditorModule</span> <span class="o">=</span> <span class="n">NotesEditorModule</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span>
                                                   <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">selectFirstItem</span><span class="o">=</span><span class="n">selectFirstItem</span><span class="p">)</span>

        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notesEditorModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showNotesEditorTable()&quot;</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showNotesEditorTable()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">notesEditorModule</span></div>

<div class="viewcode-block" id="Framework.showPrintSpectrumDisplayPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPrintSpectrumDisplayPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showPrintSpectrumDisplayPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># from ccpn.ui.gui.popups.PrintSpectrumPopup import SelectSpectrumDisplayPopup #,PrintSpectrumDisplayPopup</span>

        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ExportStripToFile</span> <span class="kn">import</span> <span class="n">ExportStripToFilePopup</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;No SpectrumDisplay found&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exportDialog</span> <span class="o">=</span> <span class="n">ExportStripToFilePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                                  <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                                  <span class="n">strips</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">,</span>
                                                  <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
            <span class="n">exportDialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.toggleToolbar"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleToolbar">[docs]</a>    <span class="k">def</span> <span class="nf">toggleToolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">toggleToolbar</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.togglePhaseConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.togglePhaseConsole">[docs]</a>    <span class="k">def</span> <span class="nf">togglePhaseConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setZoomPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">_setZoomPopup</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.resetZoom"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.resetZoom">[docs]</a>    <span class="k">def</span> <span class="nf">resetZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.copyStrip"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.copyStrip">[docs]</a>    <span class="k">def</span> <span class="nf">copyStrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">copyStrip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.flipXYAxis"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.flipXYAxis">[docs]</a>    <span class="k">def</span> <span class="nf">flipXYAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">flipXYAxis</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.flipXZAxis"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.flipXZAxis">[docs]</a>    <span class="k">def</span> <span class="nf">flipXZAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">flipXZAxis</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.flipYZAxis"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.flipYZAxis">[docs]</a>    <span class="k">def</span> <span class="nf">flipYZAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">flipYZAxis</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No strip selected&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_findMenuAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menubarText</span><span class="p">,</span> <span class="n">menuText</span><span class="p">):</span>
        <span class="c1"># not sure if this function will be needed more widely or just in console context</span>
        <span class="c1"># CCPN internal: now also used in SequenceModule._closeModule</span>

        <span class="c1">#GWV should not be here; moved to GuiMainWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_findMenuAction</span><span class="p">(</span><span class="n">menubarText</span><span class="p">,</span> <span class="n">menuText</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># for menuBarAction in self.ui.mainWindow._menuBar.actions():</span>
        <span class="c1">#   if menuBarAction.text() == menubarText:</span>
        <span class="c1">#     break</span>
        <span class="c1"># else:</span>
        <span class="c1">#   return None</span>
        <span class="c1">#</span>
        <span class="c1"># for menuAction in menuBarAction.menu().actions():</span>
        <span class="c1">#   if menuAction.text() == menuText:</span>
        <span class="c1">#     return menuAction</span>
        <span class="c1">#</span>
        <span class="c1"># return None</span>

    <span class="k">def</span> <span class="nf">_toggleConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles whether python console is displayed at bottom of the main window.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">toggleConsole</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.showChemicalShiftMapping"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showChemicalShiftMapping">[docs]</a>    <span class="k">def</span> <span class="nf">showChemicalShiftMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ChemicalShiftsMappingModule</span> <span class="kn">import</span> <span class="n">ChemicalShiftsMapping</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="n">ChemicalShiftsMapping</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span></div>

    <span class="c1">#################################################################################################</span>
    <span class="c1">## MENU callbacks:  Macro</span>
    <span class="c1">#################################################################################################</span>

<div class="viewcode-block" id="Framework.showMacroEditor"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMacroEditor">[docs]</a>    <span class="k">def</span> <span class="nf">showMacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays macro editor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span></div>
        <span class="c1"># mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showMacroEditor()&quot;)</span>
        <span class="c1"># getLogger().info(&quot;application.showMacroEditor()&quot;)</span>

<div class="viewcode-block" id="Framework.openMacroOnEditor"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.openMacroOnEditor">[docs]</a>    <span class="k">def</span> <span class="nf">openMacroOnEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays macro editor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">_openMacroFile</span><span class="p">()</span></div>
        <span class="c1"># mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showMacroEditor()&quot;)</span>
        <span class="c1"># getLogger().info(&quot;application.showMacroEditor()&quot;)</span>

<div class="viewcode-block" id="Framework.newMacroFromConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromConsole">[docs]</a>    <span class="k">def</span> <span class="nf">newMacroFromConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays macro editor with contents of python console inside.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># editor = MacroEditor(self.ui.mainWindow.moduleArea, self, &quot;Macro Editor&quot;)</span>
        <span class="c1">#FIXME:ED - haven&#39;t checked this properly</span>
        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">textEditor</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span></div>

    <span class="c1"># FIXME:ED - haven&#39;t checked this properly. Broken</span>
<div class="viewcode-block" id="Framework.newMacroFromLog"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromLog">[docs]</a>    <span class="k">def</span> <span class="nf">newMacroFromLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays macro editor with contents of the log.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># editor = MacroEditor(self.ui.mainWindow.moduleArea, self, &quot;Macro Editor&quot;)</span>
        <span class="c1">#FIXME:ED - haven&#39;t checked this properly</span>
        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">logPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.defineUserShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.defineUserShortcuts">[docs]</a>    <span class="k">def</span> <span class="nf">defineUserShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ShortcutsPopup</span> <span class="kn">import</span> <span class="n">ShortcutsPopup</span>

        <span class="n">ShortcutsPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.runMacro"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.runMacro">[docs]</a>    <span class="k">def</span> <span class="nf">runMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macroFile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a macro if a macro is specified, or opens a dialog box for selection of a macro file and then</span>
<span class="sd">        runs the selected macro.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">macroFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">ExistingFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Run Macro&quot;</span><span class="p">,</span>
                                <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userMacroPath</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.py&#39;</span><span class="p">)</span>
            <span class="n">macroFile</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">macroFile</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">macroFile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">_runMacro</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span></div>

    <span class="c1">###################################################################################################################</span>
    <span class="c1">## MENU callbacks:  Help</span>
    <span class="c1">###################################################################################################################</span>

    <span class="k">def</span> <span class="nf">_systemOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="s2">&quot;Open path on system&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;xdg-open </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;open </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_showHtmlFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="s2">&quot;Displays html files in program QT viewer or using native webbrowser depending on useNativeWebbrowser option&quot;</span>

        <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">useNativeWebbrowser</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.CcpnWebView</span> <span class="kn">import</span> <span class="n">CcpnWebView</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">newModule</span> <span class="o">=</span> <span class="n">CcpnWebView</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">urlPath</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># self.newModule = CcpnModule(mainWindow=mainWindow, name=title)</span>
            <span class="c1"># view = CcpnWebView(path)</span>
            <span class="c1"># self.newModule.addWidget(view, 0, 0, 1, 1)      # make it the first item</span>
            <span class="c1"># self.newModule.mainWidget = view      # ejb</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.showBeginnersTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBeginnersTutorial">[docs]</a>    <span class="k">def</span> <span class="nf">showBeginnersTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">beginnersTutorialPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">beginnersTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showBackboneTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBackboneTutorial">[docs]</a>    <span class="k">def</span> <span class="nf">showBackboneTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">backboneAssignmentTutorialPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">backboneAssignmentTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCSPtutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCSPtutorial">[docs]</a>    <span class="k">def</span> <span class="nf">showCSPtutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">cspTutorialPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">cspTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showScreenTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showScreenTutorial">[docs]</a>    <span class="k">def</span> <span class="nf">showScreenTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">screenTutorialPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">screenTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showVersion3Documentation"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showVersion3Documentation">[docs]</a>    <span class="k">def</span> <span class="nf">showVersion3Documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays CCPN wrapper documentation in a module.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">documentationPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_showHtmlFile</span><span class="p">(</span><span class="s2">&quot;Analysis Version-3 Documentation&quot;</span><span class="p">,</span> <span class="n">documentationPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showShortcuts">[docs]</a>    <span class="k">def</span> <span class="nf">showShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">shortcutsPath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">shortcutsPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showAboutPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showAboutPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.AboutPopup</span> <span class="kn">import</span> <span class="n">AboutPopup</span>

        <span class="n">popup</span> <span class="o">=</span> <span class="n">AboutPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showAboutCcpn"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutCcpn">[docs]</a>    <span class="k">def</span> <span class="nf">showAboutCcpn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnUrl</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnUrl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCcpnLicense"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCcpnLicense">[docs]</a>    <span class="k">def</span> <span class="nf">showCcpnLicense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnLicenceUrl</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnLicenceUrl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCodeInspectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCodeInspectionPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showCodeInspectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: open a file browser to top of source directory</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.showIssuesList"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showIssuesList">[docs]</a>    <span class="k">def</span> <span class="nf">showIssuesList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnIssuesUrl</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnIssuesUrl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showTutorials"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showTutorials">[docs]</a>    <span class="k">def</span> <span class="nf">showTutorials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">tutorials</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>

        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tutorials</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showUpdatePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showUpdatePopup">[docs]</a>    <span class="k">def</span> <span class="nf">showUpdatePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the update popup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.update.UpdatePopup</span> <span class="kn">import</span> <span class="n">UpdatePopup</span>
        <span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Url</span>

        <span class="c1"># check valid internet connection first</span>
        <span class="k">if</span> <span class="n">Url</span><span class="o">.</span><span class="n">checkInternetConnection</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="n">UpdatePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Check For Updates&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;Could not connect to the update server, please check your internet connection.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showRegisterPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRegisterPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showRegisterPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the registration popup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">_registerDetails</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showFeedbackPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showFeedbackPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showFeedbackPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the submit feedback popup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.FeedbackPopup</span> <span class="kn">import</span> <span class="n">FeedbackPopup</span>
        <span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Url</span>

        <span class="c1"># check valid internet connection first</span>
        <span class="k">if</span> <span class="n">Url</span><span class="o">.</span><span class="n">checkInternetConnection</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="n">FeedbackPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Submit Feedback&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;Could not connect to the server, please check your internet connection.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showSubmitMacroPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSubmitMacroPopup">[docs]</a>    <span class="k">def</span> <span class="nf">showSubmitMacroPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the submit macro popup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SubmitMacroPopup</span> <span class="kn">import</span> <span class="n">SubmitMacroPopup</span>
        <span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Url</span>

        <span class="c1"># check valid internet connection first</span>
        <span class="k">if</span> <span class="n">Url</span><span class="o">.</span><span class="n">checkInternetConnection</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="n">SubmitMacroPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Submit Macro&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;Could not connect to the server, please check your internet connection.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showLicense"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showLicense">[docs]</a>    <span class="k">def</span> <span class="nf">showLicense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">licensePath</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">licensePath</span><span class="p">)</span></div></div>

    <span class="c1">#########################################    End Menu callbacks   ##################################################</span>

    <span class="c1"># def printToFile(self, spectrumDisplay=None):</span>
    <span class="c1">#</span>
    <span class="c1">#   current = self.current</span>
    <span class="c1">#   # if not spectrumDisplay:</span>
    <span class="c1">#   #   spectrumDisplay = current.spectrumDisplay</span>
    <span class="c1">#   if not spectrumDisplay and current.strip:</span>
    <span class="c1">#     spectrumDisplay = current.strip.spectrumDisplay</span>
    <span class="c1">#   if not spectrumDisplay and self.spectrumDisplays:</span>
    <span class="c1">#     spectrumDisplay = self.spectrumDisplays[0]</span>
    <span class="c1">#   if spectrumDisplay:</span>
    <span class="c1">#     dialog = FileDialog(parent=self.ui.mainWindow, fileMode=FileDialog.AnyFile, text=&#39;Print to File&#39;,</span>
    <span class="c1">#                         acceptMode=FileDialog.AcceptSave, preferences=self.preferences.general, filter=&#39;SVG (*.svg)&#39;)</span>
    <span class="c1">#     path = dialog.selectedFile()</span>
    <span class="c1">#     if not path:</span>
    <span class="c1">#       return</span>
    <span class="c1">#     spectrumDisplay.printToFile(path)</span>


<div class="viewcode-block" id="isValidPath"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.isValidPath">[docs]</a><span class="k">def</span> <span class="nf">isValidPath</span><span class="p">(</span><span class="n">projectName</span><span class="p">,</span> <span class="n">stripFullPath</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stripExtension</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check whether the project name is valid after stripping fullpath and extension</span>
<span class="sd">    Can only contain alphanumeric characters and underscores</span>

<span class="sd">    :param projectName: name of project to check</span>
<span class="sd">    :param stripFullPath: set to true to remove leading directory</span>
<span class="sd">    :param stripExtension: set to true to remove extension</span>
<span class="sd">    :return: True if valid else False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">projectName</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">projectName</span><span class="p">)</span> <span class="k">if</span> <span class="n">stripFullPath</span> <span class="k">else</span> <span class="n">projectName</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">stripExtension</span> <span class="k">else</span> <span class="n">name</span>

    <span class="n">STRIPCHARS</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">STRIPCHARS</span><span class="p">)</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">True</span></div>


<div class="viewcode-block" id="getSaveDirectory"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getSaveDirectory">[docs]</a><span class="k">def</span> <span class="nf">getSaveDirectory</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and gets directory specified in the file dialog.&quot;&quot;&quot;</span>

    <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Save Project As&#39;</span><span class="p">,</span>
                        <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="n">preferences</span><span class="p">,</span>
                        <span class="n">restrictDirToFilter</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">newPath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>

    <span class="c1"># if not iterable then ignore - dialog may return string or tuple(&lt;path&gt;, &lt;fileOptions&gt;)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newPath</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">newPath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># ignore if empty</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">newPath</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># check validity of the newPath</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isValidPath</span><span class="p">(</span><span class="n">newPath</span><span class="p">,</span> <span class="n">stripFullPath</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stripExtension</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Filename can only contain alphanumeric characters and underscores&#39;</span><span class="p">)</span>
        <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Save Project&#39;</span><span class="p">,</span> <span class="s1">&#39;Filename can only contain alphanumeric characters and underscores&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>

        <span class="c1"># native dialog returns a tuple: (path, &#39;&#39;); ccpn returns a string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newPath</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">newPath</span> <span class="o">=</span> <span class="n">newPath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newPath</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="n">newPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">newPath</span><span class="p">)):</span>
            <span class="c1"># should not really need to check the second and third condition above, only</span>
            <span class="c1"># the Qt dialog stupidly insists a directory exists before you can select it</span>
            <span class="c1"># so if it exists but is empty then don&#39;t bother asking the question</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Overwrite path&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Path &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists, continue?&#39;</span> <span class="o">%</span> <span class="n">newPath</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showYesNo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
                <span class="n">newPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">newPath</span></div>


<span class="c1">########</span>

<div class="viewcode-block" id="getPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getPreferences">[docs]</a><span class="k">def</span> <span class="nf">getPreferences</span><span class="p">(</span><span class="n">skipUserPreferences</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">defaultPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">userPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">defaultPreferencesPath</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">collections</span>

            <span class="c1"># recursive update of dictionary</span>
            <span class="c1"># this deletes every key in u that is not in d</span>
            <span class="c1"># if we want every key regardless, then remove first if check below</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">d</span>

        <span class="c1"># read the default settings</span>
        <span class="n">preferencesPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultPath</span> <span class="k">if</span> <span class="n">defaultPath</span> <span class="k">else</span> <span class="n">defaultPreferencesPath</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">preferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>

        <span class="c1"># read user settings and update if not skipped</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skipUserPreferences</span><span class="p">:</span>
            <span class="c1"># from ccpn.framework.PathsAndUrls import userPreferencesPath</span>

            <span class="n">preferencesPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">userPath</span> <span class="k">if</span> <span class="n">userPath</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">userPreferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>
                <span class="n">preferences</span> <span class="o">=</span> <span class="n">_updateDict</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">userPreferences</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>  <span class="c1">#should we have the preferences hard coded as py dict for extra safety? if json goes wrong the whole project crashes!</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">defaultPreferencesPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">preferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">preferences</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>