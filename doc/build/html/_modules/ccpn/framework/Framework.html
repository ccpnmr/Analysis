<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.framework.Framework &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.framework.Framework</h1><div class="highlight"><pre>
<span></span><span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Ed Brooksbank $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-04-11 15:24:25 +0100 (Tue, April 11, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b1 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="c1"># from functools import partial</span>

<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.memops</span> <span class="kn">import</span> <span class="n">Implementation</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Api</span> <span class="k">as</span> <span class="n">apiIo</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Formats</span> <span class="k">as</span> <span class="n">ioFormats</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>

<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation</span> <span class="kn">import</span> <span class="n">Io</span> <span class="k">as</span> <span class="n">coreIo</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib</span> <span class="kn">import</span> <span class="n">CcpnNefIo</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>

<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Register</span>
<span class="kn">from</span> <span class="nn">ccpn.util.AttrDict</span> <span class="kn">import</span> <span class="n">AttrDict</span>
<span class="kn">from</span> <span class="nn">ccpn.framework</span> <span class="kn">import</span> <span class="n">Version</span>

<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">languages</span><span class="p">,</span> <span class="n">defaultLanguage</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">translator</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.lib.misc</span> <span class="kn">import</span> <span class="n">_checked</span>

<span class="kn">from</span> <span class="nn">ccpn.ui</span> <span class="kn">import</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">defaultInterface</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Current</span> <span class="kn">import</span> <span class="n">Current</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.MacroEditor</span> <span class="kn">import</span> <span class="n">MacroEditor</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.CcpnModule</span> <span class="kn">import</span> <span class="n">CcpnModule</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets</span> <span class="kn">import</span> <span class="n">MessageDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.FileDialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.Window</span> <span class="kn">import</span> <span class="n">MODULE_DICT</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Common</span> <span class="kn">import</span> <span class="n">uniquify</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
<span class="n">_DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">componentNames</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Assignment&#39;</span><span class="p">,</span> <span class="s1">&#39;Screening&#39;</span><span class="p">,</span> <span class="s1">&#39;Structure&#39;</span><span class="p">)</span>

<span class="n">interfaceNames</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NoUi&#39;</span><span class="p">,</span> <span class="s1">&#39;Gui&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="printCreditsText"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.printCreditsText">[docs]</a><span class="k">def</span> <span class="nf">printCreditsText</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Initial text to terminal &quot;&quot;&quot;</span>
  <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnLicenceUrl</span>

  <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>                                                    <span class="c1"># ejb</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="c1"># lines.append(&quot;%s&quot; % __copyright__[0:__copyright__.index(&#39;-&#39;)] + &#39;- 2016&#39;)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__copyright__</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CCPN licence. See </span><span class="si">%s</span><span class="s2">. Not to be distributed without prior consent!&quot;</span> <span class="o">%</span> <span class="n">ccpnLicenceUrl</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__credits__</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Written by:   </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__credits__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__credits__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Written by:   </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__credits__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">crLine</span> <span class="ow">in</span> <span class="n">__credits__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
          <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">crLine</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__reference__</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Please cite:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__reference__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__reference__</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Please cite:  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">__reference__</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">refLine</span> <span class="ow">in</span> <span class="n">__reference__</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
          <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">refLine</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DISCLAIMER:   This program is offered &#39;as-is&#39;. Under no circumstances will the authors, CCPN,&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              the Department of Molecular and Cell Biology, or the University of Leicester be&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              liable of any damage, loss of data, loss of revenue or any other undesired&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;              consequences originating from the usage of this software.&quot;</span><span class="p">)</span>

  <span class="c1"># print with aligning &#39;|&#39;s</span>
  <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="n">lines</span><span class="p">))</span>
  <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">+</span><span class="mi">8</span><span class="p">)))</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;|   </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;  |</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">+</span><span class="mi">8</span><span class="p">)))</span></div>


<div class="viewcode-block" id="defineProgramArguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.defineProgramArguments">[docs]</a><span class="k">def</span> <span class="nf">defineProgramArguments</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Define the arguments of the program</span>
<span class="sd">  return argparse instance</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">argparse</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process startup arguments&#39;</span><span class="p">)</span>
  <span class="c1"># for component in componentNames:</span>
  <span class="c1">#   parser.add_argument(&#39;--&#39;+component.lower(), dest=&#39;include&#39;+component, action=&#39;store_true&#39;,</span>
  <span class="c1">#                                               help=&#39;Show %s component&#39; % component.lower())</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--language&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Language for menus, etc.; valid options = (</span><span class="si">%s</span><span class="s1">); default=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">languages</span><span class="p">),</span> <span class="n">defaultLanguage</span><span class="p">)),</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">defaultLanguage</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--interface&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;User interface, to use; one of  = (</span><span class="si">%s</span><span class="s1">); default=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interfaces</span><span class="p">),</span> <span class="n">defaultInterface</span><span class="p">)),</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">defaultInterface</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--skip-user-preferences&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;skipUserPreferences&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                                                 <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Skip loading user preferences&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dark&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;darkColourScheme&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                                                 <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Use dark colour scheme&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--light&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;lightColourScheme&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                                                 <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Use dark colour scheme&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--nologging&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nologging&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Do not log information to a file&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set logging level to debug&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;projectPath&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Project path&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">parser</span></div>


<div class="viewcode-block" id="Arguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Arguments">[docs]</a><span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Class for setting FrameWork input arguments directly&quot;&quot;&quot;</span>
  <span class="n">language</span> <span class="o">=</span> <span class="n">defaultLanguage</span>
  <span class="n">interface</span> <span class="o">=</span> <span class="s1">&#39;NoUi&#39;</span>
  <span class="n">nologging</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">skipUserPreferences</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

    <span class="c1"># Dummy values</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">componentNames</span><span class="p">:</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span> <span class="o">+</span> <span class="n">component</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span> <span class="o">=</span> <span class="n">projectPath</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="createFramework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.createFramework">[docs]</a><span class="k">def</span> <span class="nf">createFramework</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

  <span class="n">args</span> <span class="o">=</span> <span class="n">Arguments</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="n">projectPath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">Framework</span><span class="p">(</span><span class="s1">&#39;CcpNmr&#39;</span><span class="p">,</span> <span class="n">Version</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
  <span class="n">result</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="c1">#</span>
  <span class="k">return</span> <span class="n">result</span></div>



<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<div class="viewcode-block" id="AutoBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.AutoBackup">[docs]</a><span class="k">class</span> <span class="nc">AutoBackup</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">backupFunction</span><span class="p">,</span> <span class="n">sleepTime</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span> <span class="o">=</span> <span class="n">sleepTime</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span> <span class="o">=</span> <span class="n">backupFunction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="bp">None</span>


<div class="viewcode-block" id="AutoBackup.run"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.AutoBackup.run">[docs]</a>  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">waitTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">waitTime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">waitTime</span> <span class="o">==</span> <span class="s1">&#39;kill&#39;</span><span class="p">:</span>
        <span class="k">return</span>
      <span class="k">elif</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">startTime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">waitTime</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleepTime</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
          <span class="k">pass</span></div></div>



<div class="viewcode-block" id="Framework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework">[docs]</a><span class="k">class</span> <span class="nc">Framework</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  The Framework class is the base class for all applications.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">Arguments</span><span class="p">()):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="n">applicationName</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span> <span class="o">=</span> <span class="n">applicationVersion</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">Version</span><span class="o">.</span><span class="n">revision</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Hack for now, how should we store these?</span>

    <span class="n">printCreditsText</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">)</span>

    <span class="c1"># self.setupComponents(args)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nologging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current</span>      <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span>  <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self._getUserPrefs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span>   <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self.getStyleSheet</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># intialised by self.getStyleSheet</span>

    <span class="c1"># Necessary as attribute is queried during initialisation:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span>  <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># This is needed to make project available in NoUi (if nothing else)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span>      <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Blocking level for command echo and logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># NEF reader</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span> <span class="o">=</span> <span class="n">CcpnNefIo</span><span class="o">.</span><span class="n">CcpnNefReader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span>    <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># NBNB TODO The following block should maybe be moved into _getUi</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_getUserPrefs</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setLanguage</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getUI</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupMenus</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="bp">None</span>


<div class="viewcode-block" id="Framework.start"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.start">[docs]</a>  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start the program execution&quot;&quot;&quot;</span>

    <span class="c1"># Load / create project</span>
    <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">projectPath</span>
    <span class="k">if</span> <span class="n">projectPath</span><span class="p">:</span>
      <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectPath</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_updateCheckableMenuItems</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkRegistration</span><span class="p">():</span>
      <span class="k">return</span>

    <span class="c1"># Needed in case project load failed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; No project, aborting ...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">updateAutoBackup</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Done, </span><span class="si">%s</span><span class="s1"> is starting</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span><span class="p">)</span>

    <span class="c1"># self.project = project</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.updateAutoBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.updateAutoBackup">[docs]</a>  <span class="k">def</span> <span class="nf">updateAutoBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoBackupEnabled</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoBackupFrequency</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.setAutoBackupTime"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.setAutoBackupTime">[docs]</a>  <span class="k">def</span> <span class="nf">setAutoBackupTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="c1"># TODO: Need to add logging...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">full</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span> <span class="o">=</span> <span class="n">AutoBackup</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_backupTimerQ</span><span class="p">,</span>
                                         <span class="n">backupFunction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backupProject</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">autoBackupThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>


  <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setAutoBackupTime</span><span class="p">(</span><span class="s1">&#39;kill&#39;</span><span class="p">)</span>
    <span class="c1"># project._resetUndo(debug=_DEBUG)</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="Framework.backupProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.backupProject">[docs]</a>  <span class="k">def</span> <span class="nf">backupProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">apiIo</span><span class="o">.</span><span class="n">backupProject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_initialiseProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialise project and set up links and objects that involve it&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

    <span class="c1"># Pass an instance of framework to project so the UI instantiation can happen</span>
    <span class="n">project</span><span class="o">.</span><span class="n">_appBase</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="c1"># Set up current</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">Current</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>

    <span class="c1"># This wraps the underlying data, including the wrapped graphics data</span>
    <span class="c1">#  - the project is now ready to use</span>

    <span class="n">project</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">()</span>

    <span class="c1"># Adapt project to preferences</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applyPreferences</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_mainWindow&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span>

      <span class="c1"># Get the mainWindow out of the application top level once it&#39;s been transferred to ui</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># The NoUi version has no mainWindow</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_refreshAfterSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Refresh user interface after project save (which may have caused project rename)&quot;&quot;&quot;</span>

    <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
    <span class="k">if</span> <span class="n">mainWindow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">mainWindow</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">setProjectName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_getUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="s1">&#39;Gui&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStyleSheet</span><span class="p">()</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.gui.Gui</span> <span class="kn">import</span> <span class="n">Gui</span>
      <span class="n">ui</span> <span class="o">=</span> <span class="n">Gui</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
      <span class="n">ui</span><span class="o">.</span><span class="n">qtApp</span><span class="o">.</span><span class="n">_ccpnApplication</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.Ui</span> <span class="kn">import</span> <span class="n">NoUi</span>
      <span class="n">ui</span> <span class="o">=</span> <span class="n">NoUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Connect UI classes for chosen ui</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ui</span>


<div class="viewcode-block" id="Framework.getStyleSheet"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getStyleSheet">[docs]</a>  <span class="k">def</span> <span class="nf">getStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return Stylesheet as determined by arguments --dark, --light or preferences</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">darkColourScheme</span><span class="p">:</span>
      <span class="n">colourScheme</span> <span class="o">=</span><span class="s1">&#39;dark&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">lightColourScheme</span><span class="p">:</span>
      <span class="n">colourScheme</span> <span class="o">=</span> <span class="s1">&#39;light&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span>

    <span class="k">if</span> <span class="n">colourScheme</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;invalid colourScheme&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">=</span> <span class="n">colourScheme</span>

    <span class="n">styleSheet</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s1">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                                   <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">StyleSheet.qss&#39;</span> <span class="o">%</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">upperFirst</span><span class="p">(</span><span class="n">colourScheme</span><span class="p">)))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
      <span class="n">additions</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s1">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">AdditionsLinux.qss&#39;</span> <span class="o">%</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">upperFirst</span><span class="p">(</span><span class="n">colourScheme</span><span class="p">)))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
      <span class="n">styleSheet</span> <span class="o">+=</span> <span class="n">additions</span>
    <span class="k">return</span> <span class="n">styleSheet</span></div>

  <span class="k">def</span> <span class="nf">_getUserPrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># user preferences</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Getting user preferences</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">getPreferences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_setLanguage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Language, check for command line override, or use preferences</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
      <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">setLanguage</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
    <span class="c1"># translator.setDebug(True)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Language set to &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">translator</span><span class="o">.</span><span class="n">_language</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_isRegistered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return True if registered&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span> <span class="o">=</span> <span class="n">Register</span><span class="o">.</span><span class="n">loadDict</span><span class="p">()</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">Register</span><span class="o">.</span><span class="n">isNewRegistration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_checkRegistration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display registration popup if there is a gui</span>
<span class="sd">    return True if ok</span>
<span class="sd">    return False on error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.RegisterPopup</span> <span class="kn">import</span> <span class="n">RegisterPopup</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isRegistered</span><span class="p">():</span>
        <span class="n">popup</span> <span class="o">=</span> <span class="n">RegisterPopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isRegistered</span><span class="p">():</span>
      <span class="k">return</span> <span class="bp">False</span>

    <span class="n">Register</span><span class="o">.</span><span class="n">updateServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="Framework.applyPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.applyPreferences">[docs]</a>  <span class="k">def</span> <span class="nf">applyPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply user preferences</span>

<span class="sd">    NBNB project should be impliclt rather than a parameter (once reorganisation is finished)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Reset remoteData DataStores to match preferences setting</span>
    <span class="n">dataPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">dataPath</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dataPath</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dataPath</span><span class="p">):</span>
      <span class="n">dataPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
    <span class="n">memopsRoot</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span>
    <span class="n">dataUrl</span> <span class="o">=</span> <span class="n">memopsRoot</span><span class="o">.</span><span class="n">findFirstDataLocationStore</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findFirstDataUrl</span><span class="p">(</span>
      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;remoteData&#39;</span>
    <span class="p">)</span>
    <span class="n">dataUrl</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Implementation</span><span class="o">.</span><span class="n">Url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">dataPath</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.initGraphics"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.initGraphics">[docs]</a>  <span class="k">def</span> <span class="nf">initGraphics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set up graphics system after loading&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules</span> <span class="kn">import</span> <span class="n">GuiStrip</span>

    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

    <span class="c1"># Initialise displays</span>
    <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">windows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span> <span class="c1"># there is exactly one window</span>
      <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_resetRemoveStripAction</span><span class="p">()</span>

    <span class="c1"># Initialise strips</span>
    <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
      <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_setupGuiStrip</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">strip</span><span class="o">.</span><span class="n">_wrappedData</span><span class="p">)</span>

      <span class="c1"># if isinstance(strip, GuiStripNd) and not strip.haveSetupZWidgets:</span>
      <span class="c1">#   strip.setZWidgets()</span>

    <span class="c1"># Initialise Rulers</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">apiMark</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedMarks</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">apiMark</span><span class="o">.</span><span class="n">sortedRulers</span><span class="p">():</span>
          <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_rulerCreated</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">)</span>

    <span class="c1"># Initialise SpectrumViews</span>
    <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
          <span class="n">spectrumView</span><span class="o">.</span><span class="n">_createdSpectrumView</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">peakList</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">strip</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initLayout</span><span class="p">()</span></div>
    <span class="c1"># self._restoreLayout()</span>

  <span class="k">def</span> <span class="nf">_initLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Restore layout of modules from previous save after graphics have been set up.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">yaml</span><span class="o">,</span> <span class="nn">os</span>

    <span class="n">containers</span><span class="p">,</span> <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
    <span class="n">keysSeen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># At this point, the spectrum windows (modules) have been created but not the other ones</span>
    <span class="c1"># These other ones have keys in MODULE_DICT</span>
    <span class="c1"># If the key is not in that dict then it is not needed, so remove</span>
    <span class="c1"># This means, for example, that Assign-specific modules are removed from Screen</span>
    <span class="c1"># If the key has already been seen then also remove</span>
    <span class="c1"># This is because PyQtGraph does not like duplicate keys when it restores the state</span>
    <span class="c1"># The code below assumes some knowledge of how PyQtGraph stores the state in terms of layout</span>

    <span class="c1"># Remaining problem: windows might be off screen</span>

    <span class="k">def</span> <span class="nf">_analyseContents</span><span class="p">(</span><span class="n">contents</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;function internal to _initLayout&quot;&quot;&quot;</span>
      <span class="n">contentToRemove</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
          <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dock&#39;</span><span class="p">:</span>
              <span class="n">key</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
              <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keysSeen</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>  <span class="c1"># if modules.get(key) then module exists already</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keysSeen</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MODULE_DICT</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODULE_DICT</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                  <span class="n">contentToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                  <span class="n">keysSeen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                  <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODULE_DICT</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                  <span class="n">func</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">_analyseContents</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

      <span class="n">contentToRemove</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>  <span class="c1"># not needed, but delete from end</span>
      <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contentToRemove</span><span class="p">:</span>
        <span class="n">contents</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># ===</span>
    <span class="c1"># start of the actual method code</span>
    <span class="c1"># ===</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;layouts&#39;</span><span class="p">,</span> <span class="s1">&#39;layout.yaml&#39;</span><span class="p">)):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;layouts&#39;</span><span class="p">,</span> <span class="s1">&#39;layout.yaml&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
          <span class="n">names</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">typ</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>  <span class="c1"># main window</span>
        <span class="n">_analyseContents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">floatLayoutsToRemove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">floatLayout</span> <span class="ow">in</span> <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">]:</span>  <span class="c1"># floating windows</span>
          <span class="n">typ</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">floatLayout</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
          <span class="n">_analyseContents</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">floatLayoutsToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">floatLayout</span><span class="p">)</span>

        <span class="n">floatLayoutsToRemove</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>  <span class="c1"># not needed, but delete from end</span>
        <span class="k">for</span> <span class="n">floatLayout</span> <span class="ow">in</span> <span class="n">floatLayoutsToRemove</span><span class="p">:</span>
          <span class="n">layout</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">floatLayout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># for now just ignore restore failures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Layout restore failed: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.getByPid"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getByPid">[docs]</a>  <span class="k">def</span> <span class="nf">getByPid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.getByGid"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getByGid">[docs]</a>  <span class="k">def</span> <span class="nf">getByGid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gid</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">getByGid</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_startCommandBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">objectParameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start block for command echoing, set undo waypoint, and echo command to ui and logger</span>

<span class="sd">    MUST be paired with _endCommandBlock call - use try ... finally to ensure both are called</span>

<span class="sd">    Set keyword:value objectParameters to point to the relevant objects in setup commands,</span>
<span class="sd">    and pass setup commands and command proper to ui for echoing</span>

<span class="sd">    Example calls:</span>

<span class="sd">    _startCommandBlock(&quot;application.createSpectrumDisplay(spectrum)&quot;, spectrum=spectrumOrPid)</span>

<span class="sd">    _startCommandBlock(</span>
<span class="sd">       &quot;newAssignment = peak.assignDimension(axisCode=%s, value=[newNmrAtom]&quot; % axisCode,</span>
<span class="sd">       peak=peakOrPid)&quot;&quot;&quot;</span>

    <span class="n">undo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">undo</span><span class="o">.</span><span class="n">blocking</span><span class="p">:</span>

      <span class="c1"># set undo step</span>
      <span class="n">undo</span><span class="o">.</span><span class="n">newWaypoint</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">suspendNotification</span><span class="p">()</span>

      <span class="c1"># Get list of command strings</span>
      <span class="n">commands</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">objectParameters</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">pid</span>
        <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = project.getByPid(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
      <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

      <span class="c1"># echo command strings</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;startCommandBlock. command=</span><span class="si">%s</span><span class="s1">, echoBlocking=</span><span class="si">%s</span><span class="s1">, undo.blocking=</span><span class="si">%s</span><span class="s1">&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span><span class="p">,</span> <span class="n">undo</span><span class="o">.</span><span class="n">blocking</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_endCommandBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;End block for command echoing,</span>

<span class="sd">    MUST be paired with _startCommandBlock call - use try ... finally to ensure both are called&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;endCommandBlock. echoBlocking=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c1"># If statement should always be True, but to avoid weird behaviour in error situations we check</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">resumeNotification</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.addApplicationMenuSpec"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addApplicationMenuSpec">[docs]</a>  <span class="k">def</span> <span class="nf">addApplicationMenuSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


  <span class="c1">#########################################    Start setup Menus      ############################</span>

  <span class="k">def</span> <span class="nf">_updateCheckableMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># This has to be kept in sync with menu items below which are checkable,</span>
    <span class="c1"># and also with MODULE_DICT keys</span>
    <span class="c1"># The code is terrible because Qt has no easy way to get hold of menus / actions</span>

    <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span>
    <span class="k">if</span> <span class="n">mainWindow</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># We have a UI with no mainWindow - nothing to do.</span>
      <span class="k">return</span>

    <span class="n">topMenu</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">topActionDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">topAction</span> <span class="ow">in</span> <span class="n">topMenu</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
      <span class="n">mainActionDict</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="n">mainAction</span> <span class="ow">in</span> <span class="n">topAction</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
        <span class="n">mainActionDict</span><span class="p">[</span><span class="n">mainAction</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">mainAction</span>
      <span class="n">topActionDict</span><span class="p">[</span><span class="n">topAction</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="n">mainActionDict</span>

    <span class="n">openModuleKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">topActionText</span><span class="p">,</span> <span class="n">mainActionText</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;SEQUENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;Molecules&#39;</span><span class="p">,</span> <span class="s1">&#39;Show Sequence&#39;</span><span class="p">),</span>
                                               <span class="p">(</span><span class="s1">&#39;PYTHON CONSOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;Python Console&#39;</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">openModuleKeys</span><span class="p">:</span>
        <span class="n">mainActionDict</span> <span class="o">=</span> <span class="n">topActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">topActionText</span><span class="p">)</span> <span class="c1"># should always exist but play safe</span>
        <span class="k">if</span> <span class="n">mainActionDict</span><span class="p">:</span>
          <span class="n">mainAction</span> <span class="o">=</span> <span class="n">mainActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mainActionText</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">mainAction</span><span class="p">:</span>
            <span class="n">mainAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.setupMenus"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.setupMenus">[docs]</a>  <span class="k">def</span> <span class="nf">setupMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Setup the menu specification.</span>

<span class="sd">    The menus are specified by a list of lists (actually, an iterable of iterables, but the term</span>
<span class="sd">    ‘list’ will be used here to mean any iterable).  Framework provides 7 menus: Project, Spectrum,</span>
<span class="sd">    Molecules, View, Macro, Plugins, Help.  If you want to create your own menu in a subclass of</span>
<span class="sd">    Framework, you need to create a list in the style described below, then call</span>
<span class="sd">    self.addApplicationMenuSpec and pass in your menu specification list.</span>

<span class="sd">    Menu specification lists are composed of two items, the first being a string which is the menu’s</span>
<span class="sd">    title, the second is a list of sub-menu items.  Each item can be zero, two or three items long.</span>
<span class="sd">    A zero-length list indicates a separator.  If the list is length two and the second item is a</span>
<span class="sd">    list, then it specifies a sub-menu in a recursive manner.  If the list is length two and the</span>
<span class="sd">    second item is callable, it specifies a menu action with the first item specifying the label</span>
<span class="sd">    and the second the callable that is triggered when the menu item is selected.  If the list is</span>
<span class="sd">    length three, it is treated as a menu item specification, with the third item a list of keyword,</span>
<span class="sd">    value pairs.</span>

<span class="sd">    The examples below may make this more clear…</span>

<span class="sd">    Create a menu called ‘Test’ with two items and a separator:</span>

<span class="sd">    | - Test</span>
<span class="sd">    |   | - Item One</span>
<span class="sd">    |   | - ------</span>
<span class="sd">    |   | - Item Two</span>

<span class="sd">    Where clicking on ‘Item One’ calls method self.itemOneMethod and clicking on ‘Item Two’</span>
<span class="sd">    calls self.itemTwoMethod</span>

<span class="sd">    |    def setupMenus(self):</span>
<span class="sd">    |      menuSpec = (‘Test’, [(‘Item One’, self.itemOneMethod),</span>
<span class="sd">    |                           (),</span>
<span class="sd">    |                           (‘Item Two’, self.itemTwoMethod),</span>
<span class="sd">    |                          ]</span>
<span class="sd">    |      self.addApplicationMenuSpec(menuSpec)</span>



<span class="sd">    More complicated menus are possible.  For example, to create the following menu</span>

<span class="sd">    | - Test</span>
<span class="sd">    |   | - Item A     ia</span>
<span class="sd">    |   | - ------</span>
<span class="sd">    |   | - Submenu B</span>
<span class="sd">    |      | - Item B1</span>
<span class="sd">    |      | - Item B2</span>
<span class="sd">    |   | - Item C     id</span>

<span class="sd">    where Item A can be activated using the two-key shortcut ‘ia’,</span>
<span class="sd">    Submenu B contains two static menu items, B1 and B2</span>
<span class="sd">    Submenu item B2 is checkable, but not checked by default</span>
<span class="sd">    Item C is disabled by default and has a shortcut of ‘ic’</span>

<span class="sd">    |   def setupMenus(self):</span>
<span class="sd">    |     subMenuSpecB = [(‘Item B1’, self.itemB1),</span>
<span class="sd">    |                     (‘Item B2’, self.itemB2, [(‘checkable’, True),</span>
<span class="sd">    |                                               (‘checked’, False)])</span>
<span class="sd">    |                    ]</span>
<span class="sd">    |</span>
<span class="sd">    |     menuSpec = (‘Test’, [(‘Item A’, self.itemA, [(‘shortcut’, ‘ia’)]),</span>
<span class="sd">    |                          (),</span>
<span class="sd">    |                          (‘Submenu B’, subMenuB),</span>
<span class="sd">    |                          (‘Item C’, self.itemA, [(‘shortcut’, ‘ic’),</span>
<span class="sd">    |                                                  (‘enabled’, False)]),</span>
<span class="sd">    |                         ]</span>
<span class="sd">    |     self.addApplicationMenuSpec(menuSpec)</span>


<span class="sd">    If we’re using the PyQt GUI, we can get the Qt action representing Item B2 somewhere in our code</span>
<span class="sd">    (for example, to change the checked status,) via:</span>

<span class="sd">    |   action = application.ui.mainWindow.getMenuAction(‘Test-&gt;Submenu B-&gt;Item B2’)</span>
<span class="sd">    |   action.setChecked(True)</span>

<span class="sd">    To see how to add items dynamically, see clearRecentProjects in this class and</span>
<span class="sd">    _fillRecentProjectsMenu in GuiMainWindow</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span>   <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;New&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createNewProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pn&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Open...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;po&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Open Recent&quot;</span><span class="p">,</span> <span class="p">()),</span>

<span class="c1">#      (&quot;Load Spectrum...&quot;, lambda: self.loadData(text=&#39;Load Spectrum&#39;), [(&#39;shortcut&#39;, &#39;ls&#39;)]),</span>
      <span class="p">(</span><span class="s2">&quot;Load Data...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ld&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Save As...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sa&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Undo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃z&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
      <span class="p">(</span><span class="s2">&quot;Redo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redo</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;⌃y&#39;</span><span class="p">)]),</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Summary&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayProjectSummary</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Archive&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">archiveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Restore From Archive...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreFromArchive</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Preferences...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showApplicationPreferences</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Close Program&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closeEvent</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;qt&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span>  <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;Load Spectrum...&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load Spectrum&#39;</span><span class="p">),</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ls&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Spectrum Groups...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSpectrumGroupsPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ss&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Set Experiment Types...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showExperimentTypePopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;et&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Pick Peaks...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakPickPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pp&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Copy PeakList&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCopyPeakListPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">)]),</span>

      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Make Projection...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showProjectionPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pj&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Print to File...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPrintSpectrumDisplayPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Molecules&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;Chain from FASTA...&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load FASTA&#39;</span><span class="p">)),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Generate Chain...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showMoleculePopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Inspect...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspectMolecule</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Reference Chemical Shifts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showRefChemicalShifts</span><span class="p">,[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rc&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;View&#39;</span><span class="p">,</span>      <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;New Blank Display&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">addBlankDisplay</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;nd&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Chemical Shift Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showChemicalShiftTable</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;ct&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;NmrResidue Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showNmrResidueTable</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;nt&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Peak Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakTable</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;lt&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Restraint Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showRestraintTable</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Sequence Graph&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSequenceGraph</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sg&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Atom Selector&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAtomSelector</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;as&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Show Sequence&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleSequenceModule</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;sq&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                                                    <span class="p">]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Current&quot;</span><span class="p">,</span> <span class="p">((</span><span class="s2">&quot;Show/Hide Toolbar&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleToolbar</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;tb&#39;</span><span class="p">)]),</span>
                   <span class="p">(</span><span class="s2">&quot;Show/Hide Phasing Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;pc&#39;</span><span class="p">)]),</span>
                   <span class="p">(</span><span class="s2">&quot;Reset Zoom&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;rz&#39;</span><span class="p">)])</span>
                  <span class="p">)),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Python Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;py&#39;</span><span class="p">),</span>
                                              <span class="p">(</span><span class="s1">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                              <span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Macro&#39;</span><span class="p">,</span>     <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;Edit...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showMacroEditor</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;New from Console...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newMacroFromConsole</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;New from Log...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newMacroFromLog</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Record Macro...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startMacroRecord</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Run...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Run Recent&quot;</span><span class="p">,</span> <span class="p">()),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Define User Shortcuts...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defineUserShortcuts</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;du&#39;</span><span class="p">)])</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Plugins&#39;</span><span class="p">,</span> <span class="p">()))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Help&#39;</span><span class="p">,</span>      <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;Tutorials&quot;</span><span class="p">,([</span>
        <span class="c1"># Submenu</span>
        <span class="p">(</span><span class="s2">&quot;Beginners Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBeginnersTutorial</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Backbone Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBackboneTutorial</span><span class="p">)</span>
      <span class="p">])),</span>
      <span class="p">(</span><span class="s2">&quot;Show Shortcuts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showShortcuts</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Show CcpNmr V3 Documentation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showVersion3Documentation</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;About CcpNmr V3...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutPopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;About CCPN...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutCcpn</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Show License...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCcpnLicense</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Inspect Code...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCodeInspectionPopup</span><span class="p">,[(</span><span class="s1">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s1">&#39;gv&#39;</span><span class="p">),</span>
                                                        <span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s2">&quot;Show Issues...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showIssuesList</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Check for Updates...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showUpdatePopup</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s2">&quot;Submit Feedback...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFeedbackPopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s2">&quot;Submit Macro...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSubmitMacroPopup</span><span class="p">)</span>
    <span class="p">]</span>
               <span class="p">))</span></div>


  <span class="c1">###################################################################################################################</span>
  <span class="c1">## These will eventually move to gui (probably via a set of lambda functions.</span>
  <span class="c1">###################################################################################################################</span>
  <span class="c1">###################################################################################################################</span>
  <span class="c1">## MENU callbacks:  Project</span>
  <span class="c1">###################################################################################################################</span>




<div class="viewcode-block" id="Framework.createNewProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.createNewProject">[docs]</a>  <span class="k">def</span> <span class="nf">createNewProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">okToContinue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_queryCloseProject</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;New Project&#39;</span><span class="p">,</span>
                                                         <span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;create a new&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">okToContinue</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.newProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newProject">[docs]</a>  <span class="k">def</span> <span class="nf">newProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">):</span>
    <span class="c1"># &quot;&quot;&quot;Create new, empty project&quot;&quot;&quot;</span>

    <span class="c1"># NB _closeProject includes a gui cleanup call</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Creating new, empty project</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">useFileLogger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">project</span></div>


<div class="viewcode-block" id="Framework.openProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.openProject">[docs]</a>  <span class="k">def</span> <span class="nf">openProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectDir</span><span class="o">=</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.loadProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadProject">[docs]</a>  <span class="k">def</span> <span class="nf">loadProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Load project from path</span>
<span class="sd">       If not path then opens a file dialog box and loads project from selected file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Load Project&#39;</span><span class="p">,</span>
                          <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">dataType</span><span class="p">,</span> <span class="n">subType</span><span class="p">,</span> <span class="n">usePath</span> <span class="o">=</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">analyseUrl</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dataType</span> <span class="o">==</span> <span class="s1">&#39;Project&#39;</span> <span class="ow">and</span> <span class="n">subType</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ioFormats</span><span class="o">.</span><span class="n">CCPN</span><span class="p">,</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">NEF</span><span class="p">):</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>

      <span class="k">if</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">CCPN</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">useFileLogger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">subType</span> <span class="o">==</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">NEF</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Loading </span><span class="si">%s</span><span class="s1"> NEF project &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subType</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadNefFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span>
      <span class="c1">#</span>
      <span class="k">return</span> <span class="n">project</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Could not recognise &quot;</span><span class="si">%s</span><span class="s1">&quot; as a project</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_loadNefFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load Project from NEF file at path, and do necessary setup&quot;&quot;&quot;</span>

    <span class="n">dataBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">getNefData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">dataBlock</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">increaseBlocking</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">nefReader</span><span class="o">.</span><span class="n">importNewProject</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">dataBlock</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftAveraging</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">decreaseBlocking</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">project</span>

<div class="viewcode-block" id="Framework.clearRecentProjects"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentProjects">[docs]</a>  <span class="k">def</span> <span class="nf">clearRecentProjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.clearRecentMacros"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentMacros">[docs]</a>  <span class="k">def</span> <span class="nf">clearRecentMacros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentMacrosMenu</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.loadData"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadData">[docs]</a>  <span class="k">def</span> <span class="nf">loadData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a file dialog box and loads data from selected file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Load Data&#39;</span>

    <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                          <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">processDropData</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s1">&#39;urls&#39;</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_saveLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">moduleArea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">moduleArea</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
    <span class="n">currentModulesDict</span> <span class="o">=</span> <span class="n">moduleArea</span><span class="o">.</span><span class="n">currentModulesDict</span>
    <span class="n">layoutPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;layouts&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">,</span> <span class="s2">&quot;layout.yaml&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
      <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">currentModulesDict</span><span class="p">,</span> <span class="n">layout</span><span class="p">],</span> <span class="n">stream</span><span class="p">)</span>
      <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


  <span class="k">def</span> <span class="nf">_restoreLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">yaml</span><span class="o">,</span> <span class="nn">os</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;layouts&#39;</span><span class="p">,</span> <span class="s1">&#39;layout.yaml&#39;</span><span class="p">)):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;layouts&#39;</span><span class="p">,</span> <span class="s1">&#39;layout.yaml&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
          <span class="n">modulesDict</span><span class="p">,</span> <span class="n">layoutState</span> <span class="o">=</span>  <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">ccpn.ui.gui.modules</span> <span class="kn">as</span> <span class="nn">gm</span>
        <span class="n">ccpnModules</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">importCcpnModules</span><span class="p">(</span><span class="n">modulesDict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ccpnModule</span> <span class="ow">in</span> <span class="n">ccpnModules</span><span class="p">:</span>
          <span class="n">newModule</span> <span class="o">=</span> <span class="n">ccpnModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">newModule</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span><span class="n">layoutState</span><span class="p">)</span>

      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># for now just ignore restore failures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Layout restore failed: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

  <span class="c1">#</span>
  <span class="c1"># def _openCcpnModule(self, ccpnModules, **kwargs):</span>
  <span class="c1">#</span>
  <span class="c1">#   for ccpnModule in ccpnModules:</span>
  <span class="c1">#     if ccpnModule.moduleName == kwargs[&#39;moduleName&#39;]:</span>
  <span class="c1">#       newModule = ccpnModule(self.project)</span>
  <span class="c1">#       self.ui.mainWindow.moduleArea.addModule(newModule)</span>

  <span class="k">def</span> <span class="nf">_saveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteExisting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save project to newPath and return True if successful&quot;&quot;&quot;</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="n">createFallback</span><span class="p">,</span>
                                   <span class="n">overwriteExisting</span><span class="o">=</span><span class="n">overwriteExisting</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Project save failed</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="c1"># NBNB TODO Gui should pre-check newPath and/or pop up something in case of failure</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_updateWindowTitle</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Archive&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_updateRecentFiles</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_saveLayout</span><span class="p">()</span>

      <span class="c1"># saveIconPath = os.path.join(Path.getPathToImport(&#39;ccpn.ui.gui.widgets&#39;), &#39;icons&#39;, &#39;save.png&#39;)</span>

      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;==&gt; Project successfully saved</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
      <span class="c1"># MessageDialog.showMessage(&#39;Project saved&#39;, &#39;Project successfully saved!&#39;,</span>
      <span class="c1">#                           colourScheme=self.preferences.general.colourScheme, iconPath=saveIconPath)</span>

    <span class="k">return</span> <span class="n">successful</span>


<div class="viewcode-block" id="Framework.saveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProject">[docs]</a>  <span class="k">def</span> <span class="nf">saveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">overwriteExisting</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save project to newPath and return True if successful&quot;&quot;&quot;</span>
    <span class="c1"># TODO: convert this to a save and call self.project.save()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveProject</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="n">createFallback</span><span class="p">,</span>
                               <span class="n">overwriteExisting</span><span class="o">=</span><span class="n">overwriteExisting</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_updateRecentFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">path</span>
    <span class="n">recentFiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span>
    <span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">recentFiles</span><span class="p">:</span>
        <span class="n">recentFiles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">oldPath</span> <span class="ow">in</span> <span class="n">recentFiles</span><span class="p">:</span>
        <span class="n">recentFiles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldPath</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">recentFiles</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">recentFiles</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
      <span class="n">recentFiles</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">recentFiles</span> <span class="o">=</span> <span class="n">uniquify</span><span class="p">(</span><span class="n">recentFiles</span><span class="p">)</span>
    <span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="n">recentFiles</span>


<div class="viewcode-block" id="Framework.saveProjectAs"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProjectAs">[docs]</a>  <span class="k">def</span> <span class="nf">saveProjectAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and saves project to path specified in the file dialog.&quot;&quot;&quot;</span>
    <span class="n">oldPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span>
    <span class="n">newPath</span> <span class="o">=</span> <span class="n">getSaveDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>
      <span class="c1"># Next line unnecessary, but does not hurt</span>
      <span class="n">newProjectPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
      <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveProject</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newProjectPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Saving project to </span><span class="si">%s</span><span class="s2"> aborted&quot;</span> <span class="o">%</span> <span class="n">newProjectPath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">successful</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Project not saved - no valid destination selected&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_updateRecentFiles</span><span class="p">(</span><span class="n">oldPath</span><span class="o">=</span><span class="n">oldPath</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">successful</span></div>

    <span class="c1"># NBNB TODO Consider appropriate failure handling. Is this OK?</span>


<div class="viewcode-block" id="Framework.undo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.undo">[docs]</a>  <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">([</span><span class="s1">&#39;application.undo()&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Framework.redo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.redo">[docs]</a>  <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">([</span><span class="s1">&#39;application.redo()&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Framework.saveLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveLogFile">[docs]</a>  <span class="k">def</span> <span class="nf">saveLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.clearLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearLogFile">[docs]</a>  <span class="k">def</span> <span class="nf">clearLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.displayProjectSummary"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.displayProjectSummary">[docs]</a>  <span class="k">def</span> <span class="nf">displayProjectSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Project summary module on left of main window.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ProjectSummaryPopup</span> <span class="kn">import</span> <span class="n">ProjectSummaryPopup</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>
      <span class="n">popup</span> <span class="o">=</span> <span class="n">ProjectSummaryPopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
      <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
      <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.archiveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.archiveProject">[docs]</a>  <span class="k">def</span> <span class="nf">archiveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
    <span class="n">apiProject</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">packageProject</span><span class="p">(</span><span class="n">apiProject</span><span class="p">,</span> <span class="n">includeBackups</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">includeLogs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                    <span class="n">includeArchives</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">includeSummaries</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Project Archived&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Project archived to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_updateRestoreArchiveMenu</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_archivePaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">archivesDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_ARCHIVES_DIRECTORY</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">):</span>
      <span class="n">fileNames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">)</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">archivesDirectory</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span> <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">fileNames</span> <span class="k">if</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tgz&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">paths</span>

<div class="viewcode-block" id="Framework.restoreFromArchive"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.restoreFromArchive">[docs]</a>  <span class="k">def</span> <span class="nf">restoreFromArchive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archivePath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">archivePath</span><span class="p">:</span>
      <span class="n">archivesDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_ARCHIVES_DIRECTORY</span><span class="p">)</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">ExistingFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Select Archive&quot;</span><span class="p">,</span>
                          <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                          <span class="n">directory</span><span class="o">=</span><span class="n">archivesDirectory</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.tgz&#39;</span><span class="p">)</span>
      <span class="n">archivePath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">archivePath</span><span class="p">:</span>
      <span class="n">directoryPrefix</span> <span class="o">=</span> <span class="n">archivePath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># -4 removes the .tgz</span>
      <span class="n">outputPath</span><span class="p">,</span> <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpackCcpnTarfile</span><span class="p">(</span><span class="n">archivePath</span><span class="p">,</span> <span class="n">outputPath</span><span class="o">=</span><span class="n">directoryPrefix</span><span class="p">)</span>
      <span class="n">pythonExe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="n">Path</span><span class="o">.</span><span class="n">CCPN_PYTHON</span><span class="p">)</span>
      <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">pythonExe</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outputPath</span><span class="p">]</span>
      <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span>
      <span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_unpackCcpnTarfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tarfilePath</span><span class="p">,</span> <span class="n">outputPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">directoryPrefix</span><span class="o">=</span><span class="s1">&#39;CcpnProject_&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # CCPN INTERNAL - called in loadData method of Project</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">outputPath</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputPath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
      <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">temporaryDirectory</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">directoryPrefix</span><span class="p">)</span>
      <span class="n">outputPath</span> <span class="o">=</span> <span class="n">temporaryDirectory</span><span class="o">.</span><span class="n">name</span>

    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">outputPath</span><span class="p">)</span>
      <span class="n">tp</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tarfilePath</span><span class="p">)</span>
      <span class="n">tp</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>

       <span class="c1"># look for a directory inside and assume the first found is the project directory (there should be exactly one)</span>
      <span class="n">relfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">relfile</span> <span class="ow">in</span> <span class="n">relfiles</span><span class="p">:</span>
        <span class="n">fullfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="n">relfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fullfile</span><span class="p">):</span>
          <span class="n">outputPath</span> <span class="o">=</span> <span class="n">fullfile</span>
          <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find project directory in tarfile&#39;</span><span class="p">)</span>

    <span class="k">finally</span><span class="p">:</span>
      <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputPath</span><span class="p">,</span> <span class="n">temporaryDirectory</span>

<div class="viewcode-block" id="Framework.showApplicationPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showApplicationPreferences">[docs]</a>  <span class="k">def</span> <span class="nf">showApplicationPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Application Preferences Popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PreferencesPopup</span> <span class="kn">import</span> <span class="n">PreferencesPopup</span>

    <span class="n">PreferencesPopup</span><span class="p">(</span><span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves application preferences. Displays message box asking user to save project or not.</span>
<span class="sd">    Closes Application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/.ccpn/v3settings.json&quot;</span><span class="p">)</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">prefPath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Preferences not saved: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
    <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">reply</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showMulti</span><span class="p">(</span><span class="s2">&quot;Quit Program&quot;</span><span class="p">,</span> <span class="s2">&quot;Do you want to save changes before quitting?&quot;</span><span class="p">,</span>
                                    <span class="p">[</span><span class="s1">&#39;Save and Quit&#39;</span><span class="p">,</span> <span class="s1">&#39;Quit without Saving&#39;</span><span class="p">,</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">],</span>
                                    <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;Save and Quit&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">()</span>
      <span class="c1"># Close and clean up project</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
      <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;Quit without Saving&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
      <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_closeExtraWindows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">tempAreas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">tempAreas</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tempAreas</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">tempArea</span> <span class="ow">in</span> <span class="n">tempAreas</span><span class="p">:</span>
        <span class="n">tempArea</span><span class="o">.</span><span class="n">window</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_closeProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close project and clean up - when opening another or quitting application&quot;&quot;&quot;</span>

    <span class="c1"># NB: this function must clan up both wrapper and ui/gui</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># Cleans up wrapper project, including graphics data objects (Window, Strip, etc.)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">:</span>
      <span class="c1"># ui/gui cleanup</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeExtraWindows</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="c1">###################################################################################################################</span>
  <span class="c1">## MENU callbacks:  Spectrum</span>
  <span class="c1">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.showSpectrumGroupsPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSpectrumGroupsPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showSpectrumGroupsPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumGroupEditor</span> <span class="kn">import</span> <span class="n">SpectrumGroupEditor</span>
    <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">editorMode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.showProjectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showProjectionPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showProjectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project contains no spectra.&#39;</span><span class="p">,</span> <span class="s1">&#39;Make Projection Popup cannot be displayed&#39;</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumProjectionPopup</span> <span class="kn">import</span> <span class="n">SpectrumProjectionPopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumProjectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.showExperimentTypePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showExperimentTypePopup">[docs]</a>  <span class="k">def</span> <span class="nf">showExperimentTypePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays experiment type popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ExperimentTypePopup</span> <span class="kn">import</span> <span class="n">ExperimentTypePopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">ExperimentTypePopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.showPeakPickPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakPickPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showPeakPickPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Peak Picking Popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PeakFind</span> <span class="kn">import</span> <span class="n">PeakFindPopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">PeakFindPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">current</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showCopyPeakListPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCopyPeakListPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showCopyPeakListPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists. Peak Lists cannot be copied&#39;</span><span class="p">)</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak Lists cannot be copied&#39;</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CopyPeakListPopup</span> <span class="kn">import</span> <span class="n">CopyPeakListPopup</span>
      <span class="n">CopyPeakListPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


  <span class="c1">################################################################################################</span>
  <span class="c1">## MENU callbacks:  Molecule</span>
  <span class="c1">################################################################################################</span>

<div class="viewcode-block" id="Framework.showMoleculePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMoleculePopup">[docs]</a>  <span class="k">def</span> <span class="nf">showMoleculePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays sequence creation popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.CreateSequence</span> <span class="kn">import</span> <span class="n">CreateSequence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showMoleculePopup()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showMoleculePopup()&quot;</span><span class="p">)</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">CreateSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<div class="viewcode-block" id="Framework.toggleSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleSequenceModule">[docs]</a>  <span class="k">def</span> <span class="nf">toggleSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Toggles whether Sequence Module is displayed or not&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sequenceModule&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hideSequenceModule</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">showSequenceModule</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSequenceModule">[docs]</a>  <span class="k">def</span> <span class="nf">showSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Sequence Module at the top of the screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.SequenceModule</span> <span class="kn">import</span> <span class="n">SequenceModule</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span> <span class="o">=</span> <span class="n">SequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="p">,</span>
                                            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span></div>


<div class="viewcode-block" id="Framework.hideSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.hideSequenceModule">[docs]</a>  <span class="k">def</span> <span class="nf">hideSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hides sequence module&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;sequenceModule&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.inspectMolecule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.inspectMolecule">[docs]</a>  <span class="k">def</span> <span class="nf">inspectMolecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Framework.showRefChemicalShifts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRefChemicalShifts">[docs]</a>  <span class="k">def</span> <span class="nf">showRefChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Reference Chemical Shifts module.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ReferenceChemicalShifts</span> <span class="kn">import</span> <span class="n">ReferenceChemicalShifts</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">refChemShifts</span> <span class="o">=</span> <span class="n">ReferenceChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span></div>


  <span class="c1">###################################################################################################################</span>
  <span class="c1">## MENU callbacks:  VIEW</span>
  <span class="c1">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.addBlankDisplay"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addBlankDisplay">[docs]</a>  <span class="k">def</span> <span class="nf">addBlankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">blankDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">addBlankDisplay</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span></div>

  <span class="c1"># Property to issue deprecation warning, remove when value removed</span>
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">blankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
    <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;{}.{} is deprecated.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__class__</span><span class="p">,</span> <span class="n">__name__</span><span class="p">),</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__blankDisplay</span>
  <span class="nd">@blankDisplay.setter</span>
  <span class="k">def</span> <span class="nf">blankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__blankDisplay</span> <span class="o">=</span> <span class="n">value</span>


<div class="viewcode-block" id="Framework.showChemicalShiftTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showChemicalShiftTable">[docs]</a>  <span class="k">def</span> <span class="nf">showChemicalShiftTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Chemical Shift table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Project has no Chemical Shift Lists. Chemical Shift Table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Chemical Shift Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Chemical Shift Table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ChemicalShiftTable</span> <span class="kn">import</span> <span class="n">ChemicalShiftTable</span>
    <span class="n">chemicalShiftTable</span> <span class="o">=</span> <span class="n">ChemicalShiftTable</span><span class="p">(</span><span class="n">chemicalShiftLists</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">chemicalShiftTable</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showNmrResidueTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showNmrResidueTable">[docs]</a>  <span class="k">def</span> <span class="nf">showNmrResidueTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Nmr Residue Table&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.NmrResidueTable</span> <span class="kn">import</span> <span class="n">NmrResidueTableModule</span>
    <span class="n">nmrResidueTableModule</span> <span class="o">=</span> <span class="n">NmrResidueTableModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="c1">#nmrResidueTableModule = CcpnModule(name=&#39;Nmr Residue Table&#39;)</span>
    <span class="c1">#nmrResidueTableModule.layout.addWidget(nmrResidueTable)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">nmrResidueTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showPeakTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakTable">[docs]</a>  <span class="k">def</span> <span class="nf">showPeakTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectedList</span><span class="p">:</span><span class="n">PeakList</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Peak table on left of main window with specified list selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.PeakTable</span> <span class="kn">import</span> <span class="n">PeakTable</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists. Peak table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Peak Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">peakTable</span> <span class="o">=</span> <span class="n">PeakTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">selectedList</span><span class="o">=</span><span class="n">selectedList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakTable</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showPeakTable()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showPeakTable()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showRestraintTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRestraintTable">[docs]</a>  <span class="k">def</span> <span class="nf">showRestraintTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectedList</span><span class="p">:</span><span class="n">PeakList</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Peak table on left of main window with specified list selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.RestraintTable</span> <span class="kn">import</span> <span class="n">RestraintTable</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">restraintLists</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Project has no Restraint Lists. Restraint table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Project has no Restraint Lists.&#39;</span><span class="p">,</span> <span class="s1">&#39;Restraint table cannot be displayed&#39;</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="n">restraintTable</span> <span class="o">=</span> <span class="n">RestraintTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">selectedList</span><span class="o">=</span><span class="n">selectedList</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">restraintTable</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showRestraintTable()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showRestraintTable()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showPrintSpectrumDisplayPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPrintSpectrumDisplayPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showPrintSpectrumDisplayPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PrintSpectrumPopup</span> <span class="kn">import</span> <span class="n">SelectSpectrumDisplayPopup</span> <span class="c1">#,PrintSpectrumDisplayPopup</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;No Spectrum Display found&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">SelectSpectrumDisplayPopup</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>
      <span class="c1"># PrintSpectrumDisplayPopup(project=self.project).exec_()</span>


<div class="viewcode-block" id="Framework.showSequenceGraph"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSequenceGraph">[docs]</a>  <span class="k">def</span> <span class="nf">showSequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays assigner at the bottom of the screen, relative to another module if nextTo is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.AnalysisAssign.modules.SequenceGraph</span> <span class="kn">import</span> <span class="n">SequenceGraph</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;assigner&#39;</span><span class="p">):</span>
      <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assigner</span> <span class="o">=</span> <span class="n">SequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;backboneModule&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">backboneModule</span><span class="o">.</span><span class="n">_connectSequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">relativeTo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showSequenceGraph()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showSequenceGraph()&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assigner</span></div>

<div class="viewcode-block" id="Framework.showAtomSelector"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAtomSelector">[docs]</a>  <span class="k">def</span> <span class="nf">showAtomSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Atom Selector.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.AnalysisAssign.modules.AtomSelector</span> <span class="kn">import</span> <span class="n">AtomSelector</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span> <span class="o">=</span> <span class="n">AtomSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.showAtomSelector()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.showAtomSelector()&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span></div>

<div class="viewcode-block" id="Framework.toggleToolbar"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleToolbar">[docs]</a>  <span class="k">def</span> <span class="nf">toggleToolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">toggleToolbar</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.togglePhaseConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.togglePhaseConsole">[docs]</a>  <span class="k">def</span> <span class="nf">togglePhaseConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.resetZoom"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.resetZoom">[docs]</a>  <span class="k">def</span> <span class="nf">resetZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_findMenuAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menubarText</span><span class="p">,</span> <span class="n">menuText</span><span class="p">):</span>

    <span class="c1"># not sure if this function will be needed more widely or just in console context</span>

    <span class="k">for</span> <span class="n">menuBarAction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_menuBar</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">menuBarAction</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">menubarText</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>

    <span class="k">for</span> <span class="n">menuAction</span> <span class="ow">in</span> <span class="n">menuBarAction</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">menuAction</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">menuText</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">menuAction</span>

    <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="Framework.toggleConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleConsole">[docs]</a>  <span class="k">def</span> <span class="nf">toggleConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether python console is displayed at bottom of the main window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;Python Console&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">moveModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findMenuAction</span><span class="p">(</span><span class="s1">&#39;View&#39;</span><span class="p">,</span> <span class="s1">&#39;Python Console&#39;</span><span class="p">)</span>
      <span class="n">closeFunc</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">trigger</span> <span class="k">if</span> <span class="n">action</span> <span class="k">else</span> <span class="bp">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Python Console&#39;</span><span class="p">,</span> <span class="n">closeFunc</span><span class="o">=</span><span class="n">closeFunc</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span></div>


  <span class="c1">#################################################################################################</span>
  <span class="c1">## MENU callbacks:  Macro</span>
  <span class="c1">#################################################################################################</span>

<div class="viewcode-block" id="Framework.showMacroEditor"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMacroEditor">[docs]</a>  <span class="k">def</span> <span class="nf">showMacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro Editor&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.newMacroFromConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromConsole">[docs]</a>  <span class="k">def</span> <span class="nf">newMacroFromConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with contents of python console inside.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro Editor&quot;</span><span class="p">)</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">textEditor</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span></div>

<div class="viewcode-block" id="Framework.newMacroFromLog"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromLog">[docs]</a>  <span class="k">def</span> <span class="nf">newMacroFromLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with contents of the log.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro Editor&quot;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">logPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.startMacroRecord"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.startMacroRecord">[docs]</a>  <span class="k">def</span> <span class="nf">startMacroRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with additional buttons for recording a macro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">macroEditor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro Editor&quot;</span><span class="p">,</span> <span class="n">showRecordButtons</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;application.startMacroRecord()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.startMacroRecord()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.defineUserShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.defineUserShortcuts">[docs]</a>  <span class="k">def</span> <span class="nf">defineUserShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ShortcutModule</span> <span class="kn">import</span> <span class="n">ShortcutModule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shortcutModule</span> <span class="o">=</span> <span class="n">ShortcutModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.runMacro"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.runMacro">[docs]</a>  <span class="k">def</span> <span class="nf">runMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macroFile</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a macro if a macro is specified, or opens a dialog box for selection of a macro file and then</span>
<span class="sd">    runs the selected macro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">macroFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">ExistingFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Run Macro&quot;</span><span class="p">,</span>
                          <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                          <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userMacroPath</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;*.py&#39;</span><span class="p">)</span>
      <span class="n">macroFile</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">macroFile</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">macroFile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span>
    <span class="c1"># self._fillRecentMacrosMenu()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">_runMacro</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span></div>


  <span class="c1">###################################################################################################################</span>
  <span class="c1">## MENU callbacks:  Help</span>
  <span class="c1">###################################################################################################################</span>



  <span class="k">def</span> <span class="nf">_systemOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="s2">&quot;Open path on system&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;xdg-open </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;open </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_showHtmlFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="s2">&quot;Displays html files in program QT viewer or using native webbrowser depending on useNativeWebbrowser option&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">useNativeWebbrowser</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.CcpnWebView</span> <span class="kn">import</span> <span class="n">CcpnWebView</span>
      <span class="n">newModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
      <span class="n">view</span> <span class="o">=</span> <span class="n">CcpnWebView</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
      <span class="n">newModule</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">newModule</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.showBeginnersTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBeginnersTutorial">[docs]</a>  <span class="k">def</span> <span class="nf">showBeginnersTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">beginnersTutorialPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">beginnersTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showBackboneTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBackboneTutorial">[docs]</a>  <span class="k">def</span> <span class="nf">showBackboneTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">backboneAssignmentTutorialPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">backboneAssignmentTutorialPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showVersion3Documentation"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showVersion3Documentation">[docs]</a>  <span class="k">def</span> <span class="nf">showVersion3Documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays CCPN wrapper documentation in a module.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">documentationPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_showHtmlFile</span><span class="p">(</span><span class="s2">&quot;Analysis Version-3 Documentation&quot;</span><span class="p">,</span> <span class="n">documentationPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showShortcuts">[docs]</a>  <span class="k">def</span> <span class="nf">showShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">shortcutsPath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">shortcutsPath</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showAboutPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showAboutPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.AboutPopup</span> <span class="kn">import</span> <span class="n">AboutPopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">AboutPopup</span><span class="p">()</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showAboutCcpn"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutCcpn">[docs]</a>  <span class="k">def</span> <span class="nf">showAboutCcpn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnUrl</span>
    <span class="kn">import</span> <span class="nn">webbrowser</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnUrl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCcpnLicense"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCcpnLicense">[docs]</a>  <span class="k">def</span> <span class="nf">showCcpnLicense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnLicenceUrl</span>
    <span class="kn">import</span> <span class="nn">webbrowser</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnLicenceUrl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Framework.showCodeInspectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCodeInspectionPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showCodeInspectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># TODO: open a file browser to top of source directory</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Framework.showIssuesList"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showIssuesList">[docs]</a>  <span class="k">def</span> <span class="nf">showIssuesList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">ccpnIssuesUrl</span>
    <span class="kn">import</span> <span class="nn">webbrowser</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ccpnIssuesUrl</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.showUpdatePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showUpdatePopup">[docs]</a>  <span class="k">def</span> <span class="nf">showUpdatePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.update.UpdatePopup</span> <span class="kn">import</span> <span class="n">UpdatePopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="n">UpdatePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showFeedbackPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showFeedbackPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showFeedbackPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.FeedbackPopup</span> <span class="kn">import</span> <span class="n">FeedbackPopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="n">FeedbackPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showSubmitMacroPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSubmitMacroPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showSubmitMacroPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SubmitMacroPopup</span> <span class="kn">import</span> <span class="n">SubmitMacroPopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="n">SubmitMacroPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

<div class="viewcode-block" id="Framework.showLicense"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showLicense">[docs]</a>  <span class="k">def</span> <span class="nf">showLicense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">licensePath</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_systemOpen</span><span class="p">(</span><span class="n">licensePath</span><span class="p">)</span></div></div>


  <span class="c1">#########################################    End Menu callbacks   ##################################################</span>

  <span class="c1"># def printToFile(self, spectrumDisplay=None):</span>
  <span class="c1">#</span>
  <span class="c1">#   current = self.current</span>
  <span class="c1">#   # if not spectrumDisplay:</span>
  <span class="c1">#   #   spectrumDisplay = current.spectrumDisplay</span>
  <span class="c1">#   if not spectrumDisplay and current.strip:</span>
  <span class="c1">#     spectrumDisplay = current.strip.spectrumDisplay</span>
  <span class="c1">#   if not spectrumDisplay and self.spectrumDisplays:</span>
  <span class="c1">#     spectrumDisplay = self.spectrumDisplays[0]</span>
  <span class="c1">#   if spectrumDisplay:</span>
  <span class="c1">#     dialog = FileDialog(parent=self.ui.mainWindow, fileMode=FileDialog.AnyFile, text=&#39;Print to File&#39;,</span>
  <span class="c1">#                         acceptMode=FileDialog.AcceptSave, preferences=self.preferences.general, filter=&#39;SVG (*.svg)&#39;)</span>
  <span class="c1">#     path = dialog.selectedFile()</span>
  <span class="c1">#     if not path:</span>
  <span class="c1">#       return</span>
  <span class="c1">#     spectrumDisplay.printToFile(path)</span>

<div class="viewcode-block" id="getSaveDirectory"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getSaveDirectory">[docs]</a><span class="k">def</span> <span class="nf">getSaveDirectory</span><span class="p">(</span><span class="n">preferences</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and gets directory specified in the file dialog.&quot;&quot;&quot;</span>

  <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Save Project As&#39;</span><span class="p">,</span>
                      <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="n">preferences</span><span class="p">)</span>
  <span class="n">newPath</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">newPath</span><span class="p">:</span>
    <span class="k">return</span>
  <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>
    <span class="n">newPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">newPath</span><span class="p">)):</span>
      <span class="c1"># should not really need to check the second and third condition above, only</span>
      <span class="c1"># the Qt dialog stupidly insists a directory exists before you can select it</span>
      <span class="c1"># so if it exists but is empty then don&#39;t bother asking the question</span>
      <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Overwrite path&#39;</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Path &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists, continue?&#39;</span> <span class="o">%</span> <span class="n">newPath</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showYesNo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">colourScheme</span><span class="o">=</span><span class="n">preferences</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">):</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">return</span> <span class="n">newPath</span></div>

<span class="c1">########</span>

<div class="viewcode-block" id="getPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getPreferences">[docs]</a><span class="k">def</span> <span class="nf">getPreferences</span><span class="p">(</span><span class="n">skipUserPreferences</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">defaultPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">userPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">collections</span>
    <span class="c1"># recursive update of dictionary</span>
    <span class="c1"># this deletes every key in u that is not in d</span>
    <span class="c1"># if we want every key regardless, then remove first if check below</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">d</span>

  <span class="c1"># read the default settings</span>
  <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">defaultPreferencesPath</span>
  <span class="n">preferencesPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultPath</span> <span class="k">if</span> <span class="n">defaultPath</span> <span class="k">else</span> <span class="n">defaultPreferencesPath</span><span class="p">)</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>

  <span class="c1"># read user settings and update if not skipped</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">skipUserPreferences</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">userPreferencesPath</span>
    <span class="n">preferencesPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">userPath</span> <span class="k">if</span> <span class="n">userPath</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">userPreferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span>
      <span class="n">preferences</span> <span class="o">=</span> <span class="n">_updateDict</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">userPreferences</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">preferences</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>