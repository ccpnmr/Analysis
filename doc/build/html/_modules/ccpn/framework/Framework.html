<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.framework.Framework &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.framework.Framework</h1><div class="highlight"><pre>
<span class="c">#=========================================================================================</span>
<span class="c"># Licence, Reference and Credits</span>
<span class="c">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;Copyright (C) CCPN project (www.ccpn.ac.uk) 2014 - $Date: 2016-05-16 17:45:50 +0100 (Mon, 16 May 2016) $&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="s">&quot;Wayne Boucher, Rasmus H Fogh, Luca Mureddu, Simon P Skinner &amp; Geerten W Vuister&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;CCPN license. See www.ccpn.ac.uk/license &quot;</span>
              <span class="s">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for license text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;For publications, please use reference from www.ccpn.ac.uk/license&quot;</span>
                <span class="s">&quot; or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c">#=========================================================================================</span>
<span class="c"># Last code modification:</span>
<span class="c">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;$Author: TJ Ragan $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&quot;$Date: 2016-05-16 17:45:50 +0100 (Mon, 16 May 2016) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;$Revision: 9320 $&quot;</span>

<span class="c">#=========================================================================================</span>
<span class="c"># Start of code</span>
<span class="c">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.memops</span> <span class="kn">import</span> <span class="n">Implementation</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Api</span> <span class="k">as</span> <span class="n">apiIo</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>

<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation</span> <span class="kn">import</span> <span class="n">Io</span> <span class="k">as</span> <span class="n">coreIo</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Version</span> <span class="kn">import</span> <span class="n">applicationVersion</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>

<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Register</span>
<span class="kn">from</span> <span class="nn">ccpn.util.AttrDict</span> <span class="kn">import</span> <span class="n">AttrDict</span>

<span class="kn">from</span> <span class="nn">ccpn.framework.lib</span> <span class="kn">import</span> <span class="n">SvnRevision</span>

<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">languages</span><span class="p">,</span> <span class="n">defaultLanguage</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">translator</span>

<span class="kn">from</span> <span class="nn">ccpn.ui</span> <span class="kn">import</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">defaultInterface</span>
<span class="kn">from</span> <span class="nn">ccpn.framework.Current</span> <span class="kn">import</span> <span class="n">Current</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.MacroEditor</span> <span class="kn">import</span> <span class="n">MacroEditor</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Module</span> <span class="kn">import</span> <span class="n">CcpnModule</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets</span> <span class="kn">import</span> <span class="n">MessageDialog</span>
<span class="c"># from ccpn.ui.gui.widgets.Action import Action</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.Window</span> <span class="kn">import</span> <span class="n">MODULE_DICT</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QKeySequence</span>

<span class="n">_DEBUG</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">componentNames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Assignment&#39;</span><span class="p">,</span> <span class="s">&#39;Screening&#39;</span><span class="p">,</span> <span class="s">&#39;Structure&#39;</span><span class="p">)</span>

<span class="n">interfaceNames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;NoUi&#39;</span><span class="p">,</span> <span class="s">&#39;Gui&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="printCreditsText"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.printCreditsText">[docs]</a><span class="k">def</span> <span class="nf">printCreditsText</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Initial text to terminal &quot;&quot;&quot;</span>

  <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">, version: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">programName</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__copyright__</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">__copyright__</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;- 2016&#39;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__license__</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Not to be distributed without prior consent!&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
  <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Written by: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">__credits__</span><span class="p">)</span>

  <span class="c"># print with aligning &#39;|&#39;s</span>
  <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span><span class="n">lines</span><span class="p">))</span>
  <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">+</span><span class="mi">8</span><span class="p">)))</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;|   </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;  |</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
  <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">+</span><span class="mi">8</span><span class="p">)))</span></div>


<div class="viewcode-block" id="defineProgramArguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.defineProgramArguments">[docs]</a><span class="k">def</span> <span class="nf">defineProgramArguments</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Define the arguments of the program</span>
<span class="sd">  return argparse instance</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">argparse</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;Process startup arguments&#39;</span><span class="p">)</span>
  <span class="c"># for component in componentNames:</span>
  <span class="c">#   parser.add_argument(&#39;--&#39;+component.lower(), dest=&#39;include&#39;+component, action=&#39;store_true&#39;,</span>
  <span class="c">#                                               help=&#39;Show %s component&#39; % component.lower())</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--language&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Language for menus, etc.; valid options = (</span><span class="si">%s</span><span class="s">); default=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span> <span class="p">,</span><span class="n">defaultLanguage</span><span class="p">)),</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">defaultLanguage</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--interface&#39;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;User interface, to use; one of  = (</span><span class="si">%s</span><span class="s">); default=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interfaces</span><span class="p">)</span> <span class="p">,</span><span class="n">defaultInterface</span><span class="p">)),</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">defaultInterface</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--skip-user-preferences&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;skipUserPreferences&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span>
                                                 <span class="n">help</span><span class="o">=</span><span class="s">&#39;Skip loading user preferences&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--nologging&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;nologging&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Do not log information to a file&#39;</span><span class="p">)</span>
  <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;projectPath&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Project path&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">parser</span></div>

<div class="viewcode-block" id="Arguments"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Arguments">[docs]</a><span class="k">class</span> <span class="nc">Arguments</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Class for setting FrameWork input arguments directly&quot;&quot;&quot;</span>
  <span class="n">language</span> <span class="o">=</span> <span class="n">defaultLanguage</span>
  <span class="n">interface</span> <span class="o">=</span> <span class="s">&#39;NoUi&#39;</span>
  <span class="n">nologging</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">skipUserPreferences</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

    <span class="c"># Dummy values</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">componentNames</span><span class="p">:</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;include&#39;</span> <span class="o">+</span> <span class="n">component</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">projectPath</span> <span class="o">=</span> <span class="n">projectPath</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="getFramework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getFramework">[docs]</a><span class="k">def</span> <span class="nf">getFramework</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

  <span class="n">args</span> <span class="o">=</span> <span class="n">Arguments</span><span class="p">(</span><span class="n">projectPath</span><span class="o">=</span><span class="n">projectPath</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">Framework</span><span class="p">(</span><span class="s">&#39;CcpNmr&#39;</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
  <span class="n">result</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
  <span class="c">#</span>
  <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="Framework"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework">[docs]</a><span class="k">class</span> <span class="nc">Framework</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  The Framework class is the base class for all applications</span>
<span class="sd">  It&#39;s currently broken, so don&#39;t use this if you want your application to actually work!</span>
<span class="sd">  &quot;&quot;&quot;</span>


  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="n">applicationName</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span> <span class="o">=</span> <span class="n">applicationVersion</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">SvnRevision</span><span class="o">.</span><span class="n">revision</span><span class="p">()</span>

    <span class="n">printCreditsText</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">applicationName</span><span class="p">,</span> <span class="n">applicationVersion</span><span class="p">)</span>

    <span class="c"># self.setupComponents(args)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">useFileLogger</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nologging</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Necessary as attribute is queried during initialisation:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># This is needed to make project available in NoUi (if nothing else)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># Blocking level for command echo and logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># NBNB TODO The following block should maybe be moved into _getUi</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_getUserPrefs</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setLanguage</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styleSheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getUI</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setupMenus</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backupPopup</span> <span class="o">=</span> <span class="bp">None</span>


<div class="viewcode-block" id="Framework.start"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.start">[docs]</a>  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start the program execution&quot;&quot;&quot;</span>

    <span class="c"># Load / create project</span>
    <span class="n">projectPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">projectPath</span>
    <span class="k">if</span> <span class="n">projectPath</span><span class="p">:</span>
      <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectPath</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Done, </span><span class="si">%s</span><span class="s"> is starting</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationName</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkRegistration</span><span class="p">():</span>
      <span class="k">return</span>

    <span class="c"># self.project = project</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    
    <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_initialiseProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialise project and set up links and objects that involve it&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

    <span class="c"># Pass an instance of framework to project so the UI instantiation can happen</span>
    <span class="n">project</span><span class="o">.</span><span class="n">_appBase</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="c"># Set up current</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">Current</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">)</span>

    <span class="c"># This wraps the underlying data, including the wrapped graphics data</span>
    <span class="c">#  - the project is now ready to use</span>

    <span class="n">project</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">()</span>

    <span class="c"># Adapt project to preferences</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">applyPreferences</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span>

    <span class="c"># Get the mainWindow out of the framework once it&#39;s been transferred to ui</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mainWindow</span>


  <span class="k">def</span> <span class="nf">_getUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="s">&#39;Gui&#39;</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.gui.Gui</span> <span class="kn">import</span> <span class="n">Gui</span>
      <span class="n">ui</span> <span class="o">=</span> <span class="n">Gui</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.ui.Ui</span> <span class="kn">import</span> <span class="n">NoUi</span>
      <span class="n">ui</span> <span class="o">=</span> <span class="n">NoUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c"># Connect UI classes for chosen ui</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ui</span>


<div class="viewcode-block" id="Framework.getStyleSheet"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getStyleSheet">[docs]</a>  <span class="k">def</span> <span class="nf">getStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">preferences</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">preferences</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span>

    <span class="n">colourScheme</span> <span class="o">=</span> <span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span>
    <span class="n">colourScheme</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">upperFirst</span><span class="p">(</span><span class="n">colourScheme</span><span class="p">)</span>

    <span class="n">styleSheet</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                                   <span class="s">&#39;</span><span class="si">%s</span><span class="s">StyleSheet.qss&#39;</span> <span class="o">%</span> <span class="n">colourScheme</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span><span class="p">:</span>
      <span class="n">additions</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getPathToImport</span><span class="p">(</span><span class="s">&#39;ccpn.ui.gui.widgets&#39;</span><span class="p">),</span>
                                    <span class="s">&#39;</span><span class="si">%s</span><span class="s">AdditionsLinux.qss&#39;</span> <span class="o">%</span> <span class="n">colourScheme</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
      <span class="n">styleSheet</span> <span class="o">+=</span> <span class="n">additions</span>
    <span class="k">return</span> <span class="n">styleSheet</span></div>


  <span class="c"># def setupComponents(self, args):</span>
  <span class="c">#   # components (for menus)</span>
  <span class="c">#   self.components = set()</span>
  <span class="c">#   for component in componentNames:</span>
  <span class="c">#     if getattr(args, &#39;include&#39; + component):</span>
  <span class="c">#       self.components.add(component)</span>
  <span class="c">#</span>
  <span class="c">#</span>
  <span class="k">def</span> <span class="nf">_getUserPrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># user preferences</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Getting user preferences</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span> <span class="o">=</span> <span class="n">getPreferences</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">skipUserPreferences</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_setLanguage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Language, check for command line override, or use preferences</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
      <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">language</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">setLanguage</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
    <span class="c"># translator.setDebug(True)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Language set to &quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">translator</span><span class="o">.</span><span class="n">_language</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_isRegistered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;return True if registered&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span> <span class="o">=</span> <span class="n">Register</span><span class="o">.</span><span class="n">loadDict</span><span class="p">()</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">Register</span><span class="o">.</span><span class="n">isNewRegistration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_checkRegistration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display registration popup if there is a gui</span>
<span class="sd">    return True if ok</span>
<span class="sd">    return False on error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.RegisterPopup</span> <span class="kn">import</span> <span class="n">RegisterPopup</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isRegistered</span><span class="p">():</span>
        <span class="n">popup</span> <span class="o">=</span> <span class="n">RegisterPopup</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isRegistered</span><span class="p">():</span>
      <span class="k">return</span> <span class="bp">False</span>

    <span class="n">Register</span><span class="o">.</span><span class="n">updateServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_registrationDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="Framework.applyPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.applyPreferences">[docs]</a>  <span class="k">def</span> <span class="nf">applyPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply user preferences</span>

<span class="sd">    NBNB project should be impliclt rather than a parameter (once reorganisation is finished)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Reset remoteData DataStores to match preferences setting</span>
    <span class="n">dataPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">dataPath</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dataPath</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dataPath</span><span class="p">):</span>
      <span class="n">dataPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span>
    <span class="n">memopsRoot</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span>
    <span class="n">dataUrl</span> <span class="o">=</span> <span class="n">memopsRoot</span><span class="o">.</span><span class="n">findFirstDataLocationStore</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;standard&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findFirstDataUrl</span><span class="p">(</span>
      <span class="n">name</span><span class="o">=</span><span class="s">&#39;remoteData&#39;</span>
    <span class="p">)</span>
    <span class="n">dataUrl</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">Implementation</span><span class="o">.</span><span class="n">Url</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">dataPath</span><span class="p">)</span></div>


<div class="viewcode-block" id="Framework.initGraphics"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.initGraphics">[docs]</a>  <span class="k">def</span> <span class="nf">initGraphics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set up graphics system after loading&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.Window</span> <span class="kn">import</span> <span class="n">MODULE_DICT</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules</span> <span class="kn">import</span> <span class="n">GuiStrip</span>
    <span class="c"># Initialise strips</span>
    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
    <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
      <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_setupGuiStrip</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">strip</span><span class="o">.</span><span class="n">_wrappedData</span><span class="p">)</span>

      <span class="c"># if isinstance(strip, GuiStripNd) and not strip.haveSetupZWidgets:</span>
      <span class="c">#   strip.setZWidgets()</span>

    <span class="c"># Initialise Rulers</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">apiMark</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedMarks</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">apiMark</span><span class="o">.</span><span class="n">sortedRulers</span><span class="p">():</span>
          <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_rulerCreated</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">)</span>

    <span class="c"># Initialise SpectrumViews</span>
    <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
          <span class="n">spectrumView</span><span class="o">.</span><span class="n">_createdSpectrumView</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">peakList</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
            <span class="n">strip</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakList</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initLayout</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_initLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Restore layout of modules from previous save after graphics have been set up.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">yaml</span><span class="o">,</span> <span class="nn">os</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;layouts&#39;</span><span class="p">,</span> <span class="s">&#39;layout.yaml&#39;</span><span class="p">)):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;layouts&#39;</span><span class="p">,</span> <span class="s">&#39;layout.yaml&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">typ</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">layout</span><span class="p">[</span><span class="s">&#39;main&#39;</span><span class="p">]</span>

        <span class="c"># TODO: When UI has a main window, change the call below (then move the whole function!)</span>
        <span class="n">containers</span><span class="p">,</span> <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
        <span class="n">flatten</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">n</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">n</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="k">else</span> <span class="p">(</span><span class="n">a</span><span class="p">,)))</span>
        <span class="n">flatContents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">contents</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">flatContents</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">MODULE_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
             <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODULE_DICT</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
             <span class="n">func</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">layout</span><span class="p">[</span><span class="s">&#39;float&#39;</span><span class="p">]:</span>
          <span class="n">typ</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;main&#39;</span><span class="p">]</span>
          <span class="n">containers</span><span class="p">,</span> <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dock&#39;</span><span class="p">:</span>
              <span class="n">obj</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
              <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MODULE_DICT</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>


<div class="viewcode-block" id="Framework.getByPid"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.getByPid">[docs]</a>  <span class="k">def</span> <span class="nf">getByPid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_startCommandBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">objectParameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Start block for command echoing, set undo waypoint, and echo command to ui and logger</span>

<span class="sd">    MUST be paired with _endCommandBlock call - use try ... finally to ensure both are called</span>

<span class="sd">    Set keyword:value objectParameters to point to the relevant objects in setup commands,</span>
<span class="sd">    and pass setup commands and command proper to ui for echoing</span>

<span class="sd">    Example calls:</span>

<span class="sd">    _startCommandBlock(&quot;application.createSpectrumDisplay(spectrum)&quot;, spectrum=spectrumOrPid)</span>

<span class="sd">    _startCommandBlock(</span>
<span class="sd">       &quot;newAssignment = peak.assignDimension(axisCode=%s, value=[newNmrAtom]&quot; % axisCode,</span>
<span class="sd">       peak=peakOrPid)&quot;&quot;&quot;</span>

    <span class="n">undo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">undo</span><span class="o">.</span><span class="n">blocking</span><span class="p">:</span>

      <span class="c"># set undo step</span>
      <span class="n">undo</span><span class="o">.</span><span class="n">newWaypoint</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">suspendNotification</span><span class="p">()</span>

      <span class="c"># Get list of command strings</span>
      <span class="n">commands</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">objectParameters</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">pid</span>
        <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> = project.getByPid(</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
      <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

      <span class="c"># echo command strings</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">(</span><span class="n">commands</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;startCommandBlock. command=</span><span class="si">%s</span><span class="s">, echoBlocking=</span><span class="si">%s</span><span class="s">, undo.blocking=</span><span class="si">%s</span><span class="s">&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span><span class="p">,</span> <span class="n">undo</span><span class="o">.</span><span class="n">blocking</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_endCommandBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;End block for command echoing,</span>

<span class="sd">    MUST be paired with _startCommandBlock call - use try ... finally to ensure both are called&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;endCommandBlock. echoBlocking=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c"># If statement should always be True, but to avoid weird behaviour in error situations we check</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">resumeNotification</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.addApplicationMenuSpec"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addApplicationMenuSpec">[docs]</a>  <span class="k">def</span> <span class="nf">addApplicationMenuSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


  <span class="c">#########################################    Start setup Menus      ############################</span>

<div class="viewcode-block" id="Framework.setupMenus"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.setupMenus">[docs]</a>  <span class="k">def</span> <span class="nf">setupMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Setup the menu specification.</span>

<span class="sd">    The menus are specified by a list of lists (actually, an iterable of iterables, but the term</span>
<span class="sd">    ‘list’ will be used here to mean any iterable).  Framework provides 7 menus: Project, Spectrum,</span>
<span class="sd">    Molecules, View, Macro, Plugins, Help.  If you want to create your own menu in a subclass of</span>
<span class="sd">    Framework, you need to create a list in the style described below, then call</span>
<span class="sd">    self.addApplicationMenuSpec and pass in your menu specification list.</span>

<span class="sd">    Menu specification lists are composed of two items, the first being a string which is the menu’s</span>
<span class="sd">    title, the second is a list of sub-menu items.  Each item can be zero, two or three items long.</span>
<span class="sd">    A zero-length list indicates a separator.  If the list is length two and the second item is a</span>
<span class="sd">    list, then it specifies a sub-menu in a recursive manner.  If the list is length two and the second</span>
<span class="sd">    item is callable, it specifies a menu action with the first item specifying the label and the second</span>
<span class="sd">    the callable that is triggered when the menu item is selected.  If the list is length three, it is</span>
<span class="sd">    treated as a menu item specification, with the third item a list of keyword, value pairs.</span>

<span class="sd">    The examples below may make this more clear…</span>

<span class="sd">    Create a menu called ‘Test’ with two items and a separator:</span>

<span class="sd">    | - Test</span>
<span class="sd">        |- Item One</span>
<span class="sd">        |- ------</span>
<span class="sd">        |- Item Two</span>

<span class="sd">    Where clicking on ‘Item One’ calls method self.itemOneMethod and clicking on ‘Item Two’</span>
<span class="sd">    calls self.itemTwoMethod</span>

<span class="sd">        def setupMenus(self):</span>
<span class="sd">          menuSpec = (‘Test’, [(‘Item One’, self.itemOneMethod),</span>
<span class="sd">                               (),</span>
<span class="sd">                               (‘Item Two’, self.itemTwoMethod),</span>
<span class="sd">                              ]</span>
<span class="sd">          self.addApplicationMenuSpec(menuSpec)</span>

<span class="sd">    
</span>
<span class="sd">    More complicated menus are possible.  For example, to create the following menu</span>

<span class="sd">    | - Test</span>
<span class="sd">        |- Item A     ia</span>
<span class="sd">        |- ------</span>
<span class="sd">        |- Submenu B</span>
<span class="sd">           |- Item B1</span>
<span class="sd">           |- Item B2</span>
<span class="sd">        |- Item C     id</span>

<span class="sd">    where Item A can be activated using the two-key shortcut ‘ia’,</span>
<span class="sd">    Submenu B contains two static menu items, B1 and B2</span>
<span class="sd">    Submenu item B2 is checkable, but not checked by default</span>
<span class="sd">    Item C is disabled by default and has a shortcut of ‘ic’</span>

<span class="sd">        def setupMenus(self):</span>
<span class="sd">          subMenuSpecB = [(‘Item B1’, self.itemB1),</span>
<span class="sd">                          (‘Item B2’, self.itemB2, [(‘checkable’, True),</span>
<span class="sd">                                                    (‘checked’, False)])</span>
<span class="sd">                         ]</span>

<span class="sd">          menuSpec = (‘Test’, [(‘Item A’, self.itemA, [(‘shortcut’, ‘ia’)]),</span>
<span class="sd">                               (),</span>
<span class="sd">                               (‘Submenu B’, subMenuB),</span>
<span class="sd">                               (‘Item C’, self.itemA, [(‘shortcut’, ‘ic’),</span>
<span class="sd">                                                       (‘enabled’, False)]),</span>
<span class="sd">                              ]</span>
<span class="sd">          self.addApplicationMenuSpec(menuSpec)</span>


<span class="sd">    If we’re using the PyQt GUI, we can get the Qt action representing Item B2 somewhere in our code</span>
<span class="sd">    (for example, to change the checked status,) via:</span>

<span class="sd">        action = framework.ui.mainWindow.getMenuAction(‘Test-&gt;Submenu B-&gt;Item B2’)</span>
<span class="sd">        action.setChecked(True)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_menuSpec</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># TODO: remove QKeySequence</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Project&#39;</span><span class="p">,</span>   <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;New&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createNewProject</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;pn&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Open...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openProject</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;po&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Open Recent&quot;</span><span class="p">,</span> <span class="p">()),</span>

      <span class="p">(</span><span class="s">&quot;Load Spectrum&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load Spectrum&#39;</span><span class="p">),</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ls&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Load Data&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadData</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ld&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ps&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Save As...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProjectAs</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;sa&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Undo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="n">QKeySequence</span><span class="p">(</span><span class="s">&quot;Ctrl+z&quot;</span><span class="p">))]),</span>
      <span class="p">(</span><span class="s">&quot;Redo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redo</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="n">QKeySequence</span><span class="p">(</span><span class="s">&quot;Ctrl+y&quot;</span><span class="p">))]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Summary&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">displayProjectSummary</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Archive&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">archiveProject</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Backup...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBackupPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Preferences&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showApplicationPreferences</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Close Program&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closeEvent</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;qt&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Spectrum&#39;</span><span class="p">,</span>  <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;Spectrum Groups...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSpectrumGroupsPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ss&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Set Experiment Types...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showExperimentTypePopup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;et&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Pick Peaks...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakPickPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;pp&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Integration&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showIntegrationModule</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;it&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s">&#39;enabled&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Make Projection...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showProjectionPopup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;pj&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Phasing Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;pc&#39;</span><span class="p">)])</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Molecules&#39;</span><span class="p">,</span> <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;Create Molecule...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showMoleculePopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Show Sequence&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleSequenceModule</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;sq&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                                                    <span class="p">]),</span>
      <span class="p">(</span><span class="s">&quot;Inspect...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspectMolecule</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Reference Chemical Shifts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showRefChemicalShifts</span><span class="p">,[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;rc&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;View&#39;</span><span class="p">,</span>      <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;New Blank Display&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">addBlankDisplay</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;nd&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Chemical Shift Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showChemicalShiftTable</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ct&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;NmrResidue Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showNmrResidueTable</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;nt&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Peak Table&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPeakTable</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;lt&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Sequence Graph&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSequenceGraph</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;sg&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Atom Selector&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAtomSelector</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;as&#39;</span><span class="p">)]),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Console&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggleConsole</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;py&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s">&#39;checkable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s">&#39;checked&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)])</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Macro&#39;</span><span class="p">,</span>     <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;Edit...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showMacroEditor</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;New from Console...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newMacroFromConsole</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;New from Log...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newMacroFromLog</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Record Macro...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startMacroRecord</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Run...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;rm&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Run Recent&quot;</span><span class="p">,</span> <span class="p">())</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Plugins&#39;</span><span class="p">,</span>   <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;PARAssign Setup&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showParassignSetup</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;q1&#39;</span><span class="p">)]),</span>
    <span class="p">]</span>
               <span class="p">))</span>

    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;Help&#39;</span><span class="p">,</span>      <span class="p">[</span>
      <span class="p">(</span><span class="s">&quot;Command...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCommandHelp</span><span class="p">,</span> <span class="p">[(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span> <span class="s">&#39;ss&#39;</span><span class="p">)]),</span>
      <span class="p">(</span><span class="s">&quot;Tutorials&quot;</span><span class="p">,([</span>
        <span class="c"># Submenu</span>
        <span class="p">(</span><span class="s">&quot;Beginners Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBeginnersTutorial</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;Backbone Tutorial&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showBackboneTutorial</span><span class="p">)</span>
      <span class="p">])),</span>
      <span class="p">(</span><span class="s">&quot;Show Shortcuts&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showShortcuts</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Show CcpNmr V3 Documentation&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showWrapperDocumentation</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;About CcpNmr V3...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutPopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;About CCPN...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAboutCcpnPopup</span><span class="p">),</span>
      <span class="p">(),</span>
      <span class="p">(</span><span class="s">&quot;Inspect Code...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCodeInspectionPopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Check for Updates...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showUpdatePopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Submit Feedback...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFeedbackPopup</span><span class="p">),</span>
      <span class="p">(</span><span class="s">&quot;Submit Macro...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSubmitMacroPopup</span><span class="p">)</span>
    <span class="p">]</span></div>
               <span class="p">))</span>


  <span class="c">###################################################################################################################</span>
  <span class="c">## These will eventually move to gui (probably via a set of lambda functions.</span>
  <span class="c">###################################################################################################################</span>
  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  Project</span>
  <span class="c">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.createNewProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.createNewProject">[docs]</a>
  <span class="k">def</span> <span class="nf">createNewProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">okToContinue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_queryCloseProject</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;New Project&#39;</span><span class="p">,</span>
                                                         <span class="n">phrase</span><span class="o">=</span><span class="s">&#39;create a new&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">okToContinue</span><span class="p">:</span></div>
      <span class="bp">self</span><span class="o">.</span><span class="n">newProject</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.newProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newProject">[docs]</a>
  <span class="k">def</span> <span class="nf">newProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">):</span>
    <span class="c"># &quot;&quot;&quot;Create new, empty project&quot;&quot;&quot;</span>

    <span class="c"># NB _closeProject includes a gui cleanup call</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Creating new, empty project</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">newProject</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">project</span>

<div class="viewcode-block" id="Framework.openProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.openProject">[docs]</a>
  <span class="k">def</span> <span class="nf">openProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectDir</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.loadProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadProject">[docs]</a>
  <span class="k">def</span> <span class="nf">loadProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Load project from path</span>
<span class="sd">       If not path then opens a file dialog box and loads project from selected file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.FileDialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#39;Load Project&#39;</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Loading &quot;</span><span class="si">%s</span><span class="s">&quot; project</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">coreIo</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initialiseProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="n">project</span><span class="o">.</span><span class="n">_resetUndo</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">_DEBUG</span><span class="p">)</span>
</div>
    <span class="k">return</span> <span class="n">project</span>

<div class="viewcode-block" id="Framework.clearRecentProjects"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentProjects">[docs]</a>
  <span class="k">def</span> <span class="nf">clearRecentProjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="p">[]</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.clearRecentMacros"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearRecentMacros">[docs]</a>
  <span class="k">def</span> <span class="nf">clearRecentMacros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span> <span class="o">=</span> <span class="p">[]</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_fillRecentMacrosMenu</span><span class="p">()</span>

<div class="viewcode-block" id="Framework.loadData"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.loadData">[docs]</a>
  <span class="k">def</span> <span class="nf">loadData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a file dialog box and loads data from selected file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.FileDialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>

    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;Load Data&#39;</span>
    <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># NBNB TBD I assume here that path is either a string or a list lf string paths.</span>
    <span class="c"># NBNB FIXME if incorrect</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
      <span class="k">return</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>
</div>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">processDropData</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s">&#39;urls&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.saveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProject">[docs]</a>
  <span class="k">def</span> <span class="nf">saveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save project to newPath and return True if successful&quot;&quot;&quot;</span>
    <span class="c"># TODO: convert this to a save and call self.project.save()</span>
    <span class="k">pass</span>
    <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="n">createFallback</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Project save failed</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

      <span class="c"># NBNB TODO Gui should pre-check newPath and/or pop up something in case of failure</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_updateWindowTitle</span><span class="p">()</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
    <span class="n">layoutPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;layouts&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">):</span>
      <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">layoutPath</span><span class="p">,</span> <span class="s">&quot;layout.yaml&quot;</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
      <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
      <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c"># saveIconPath = os.path.join(Path.getPathToImport(&#39;ccpn.ui.gui.widgets&#39;), &#39;icons&#39;, &#39;save.png&#39;)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;==&gt; Project successfully saved</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c"># MessageDialog.showMessage(&#39;Project saved&#39;, &#39;Project successfully saved!&#39;,</span>
    <span class="c">#                           colourScheme=self.preferences.general.colourScheme, iconPath=saveIconPath)</span>
</div>
    <span class="k">return</span> <span class="n">successful</span>
<div class="viewcode-block" id="Framework.saveProjectAs"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveProjectAs">[docs]</a>
  <span class="k">def</span> <span class="nf">saveProjectAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and saves project to path specified in the file dialog.&quot;&quot;&quot;</span>
    <span class="n">newPath</span> <span class="o">=</span> <span class="n">getSaveDirectory</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>
      <span class="c"># Next line unnecessary, but does not hurt</span>
      <span class="n">newProjectPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
      <span class="n">successful</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">(</span><span class="n">newPath</span><span class="o">=</span><span class="n">newProjectPath</span><span class="p">,</span> <span class="n">createFallback</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">successful</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Saving project to </span><span class="si">%s</span><span class="s"> aborted&quot;</span> <span class="o">%</span> <span class="n">newProjectPath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">successful</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Project not saved - no valid destination selected&quot;</span><span class="p">)</span>
    <span class="c">#</span></div>
    <span class="k">return</span> <span class="n">successful</span>

    <span class="c"># NBNB TODO Consider appropriate failure handling. Is this OK?</span>
<div class="viewcode-block" id="Framework.saveBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveBackup">[docs]</a>
  <span class="k">def</span> <span class="nf">saveBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="k">pass</span>
<div class="viewcode-block" id="Framework.restoreBackup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.restoreBackup">[docs]</a>
  <span class="k">def</span> <span class="nf">restoreBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="k">pass</span>
<div class="viewcode-block" id="Framework.undo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.undo">[docs]</a>
  <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">([</span><span class="s">&#39;application.undo()&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
<div class="viewcode-block" id="Framework.redo"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.redo">[docs]</a>
  <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">echoCommands</span><span class="p">([</span><span class="s">&#39;application.redo()&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">_echoBlocking</span> <span class="o">-=</span> <span class="mi">1</span>
<div class="viewcode-block" id="Framework.saveLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.saveLogFile">[docs]</a>
  <span class="k">def</span> <span class="nf">saveLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="k">pass</span>
<div class="viewcode-block" id="Framework.clearLogFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.clearLogFile">[docs]</a>
  <span class="k">def</span> <span class="nf">clearLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="k">pass</span>
<div class="viewcode-block" id="Framework.displayProjectSummary"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.displayProjectSummary">[docs]</a>
  <span class="k">def</span> <span class="nf">displayProjectSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Not implemented yet&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;This function has not been implemented in the current version&#39;</span><span class="p">,</span></div>
                                  <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.archiveProject"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.archiveProject">[docs]</a>
  <span class="k">def</span> <span class="nf">archiveProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">datetime</span>
    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
    <span class="n">apiProject</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">projectPath</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">path</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%y%m</span><span class="si">%d</span><span class="s">%H%M%S&#39;</span><span class="p">)</span>
    <span class="n">filePrefix</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">projectPath</span><span class="p">),</span> <span class="n">now</span><span class="p">)</span>
    <span class="n">filePrefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">projectPath</span><span class="p">),</span> <span class="n">filePrefix</span><span class="p">)</span>
    <span class="n">fileName</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">packageProject</span><span class="p">(</span><span class="n">apiProject</span><span class="p">,</span> <span class="n">filePrefix</span><span class="p">,</span> <span class="n">includeBackups</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">includeLogs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Project Archived&#39;</span><span class="p">,</span></div>
                           <span class="s">&#39;Project archived to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showBackupPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBackupPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showBackupPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.BackupPopup</span> <span class="kn">import</span> <span class="n">BackupPopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backupPopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">backupPopup</span> <span class="o">=</span> <span class="n">BackupPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backupPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">backupPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showApplicationPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showApplicationPreferences">[docs]</a>
  <span class="k">def</span> <span class="nf">showApplicationPreferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Application Preferences Popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PreferencesPopup</span> <span class="kn">import</span> <span class="n">PreferencesPopup</span>
</div>
    <span class="n">PreferencesPopup</span><span class="p">(</span><span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves application preferences. Displays message box asking user to save project or not.</span>
<span class="sd">    Closes Application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&quot;~/.ccpn/v3settings.json&quot;</span><span class="p">)</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">prefPath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Preferences not saved: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">))</span>
    <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">reply</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showMulti</span><span class="p">(</span><span class="s">&quot;Quit Program&quot;</span><span class="p">,</span> <span class="s">&quot;Do you want to save changes before quitting?&quot;</span><span class="p">,</span>
                                    <span class="p">[</span><span class="s">&#39;Save and Quit&#39;</span><span class="p">,</span> <span class="s">&#39;Quit without Saving&#39;</span><span class="p">,</span> <span class="s">&#39;Cancel&#39;</span><span class="p">],</span>
                                    <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s">&#39;Save and Quit&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">saveProject</span><span class="p">()</span>
      <span class="c"># Close and clean up project</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
      <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="s">&#39;Quit without Saving&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefPath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
      <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_closeProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close project and clean up - when opening another or quitting application&quot;&quot;&quot;</span>

    <span class="c"># NB: this function must clan up both wrapper and ui/gui</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c"># Cleans up wrapper project, including graphics data objects (Window, Strip, etc.)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">:</span>
      <span class="c"># ui/gui cleanup</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  Spectrum</span>
  <span class="c">###################################################################################################################</span>
<div class="viewcode-block" id="Framework.showSpectrumGroupsPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSpectrumGroupsPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showSpectrumGroupsPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumGroupEditor</span> <span class="kn">import</span> <span class="n">SpectrumGroupEditor</span></div>
    <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showProjectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showProjectionPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showProjectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="k">pass</span>
<div class="viewcode-block" id="Framework.showExperimentTypePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showExperimentTypePopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showExperimentTypePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays experiment type popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ExperimentTypePopup</span> <span class="kn">import</span> <span class="n">ExperimentTypePopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">ExperimentTypePopup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span></div>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showPeakPickPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakPickPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showPeakPickPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Peak Picking Popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PeakFind</span> <span class="kn">import</span> <span class="n">PeakFindPopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">PeakFindPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span></div>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showIntegrationModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showIntegrationModule">[docs]</a>
  <span class="k">def</span> <span class="nf">showIntegrationModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">createSpectrumDisplay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="kn">from</span> <span class="nn">ccpn.AnalysisMetabolomics.Integration</span> <span class="kn">import</span> <span class="n">IntegrationTable</span><span class="p">,</span> <span class="n">IntegrationWidget</span>
    <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">integrationWidget</span> <span class="o">=</span> <span class="n">IntegrationWidget</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                                                          <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">integrationTable</span> <span class="o">=</span> <span class="n">IntegrationTable</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
                                                        <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">blankDisplay</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">blankDisplay</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></div>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">blankDisplay</span> <span class="o">=</span> <span class="bp">None</span>
<div class="viewcode-block" id="Framework.togglePhaseConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.togglePhaseConsole">[docs]</a>
  <span class="k">def</span> <span class="nf">togglePhaseConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">togglePhaseConsole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>


  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  Molecule</span>
  <span class="c">###################################################################################################################</span>

<div class="viewcode-block" id="Framework.showMoleculePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMoleculePopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showMoleculePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays sequence creation popup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.CreateSequence</span> <span class="kn">import</span> <span class="n">CreateSequence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showMoleculePopup()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showMoleculePopup()&quot;</span><span class="p">)</span></div>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">CreateSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.toggleSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleSequenceModule">[docs]</a>
  <span class="k">def</span> <span class="nf">toggleSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Toggles whether Sequence Module is displayed or not&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;sequenceModule&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hideSequenceModule</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">showSequenceModule</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.toggleSequenceModule()&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSequenceModule">[docs]</a>
  <span class="k">def</span> <span class="nf">showSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Sequence Module at the top of the screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.SequenceModule</span> <span class="kn">import</span> <span class="n">SequenceModule</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span> <span class="o">=</span> <span class="n">SequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="p">,</span>
                                            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span>
<div class="viewcode-block" id="Framework.hideSequenceModule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.hideSequenceModule">[docs]</a>
  <span class="k">def</span> <span class="nf">hideSequenceModule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hides sequence module&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sequenceModule</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;sequenceModule&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.inspectMolecule"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.inspectMolecule">[docs]</a>
  <span class="k">def</span> <span class="nf">inspectMolecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets</span> <span class="kn">import</span> <span class="n">MessageDialog</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;This function has not been implemented in the current version&#39;</span><span class="p">,</span></div>
                                  <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showRefChemicalShifts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showRefChemicalShifts">[docs]</a>
  <span class="k">def</span> <span class="nf">showRefChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Reference Chemical Shifts module.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ReferenceChemicalShifts</span> <span class="kn">import</span> <span class="n">ReferenceChemicalShifts</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">refChemShifts</span> <span class="o">=</span> <span class="n">ReferenceChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>



  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  VIEW</span>
  <span class="c">###################################################################################################################</span>
<div class="viewcode-block" id="Framework.addBlankDisplay"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.addBlankDisplay">[docs]</a>
  <span class="k">def</span> <span class="nf">addBlankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.GuiBlankDisplay</span> <span class="kn">import</span> <span class="n">GuiBlankDisplay</span>

    <span class="k">if</span> <span class="s">&#39;BLANK DISPLAY&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">blankDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;BLANK DISPLAY&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">blankDisplay</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="k">return</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">moveModule</span><span class="p">(</span><span class="n">blankDisplay</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">blankDisplay</span> <span class="o">=</span> <span class="n">GuiBlankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blankDisplay</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">((</span><span class="s">&quot;application.addBlankDisplay()&quot;</span><span class="p">))</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.addBlankDisplay()&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showChemicalShiftTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showChemicalShiftTable">[docs]</a>
  <span class="k">def</span> <span class="nf">showChemicalShiftTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Chemical Shift table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.ChemicalShiftTable</span> <span class="kn">import</span> <span class="n">NmrAtomShiftTable</span> <span class="k">as</span> <span class="n">Table</span>
    <span class="n">chemicalShiftTable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">chemicalShiftLists</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">chemicalShiftTable</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showChemicalShiftTable()&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.showNmrResidueTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showNmrResidueTable">[docs]</a>
  <span class="k">def</span> <span class="nf">showNmrResidueTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Nmr Residue Table&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.NmrResidueTable</span> <span class="kn">import</span> <span class="n">NmrResidueTable</span>
    <span class="n">nmrResidueTable</span> <span class="o">=</span> <span class="n">NmrResidueTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="n">nmrResidueTableModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Nmr Residue Table&#39;</span><span class="p">)</span>
    <span class="n">nmrResidueTableModule</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">nmrResidueTable</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">nmrResidueTableModule</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showNmrResidueTable()&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showPeakTable"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showPeakTable">[docs]</a>
  <span class="k">def</span> <span class="nf">showPeakTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">selectedList</span><span class="p">:</span><span class="n">PeakList</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays Peak table on left of main window with specified list selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.PeakTable</span> <span class="kn">import</span> <span class="n">PeakTable</span>

    <span class="n">peakList</span> <span class="o">=</span> <span class="n">PeakTable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">selectedList</span><span class="o">=</span><span class="n">selectedList</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">peakList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showPeakTable()&quot;</span><span class="p">)</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showPeakTable()&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showSequenceGraph"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSequenceGraph">[docs]</a>
  <span class="k">def</span> <span class="nf">showSequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays assigner at the bottom of the screen, relative to another module if nextTo is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.Assign.modules.SequenceGraph</span> <span class="kn">import</span> <span class="n">SequenceGraph</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;assigner&#39;</span><span class="p">):</span>
      <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">assigner</span> <span class="o">=</span> <span class="n">SequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;backboneModule&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">backboneModule</span><span class="o">.</span><span class="n">_connectSequenceGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">relativeTo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assigner</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showSequenceGraph()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showSequenceGraph()&quot;</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assigner</span>
<div class="viewcode-block" id="Framework.showAtomSelector"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAtomSelector">[docs]</a>
  <span class="k">def</span> <span class="nf">showAtomSelector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="p">:</span><span class="n">CcpnModule</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays Atom Selector.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.Assign.modules.AtomSelector</span> <span class="kn">import</span> <span class="n">AtomSelector</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span> <span class="o">=</span> <span class="n">AtomSelector</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.showAtomSelector()&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.showAtomSelector()&quot;</span><span class="p">)</span></div>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomSelector</span>

<div class="viewcode-block" id="Framework.toggleConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.toggleConsole">[docs]</a>
  <span class="k">def</span> <span class="nf">toggleConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether python console is displayed at bottom of the main window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s">&#39;PYTHON CONSOLE&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">moveModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Python Console&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="p">)</span></div>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsoleModule</span><span class="p">,</span> <span class="s">&#39;bottom&#39;</span><span class="p">)</span>


  <span class="c">##################################################################################################################</span>
  <span class="c">## MENU callbacks:  Plugins</span>
  <span class="c">###################################################################################################################</span>
<div class="viewcode-block" id="Framework.showParassignSetup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showParassignSetup">[docs]</a>
  <span class="k">def</span> <span class="nf">showParassignSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">ccpn.plugins.PARAssign.PARAssignSetup</span> <span class="kn">import</span> <span class="n">ParassignSetup</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">ParassignSetup</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
      <span class="n">newModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;PARAssign Setup&#39;</span><span class="p">)</span>
      <span class="n">newModule</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">newModule</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span></div>
      <span class="k">print</span><span class="p">(</span><span class="s">&#39;PARAssign cannot be found&#39;</span><span class="p">)</span>



  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  Macro</span>
  <span class="c">###################################################################################################################</span>
<div class="viewcode-block" id="Framework.showMacroEditor"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showMacroEditor">[docs]</a>
  <span class="k">def</span> <span class="nf">showMacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Macro Editor&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.newMacroFromConsole"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromConsole">[docs]</a>
  <span class="k">def</span> <span class="nf">newMacroFromConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with contents of python console inside.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Macro Editor&quot;</span><span class="p">)</span></div>
    <span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">textEditor</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">())</span>
<div class="viewcode-block" id="Framework.newMacroFromLog"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.newMacroFromLog">[docs]</a>
  <span class="k">def</span> <span class="nf">newMacroFromLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with contents of the log.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Macro Editor&quot;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">logPath</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span></div>
    <span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.startMacroRecord"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.startMacroRecord">[docs]</a>
  <span class="k">def</span> <span class="nf">startMacroRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with additional buttons for recording a macro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">macroEditor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Macro Editor&quot;</span><span class="p">,</span> <span class="n">showRecordButtons</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s">&quot;application.startMacroRecord()&quot;</span><span class="p">)</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;application.startMacroRecord()&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.defineUserShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.defineUserShortcuts">[docs]</a>
  <span class="k">def</span> <span class="nf">defineUserShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;This function has not been implemented in the current version&#39;</span><span class="p">,</span></div>
                                  <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.runMacro"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.runMacro">[docs]</a>
  <span class="k">def</span> <span class="nf">runMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macroFile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a macro if a macro is specified, or opens a dialog box for selection of a macro file and then</span>
<span class="sd">    runs the selected macro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">macroFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">macroFile</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="s">&quot;Run Macro&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">macroPath</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span>
    <span class="c"># self._fillRecentMacrosMenu()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">_runMacro</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span>



  <span class="c">###################################################################################################################</span>
  <span class="c">## MENU callbacks:  Help</span>
  <span class="c">###################################################################################################################</span>


<div class="viewcode-block" id="Framework.showCommandHelp"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCommandHelp">[docs]</a>
  <span class="k">def</span> <span class="nf">showCommandHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;This function has not been implemented in the current version&#39;</span><span class="p">,</span></div>
                                  <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showBeginnersTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBeginnersTutorial">[docs]</a>
  <span class="k">def</span> <span class="nf">showBeginnersTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="s">&#39;tutorials&#39;</span><span class="p">,</span> <span class="s">&#39;BeginnersTutorial.pdf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;xdg-open </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span></div>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;open </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showBackboneTutorial"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showBackboneTutorial">[docs]</a>
  <span class="k">def</span> <span class="nf">showBackboneTutorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="s">&#39;tutorials&#39;</span><span class="p">,</span> <span class="s">&#39;BackboneAssignmentTutorial.pdf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;xdg-open </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span></div>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;open </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_showApiDocumentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays API documentation in a module.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_showDocumentation</span><span class="p">(</span><span class="s">&quot;API Documentation&quot;</span><span class="p">,</span> <span class="s">&#39;apidoc&#39;</span><span class="p">,</span> <span class="s">&#39;api.html&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showWrapperDocumentation"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showWrapperDocumentation">[docs]</a>
  <span class="k">def</span> <span class="nf">showWrapperDocumentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays CCPN wrapper documentation in a module.&quot;&quot;&quot;</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">_showDocumentation</span><span class="p">(</span><span class="s">&quot;CCPN Documentation&quot;</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;html&#39;</span><span class="p">,</span> <span class="s">&#39;index.html&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_showDocumentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.CcpnWebView</span> <span class="kn">import</span> <span class="n">CcpnWebView</span>

    <span class="n">newModule</span> <span class="o">=</span> <span class="n">CcpnModule</span><span class="p">(</span><span class="s">&quot;API Documentation&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="s">&#39;doc&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CcpnWebView</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">newModule</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">newModule</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showShortcuts"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showShortcuts">[docs]</a>
  <span class="k">def</span> <span class="nf">showShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="s">&#39;doc&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;AnalysisShortcuts.pdf&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;linux&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;xdg-open </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span></div>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;open </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="Framework.showAboutPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showAboutPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.AboutPopup</span> <span class="kn">import</span> <span class="n">AboutPopup</span>
    <span class="n">popup</span> <span class="o">=</span> <span class="n">AboutPopup</span><span class="p">()</span>
    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>
    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showAboutCcpnPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showAboutCcpnPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showAboutCcpnPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">webbrowser</span></div>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;http://www.ccpn.ac.uk&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showCodeInspectionPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showCodeInspectionPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showCodeInspectionPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                  <span class="s">&#39;This function has not been implemented in the current version&#39;</span><span class="p">,</span></div>
                                  <span class="n">colourScheme</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">)</span>
<div class="viewcode-block" id="Framework.showUpdatePopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showUpdatePopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showUpdatePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.update.UpdatePopup</span> <span class="kn">import</span> <span class="n">UpdatePopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="n">UpdatePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showFeedbackPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showFeedbackPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showFeedbackPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.FeedbackPopup</span> <span class="kn">import</span> <span class="n">FeedbackPopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="n">FeedbackPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
<div class="viewcode-block" id="Framework.showSubmitMacroPopup"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.showSubmitMacroPopup">[docs]</a>
  <span class="k">def</span> <span class="nf">showSubmitMacroPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SubmitMacroPopup</span> <span class="kn">import</span> <span class="n">SubmitMacroPopup</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span> <span class="o">=</span> <span class="n">SubmitMacroPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    <span class="bp">self</span><span class="o">.</span><span class="n">submitMacroPopup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>



  <span class="c">#########################################    End Menu callbacks   ##################################################</span>
<div class="viewcode-block" id="Framework.printToFile"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.Framework.printToFile">[docs]</a>
  <span class="k">def</span> <span class="nf">printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrumDisplay</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplay</span><span class="p">:</span>
      <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplay</span> <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
      <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplay</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>
      <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">spectrumDisplay</span><span class="p">:</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s">&#39;Print to File&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&#39;SVG (*.svg)&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span></div></div>
      <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">printToFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


<div class="viewcode-block" id="getSaveDirectory"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getSaveDirectory">[docs]</a>
<span class="k">def</span> <span class="nf">getSaveDirectory</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Opens save Project as dialog box and gets directory specified in the file dialog.&quot;&quot;&quot;</span>
  <span class="n">preferences</span> <span class="o">=</span> <span class="n">getPreferences</span><span class="p">()</span>
  <span class="n">dialog</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s">&#39;Save Project As...&#39;</span><span class="p">)</span>
  <span class="n">dialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">)</span>
  <span class="n">dialog</span><span class="o">.</span><span class="n">setAcceptMode</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s">&#39;dark&#39;</span><span class="p">:</span>
    <span class="n">dialog</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                        QFileDialog QWidget {</span>
<span class="s">                                            background-color: #2a3358;</span>
<span class="s">                                            color: #f7ffff;</span>
<span class="s">                                            }</span>
<span class="s">                        &quot;&quot;&quot;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s">&#39;light&#39;</span><span class="p">:</span>
    <span class="n">dialog</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s">&quot;QFileDialog QWidget {color: #464e76; }&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span>
  <span class="n">fileNames</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">fileNames</span><span class="p">:</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span>
  <span class="n">newPath</span> <span class="o">=</span> <span class="n">fileNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">newPath</span><span class="p">:</span>
    <span class="n">newPath</span> <span class="o">=</span> <span class="n">apiIo</span><span class="o">.</span><span class="n">addCcpnDirectorySuffix</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">newPath</span><span class="p">)):</span>
      <span class="c"># should not really need to check the second and third condition above, only</span>
      <span class="c"># the Qt dialog stupidly insists a directory exists before you can select it</span>
      <span class="c"># so if it exists but is empty then don&#39;t bother asking the question</span>
      <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Overwrite path&#39;</span>
      <span class="n">msg</span> <span class="o">=</span><span class="s">&#39;Path &quot;</span><span class="si">%s</span><span class="s">&quot; already exists, continue?&#39;</span> <span class="o">%</span> <span class="n">newPath</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showYesNo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">colourScheme</span><span class="o">=</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">colourScheme</span><span class="p">):</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</div>
  <span class="k">return</span> <span class="n">newPath</span>


<span class="c">########</span>
<div class="viewcode-block" id="getPreferences"><a class="viewcode-back" href="../../../ccpn/ccpn.framework.html#ccpn.framework.Framework.getPreferences">[docs]</a>
<span class="k">def</span> <span class="nf">getPreferences</span><span class="p">(</span><span class="n">skipUserPreferences</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">defaultPreferencesPath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">userPreferencesPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">_readPreferencesFile</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">):</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">AttrDict</span><span class="p">)</span> <span class="c">##TBD find a better way ?!?</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">preferences</span>

  <span class="k">def</span> <span class="nf">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">collections</span>
    <span class="c"># recursive update of dictionary</span>
    <span class="c"># this deletes every key in u that is not in d</span>
    <span class="c"># if we want every key regardless, then remove first if check below</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_updateDict</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">d</span>

  <span class="n">preferencesPath</span> <span class="o">=</span> <span class="p">(</span><span class="n">defaultPreferencesPath</span> <span class="k">if</span> <span class="n">defaultPreferencesPath</span> <span class="k">else</span>
                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">getTopDirectory</span><span class="p">(),</span> <span class="s">&#39;config&#39;</span><span class="p">,</span> <span class="s">&#39;defaultv3settings.json&#39;</span><span class="p">))</span>
  <span class="n">preferences</span> <span class="o">=</span> <span class="n">_readPreferencesFile</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">skipUserPreferences</span><span class="p">:</span>
    <span class="n">preferencesPath</span> <span class="o">=</span> <span class="n">userPreferencesPath</span> <span class="k">if</span> <span class="n">userPreferencesPath</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~/.ccpn/v3settings.json&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">):</span>
      <span class="n">_updateDict</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">_readPreferencesFile</span><span class="p">(</span><span class="n">preferencesPath</span><span class="p">))</span>
</div>
  <span class="k">return</span> <span class="n">preferences</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>