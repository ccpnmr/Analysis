<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.modules.GuiSpectrumView &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.modules.GuiSpectrumView</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module Documentation here</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan&quot;</span>
               <span class="s2">&quot;Simon P Skinner &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Ed Brooksbank $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-04-07 11:40:39 +0100 (Fri, April 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b1 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>

<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Colour</span>

<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="kn">as</span> <span class="nn">pg</span>

<span class="c1">#from ccpn.ui.gui.modules.spectrumPane.PeakListItem import PeakListItem</span>
<span class="c1">#from ccpn.ui.gui.modules.spectrumPane.IntegralListItem import IntegralListItem</span>

<span class="n">SpectrumViewParams</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SpectrumViewParams&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;valuePerPoint&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;totalPointCount&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;minAliasedFrequency&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;maxAliasedFrequency&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;dataDim&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="GuiSpectrumView"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiSpectrumView.GuiSpectrumView">[docs]</a><span class="k">class</span> <span class="nc">GuiSpectrumView</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="p">):</span>

  <span class="c1">#def __init__(self, guiSpectrumDisplay, apiSpectrumView, dimMapping=None):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; spectrumPane is the parent</span>
<span class="sd">        spectrum is the Spectrum object</span>
<span class="sd">        dimMapping is from spectrum numerical dimensions to spectrumPane numerical dimensions</span>
<span class="sd">        (for example, xDim is what gets mapped to 0 and yDim is what gets mapped to 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">scene</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_apiDataSource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">spectrumView</span><span class="o">.</span><span class="n">dataSource</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupsToolBar</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_apiDataSource</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
      <span class="c1"># below does not work so looks like we have a Qt / data model visibility sync issue</span>
      <span class="c1">#self._wrappedData.spectrumView.displayPositiveContours = self._wrappedData.spectrumView.displayNegativeContours = False</span>

    <span class="c1">##self.spectrum = self._parent # Is this necessary?</span>
    
    <span class="c1">###self.setDimMapping(dimMapping)</span>
    <span class="c1">#self.peakListItems = {} # CCPN peakList -&gt; Qt peakListItem</span>

    <span class="c1"># strip = self._parent</span>
    <span class="c1"># strip.setupAxes()</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    for peakList in spectrum.peakLists:</span>
<span class="sd">      self.peakListItems[peakList.pid] = PeakListItem(self, peakList)</span>
<span class="sd">&quot;&quot;&quot;</span>      
    <span class="c1"># guiSpectrumDisplay.spectrumItems.append(self)</span>
    
    <span class="c1">##for strip in self.strips:</span>
    <span class="c1">##  strip.addSpectrum(self)</span>

  <span class="c1"># To write your own graphics item, you first create a subclass of QGraphicsItem, and</span>
  <span class="c1"># then start by implementing its two pure virtual public functions:</span>
  <span class="c1"># boundingRect(), which returns an estimate of the area painted by the item,</span>
  <span class="c1"># and paint(), which implements the actual painting. For example:</span>

  <span class="c1"># mandatory function to override for QGraphicsItem</span>
  <span class="c1"># Implemented in GuiSpectrumViewNd or GuiSpectrumView1d</span>
<div class="viewcode-block" id="GuiSpectrumView.paint"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiSpectrumView.GuiSpectrumView.paint">[docs]</a>  <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">pass</span></div>

  <span class="c1"># mandatory function to override for QGraphicsItem</span>
<div class="viewcode-block" id="GuiSpectrumView.boundingRect"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiSpectrumView.GuiSpectrumView.boundingRect">[docs]</a>  <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># seems necessary to have</span>
    <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>  <span class="c1"># TBD: remove hardwiring</span></div>
                                          <span class="c1"># Earlier versions too large value (~1400,1000);</span>
    <span class="c1"># i.e larger then inital MainWIndow size; reduced to (900, 700); but (100, 150) appears</span>
    <span class="c1"># to give less flicker in Scrolled Strips.</span>

  <span class="c1"># override of Qt setVisible</span>
<div class="viewcode-block" id="GuiSpectrumView.setVisible"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiSpectrumView.GuiSpectrumView.setVisible">[docs]</a>  <span class="k">def</span> <span class="nf">setVisible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">):</span>
    <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
      <span class="n">peakListView</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span></div>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  def setDimMapping(self, dimMapping=None):</span>
<span class="sd">    </span>
<span class="sd">    dimensionCount = self.spectrum.dimensionCount</span>
<span class="sd">    if dimMapping is None:</span>
<span class="sd">      dimMapping = {}</span>
<span class="sd">      for i in range(dimensionCount):</span>
<span class="sd">        dimMapping[i] = i</span>
<span class="sd">    self.dimMapping = dimMapping</span>

<span class="sd">    xDim = yDim = None</span>
<span class="sd">    inverseDimMapping = {}</span>
<span class="sd">    for dim in dimMapping:</span>
<span class="sd">      inverseDim = dimMapping[dim]</span>
<span class="sd">      if inverseDim == 0:</span>
<span class="sd">        xDim = inverseDim</span>
<span class="sd">      elif inverseDim == 1:</span>
<span class="sd">        yDim = inverseDim</span>
<span class="sd">    </span>
<span class="sd">    if xDim is not None: </span>
<span class="sd">      assert 0 &lt;= xDim &lt; dimensionCount, &#39;xDim = %d, dimensionCount = %d&#39; % (xDim, dimensionCount)</span>
<span class="sd">      </span>
<span class="sd">    if yDim is not None:</span>
<span class="sd">      assert 0 &lt;= yDim &lt; dimensionCount, &#39;yDim = %d, dimensionCount = %d&#39; % (yDim, dimensionCount)</span>
<span class="sd">      assert xDim != yDim, &#39;xDim = yDim = %d&#39; % xDim</span>

<span class="sd">    self.xDim = xDim</span>
<span class="sd">    self.yDim = yDim</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">_getSpectrumViewParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisDim</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get position, width, totalPointCount, minAliasedFrequency, maxAliasedFrequency</span>
<span class="sd">    for axisDimth axis (zero-origin)&quot;&quot;&quot;</span>

    <span class="c1"># axis = self.strip.orderedAxes[axisDim]</span>
    <span class="n">dataDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apiStripSpectrumView</span><span class="o">.</span><span class="n">spectrumView</span><span class="o">.</span><span class="n">orderedDataDims</span><span class="p">[</span><span class="n">axisDim</span><span class="p">]</span>
    <span class="n">totalPointCount</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataDim</span><span class="o">.</span><span class="n">numPointsOrig</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataDim</span><span class="p">,</span> <span class="s2">&quot;numPointsOrig&quot;</span><span class="p">)</span>
                       <span class="k">else</span> <span class="n">dataDim</span><span class="o">.</span><span class="n">numPoints</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataDim</span><span class="o">.</span><span class="n">dataSource</span><span class="o">.</span><span class="n">sortedDataDims</span><span class="p">()):</span>
      <span class="c1"># Must be done this way as dataDim.dim may not be in order 1,2,3 (e.g. for projections)</span>
      <span class="k">if</span> <span class="n">dd</span> <span class="ow">is</span> <span class="n">dataDim</span><span class="p">:</span>
        <span class="n">minAliasedFrequency</span><span class="p">,</span> <span class="n">maxAliasedFrequency</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">aliasingLimits</span><span class="p">)[</span><span class="n">ii</span><span class="p">]</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">minAliasedFrequency</span> <span class="o">=</span> <span class="n">maxAliasedFrequency</span> <span class="o">=</span> <span class="n">dataDim</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataDim</span><span class="p">,</span> <span class="s1">&#39;primaryDataDimRef&#39;</span><span class="p">):</span>
      <span class="c1"># FreqDataDim - get ppm valuePerPoint</span>
      <span class="n">ddr</span> <span class="o">=</span> <span class="n">dataDim</span><span class="o">.</span><span class="n">primaryDataDimRef</span>
      <span class="n">valuePerPoint</span> <span class="o">=</span> <span class="n">ddr</span> <span class="ow">and</span> <span class="n">ddr</span><span class="o">.</span><span class="n">valuePerPoint</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataDim</span><span class="p">,</span> <span class="s1">&#39;valuePerPoint&#39;</span><span class="p">):</span>
      <span class="c1"># FidDataDim - get time valuePerPoint</span>
      <span class="n">valuePerPoint</span> <span class="o">=</span> <span class="n">dataDim</span><span class="o">.</span><span class="n">valuePerPoint</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Sampled DataDim - return None</span>
      <span class="n">valuePerPoint</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># return axis.position, axis.width, totalPointCount, minAliasedFrequency, maxAliasedFrequency, dataDim</span>
    <span class="k">return</span> <span class="n">SpectrumViewParams</span><span class="p">(</span><span class="n">valuePerPoint</span><span class="p">,</span> <span class="n">totalPointCount</span><span class="p">,</span>
                              <span class="n">minAliasedFrequency</span><span class="p">,</span> <span class="n">maxAliasedFrequency</span><span class="p">,</span> <span class="n">dataDim</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_getColour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colourAttr</span><span class="p">,</span> <span class="n">defaultColour</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">colour</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colourAttr</span><span class="p">)</span>
    <span class="c1"># if not colour:</span>
    <span class="c1">#   colour = getattr(self.spectrum, colourAttr)</span>
      
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colour</span><span class="p">:</span>
      <span class="n">colour</span> <span class="o">=</span> <span class="n">defaultColour</span>

    <span class="n">colour</span> <span class="o">=</span> <span class="n">Colour</span><span class="o">.</span><span class="n">colourNameToHexDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colour</span><span class="p">,</span> <span class="n">colour</span><span class="p">)</span>  <span class="c1"># works even if None</span>
      
    <span class="k">return</span> <span class="n">colour</span>

  <span class="k">def</span> <span class="nf">_spectrumViewHasChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change action icon colour and other changes when spectrumView changes</span>

<span class="sd">    NB SpectrumView change notifiers are triggered when either DataSource or ApiSpectrumView change&quot;&quot;&quot;</span>
    <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="n">apiDataSource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">_wrappedData</span>

    <span class="c1"># Update action icol colour</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apiDataSource</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
      <span class="n">pix</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">is1D</span><span class="p">:</span>
        <span class="n">pix</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliceColour</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">pix</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positiveContourColour</span><span class="p">))</span>
      <span class="n">action</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">pix</span><span class="p">))</span>

    <span class="c1"># Update strip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_createdSpectrumView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set up SpectrumDisplay when new StripSpectrumView is created - for notifiers&quot;&quot;&quot;</span>

    <span class="c1"># NBNB TBD FIXME get rid of API objects</span>

    <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="n">spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum</span>

    <span class="c1"># Set Z widgets for nD strips</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">is1D</span><span class="p">:</span>
      <span class="n">strip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="o">.</span><span class="n">haveSetupZWidgets</span><span class="p">:</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">_setZWidgets</span><span class="p">()</span>

    <span class="c1"># Handle action buttons</span>
    <span class="n">apiDataSource</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">_wrappedData</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumActionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apiDataSource</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
      <span class="c1"># add toolbar action (button)</span>
      <span class="n">spectrumName</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">name</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrumName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">spectrumName</span> <span class="o">=</span> <span class="n">spectrumName</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.....&#39;</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumToolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">spectrumName</span><span class="p">)</span>
      <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">action</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="n">widget</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumToolBar</span><span class="o">.</span><span class="n">widgetForAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="n">widget</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">is1D</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
      <span class="n">widget</span><span class="o">.</span><span class="n">spectrumView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
      <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumActionDict</span><span class="p">[</span><span class="n">apiDataSource</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
      <span class="c1"># The following call sets the icon colours:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_spectrumViewHasChanged</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">is1D</span><span class="p">:</span>
      <span class="n">action</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">)</span>
    <span class="n">action</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setVisible</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_deletedSpectrumView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update interface when a spectrumView is deleted&quot;&quot;&quot;</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;plot&#39;</span><span class="p">):</span>  <span class="c1"># 1d</span>
      <span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>

<div class="viewcode-block" id="GuiSpectrumView.refreshData"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiSpectrumView.GuiSpectrumView.refreshData">[docs]</a>  <span class="k">def</span> <span class="nf">refreshData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Needs to be implemented in subclass&#39;</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>