<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.modules.GuiStrip &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="ccpn.ui.gui.modules" href="../modules.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../modules.html" accesskey="U">ccpn.ui.gui.modules</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.modules.GuiStrip</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module Documentation here</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Simon P Skinner &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Wayne Boucher $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-04-11 15:15:27 +0100 (Tue, April 11, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b1 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>

<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="kn">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Peak</span> <span class="kn">import</span> <span class="n">Peak</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.CcpnGridItem</span> <span class="kn">import</span> <span class="n">CcpnGridItem</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Widget</span> <span class="kn">import</span> <span class="n">Widget</span>

<span class="kn">from</span> <span class="nn">ccpn.util.Colour</span> <span class="kn">import</span> <span class="n">Colour</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Ticks</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.ccpnmr.gui.Task</span> <span class="kn">import</span> <span class="n">Ruler</span> <span class="k">as</span> <span class="n">ApiRuler</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.AxisTextItem</span> <span class="kn">import</span> <span class="n">AxisTextItem</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.PlotWidget</span> <span class="kn">import</span> <span class="n">PlotWidget</span>

<span class="c1"># def _sufficientlyDifferentWidth(region1, region2):</span>
<span class="c1">#</span>
<span class="c1">#   w1 = abs(region1[1] - region1[0])</span>
<span class="c1">#   w2 = abs(region2[1] - region2[0])</span>
<span class="c1">#   d = abs(w1 - w2)</span>
<span class="c1">#</span>
<span class="c1">#   return d &gt; 1.0e-5 * max(w1, w2)</span>
<span class="c1">#</span>
<span class="c1"># def _scaleRegion(otherPreviousRegion, region, previousRegion):</span>
<span class="c1">#</span>
<span class="c1">#   otherPreviousRegionWidth = abs(otherPreviousRegion[1] - otherPreviousRegion[0])</span>
<span class="c1">#   regionWidth = abs(region[1] - region[0])</span>
<span class="c1">#   previousRegionWidth = abs(previousRegion[1] - previousRegion[0])</span>
<span class="c1">#</span>
<span class="c1">#   otherRegionWidth = otherPreviousRegionWidth * regionWidth / previousRegionWidth</span>
<span class="c1">#   otherRegionPosition = 0.5 * (otherPreviousRegion[1] + otherPreviousRegion[0])</span>
<span class="c1">#</span>
<span class="c1">#   return (otherRegionPosition - 0.5*otherRegionWidth, otherRegionPosition + 0.5*otherRegionWidth)</span>
  
<div class="viewcode-block" id="GuiStrip"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip">[docs]</a><span class="k">class</span> <span class="nc">GuiStrip</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span> <span class="c1"># DropBase needs to be first, else the drop events are not processed</span>

  <span class="n">sigClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">useOpenGL</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">stripFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">stripFrame</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>  <span class="c1"># NBNB TBD is it worth keeping both?</span>

    <span class="n">Widget</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># DropBase.__init__(self, self._parent._appBase)</span>
    <span class="c1"># DropBase.__init__(self, self._parent._appBase, self.dropCallback)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span> <span class="o">=</span> <span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stripFrame</span><span class="p">,</span> <span class="n">appBase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_appBase</span><span class="p">,</span>
                                 <span class="n">useOpenGL</span><span class="o">=</span><span class="n">useOpenGL</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
              <span class="c1"># dropCallback=self.dropCallback, useOpenGL=useOpenGL)#, gridSpan=(1, 1))</span>
    <span class="c1"># newSplitter = QtGui.QSplitter   # NBNB FIXME - is this correct?</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stripFrame</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span><span class="o">.</span><span class="n">orderedStrips</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_appBase</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">current</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">colourScheme</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s1">&#39;light&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;#f7ffff&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">foreground</span> <span class="o">=</span> <span class="s1">&#39;#080000&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gridColour</span> <span class="o">=</span> <span class="s1">&#39;#080000&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="s1">&#39;#080000&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">foreground</span> <span class="o">=</span> <span class="s1">&#39;#f7ffff&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">gridColour</span> <span class="o">=</span> <span class="s1">&#39;#f7ffff&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">registerNotify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_highlightCurrentStrip</span><span class="p">,</span> <span class="s1">&#39;strips&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">setMenuEnabled</span><span class="p">(</span><span class="n">enableMenu</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">enableViewBoxMenu</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xAxisAtomLabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yAxisAtomLabels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">registerNotifier</span><span class="p">(</span><span class="s1">&#39;Peak&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateDisplayedPeaks</span><span class="p">)</span>


    <span class="c1">#self.xAxis = Axis(self.plotWidget, orientation=&#39;top&#39;, #pen=self.foreground,</span>
    <span class="c1">#                  viewBox=self.viewBox, axisCode=self.orderedAxes[0].code)</span>
    <span class="c1">#self.yAxis = Axis(self.plotWidget, orientation=&#39;left&#39;, #pen=self.foreground,</span>
    <span class="c1">#                  viewBox=self.viewBox, axisCode=self.orderedAxes[1].code)</span>

    <span class="k">for</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">):</span>
      <span class="n">axisItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">orientation</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
      <span class="n">axisItem</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">):</span>
      <span class="n">axisItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">orientation</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
      <span class="n">axisItem</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gridShown</span> <span class="o">=</span> <span class="bp">True</span>


    <span class="c1"># self.viewBox.sigClicked.connect(self._mouseClicked)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">CcpnGridItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridColour</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_createCrossHair</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mouseMoved</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMousePosition</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xPreviousRegion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPreviousRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">axisPositionDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># axisCode --&gt; position</span>
    <span class="c1"># need to keep track of mouse position because Qt shortcuts don&#39;t provide the widget or the position of where the cursor is</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">vRulerLineDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ruler --&gt; vertical line for that ruler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hRulerLineDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ruler --&gt; horizontal line for that ruler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rulerLabelDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ruler --&gt; label for that ruler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initRulers</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">mousePixel</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mousePosition</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">phasingPivot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_movedPivot</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetHPhasingPivot</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">phasingPivot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_movedPivot</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetVPhasingPivot</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># Notifiers.registerNotify(self._axisRegionUpdated, &#39;ccpnmr.gui.Task.Axis&#39;, &#39;setPosition&#39;)</span>
    <span class="c1"># Notifiers.registerNotify(self._axisRegionUpdated, &#39;ccpnmr.gui.Task.Axis&#39;, &#39;setWidth&#39;)</span>
    <span class="c1"># Notifiers.registerNotify(self.rulerCreated, &#39;ccpnmr.gui.Task.Ruler&#39;, &#39;__init__&#39;)</span>
    <span class="c1"># Notifiers.registerNotify(self.rulerDeleted, &#39;ccpnmr.gui.Task.Ruler&#39;, &#39;delete&#39;)</span>


  <span class="k">def</span> <span class="nf">_updateDisplayedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peak</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peak</span><span class="o">.</span><span class="n">peakList</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_unregisterStrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">unRegisterNotify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_highlightCurrentStrip</span><span class="p">,</span> <span class="s1">&#39;strips&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">unRegisterNotifier</span><span class="p">(</span><span class="s1">&#39;Peak&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateDisplayedPeaks</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_highlightCurrentStrip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strips</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s1">&#39;light&#39;</span><span class="p">:</span>
      <span class="n">axisColour</span> <span class="o">=</span> <span class="s1">&#39;#3333ff&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span><span class="p">:</span>
      <span class="n">axisColour</span> <span class="o">=</span> <span class="s1">&#39;#00ff00&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="c1"># if self is self.current.strips[0]:</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">):</span>
        <span class="n">axisItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">orientation</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
        <span class="n">axisItem</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">axisColour</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">):</span>
        <span class="n">axisItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">orientation</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
        <span class="n">axisItem</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
    <span class="c1"># CCPN INTERNAL - called in printToFile method of GuiMainWindow</span>

    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_printToFile</span><span class="p">(</span><span class="n">printer</span><span class="p">)</span>

    <span class="c1"># print box</span>

    <span class="c1"># print ticks and grid line</span>
    <span class="n">viewRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">viewRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># TBD: relies on axes being backwards</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">w0</span> <span class="o">=</span> <span class="n">viewRegion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># TBD: relies on axes being backwards, which is not true in 1D</span>
    <span class="n">xMajorTicks</span><span class="p">,</span> <span class="n">xMinorTicks</span><span class="p">,</span> <span class="n">xMajorFormat</span> <span class="o">=</span> <span class="n">Ticks</span><span class="o">.</span><span class="n">findTicks</span><span class="p">((</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">))</span>
    <span class="n">yMajorTicks</span><span class="p">,</span> <span class="n">yMinorTicks</span><span class="p">,</span> <span class="n">yMajorFormat</span> <span class="o">=</span> <span class="n">Ticks</span><span class="o">.</span><span class="n">findTicks</span><span class="p">((</span><span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">))</span>

    <span class="n">xScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">v1</span><span class="o">-</span><span class="n">v0</span><span class="p">)</span>
    <span class="n">xOffset</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="n">xScale</span><span class="o">*</span><span class="n">v0</span>
    <span class="n">yScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w1</span><span class="o">-</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">yOffset</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="n">yScale</span><span class="o">*</span><span class="n">w0</span>
    <span class="n">xMajorText</span> <span class="o">=</span> <span class="p">[</span><span class="n">xMajorFormat</span> <span class="o">%</span> <span class="n">tick</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMajorTicks</span><span class="p">]</span>
    <span class="n">xMajorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">xScale</span><span class="o">+</span><span class="n">xOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMajorTicks</span><span class="p">]</span>
    <span class="n">xMinorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">xScale</span><span class="o">+</span><span class="n">xOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMinorTicks</span><span class="p">]</span>
    <span class="n">yMajorText</span> <span class="o">=</span> <span class="p">[</span><span class="n">xMajorFormat</span> <span class="o">%</span> <span class="n">tick</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMajorTicks</span><span class="p">]</span>
    <span class="n">yMajorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">yScale</span><span class="o">+</span><span class="n">yOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMajorTicks</span><span class="p">]</span>
    <span class="n">yMinorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">yScale</span><span class="o">+</span><span class="n">yOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMinorTicks</span><span class="p">]</span>

    <span class="n">xTickHeight</span> <span class="o">=</span> <span class="n">yTickHeight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span>

    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMinorTicks</span><span class="p">:</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">xTickHeight</span><span class="p">)</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xMajorTicks</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#888888&#39;</span><span class="p">)</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">xTickHeight</span><span class="p">)</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">xMajorText</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">tick</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">*</span><span class="n">fontsize</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">xTickHeight</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># output backwards for y</span>
    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMinorTicks</span><span class="p">:</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">yTickHeight</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yMajorTicks</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#888888&#39;</span><span class="p">)</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">yTickHeight</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">)</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">yMajorText</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">yTickHeight</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fontsize</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fontsize</span><span class="p">)</span>

  <span class="c1"># def addStrip(self):</span>
  <span class="c1">#</span>
  <span class="c1">#   newStrip = self.strips[0].clone()</span>
  <span class="c1">#   print(&#39;spectrumViews&#39;, newStrip.spectrumViews)</span>
  <span class="c1">#   for spectrumView in newStrip.spectrumViews:</span>
  <span class="c1">#     spectrumView.connectStrip(newStrip)</span>


  <span class="c1">#</span>
  <span class="c1">#</span>
  <span class="c1"># def setupAxes(self):</span>
  <span class="c1">#</span>
  <span class="c1">#   # this is called from GuiSpectrumView because the axes are not ready when the strip is created</span>
  <span class="c1">#   # TBD: but that means this is called for every spectrum in the strip, which is not what we want</span>
  <span class="c1">#   self.viewBox.setXRange(*self.orderedAxes[0].region)</span>
  <span class="c1">#   self.viewBox.setYRange(*self.orderedAxes[1].region)</span>
  <span class="c1">#   self.xAxisTextItem = AxisTextItem(self.plotWidget, orientation=&#39;top&#39;,</span>
  <span class="c1">#                                 axisCode=self.orderedAxes[0].code)</span>
  <span class="c1">#   self.yAxisTextItem = AxisTextItem(self.plotWidget, orientation=&#39;left&#39;,</span>
  <span class="c1">#                                 axisCode=self.orderedAxes[1].code)</span>
  <span class="c1">#   self.viewBox.sigStateChanged.connect(self.moveAxisCodeLabels)</span>
  <span class="c1">#   self.viewBox.sigRangeChanged.connect(self.updateRegion)</span>

  <span class="k">def</span> <span class="nf">_newPhasingTrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_newPhasingTrace</span><span class="p">()</span>
      
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  def newHPhasingTrace(self):</span>
<span class="sd">    </span>
<span class="sd">    for spectrumView in self.spectrumViews:</span>
<span class="sd">      spectrumView.newHPhasingTrace(self.mousePosition[1])</span>
<span class="sd">      </span>
<span class="sd">  def newVPhasingTrace(self):</span>
<span class="sd">    </span>
<span class="sd">    for spectrumView in self.spectrumViews:</span>
<span class="sd">      spectrumView.newVPhasingTrace(self.mousePosition[0])</span>
<span class="sd">  &quot;&quot;&quot;</span>
   
  <span class="k">def</span> <span class="nf">_setPhasingPivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePivot</span><span class="p">()</span>
      
<div class="viewcode-block" id="GuiStrip.removePhasingTraces"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.removePhasingTraces">[docs]</a>  <span class="k">def</span> <span class="nf">removePhasingTraces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">removePhasingTraces</span><span class="p">()</span></div>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  def togglePhasingPivot(self):</span>
<span class="sd">    </span>
<span class="sd">    self.hPhasingPivot.setPos(self.mousePosition[0])</span>
<span class="sd">    self.hPhasingPivot.setVisible(not self.hPhasingPivot.isVisible())</span>
<span class="sd">  &quot;&quot;&quot;</span>
  
  <span class="k">def</span> <span class="nf">_updatePivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># this is called if pivot entry at bottom of display is updated and then &quot;return&quot; key used</span>
  
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
  
  <span class="k">def</span> <span class="nf">_movedPivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># this is called if pivot on screen is dragged</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">getXPos</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">getYPos</span><span class="p">()</span>
      
    <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
    
<div class="viewcode-block" id="GuiStrip.turnOnPhasing"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.turnOnPhasing">[docs]</a>  <span class="k">def</span> <span class="nf">turnOnPhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_turnOnPhasing</span><span class="p">()</span></div>
      
<div class="viewcode-block" id="GuiStrip.turnOffPhasing"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.turnOffPhasing">[docs]</a>  <span class="k">def</span> <span class="nf">turnOffPhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_turnOffPhasing</span><span class="p">()</span></div>
      
  <span class="k">def</span> <span class="nf">_changedPhasingDirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_changedPhasingDirection</span><span class="p">()</span>
      
  <span class="k">def</span> <span class="nf">_updatePhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#colour = &#39;#ffffff&#39; if self.background == &#39;k&#39; else &#39;#000000&#39;</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;#e4e15b&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span> <span class="k">else</span> <span class="s1">&#39;#000000&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setPen</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colour</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setPen</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colour</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
      
  <span class="k">def</span> <span class="nf">_updateRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewBox</span><span class="p">):</span>
    <span class="c1"># this is called when the viewBox is changed on the screen via the mouse</span>
    
    <span class="c1"># this code is complicated because need to keep viewBox region and axis region in sync</span>
    <span class="c1"># and there can be different viewBoxes with the same axis</span>

    <span class="k">assert</span> <span class="n">viewBox</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="p">,</span> <span class="s1">&#39;viewBox = </span><span class="si">%s</span><span class="s1">, self.viewBox = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">viewBox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_updateY</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_updateY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_widthsChangedEnough</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
      <span class="n">r1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
      <span class="n">r2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
      <span class="n">minDiff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">maxDiff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">minDiff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">maxDiff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>

    <span class="n">yRange</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
      <span class="n">stripYRange</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">_widthsChangedEnough</span><span class="p">(</span><span class="n">stripYRange</span><span class="p">,</span> <span class="n">yRange</span><span class="p">):</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">yRange</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_moveAxisCodeLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Puts axis code labels in the correct place on the PlotWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">###self.xAxis.textItem.setPos(self.viewBox.boundingRect().bottomLeft())</span>
    <span class="c1">###self.yAxis.textItem.setPos(self.viewBox.boundingRect().topRight())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xAxisTextItem</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yAxisTextItem</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">topRight</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xAxisAtomLabels</span><span class="p">:</span>
      <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">())</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
      <span class="n">item</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yAxisAtomLabels</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">())</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
      <span class="n">item</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="c1"># self.textItem.setPos(self.viewBox.boundingRect().topLeft())</span>

  <span class="c1"># def hideCrossHairs(self):</span>
  <span class="c1">#   &quot;&quot;&quot;</span>
  <span class="c1">#   Hides all crosshairs in all strips in parent spectrum display.</span>
  <span class="c1">#   &quot;&quot;&quot;</span>
  <span class="c1">#   for strip in self.guiSpectrumDisplay.guiStrips:</span>
  <span class="c1">#     strip.hideCrossHair()</span>

  <span class="k">def</span> <span class="nf">_createCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a single or double cross hair depending on specification in application preferences.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">doubleCrossHair</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_toggleCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether crosshair is visible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">_showCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays cross hair in strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_hideCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hides cross hair in strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStrip.toggleGrid"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.toggleGrid">[docs]</a>  <span class="k">def</span> <span class="nf">toggleGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether grid is visible in the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">())</span></div>

  <span class="k">def</span> <span class="nf">_crosshairCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisCode</span><span class="p">):</span>
    <span class="c1"># determines what axisCodes are compatible as far as drawing crosshair is concerned</span>
    <span class="c1"># TBD: the naive approach below should be improved</span>
    <span class="k">return</span> <span class="n">axisCode</span> <span class="c1">#if axisCode[0].isupper() else axisCode</span>
      
  <span class="k">def</span> <span class="nf">_setCrossHairPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisPositionDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # CCPN INTERNAL</span>
<span class="sd">    Called in _setCrossHairPosition method of GuiSpectrumDisplay</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">axisPositionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_crosshairCode</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
    <span class="n">position2</span> <span class="o">=</span> <span class="n">axisPositionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_crosshairCode</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vLine</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">position2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vLine2</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position2</span><span class="p">)</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">axisPositionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_crosshairCode</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
    <span class="n">position2</span> <span class="o">=</span> <span class="n">axisPositionDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_crosshairCode</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hLine</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">position2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hLine2</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position2</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_createMarkAtCursorPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
    <span class="c1"># TBD: this creates a mark in all dims, is that what we want??</span>
    <span class="n">axisPositionDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisPositionDict</span>
    <span class="n">axisCodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis</span><span class="o">.</span><span class="n">code</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">]</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">axisPositionDict</span><span class="p">[</span><span class="n">axisCode</span><span class="p">]</span> <span class="k">for</span> <span class="n">axisCode</span> <span class="ow">in</span> <span class="n">axisCodes</span><span class="p">]</span>
    <span class="n">mark</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">newMark</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">axisCodes</span><span class="p">)</span>

  <span class="c1">#</span>
  <span class="k">def</span> <span class="nf">_rulerCreated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">):</span>
    <span class="n">axisCode</span> <span class="o">=</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">axisCode</span> <span class="c1"># TBD: use label and unit</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">position</span>
    <span class="k">if</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
      <span class="n">colour</span> <span class="o">=</span> <span class="n">Colour</span><span class="p">(</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">colour</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreground</span>
    <span class="c1"># TBD: is the below correct (so the correct axes)?</span>
    <span class="k">if</span> <span class="n">axisCode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
      <span class="n">line</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vRulerLineDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>

    <span class="k">if</span> <span class="n">axisCode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
      <span class="n">line</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hRulerLineDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>

  <span class="k">def</span> <span class="nf">_rulerDeleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vRulerLineDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hRulerLineDict</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">dd</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            
  <span class="k">def</span> <span class="nf">_initRulers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">marks</span><span class="p">:</span>
      <span class="n">apiMark</span> <span class="o">=</span> <span class="n">mark</span><span class="o">.</span><span class="n">_wrappedData</span>
      <span class="k">for</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">apiMark</span><span class="o">.</span><span class="n">rulers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rulerCreated</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_mouseMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positionPixel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the position of the crosshair when the mouse is moved.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="c1"># position is in pixels</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">sceneBoundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">positionPixel</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">mousePixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">positionPixel</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">positionPixel</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
      <span class="n">mousePoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">positionPixel</span><span class="p">)</span> <span class="c1"># mouse point is in ppm</span>
      <span class="n">axisPositionDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisPositionDict</span>
      <span class="n">position</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">):</span>
        <span class="c1"># TBD: what if x and y have the same (or related) axis codes?</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">pos</span> <span class="o">=</span> <span class="n">mousePoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">pos</span> <span class="o">=</span> <span class="n">mousePoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">pos</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">position</span>
        <span class="n">axisPositionDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_crosshairCode</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">code</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">position</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">mousePosition</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="c1"># position is in ppm</span>
      <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">windows</span><span class="p">:</span>
        <span class="n">window</span><span class="o">.</span><span class="n">_setCrossHairPosition</span><span class="p">(</span><span class="n">axisPositionDict</span><span class="p">)</span>
      <span class="c1">###self.vLine.setPos(mousePoint.x())</span>
      <span class="c1">###self.hLine.setPos(mousePoint.y())</span>
      <span class="c1">###for vLine in self.guiSpectrumDisplay._appBase.vLines:</span>
      <span class="c1">###  vLine.setPos(self.mousePoint.x())</span>
      <span class="c1">###for hLine in self.guiSpectrumDisplay._appBase.hLines:</span>
      <span class="c1">###  hLine.setPos(self.mousePoint.y())</span>
    <span class="c1">###return self.mousePoint</span>

  <span class="k">def</span> <span class="nf">_showMousePosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays mouse position for both axes by axis code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span>
      <span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%.3f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%.4g</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span><span class="o">.</span><span class="n">positionBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">format</span> <span class="o">%</span>
      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
    <span class="p">)</span>

<div class="viewcode-block" id="GuiStrip.zoomToRegion"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomToRegion">[docs]</a>  <span class="k">def</span> <span class="nf">zoomToRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xRegion</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">yRegion</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">xRegion</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">yRegion</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.zoomX"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomX">[docs]</a>  <span class="k">def</span> <span class="nf">zoomX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms x axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.zoomY"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomY">[docs]</a>  <span class="k">def</span> <span class="nf">zoomY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms y axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.resetZoom"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.resetZoom">[docs]</a>  <span class="k">def</span> <span class="nf">resetZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms both axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">autoRange</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_zoomTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomToRegion</span><span class="p">(</span><span class="n">xRegion</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">yRegion</span><span class="o">=</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomPopup</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStrip.showZoomPopup"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showZoomPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showZoomPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and displays a popup for zooming to a region in the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomPopup</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">()</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;x2&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;y1&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;y2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">okButton</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>
    <span class="n">okButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zoomTo</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">x1</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">x2</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span>
                                                   <span class="nb">float</span><span class="p">(</span><span class="n">y1</span><span class="o">.</span><span class="n">text</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y2</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                                     <span class="p">)</span>
                             <span class="p">)</span>
    <span class="n">cancelButton</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Cancel&#39;</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">okButton</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">cancelButton</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">cancelButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomPopup</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomPopup</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomPopup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_storeZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds current region to the zoom stack for the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">_restoreZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Restores last saved region to the zoom stack for the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">restoredZoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
      <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="n">restoredZoom</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">restoredZoom</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="n">restoredZoom</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">restoredZoom</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStrip.showSpectrum"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showSpectrum">[docs]</a>  <span class="k">def</span> <span class="nf">showSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiSpectrumView</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;should be implemented in subclass&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.showPeaks"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showPeaks">[docs]</a>  <span class="k">def</span> <span class="nf">showPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peakList</span><span class="p">:</span><span class="n">PeakList</span><span class="p">,</span> <span class="n">peaks</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Peak</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1">###from ccpn.ui.gui.modules.spectrumItems.GuiPeakListView import GuiPeakListView</span>
    <span class="c1"># NBNB TBD 1) we should not always display all peak lists together</span>
    <span class="c1"># NBNB TBD 2) This should not be called for each strip</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">peaks</span><span class="p">:</span>
      <span class="n">peaks</span> <span class="o">=</span> <span class="n">peakList</span><span class="o">.</span><span class="n">peaks</span>

    <span class="n">peakListView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findPeakListView</span><span class="p">(</span><span class="n">peakList</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">peakListView</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak</span> <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIsInPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIsInFlankingPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stripFrame</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="n">peaks</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_resetRemoveStripAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update interface when a strip is created or deleted.</span>

<span class="sd">      NB notifier is executed after deletion is final but before the wrapper is updated.</span>
<span class="sd">      len() &gt; 1 check is correct also for delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_resetRemoveStripAction</span><span class="p">()</span></div>


<span class="c1"># Notifiers:</span>
<span class="k">def</span> <span class="nf">_axisRegionChanged</span><span class="p">(</span><span class="n">axis</span><span class="p">:</span><span class="s1">&#39;Axis&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Notifier function: Update strips etc. for when axis position or width changes&quot;&quot;&quot;</span>

  <span class="n">position</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">position</span>
  <span class="n">width</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">width</span>
  <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

  <span class="n">strip</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">strip</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span><span class="p">:</span>

    <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># X axis</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Y axis</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># One of the Z axes</span>
        <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">peakListView</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="n">peakList</span> <span class="o">=</span> <span class="n">peakListView</span><span class="o">.</span><span class="n">peakList</span>
                <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak</span> <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peakList</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">strip</span><span class="o">.</span><span class="n">peakIsInPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span> <span class="ow">or</span> <span class="n">strip</span><span class="o">.</span><span class="n">peakIsInFlankingPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)]</span>
                <span class="n">strip</span><span class="o">.</span><span class="n">stripFrame</span><span class="o">.</span><span class="n">guiSpectrumDisplay</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="n">peaks</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">2</span>
          <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">planeLabel</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">planeSize</span> <span class="o">=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">singleStep</span><span class="p">()</span>
            <span class="n">planeLabel</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">strip</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeCounts</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="n">planeSize</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="p">,</span> <span class="s1">&#39;activePeakItemDict&#39;</span><span class="p">):</span>  <span class="c1"># ND display</span>
          <span class="n">activePeakItemDict</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">activePeakItemDict</span>
          <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
              <span class="n">peakItemDict</span> <span class="o">=</span> <span class="n">activePeakItemDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="p">{})</span>
              <span class="k">for</span> <span class="n">peakItem</span> <span class="ow">in</span> <span class="n">peakItemDict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">peakItem</span><span class="o">.</span><span class="n">_stripRegionUpdated</span><span class="p">()</span>

    <span class="k">finally</span><span class="p">:</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">False</span>

  <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># ASSUMES that only do H phasing</span>
    <span class="n">strip</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>


<span class="c1"># NB The following two notifiers could be replaced by wrapper notifiers on</span>
<span class="c1"># Mark, &#39;change&#39;. But it would be rather more clumsy, so leave it as it is.</span>

<span class="c1"># NBNB TODO code uses API object. REFACTOR</span>

<span class="k">def</span> <span class="nf">_rulerCreated</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">:</span><span class="n">ApiRuler</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;]Notifier function for creating rulers&quot;&quot;&quot;</span>
  <span class="n">axisCode</span> <span class="o">=</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">axisCode</span> <span class="c1"># TBD: use label and unit</span>
  <span class="n">position</span> <span class="o">=</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">position</span>
  <span class="n">label</span> <span class="o">=</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">label</span>
  <span class="n">colour</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="k">if</span> <span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">colour</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="n">Colour</span><span class="p">(</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">colour</span><span class="p">)</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">guiTask</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
    <span class="n">axisOrder</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span>
    <span class="c1"># TBD: is the below correct (so the correct axes)?</span>
    <span class="k">if</span> <span class="n">axisCode</span> <span class="o">==</span> <span class="n">axisOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">colour</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">strip</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
      <span class="n">line</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">vRulerLineDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
      <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">textItem</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">TextItem</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">())</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
        <span class="n">textItem</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">textItem</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">textItem</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">xAxisAtomLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textItem</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">rulerLabelDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">textItem</span>


    <span class="k">elif</span> <span class="n">axisCode</span> <span class="o">==</span> <span class="n">axisOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">colour</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">strip</span><span class="o">.</span><span class="n">foreground</span><span class="p">)</span>
      <span class="n">line</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">hRulerLineDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
      <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">textItem</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">TextItem</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span><span class="o">.</span><span class="n">bottomLeft</span><span class="p">())</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="n">textItem</span><span class="o">.</span><span class="n">anchor</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">textItem</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">textItem</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">yAxisAtomLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">textItem</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">rulerLabelDict</span><span class="p">[</span><span class="n">apiRuler</span><span class="p">]</span> <span class="o">=</span> <span class="n">textItem</span>

<span class="k">def</span> <span class="nf">_rulerDeleted</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">:</span><span class="n">ApiRuler</span><span class="p">):</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">guiTask</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">vRulerLineDict</span><span class="p">,</span> <span class="n">strip</span><span class="o">.</span><span class="n">hRulerLineDict</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">rulerLabelDict</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">rulerLabelDict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="c1"># Add notifier functions to Project</span>


<span class="c1"># NB This notifier must be implemented as an API postInit notifier,</span>
<span class="c1"># As it relies on Axs that are not yet created when &#39;created&#39; notifiers are executed</span>
<span class="k">def</span> <span class="nf">_setupGuiStrip</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiStrip</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set up graphical parameters for completed strips - for notifiers&quot;&quot;&quot;</span>
  <span class="n">strip</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiStrip</span><span class="p">]</span>

  <span class="n">orderedAxes</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">orderedAxes</span>
  <span class="n">axisOrder</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span>
  <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>

  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">xAxisTextItem</span> <span class="o">=</span> <span class="n">AxisTextItem</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                    <span class="n">axisCode</span><span class="o">=</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">yAxisTextItem</span> <span class="o">=</span> <span class="n">AxisTextItem</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="n">axisCode</span><span class="o">=</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">sigStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">_moveAxisCodeLabels</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">sigRangeChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">_updateRegion</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../modules.html" >ccpn.ui.gui.modules</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>