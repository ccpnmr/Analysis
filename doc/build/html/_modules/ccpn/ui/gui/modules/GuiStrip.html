<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.modules.GuiStrip &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.modules.GuiStrip</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module Documentation here</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Wayne Boucher $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:32:44 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b2 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="kn">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtOpenGL</span>

<span class="kn">from</span> <span class="nn">ccpn.core.Peak</span> <span class="kn">import</span> <span class="n">Peak</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Notifiers</span> <span class="kn">import</span> <span class="n">Notifier</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.guiSettings</span> <span class="kn">import</span> <span class="n">textFontSmall</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Button</span> <span class="kn">import</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.PlotWidget</span> <span class="kn">import</span> <span class="n">PlotWidget</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Label</span> <span class="kn">import</span> <span class="n">Label</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.LineEdit</span> <span class="kn">import</span> <span class="n">FloatLineEdit</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Widget</span> <span class="kn">import</span> <span class="n">Widget</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.PlaneToolbar</span> <span class="kn">import</span> <span class="n">_StripLabel</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Frame</span> <span class="kn">import</span> <span class="n">Frame</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.GuiNotifier</span> <span class="kn">import</span> <span class="n">GuiNotifier</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.DropBase</span> <span class="kn">import</span> <span class="n">DropBase</span>


<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Ticks</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.ccpnmr.gui.Task</span> <span class="kn">import</span> <span class="n">Ruler</span> <span class="k">as</span> <span class="n">ApiRuler</span>

<span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>


<div class="viewcode-block" id="GuiStrip"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip">[docs]</a><span class="k">class</span> <span class="nc">GuiStrip</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrumDisplay</span><span class="p">,</span> <span class="n">useOpenGL</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic strip class; used in StripNd and Strip1d</span>

<span class="sd">    :param spectrumDisplay: spectrumDisplay instance</span>

<span class="sd">    This module inherits attributes from the Strip wrapper class:</span>
<span class="sd">    Use clone() method to make a copy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># For now, cannot set spectrumDisplay attribute as it is owned by the wrapper class</span>
    <span class="c1"># self.spectrumDisplay = spectrumDisplay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">mainWindow</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span>

    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;GuiStrip&gt;&gt;&gt; spectrumDisplay: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="p">)</span>
    <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">stripFrame</span><span class="p">,</span> <span class="n">setLayout</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">showBorder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="n">acceptDrops</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;expanding&#39;</span><span class="p">,</span> <span class="n">vPolicy</span><span class="o">=</span><span class="s1">&#39;expanding&#39;</span> <span class="c1">##&#39;minimal&#39;</span>
                  <span class="p">)</span>

    <span class="c1"># it appears to be required to explicitly set these, otherwise</span>
    <span class="c1"># the Widget will not fill all available space</span>
    <span class="c1">###self.setSizePolicy(QtGui.QSizePolicy.Expanding, QtGui.QSizePolicy.Expanding)</span>
    <span class="c1"># The strip is responsive on restore to the contentMargins set here</span>
    <span class="c1">#self.setContentsMargins(5, 0, 5, 0)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">#self.setMinimumWidth(250)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span> <span class="o">=</span> <span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">useOpenGL</span><span class="o">=</span><span class="n">useOpenGL</span><span class="p">,</span>
                                 <span class="n">showDoubleCrosshair</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">doubleCrossHair</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
    <span class="c1"># GWV: plotWidget appears not to be responsive to contentsMargins</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">getLayout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Widgets for toolbar; items will be added by GuiStripNd (eg. the Z/A-plane boxes)</span>
    <span class="c1"># and GuiStrip1d; will be hidden for 2D&#39;s by GuiSpectrumView</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripToolBarWidget</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">setLayout</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;expanding&#39;</span><span class="p">,</span>
                                      <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                                      <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripToolBarWidget</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1"># Widgets for _stripIdLabel and _stripLabel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_labelWidget</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">setLayout</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;expanding&#39;</span><span class="p">,</span> <span class="n">vAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                     <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                                    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_labelWidget</span><span class="o">.</span><span class="n">setFixedHeight</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>

    <span class="c1"># display and pid</span>
    <span class="c1">#TODO:GEERTEN correct once pid has been reviewed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripIdLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelWidget</span><span class="p">,</span>
                               <span class="n">text</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]),</span>
                               <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">hAlign</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">vAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripIdLabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">textFontSmall</span><span class="p">)</span>

    <span class="c1"># Displays a draggable label for the strip</span>
    <span class="c1">#TODO:GEERTEN reinsert a notifier for update in case this displays a nmrResidue</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span> <span class="o">=</span> <span class="n">_StripLabel</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelWidget</span><span class="p">,</span>
                                   <span class="n">text</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
                                   <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">hAlign</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">vAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">textFontSmall</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hideStripLabel</span><span class="p">()</span>

    <span class="c1"># A label to display the cursor positions (updated by _showMousePosition)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cursorLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelWidget</span><span class="p">,</span>
                               <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                               <span class="n">hAlign</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">vAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="n">vPolicy</span><span class="o">=</span><span class="s1">&#39;expanding&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cursorLabel</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">textFontSmall</span><span class="p">)</span>

    <span class="c1"># Strip needs access to plotWidget&#39;s items and info #TODO: get rid of this</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plotItem</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">showDoubleCrossHair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">doubleCrossHair</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_showCrossHair</span><span class="p">()</span>
    <span class="c1"># callbacks</span>
    <span class="c1">###self.plotWidget.scene().sigMouseMoved.connect(self._mouseMoved)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseMoved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_showMousePosition</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xPreviousRegion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yPreviousRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>

    <span class="c1"># need to keep track of mouse position because Qt shortcuts don&#39;t provide</span>
    <span class="c1"># the widget or the position of where the cursor is</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axisPositionDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># axisCode --&gt; position</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initRulers</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">phasingPivot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_movedPivot</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetHPhasingPivot</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">sigPositionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">phasingPivot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_movedPivot</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetVPhasingPivot</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># notifier for highlighting the strip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripNotifier</span> <span class="o">=</span> <span class="n">Notifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">CURRENT</span><span class="p">],</span> <span class="s1">&#39;strip&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlightCurrentStrip</span><span class="p">)</span>
    <span class="c1"># Notifier for updating the peaks</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_peakNotifier</span> <span class="o">=</span> <span class="n">Notifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">CREATE</span><span class="p">],</span> <span class="s1">&#39;Peak&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateDisplayedPeaks</span><span class="p">)</span>
    <span class="c1"># Notifier for change of stripLabel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabelNotifier</span> <span class="o">=</span> <span class="n">Notifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">RENAME</span><span class="p">],</span> <span class="s1">&#39;NmrResidue&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateStripLabel</span><span class="p">)</span>
    <span class="c1">#self._stripNotifier.setDebug(True)</span>
    <span class="c1">#self._peakNotifier.setDebug(True)</span>

    <span class="c1"># For now, all dropevents are not strip specific, use spectrumDisplay&#39;s</span>
    <span class="c1"># handling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_droppedNotifier</span> <span class="o">=</span> <span class="n">GuiNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                       <span class="p">[</span><span class="n">GuiNotifier</span><span class="o">.</span><span class="n">DROPEVENT</span><span class="p">],</span> <span class="p">[</span><span class="n">DropBase</span><span class="o">.</span><span class="n">URLS</span><span class="p">,</span> <span class="n">DropBase</span><span class="o">.</span><span class="n">PIDS</span><span class="p">],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_processDroppedItems</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">gridIsVisible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;True if grid is visible&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">crossHairIsVisible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;True if crosshair is visible&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair1</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">pythonConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span>

<div class="viewcode-block" id="GuiStrip.getStripLabel"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.getStripLabel">[docs]</a>  <span class="k">def</span> <span class="nf">getStripLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the stripLabel widget&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span></div>

<div class="viewcode-block" id="GuiStrip.setStripLabelText"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.setStripLabelText">[docs]</a>  <span class="k">def</span> <span class="nf">setStripLabelText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;set the text of the _stripLabel&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.getStripLabelText"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.getStripLabelText">[docs]</a>  <span class="k">def</span> <span class="nf">getStripLabelText</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;return the text of the _stripLabel&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span><span class="o">.</span><span class="n">text</span><span class="p">()</span></div>

<div class="viewcode-block" id="GuiStrip.showStripLabel"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showStripLabel">[docs]</a>  <span class="k">def</span> <span class="nf">showStripLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doShow</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;show / hide the _stripLabel&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">doShow</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.hideStripLabel"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.hideStripLabel">[docs]</a>  <span class="k">def</span> <span class="nf">hideStripLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Hide the _stripLabel; convienience&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabel</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_updateStripLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbackDict</span><span class="p">):</span>
    <span class="s2">&quot;Update the striplabel if it represented a NmrResidue that has changed its id&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStripLabelText</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">callbackDict</span><span class="p">[</span><span class="s1">&#39;oldPid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">setStripLabelText</span><span class="p">(</span><span class="n">callbackDict</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_unregisterStrip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripNotifier</span><span class="o">.</span><span class="n">unRegister</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_peakNotifier</span><span class="o">.</span><span class="n">unRegister</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stripLabelNotifier</span><span class="o">.</span><span class="n">unRegister</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_droppedNotifier</span><span class="o">.</span><span class="n">unRegister</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_updateDisplayedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="s2">&quot;Callback when peaks have changed&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">peakList</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_highlightCurrentStrip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="s2">&quot;Callback to highlight the axes of current strip&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">highlightAxes</span><span class="p">(</span><span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="p">):</span>
    <span class="c1"># CCPN INTERNAL - called in printToFile method of GuiMainWindow</span>

    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_printToFile</span><span class="p">(</span><span class="n">printer</span><span class="p">)</span>

    <span class="c1"># print box</span>

    <span class="c1"># print ticks and grid line</span>
    <span class="n">viewRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()</span>
    <span class="n">v1</span><span class="p">,</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">viewRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># TBD: relies on axes being backwards</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">w0</span> <span class="o">=</span> <span class="n">viewRegion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># TBD: relies on axes being backwards, which is not true in 1D</span>
    <span class="n">xMajorTicks</span><span class="p">,</span> <span class="n">xMinorTicks</span><span class="p">,</span> <span class="n">xMajorFormat</span> <span class="o">=</span> <span class="n">Ticks</span><span class="o">.</span><span class="n">findTicks</span><span class="p">((</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">))</span>
    <span class="n">yMajorTicks</span><span class="p">,</span> <span class="n">yMinorTicks</span><span class="p">,</span> <span class="n">yMajorFormat</span> <span class="o">=</span> <span class="n">Ticks</span><span class="o">.</span><span class="n">findTicks</span><span class="p">((</span><span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">))</span>

    <span class="n">xScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">v1</span><span class="o">-</span><span class="n">v0</span><span class="p">)</span>
    <span class="n">xOffset</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="n">xScale</span><span class="o">*</span><span class="n">v0</span>
    <span class="n">yScale</span> <span class="o">=</span> <span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w1</span><span class="o">-</span><span class="n">w0</span><span class="p">)</span>
    <span class="n">yOffset</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="n">yScale</span><span class="o">*</span><span class="n">w0</span>
    <span class="n">xMajorText</span> <span class="o">=</span> <span class="p">[</span><span class="n">xMajorFormat</span> <span class="o">%</span> <span class="n">tick</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMajorTicks</span><span class="p">]</span>
    <span class="n">xMajorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">xScale</span><span class="o">+</span><span class="n">xOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMajorTicks</span><span class="p">]</span>
    <span class="n">xMinorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">xScale</span><span class="o">+</span><span class="n">xOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMinorTicks</span><span class="p">]</span>
    <span class="n">yMajorText</span> <span class="o">=</span> <span class="p">[</span><span class="n">xMajorFormat</span> <span class="o">%</span> <span class="n">tick</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMajorTicks</span><span class="p">]</span>
    <span class="n">yMajorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">yScale</span><span class="o">+</span><span class="n">yOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMajorTicks</span><span class="p">]</span>
    <span class="n">yMinorTicks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">*</span><span class="n">yScale</span><span class="o">+</span><span class="n">yOffset</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMinorTicks</span><span class="p">]</span>

    <span class="n">xTickHeight</span> <span class="o">=</span> <span class="n">yTickHeight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="o">-</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span>

    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">xMinorTicks</span><span class="p">:</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">xTickHeight</span><span class="p">)</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xMajorTicks</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#888888&#39;</span><span class="p">)</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">xTickHeight</span><span class="p">)</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">xMajorText</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">tick</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">*</span><span class="n">fontsize</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">xTickHeight</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># output backwards for y</span>
    <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">yMinorTicks</span><span class="p">:</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">yTickHeight</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yMajorTicks</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#888888&#39;</span><span class="p">)</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">yTickHeight</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="p">)</span>
      <span class="n">text</span> <span class="o">=</span> <span class="n">yMajorText</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
      <span class="n">printer</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">yTickHeight</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fontsize</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">printer</span><span class="o">.</span><span class="n">y1</span><span class="o">-</span><span class="n">tick</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fontsize</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_newPhasingTrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_newPhasingTrace</span><span class="p">()</span>
      
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  def newHPhasingTrace(self):</span>
<span class="sd">    </span>
<span class="sd">    for spectrumView in self.spectrumViews:</span>
<span class="sd">      spectrumView.newHPhasingTrace(self.mousePosition[1])</span>
<span class="sd">      </span>
<span class="sd">  def newVPhasingTrace(self):</span>
<span class="sd">    </span>
<span class="sd">    for spectrumView in self.spectrumViews:</span>
<span class="sd">      spectrumView.newVPhasingTrace(self.mousePosition[0])</span>
<span class="sd">  &quot;&quot;&quot;</span>
   
  <span class="k">def</span> <span class="nf">_setPhasingPivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">cursorPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">cursorPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePivot</span><span class="p">()</span>
      
<div class="viewcode-block" id="GuiStrip.removePhasingTraces"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.removePhasingTraces">[docs]</a>  <span class="k">def</span> <span class="nf">removePhasingTraces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">removePhasingTraces</span><span class="p">()</span></div>

  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  def togglePhasingPivot(self):</span>
<span class="sd">    </span>
<span class="sd">    self.hPhasingPivot.setPos(self.mousePosition[0])</span>
<span class="sd">    self.hPhasingPivot.setVisible(not self.hPhasingPivot.isVisible())</span>
<span class="sd">  &quot;&quot;&quot;</span>
  
  <span class="k">def</span> <span class="nf">_updatePivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># this is called if pivot entry at bottom of display is updated and then &quot;return&quot; key used</span>
  
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
  
  <span class="k">def</span> <span class="nf">_movedPivot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># this is called if pivot on screen is dragged</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">getXPos</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">getYPos</span><span class="p">()</span>
      
    <span class="n">phasingFrame</span><span class="o">.</span><span class="n">pivotEntry</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
    
<div class="viewcode-block" id="GuiStrip.turnOnPhasing"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.turnOnPhasing">[docs]</a>  <span class="k">def</span> <span class="nf">turnOnPhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_turnOnPhasing</span><span class="p">()</span></div>
      
<div class="viewcode-block" id="GuiStrip.turnOffPhasing"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.turnOffPhasing">[docs]</a>  <span class="k">def</span> <span class="nf">turnOffPhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_turnOffPhasing</span><span class="p">()</span></div>
      
  <span class="k">def</span> <span class="nf">_changedPhasingDirection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">phasingFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">phasingFrame</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">phasingFrame</span><span class="o">.</span><span class="n">getDirection</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_changedPhasingDirection</span><span class="p">()</span>
      
  <span class="k">def</span> <span class="nf">_updatePhasing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># TODO:GEERTEN: Fix with proper stylesheet</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="s1">&#39;#e4e15b&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">colourScheme</span> <span class="o">==</span> <span class="s1">&#39;dark&#39;</span> <span class="k">else</span> <span class="s1">&#39;#000000&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hPhasingPivot</span><span class="o">.</span><span class="n">setPen</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colour</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vPhasingPivot</span><span class="o">.</span><span class="n">setPen</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colour</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="n">spectrumView</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>
      
  <span class="k">def</span> <span class="nf">_updateRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewBox</span><span class="p">):</span>
    <span class="c1"># this is called when the viewBox is changed on the screen via the mouse</span>
    <span class="c1"># this code is complicated because need to keep viewBox region and axis region in sync</span>
    <span class="c1"># and there can be different viewBoxes with the same axis</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

    <span class="k">assert</span> <span class="n">viewBox</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="p">,</span> <span class="s1">&#39;viewBox = </span><span class="si">%s</span><span class="s1">, self.viewBox = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">viewBox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_updateY</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>

    <span class="c1"># the below updates the wrapper model</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[:</span><span class="mi">2</span><span class="p">]):</span>
      <span class="n">viewRange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
      <span class="n">axis</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">viewRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">viewRange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">axis</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">viewRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">viewRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">_updateY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_widthsChangedEnough</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
      <span class="n">r1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
      <span class="n">r2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
      <span class="n">minDiff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">maxDiff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">minDiff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">maxDiff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">yRange</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">stripYRange</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">_widthsChangedEnough</span><span class="p">(</span><span class="n">stripYRange</span><span class="p">,</span> <span class="n">yRange</span><span class="p">):</span>
          <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">yRange</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_toggleCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot; Toggles whether crosshair is visible&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair1</span><span class="o">.</span><span class="n">toggle</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showDoubleCrossHair</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair2</span><span class="o">.</span><span class="n">toggle</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_showCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Displays crosshair in strip&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showDoubleCrossHair</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_hideCrossHair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Hides crosshair in strip.&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair1</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showDoubleCrossHair</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">crossHair2</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStrip.toggleGrid"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.toggleGrid">[docs]</a>  <span class="k">def</span> <span class="nf">toggleGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Toggles whether grid is visible in the strip.&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">toggleGrid</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_crosshairCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisCode</span><span class="p">):</span>
    <span class="c1"># determines what axisCodes are compatible as far as drawing crosshair is concerned</span>
    <span class="c1"># TBD: the naive approach below should be improved</span>
    <span class="k">return</span> <span class="n">axisCode</span> <span class="c1">#if axisCode[0].isupper() else axisCode</span>

  <span class="k">def</span> <span class="nf">_createMarkAtCursorPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
    <span class="c1"># TODO: this creates a mark in all dims, is that what we want??</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">axisPositionDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisPositionDict</span>
    <span class="n">axisCodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis</span><span class="o">.</span><span class="n">code</span> <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">]</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">axisPositionDict</span><span class="p">[</span><span class="n">axisCode</span><span class="p">]</span> <span class="k">for</span> <span class="n">axisCode</span> <span class="ow">in</span> <span class="n">axisCodes</span><span class="p">]</span>
    <span class="n">task</span><span class="o">.</span><span class="n">newMark</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">axisCodes</span><span class="p">)</span> <span class="c1"># the &#39;white&#39; is overridden in PlotWidget._addRulerLine()</span>

  <span class="c1"># TODO: remove apiRuler (when notifier at bottom of module gets rid of it)</span>
  <span class="k">def</span> <span class="nf">_initRulers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">mark</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">marks</span><span class="p">:</span>
      <span class="n">apiMark</span> <span class="o">=</span> <span class="n">mark</span><span class="o">.</span><span class="n">_wrappedData</span>
      <span class="k">for</span> <span class="n">apiRuler</span> <span class="ow">in</span> <span class="n">apiMark</span><span class="o">.</span><span class="n">rulers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">_addRulerLine</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_showMousePosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays mouse position for both axes by axis code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span>
      <span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%.3f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%.4g</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%.2f</span><span class="s2">&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_cursorLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">format</span> <span class="o">%</span>
      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
    <span class="p">)</span>

<div class="viewcode-block" id="GuiStrip.zoomToRegion"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomToRegion">[docs]</a>  <span class="k">def</span> <span class="nf">zoomToRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xRegion</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">yRegion</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">xRegion</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">yRegion</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.zoomX"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomX">[docs]</a>  <span class="k">def</span> <span class="nf">zoomX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms x axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.zoomY"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.zoomY">[docs]</a>  <span class="k">def</span> <span class="nf">zoomY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms y axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.resetZoom"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.resetZoom">[docs]</a>  <span class="k">def</span> <span class="nf">resetZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zooms both axis of strip to the specified region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">autoRange</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStrip.showZoomPopup"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showZoomPopup">[docs]</a>  <span class="k">def</span> <span class="nf">showZoomPopup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and displays a popup for zooming to a region in the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zoomPopup</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">()</span>

    <span class="n">Label</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">x1LineEdit</span> <span class="o">=</span> <span class="n">FloatLineEdit</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">Label</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">x2LineEdit</span> <span class="o">=</span> <span class="n">FloatLineEdit</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">Label</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">y1LineEdit</span> <span class="o">=</span> <span class="n">FloatLineEdit</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">Label</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">y2LineEdit</span> <span class="o">=</span> <span class="n">FloatLineEdit</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_zoomTo</span><span class="p">():</span>
      <span class="n">x1</span> <span class="o">=</span> <span class="n">x1LineEdit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
      <span class="n">y1</span> <span class="o">=</span> <span class="n">y1LineEdit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
      <span class="n">x2</span> <span class="o">=</span> <span class="n">x2LineEdit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
      <span class="n">y2</span> <span class="o">=</span> <span class="n">y2LineEdit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
      <span class="k">if</span> <span class="bp">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Zoom: must specify region completely&#39;</span><span class="p">)</span>
        <span class="k">return</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">zoomToRegion</span><span class="p">(</span><span class="n">xRegion</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">yRegion</span><span class="o">=</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
      <span class="n">zoomPopup</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">Button</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_zoomTo</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">Button</span><span class="p">(</span><span class="n">zoomPopup</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Cancel&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">zoomPopup</span><span class="o">.</span><span class="n">close</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">gridSpan</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">zoomPopup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_storeZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds current region to the zoom stack for the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">viewRange</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">_restoreZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Restores last saved region to the zoom stack for the strip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">restoredZoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storedZooms</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
      <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="n">restoredZoom</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">restoredZoom</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="n">restoredZoom</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">restoredZoom</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStrip.showPeaks"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStrip.GuiStrip.showPeaks">[docs]</a>  <span class="k">def</span> <span class="nf">showPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peakList</span><span class="p">:</span><span class="n">PeakList</span><span class="p">,</span> <span class="n">peaks</span><span class="p">:</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Peak</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1">###from ccpn.ui.gui.modules.spectrumItems.GuiPeakListView import GuiPeakListView</span>
    <span class="c1"># NBNB TBD 1) we should not always display all peak lists together</span>
    <span class="c1"># NBNB TBD 2) This should not be called for each strip</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">peaks</span><span class="p">:</span>
      <span class="n">peaks</span> <span class="o">=</span> <span class="n">peakList</span><span class="o">.</span><span class="n">peaks</span>

    <span class="n">peakListView</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findPeakListView</span><span class="p">(</span><span class="n">peakList</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">peakListView</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak</span> <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIsInPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIsInFlankingPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="n">peaks</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_resetRemoveStripAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update interface when a strip is created or deleted.</span>

<span class="sd">      NB notifier is executed after deletion is final but before the wrapper is updated.</span>
<span class="sd">      len() &gt; 1 check is correct also for delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>  <span class="c1"># GWV: poor soultion self.spectrumDisplay._resetRemoveStripAction()</span></div>


<span class="c1"># Notifiers:</span>
<span class="k">def</span> <span class="nf">_axisRegionChanged</span><span class="p">(</span><span class="n">axis</span><span class="p">:</span><span class="s1">&#39;Axis&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Notifier function: Update strips etc. for when axis position or width changes&quot;&quot;&quot;</span>

  <span class="n">strip</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">strip</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

  <span class="n">position</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">position</span>
  <span class="n">width</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">width</span>
  <span class="n">region</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span><span class="p">:</span>

    <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># X axis</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Y axis</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># One of the Z axes</span>
        <span class="n">strip</span><span class="o">.</span><span class="n">_updateTraces</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
          <span class="n">spectrumView</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
          <span class="k">if</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">peakListView</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
                <span class="n">peakList</span> <span class="o">=</span> <span class="n">peakListView</span><span class="o">.</span><span class="n">peakList</span>
                <span class="n">peaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak</span> <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peakList</span><span class="o">.</span><span class="n">peaks</span> <span class="k">if</span> <span class="n">strip</span><span class="o">.</span><span class="n">peakIsInPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span> <span class="ow">or</span> <span class="n">strip</span><span class="o">.</span><span class="n">peakIsInFlankingPlane</span><span class="p">(</span><span class="n">peak</span><span class="p">)]</span>
                <span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">showPeaks</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="n">peaks</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">axisOrder</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">2</span>
          <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">planeLabel</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">planeSize</span> <span class="o">=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">singleStep</span><span class="p">()</span>
            <span class="n">planeLabel</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">strip</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeCounts</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="n">planeSize</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="p">,</span> <span class="s1">&#39;activePeakItemDict&#39;</span><span class="p">):</span>  <span class="c1"># ND display</span>
          <span class="n">activePeakItemDict</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">activePeakItemDict</span>
          <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="n">strip</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
              <span class="n">peakItemDict</span> <span class="o">=</span> <span class="n">activePeakItemDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">peakListView</span><span class="p">,</span> <span class="p">{})</span>
              <span class="k">for</span> <span class="n">peakItem</span> <span class="ow">in</span> <span class="n">peakItemDict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">peakItem</span><span class="o">.</span><span class="n">_stripRegionUpdated</span><span class="p">()</span>

    <span class="k">finally</span><span class="p">:</span>
      <span class="n">strip</span><span class="o">.</span><span class="n">beingUpdated</span> <span class="o">=</span> <span class="bp">False</span>

  <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># ASSUMES that only do H phasing</span>
    <span class="n">strip</span><span class="o">.</span><span class="n">_updatePhasing</span><span class="p">()</span>


<span class="c1"># NB The following two notifiers could be replaced by wrapper notifiers on</span>
<span class="c1"># Mark, &#39;change&#39;. But it would be rather more clumsy, so leave it as it is.</span>

<span class="c1"># NBNB TODO code uses API object. REFACTOR</span>

<span class="k">def</span> <span class="nf">_rulerCreated</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">:</span><span class="n">ApiRuler</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Notifier function for creating rulers&quot;&quot;&quot;</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">guiTask</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
    <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">_addRulerLine</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_rulerDeleted</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiRuler</span><span class="p">:</span><span class="n">ApiRuler</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Notifier function for deleting rulers&quot;&quot;&quot;</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiRuler</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">guiTask</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">strip</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">strips</span><span class="p">:</span>
    <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">_removeRulerLine</span><span class="p">(</span><span class="n">apiRuler</span><span class="p">)</span>

<span class="c1"># Add notifier functions to Project</span>


<span class="c1"># NB This notifier must be implemented as an API postInit notifier,</span>
<span class="c1"># As it relies on Axs that are not yet created when &#39;created&#39; notifiers are executed</span>
<span class="k">def</span> <span class="nf">_setupGuiStrip</span><span class="p">(</span><span class="n">project</span><span class="p">:</span><span class="n">Project</span><span class="p">,</span> <span class="n">apiStrip</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set up graphical parameters for completed strips - for notifiers&quot;&quot;&quot;</span>
  <span class="n">strip</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiStrip</span><span class="p">]</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">strip</span><span class="o">.</span><span class="n">_finaliseDone</span><span class="p">:</span> <span class="k">return</span>

  <span class="n">orderedAxes</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">orderedAxes</span>
  <span class="n">padding</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">stripRegionPadding</span>

  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setXRange</span><span class="p">(</span><span class="o">*</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">setYRange</span><span class="p">(</span><span class="o">*</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">_initTextItems</span><span class="p">()</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">sigStateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">_moveAxisCodeLabels</span><span class="p">)</span>
  <span class="n">strip</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">sigRangeChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">_updateRegion</span><span class="p">)</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>