<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.modules.GuiMainWindow &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.modules.GuiMainWindow</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This Module implements the main graphics window functionality</span>
<span class="sd">It works in concert with a wrapper object for storing/retrieving attibute values</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Geerten Vuister $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:32:44 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b2 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: TJ Ragan $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-04 09:51:15 +0100 (Tue, April 04, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QKeySequence</span>

<span class="kn">from</span> <span class="nn">ccpn.util.Svg</span> <span class="kn">import</span> <span class="n">Svg</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.BlankDisplay</span> <span class="kn">import</span> <span class="n">BlankDisplay</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.GuiSpectrumDisplay</span> <span class="kn">import</span> <span class="n">GuiSpectrumDisplay</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.GuiStrip</span> <span class="kn">import</span> <span class="n">GuiStrip</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.GuiWindow</span> <span class="kn">import</span> <span class="n">GuiWindow</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.MacroEditor</span> <span class="kn">import</span> <span class="n">MacroEditor</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets</span> <span class="kn">import</span> <span class="n">MessageDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Action</span> <span class="kn">import</span> <span class="n">Action</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.FileDialog</span> <span class="kn">import</span> <span class="n">FileDialog</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.IpythonConsole</span> <span class="kn">import</span> <span class="n">IpythonConsole</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Menu</span> <span class="kn">import</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">MenuBar</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.SideBar</span> <span class="kn">import</span> <span class="n">SideBar</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.CcpnModuleArea</span> <span class="kn">import</span> <span class="n">CcpnModuleArea</span>

<span class="kn">from</span> <span class="nn">ccpn.util.Common</span> <span class="kn">import</span> <span class="n">uniquify</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Logging</span>


<span class="c1">#TODO:WAYNE: incorporate most functionality from GuiWindow and</span>
<span class="c1">#TODO:TJ: functionality from FrameWork</span>
<span class="c1"># For readability there should be a class:</span>
<span class="c1"># _MainWindowShortCuts which (Only!) has the shortcut definitions and the callbacks to initiate them.</span>
<span class="c1"># The latter should all be private methods!</span>
<span class="c1"># For readability there should be a class:</span>
<span class="c1"># _MainWindowMenus which (Only!) has menu instantiations, the callbacks to initiate them, + relevant methods</span>
<span class="c1"># The latter should all be private methods!</span>
<span class="c1">#</span>
<span class="c1"># The docstring of GuiMainWindow should detail how this setup is</span>


<div class="viewcode-block" id="GuiMainWindow"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow">[docs]</a><span class="k">class</span> <span class="nc">GuiMainWindow</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">GuiWindow</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>

    <span class="n">QtGui</span><span class="o">.</span><span class="n">QMainWindow</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># Layout</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;GuiMainWindow: layout: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">layout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">layout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">900</span><span class="p">)</span>

    <span class="c1"># connect a close event, cleaning up things as needed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">closeEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closeEvent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s1">&#39;triggered()&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closeEvent</span><span class="p">)</span>

    <span class="n">GuiWindow</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">application</span>

    <span class="c1"># Module area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span> <span class="o">=</span> <span class="n">CcpnModuleArea</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;GuiMainWindow.moduleArea: layout: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span> <span class="c1">## pyqtgraph object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">recordingMacro</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setupWindow</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setupMenus</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initProject</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setShortcuts</span><span class="p">()</span>

    <span class="c1"># do not need an unRegisterNotify because those removed when mainWindow / project destroyed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">registerNotify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resetRemoveStripAction</span><span class="p">,</span> <span class="s1">&#39;strips&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">feedbackPopup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updatePopup</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># blank display opened later by the _initLayout if there is nothing to show otherwise</span>
    <span class="c1"># self.newBlankDisplay()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s1">&#39;Ready&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_initProject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Puts relevant information from the project into the appropriate places in the main window.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO:RASMUS: assure that isNew() and isTemporary() get added to Project; remove API calls</span>
    <span class="n">isNew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apiWindow</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">isModified</span>  <span class="c1"># a bit of a hack this, but should be correct</span>

    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">[</span><span class="s1">&#39;runMacro&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">_runMacro</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; created&#39;</span> <span class="k">if</span> <span class="n">isNew</span> <span class="k">else</span> <span class="s1">&#39; opened&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">msg2</span> <span class="o">=</span> <span class="s1">&#39;project = </span><span class="si">%s</span><span class="s1">Project(&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="s1">&#39;new&#39;</span> <span class="k">if</span> <span class="n">isNew</span> <span class="k">else</span> <span class="s1">&#39;open&#39;</span><span class="p">),</span> <span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="n">msg2</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">setProject</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updateWindowTitle</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Archive&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Archive&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_updateWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #CCPN INTERNAL - called in saveProject method of Framework</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.util.GitTools</span> <span class="kn">import</span> <span class="n">getAllRepositoriesGitCommit</span>

    <span class="n">commits</span> <span class="o">=</span> <span class="n">getAllRepositoriesGitCommit</span><span class="p">()</span>
    <span class="n">windowTitle</span> <span class="o">=</span> <span class="s1">&#39;{}, {} (framework: {:.8s}, model: {:.8s})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">applicationName</span><span class="p">,</span>
                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">applicationVersion</span><span class="p">,</span>
                                                                     <span class="n">commits</span><span class="p">[</span><span class="s1">&#39;analysis&#39;</span><span class="p">],</span>
                                                                     <span class="n">commits</span><span class="p">[</span><span class="s1">&#39;ccpnmodel&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">windowTitle</span><span class="p">)</span>

<div class="viewcode-block" id="GuiMainWindow.getMenuAction"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.getMenuAction">[docs]</a>  <span class="k">def</span> <span class="nf">getMenuAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menuString</span><span class="p">,</span> <span class="n">topMenuAction</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.Translation</span> <span class="kn">import</span> <span class="n">translator</span>
    <span class="k">if</span> <span class="n">topMenuAction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">topMenuAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuBar</span>
    <span class="n">splitMenuString</span> <span class="o">=</span> <span class="n">menuString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
    <span class="n">splitMenuString</span> <span class="o">=</span> <span class="p">[</span><span class="n">translator</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">splitMenuString</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splitMenuString</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">topMenuAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splitMenuString</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">topMenuAction</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">topMenuAction</span><span class="o">.</span><span class="n">actions</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="n">splitMenuString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">menu</span><span class="p">()</span> <span class="ow">or</span> <span class="n">a</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Menu item not found.&#39;</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_setupWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up SideBar, python console and splitters to divide up main window properly.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO:GEERTEN: deal with Stylesheet issue; There is a Splitter class in Widgets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;QSplitter{</span>
<span class="s2">                                    background-color: #bec4f3;</span>
<span class="s2">                                    }</span>
<span class="s2">                          QSplitter::handle:horizontal {</span>
<span class="s2">                                                        width: 3px;</span>
<span class="s2">                                                        }</span>

<span class="s2">                          QSplitter::handle:vertical {</span>
<span class="s2">                                                        height: 3px;</span>
<span class="s2">                                                      }</span>

<span class="s2">                                    &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># IPythonConsole</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;application&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">,</span>
                      <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span><span class="p">,</span>
                      <span class="s1">&#39;preferences&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span>
                      <span class="s1">&#39;redo&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">redo</span><span class="p">,</span>
                      <span class="s1">&#39;undo&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">undo</span><span class="p">,</span>

                      <span class="s1">&#39;ui&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span>
                      <span class="s1">&#39;mainWindow&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                      <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                      <span class="s1">&#39;loadProject&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">loadProject</span><span class="p">,</span>
                      <span class="s1">&#39;newProject&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">newProject</span><span class="p">,</span>
                     <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span> <span class="o">=</span> <span class="n">IpythonConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#TODO:LUCA: find out where the string is stored when you type &#39;?&#39; in the console; prepend this string</span>
<span class="c1">#     self.pythonConsole.ipythonWidget.__doc__ = \</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># CcpNmr IPython Console Area (shortcut &#39;PY&#39; to toggle)</span>
<span class="c1">#</span>
<span class="c1"># Access to:</span>
<span class="c1">#</span>
<span class="c1">#     application, project, current, ui, mainWindow, preferences</span>
<span class="c1">#     redo(), undo(), loadProject(), newProject()</span>
<span class="c1">#</span>
<span class="c1"># &quot;&quot;&quot; + self.pythonConsole.ipythonWidget.__doc__</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sideBar</span> <span class="o">=</span> <span class="n">SideBar</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">itemDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raiseObjectProperties</span><span class="p">)</span>

    <span class="c1"># A horizontal splitter runs vertical; ie. allows Widgets resize in a horizontal direction</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_horizontalSplitter</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSplitter</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
    <span class="c1"># A vertical splitter runs horizontal; ie. allows Widgets resize in a vertical direction</span>
    <span class="c1"># self._verticalSplitter = QtGui.QSplitter(QtCore.Qt.Vertical)</span>

    <span class="c1"># GWV: do not understand this order</span>
    <span class="c1"># self._verticalSplitter.addWidget(self.sideBar)</span>
    <span class="c1"># self._horizontalSplitter.addWidget(self._verticalSplitter)</span>
    <span class="c1"># self._horizontalSplitter.addWidget(self.moduleArea)</span>
    <span class="c1"># self.setCentralWidget(self._horizontalSplitter)</span>

    <span class="c1"># GWV: there is no need for the above as the moduleArea generates its splitter</span>
    <span class="c1"># when required</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_horizontalSplitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sideBar</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_horizontalSplitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_horizontalSplitter</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_setupMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates menu bar for main window and creates the appropriate menus according to the arguments</span>
<span class="sd">    passed at startup.</span>

<span class="sd">    This currently pulls info on what menus to create from Framework.  Once GUI and Project are</span>
<span class="sd">    separated, Framework should be able to call a method to set the menus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_menuBar</span> <span class="o">=</span> <span class="n">MenuBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">_menuSpec</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_createMenu</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menuBar</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_menuBar</span><span class="o">.</span><span class="n">setNativeMenuBar</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fillRecentProjectsMenu</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fillRecentMacrosMenu</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fillPluginsMenu</span><span class="p">()</span>


  <span class="k">def</span> <span class="nf">_createMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">targetMenu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addMenu</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">targetMenu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_addMenuActions</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">spec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">_addMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menuTitle</span><span class="p">,</span> <span class="n">targetMenu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">targetMenu</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">targetMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuBar</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetMenu</span><span class="p">,</span> <span class="n">MenuBar</span><span class="p">):</span>
      <span class="n">menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menuTitle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
      <span class="n">targetMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">menu</span> <span class="o">=</span> <span class="n">targetMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">menuTitle</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">menu</span>

  <span class="k">def</span> <span class="nf">_addMenuActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menu</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
          <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">callback</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_createMenu</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">menu</span><span class="p">)</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">kwDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;shortcut&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;⌃&#39;</span><span class="p">):</span>  <span class="c1"># Unicode U+2303, NOT the carrot on your keyboard.</span>
            <span class="n">kwDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">QKeySequence</span><span class="p">(</span><span class="s1">&#39;Ctrl+{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">callback</span><span class="o">=</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwDict</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_queryCloseProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">phrase</span><span class="p">):</span>

    <span class="n">apiProject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">root</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">apiProject</span><span class="p">,</span> <span class="s1">&#39;_temporaryDirectory&#39;</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">apiProject</span><span class="o">.</span><span class="n">isProjectModified</span><span class="p">():</span>
      <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39; and any changes will be lost&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showYesNo</span><span class="p">(</span><span class="n">title</span><span class="p">,</span>
          <span class="s1">&#39;Do you really want to </span><span class="si">%s</span><span class="s1"> project (current project will be closed</span><span class="si">%s</span><span class="s1">)?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phrase</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>


<div class="viewcode-block" id="GuiMainWindow.loadProject"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.loadProject">[docs]</a>  <span class="k">def</span> <span class="nf">loadProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projectDir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a loadProject dialog box if project directory is not specified.</span>
<span class="sd">    Loads the selected project.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queryCloseProject</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Open Project&#39;</span><span class="p">,</span> <span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;open another&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">projectDir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Open Project&quot;</span><span class="p">,</span>
                            <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
        <span class="n">projectDir</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>

      <span class="k">if</span> <span class="n">projectDir</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">projectDir</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_raiseObjectProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get object from Pid and dispatch call depending on type</span>

<span class="sd">    NBNB TBD How about refactoring so that we have a shortClassName:Popup dictionary?&quot;&quot;&quot;</span>
    <span class="n">dataPid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
    <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">dataPid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">raisePopup</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;New&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">_createNewObject</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Double-click activation not implemented for Pid </span><span class="si">%s</span><span class="s2">, object </span><span class="si">%s</span><span class="s2">&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">dataPid</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_fillRecentProjectsMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populates recent projects menu with 10 most recently loaded projects</span>
<span class="sd">    specified in the preferences file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">recentFileLocations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">_getRecentFiles</span><span class="p">()</span>
    <span class="n">recentFileMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Open Recent&#39;</span><span class="p">)</span>
    <span class="n">recentFileMenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">recentFile</span> <span class="ow">in</span> <span class="n">recentFileLocations</span><span class="p">:</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">recentFile</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="n">callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">loadProject</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">recentFile</span><span class="p">))</span>
      <span class="n">recentFileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">recentFileMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="n">recentFileMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="n">recentFileMenu</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Clear&#39;</span><span class="p">,</span>
                                    <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">clearRecentProjects</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_fillMacrosMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populates recent macros menu with last ten macros ran.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#TODO: make sure that running a macro adds it to the prefs and calls this function</span>

    <span class="n">runMacrosMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Macro-&gt;Run Recent&#39;</span><span class="p">)</span>
    <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">macroPath</span> <span class="k">as</span> <span class="n">ccpnMacroPath</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">ccpnMacroPath</span><span class="p">)</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ccpnMacros</span> <span class="k">if</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ccpnMacroPath</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ccpnMacros</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;py&#39;</span><span class="p">]</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ccpnMacros</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ccpnMacros</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
      <span class="n">ccpnMacros</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ccpnMacros</span><span class="p">)</span>

      <span class="k">for</span> <span class="n">macro</span> <span class="ow">in</span> <span class="n">ccpnMacros</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">macro</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">,</span>
                                         <span class="n">macroFile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ccpnMacroPath</span><span class="p">,</span> <span class="n">macro</span><span class="p">)))</span>
        <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccpnMacros</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">FileNotFoundError</span><span class="p">:</span>
      <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">userMacroPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userMacroPath</span><span class="p">)</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">userMacroPath</span><span class="p">)</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">userMacros</span> <span class="k">if</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">userMacroPath</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">userMacros</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;py&#39;</span><span class="p">]</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">userMacros</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">userMacros</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
      <span class="n">userMacros</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">userMacros</span><span class="p">)</span>

      <span class="k">for</span> <span class="n">macro</span> <span class="ow">in</span> <span class="n">userMacros</span><span class="p">:</span>
          <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">macro</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                          <span class="n">callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">,</span>
                                           <span class="n">macroFile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">userMacroPath</span><span class="p">,</span> <span class="n">macro</span><span class="p">)))</span>
          <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">userMacros</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">FileNotFoundError</span><span class="p">:</span>
      <span class="k">pass</span>

    <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="n">runMacrosMenu</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Refresh&#39;</span><span class="p">,</span>
                                    <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillMacrosMenu</span><span class="p">))</span>
    <span class="n">runMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="n">runMacrosMenu</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Browse...&#39;</span><span class="p">,</span>
                                    <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_fillRecentMacrosMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populates recent macros menu with last ten macros ran.</span>
<span class="sd">    TODO: make sure that running a macro adds it to the prefs and calls this function</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">recentMacros</span> <span class="o">=</span> <span class="n">uniquify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="p">)</span>
    <span class="n">recentMacrosMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Macro-&gt;Run Recent&#39;</span><span class="p">)</span>
    <span class="n">recentMacrosMenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">recentMacro</span> <span class="ow">in</span> <span class="n">recentMacros</span><span class="p">:</span>
      <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">recentMacro</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runMacro</span><span class="p">,</span> <span class="n">macroFile</span><span class="o">=</span><span class="n">recentMacro</span><span class="p">))</span>
      <span class="n">recentMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">recentMacrosMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="n">recentMacrosMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="n">recentMacrosMenu</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Clear&#39;</span><span class="p">,</span>
                                      <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">clearRecentMacros</span><span class="p">))</span>


  <span class="k">def</span> <span class="nf">_addPluginSubMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Plugin</span><span class="p">):</span>
    <span class="n">targetMenu</span> <span class="o">=</span> <span class="n">pluginsMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Plugins&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;...&#39;</span> <span class="ow">in</span> <span class="n">Plugin</span><span class="o">.</span><span class="n">PLUGINNAME</span><span class="p">:</span>
      <span class="n">package</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">Plugin</span><span class="o">.</span><span class="n">PLUGINNAME</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">targetMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">topMenuAction</span><span class="o">=</span><span class="n">pluginsMenu</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">targetMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addMenu</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">targetMenu</span><span class="o">=</span><span class="n">pluginsMenu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">Plugin</span><span class="o">.</span><span class="n">PLUGINNAME</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">callback</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPlugin</span><span class="p">,</span> <span class="n">Plugin</span><span class="o">=</span><span class="n">Plugin</span><span class="p">))</span>
    <span class="n">targetMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">_fillPluginsMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.lib.ExtensionLoader</span> <span class="kn">import</span> <span class="n">getPlugins</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">pluginPath</span>

    <span class="n">pluginsMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Plugins&#39;</span><span class="p">)</span>
    <span class="n">pluginsMenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="n">Plugins</span> <span class="o">=</span> <span class="n">getPlugins</span><span class="p">(</span><span class="n">pluginPath</span><span class="p">)</span>
    <span class="n">Plugins</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Plugins</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span><span class="n">p</span><span class="o">.</span><span class="n">PLUGINNAME</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Plugin</span> <span class="ow">in</span> <span class="n">Plugins</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_addPluginSubMenu</span><span class="p">(</span><span class="n">Plugin</span><span class="p">)</span>

    <span class="n">pluginsMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="n">Plugins</span> <span class="o">=</span> <span class="n">getPlugins</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userPluginPath</span><span class="p">)</span>
    <span class="n">Plugins</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Plugins</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span><span class="n">p</span><span class="o">.</span><span class="n">PLUGINNAME</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Plugin</span> <span class="ow">in</span> <span class="n">Plugins</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_addPluginSubMenu</span><span class="p">(</span><span class="n">Plugin</span><span class="p">)</span>
    <span class="n">pluginsMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
    <span class="n">pluginsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Action</span><span class="p">(</span><span class="n">pluginsMenu</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Reload&#39;</span><span class="p">,</span>
                                      <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillPluginsMenu</span><span class="p">))</span>


<div class="viewcode-block" id="GuiMainWindow.startPlugin"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.startPlugin">[docs]</a>  <span class="k">def</span> <span class="nf">startPlugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Plugin</span><span class="p">):</span>
    <span class="n">plugin</span> <span class="o">=</span> <span class="n">Plugin</span><span class="p">(</span><span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">guiModule</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">plugin</span><span class="o">.</span><span class="n">widgetsState</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.PluginModule</span> <span class="kn">import</span> <span class="n">PluginModule</span>
        <span class="n">pluginModule</span> <span class="o">=</span> <span class="n">PluginModule</span><span class="p">(</span><span class="n">interactor</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span>
                                    <span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>   <span class="c1"># ejb</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pluginModule</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">guiModule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">plugin</span><span class="o">.</span><span class="n">PLUGINNAME</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">interactor</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">application</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span>
                                      <span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">plugin</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">pluginModule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pluginModules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pluginModule</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">pluginModule</span><span class="p">)</span></div>
    <span class="c1"># TODO: open as pop-out, not as part of MainWindow</span>
    <span class="c1"># self.moduleArea.moveModule(pluginModule, position=&#39;above&#39;, neighbor=None)</span>

  <span class="k">def</span> <span class="nf">_updateRestoreArchiveMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenuAction</span><span class="p">(</span><span class="s1">&#39;Project-&gt;Restore From Archive...&#39;</span><span class="p">)</span>
    <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">_archivePaths</span><span class="p">()))</span>

<div class="viewcode-block" id="GuiMainWindow.undo"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.undo">[docs]</a>  <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span></div>

<div class="viewcode-block" id="GuiMainWindow.redo"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.redo">[docs]</a>  <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">redo</span><span class="p">()</span></div>

<div class="viewcode-block" id="GuiMainWindow.saveLogFile"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.saveLogFile">[docs]</a>  <span class="k">def</span> <span class="nf">saveLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="GuiMainWindow.clearLogFile"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.clearLogFile">[docs]</a>  <span class="k">def</span> <span class="nf">clearLogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="GuiMainWindow.displayProjectSummary"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.displayProjectSummary">[docs]</a>  <span class="k">def</span> <span class="nf">displayProjectSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet&#39;</span><span class="p">,</span>
          <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves application preferences. Displays message box asking user to save project or not.</span>
<span class="sd">    Closes Application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">ccpn.framework.PathsAndUrls</span> <span class="kn">import</span> <span class="n">userPreferencesPath</span>
    <span class="c1">#prefPath = os.path.expanduser(&quot;~/.ccpn/v3settings.json&quot;)</span>
    <span class="c1">#TODO:TJ move all of the saving of preferences to FrameWork</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Preferences not saved: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
    <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">reply</span> <span class="o">=</span> <span class="n">MessageDialog</span><span class="o">.</span><span class="n">showMulti</span><span class="p">(</span><span class="s2">&quot;Quit Program&quot;</span><span class="p">,</span> <span class="s2">&quot;Do you want to save changes before quitting?&quot;</span><span class="p">,</span>
                                     <span class="p">[</span><span class="s1">&#39;Save and Quit&#39;</span><span class="p">,</span> <span class="s1">&#39;Quit without Saving&#39;</span><span class="p">,</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">],</span>
                                   <span class="p">)</span>
    <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;Save and Quit&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

      <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">saveProject</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">success</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># Close and clean up project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>      <span class="c1"># close if saved</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">:</span>                             <span class="c1"># ejb - don&#39;t close the project</span>
          <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">reply</span> <span class="o">==</span> <span class="s1">&#39;Quit without Saving&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
      <span class="n">prefFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">userPreferencesPath</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
      <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span> <span class="n">prefFile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
      <span class="n">prefFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">_closeProject</span><span class="p">()</span>
      <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>

  <span class="c1">#TODO:LUCA: this cannot be correct and ModuleArea is not updates; The proper way should be</span>
  <span class="c1"># that moduleArea handles this: self.moduleArea.deleteModule(blankDisplay)</span>
<div class="viewcode-block" id="GuiMainWindow.deleteBlankDisplay"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.deleteBlankDisplay">[docs]</a>  <span class="k">def</span> <span class="nf">deleteBlankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes blank display from main window module area if one is present.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">blankList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;Blank Display&#39;</span> <span class="ow">in</span> <span class="n">blankList</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">blankDisplay</span> <span class="o">=</span> <span class="n">blankList</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Blank Display&#39;</span><span class="p">]</span>
      <span class="c1"># blankDisplay.close()</span>
      <span class="n">blankDisplay</span><span class="o">.</span><span class="n">_closeModule</span><span class="p">()</span></div>

<div class="viewcode-block" id="GuiMainWindow.newBlankDisplay"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.newBlankDisplay">[docs]</a>  <span class="k">def</span> <span class="nf">newBlankDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s2">&quot;Adds new blank display to module area; returns BlankDisplay instance&quot;</span>
    <span class="n">blankDisplay</span> <span class="o">=</span> <span class="n">BlankDisplay</span><span class="p">(</span><span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># blankDisplay = BlankDisplay.instance(mainWindow=self)     # ejb - failed test with a singleton</span>
    <span class="c1">#FIXME:ED - still crashes when loading some projects</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relativeTo</span><span class="p">:</span>
      <span class="n">relativeTo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span>     <span class="c1"># ejb</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">blankDisplay</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blankDisplay</span></div>

<div class="viewcode-block" id="GuiMainWindow.newMacroFromLog"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.newMacroFromLog">[docs]</a>  <span class="k">def</span> <span class="nf">newMacroFromLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays macro editor with contents of the log.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">MacroEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moduleArea</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Macro Editor&quot;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">logPath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
    <span class="n">editor</span><span class="o">.</span><span class="n">textBox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


  <span class="c1">#TODO:TJ the below is in Framework (slightly different implementation) so presumably does not belong here???</span>
  <span class="c1">#Framework owns the command, this part juts get the file to run</span>
<div class="viewcode-block" id="GuiMainWindow.runMacro"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.runMacro">[docs]</a>  <span class="k">def</span> <span class="nf">runMacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macroFile</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a macro if a macro is specified, or opens a dialog box for selection of a macro file and then</span>
<span class="sd">    runs the selected macro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">macroFile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">ExistingFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Run Macro&quot;</span><span class="p">,</span>
                          <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptOpen</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userMacroPath</span><span class="p">):</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">setDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">userMacroPath</span><span class="p">)</span>
      <span class="n">macroFile</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">macroFile</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">macroFile</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">recentMacros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_fillRecentMacrosMenu</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">_runMacro</span><span class="p">(</span><span class="n">macroFile</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_resetRemoveStripAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strips</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">spectrumDisplay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>
      <span class="k">pass</span>  <span class="c1"># GWV: poor solution spectrumDisplay._resetRemoveStripAction()</span>

<div class="viewcode-block" id="GuiMainWindow.printToFile"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiMainWindow.GuiMainWindow.printToFile">[docs]</a>  <span class="k">def</span> <span class="nf">printToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrumDisplayOrStrip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
    <span class="c1">#TODO:LUCA: Docstring needed</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">saveName</span> <span class="o">=</span> <span class="n">spectrumDisplayOrStrip</span><span class="o">.</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;.svg&#39;</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">saveName</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplayOrStrip</span><span class="p">:</span>
      <span class="n">spectrumDisplayOrStrip</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplayOrStrip</span> <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
      <span class="n">spectrumDisplayOrStrip</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">spectrumDisplay</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spectrumDisplayOrStrip</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">:</span>
      <span class="n">spectrumDisplayOrStrip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">spectrumDisplayOrStrip</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spectrumDisplayOrStrip</span><span class="p">,</span> <span class="n">GuiSpectrumDisplay</span><span class="p">):</span>
        <span class="n">strips</span> <span class="o">=</span> <span class="n">spectrumDisplayOrStrip</span><span class="o">.</span><span class="n">strips</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">strips</span><span class="p">:</span>
          <span class="k">return</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">FileDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span>
                            <span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">saveName</span><span class="p">,</span> <span class="n">fileMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AnyFile</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Print to File&#39;</span><span class="p">,</span>
                            <span class="n">acceptMode</span><span class="o">=</span><span class="n">FileDialog</span><span class="o">.</span><span class="n">AcceptSave</span><span class="p">,</span> <span class="n">preferences</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="p">,</span>
                            <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;SVG (*.svg)&#39;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">selectedFile</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
          <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.svg&quot;</span><span class="p">):</span>
          <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="s2">&quot;.svg&quot;</span>

      <span class="n">xCount</span> <span class="o">=</span> <span class="n">yCount</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spectrumDisplayOrStrip</span><span class="p">,</span> <span class="n">GuiSpectrumDisplay</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">spectrumDisplayOrStrip</span><span class="o">.</span><span class="n">stripDirection</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
          <span class="n">yCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">strips</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">xCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">strips</span><span class="p">)</span>

      <span class="k">with</span> <span class="n">Svg</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">xCount</span><span class="o">=</span><span class="n">xCount</span><span class="p">,</span> <span class="n">yCount</span><span class="o">=</span><span class="n">yCount</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span> <span class="k">as</span> <span class="n">printer</span><span class="p">:</span>

        <span class="c1"># box</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">xNumber</span> <span class="o">=</span> <span class="n">yNumber</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spectrumDisplayOrStrip</span><span class="p">,</span> <span class="n">GuiSpectrumDisplay</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">strip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strips</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">spectrumDisplayOrStrip</span><span class="o">.</span><span class="n">stripDirection</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
              <span class="n">xOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
              <span class="n">yOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="n">yCount</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span> <span class="o">/</span> <span class="n">yCount</span><span class="p">)</span>
              <span class="n">yNumber</span> <span class="o">=</span> <span class="n">n</span>
              <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># strip separator</span>
                <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">yOutputRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">yOutputRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">xOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">width</span> <span class="o">/</span> <span class="n">xCount</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span> <span class="o">/</span> <span class="n">xCount</span><span class="p">)</span>
              <span class="n">yOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
              <span class="n">xNumber</span> <span class="o">=</span> <span class="n">n</span>
              <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># strip separator</span>
                <span class="n">printer</span><span class="o">.</span><span class="n">writeLine</span><span class="p">(</span><span class="n">xOutputRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xOutputRegion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">height</span><span class="p">)</span>
            <span class="n">printer</span><span class="o">.</span><span class="n">startRegion</span><span class="p">(</span><span class="n">xOutputRegion</span><span class="p">,</span> <span class="n">yOutputRegion</span><span class="p">,</span> <span class="n">xNumber</span><span class="p">,</span> <span class="n">yNumber</span><span class="p">)</span>
            <span class="n">strip</span><span class="o">.</span><span class="n">_printToFile</span><span class="p">(</span><span class="n">printer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">xOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
          <span class="n">yOutputRegion</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
          <span class="n">printer</span><span class="o">.</span><span class="n">startRegion</span><span class="p">(</span><span class="n">xOutputRegion</span><span class="p">,</span> <span class="n">yOutputRegion</span><span class="p">)</span>
          <span class="n">spectrumDisplayOrStrip</span><span class="o">.</span><span class="n">_printToFile</span><span class="p">(</span><span class="n">printer</span><span class="p">)</span></div>

  <span class="n">_mouseMovedSignal</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_mousePositionMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strip</span><span class="p">:</span><span class="n">GuiStrip</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; CCPN INTERNAL: called from ViewBox</span>
<span class="sd">    This is called when the mouse cursor position has changed in some strip</span>
<span class="sd">    :param strip: The strip the mouse cursor is hovering over</span>
<span class="sd">    :param position: The cursor position in &quot;natural&quot; (e.g. ppm) units</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axisCodes</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">axisCodes</span>
    <span class="n">orderedAxes</span> <span class="o">=</span> <span class="n">strip</span><span class="o">.</span><span class="n">orderedAxes</span>

    <span class="c1"># positionDict</span>
    <span class="c1">#   strip --&gt; strip</span>
    <span class="c1">#   axisCode --&gt; position (for each axisCode in strip)</span>
    <span class="c1"># for the first two axes the position is provided by the cursor</span>
    <span class="c1"># for the z axes the position is provided as the center of the axis region (i.e. the position)</span>

    <span class="n">mouseMovedDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">strip</span><span class="o">=</span><span class="n">strip</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">axisCode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axisCodes</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">orderedAxes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
      <span class="n">mouseMovedDict</span><span class="p">[</span><span class="n">axisCode</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_mouseMovedSignal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">mouseMovedDict</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>