<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.modules.GuiStripNd &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.modules.GuiStripNd</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This widget implements the nD (n&gt;2) strip. </span>
<span class="sd">Strips are contained within a SpectrumDisplay.</span>

<span class="sd">Some of the available methods:</span>

<span class="sd">changeZPlane(n:int=0, planeCount:int=None, position:float=None): Changes the position </span>
<span class="sd">    of the z axis of the strip by number of planes or a ppm position, depending</span>
<span class="sd">    on which is specified.</span>
<span class="sd">nextZPlane(n:int=0): Decreases z ppm position by one plane</span>
<span class="sd">prevZPlane(n:int=0): Decreases z ppm position by one plane</span>

<span class="sd">resetZoom(axis=None): Resets zoom of strip axes to limits of maxima and minima of </span>
<span class="sd">    the limits of the displayed spectra.</span>
<span class="sd">    </span>
<span class="sd">toggleHorizontalTrace(self): Toggles display of the horizontal trace.</span>
<span class="sd">toggleVerticalTrace(self): Toggles display of the vertical trace.</span>

<span class="sd">setStripLabelText(text:str):  set the text of the stripLabel</span>
<span class="sd">getStripLabelText() -&gt; str:  get the text of the stripLabel</span>
<span class="sd">showStripLabel(doShow:bool):  show/hide the stripLabel</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: CCPN $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:32:45 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b2 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: Geerten Vuister $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>


<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="c1"># import math</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="c1"># import pyqtgraph as pg</span>

<span class="c1"># from ccpn.core.Project import Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="c1"># from ccpn.core.Peak import Peak</span>

<span class="c1"># from ccpn.ui.gui.widgets.Button import Button</span>
<span class="c1"># from ccpn.ui.gui.widgets.DoubleSpinbox import DoubleSpinbox</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Icon</span> <span class="kn">import</span> <span class="n">Icon</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Menu</span> <span class="kn">import</span> <span class="n">Menu</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.PlaneToolbar</span> <span class="kn">import</span> <span class="n">PlaneToolbar</span><span class="p">,</span> <span class="n">PlaneSelectorWidget</span>
<span class="c1"># from ccpn.ui.gui.widgets.Spinbox import Spinbox</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>


<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.modules.GuiStrip</span> <span class="kn">import</span> <span class="n">GuiStrip</span>

<span class="c1"># from ccpn.ui.gui.modules.spectrumItems.GuiPeakListView import GuiPeakListView</span>

<div class="viewcode-block" id="GuiStripNd"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd">[docs]</a><span class="k">class</span> <span class="nc">GuiStripNd</span><span class="p">(</span><span class="n">GuiStrip</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Main Strip for Nd spectra object</span>

<span class="sd">  This module inherits the following attributes from the Strip wrapper class:</span>

<span class="sd">  serial          serial number of Strip, used in Pid and to identify the Strip</span>
<span class="sd">                    :return &lt;str&gt;</span>
<span class="sd">  axisCodes         Fixed string Axis codes in original display order</span>
<span class="sd">                      :return &lt;tuple&gt;:(X, Y, Z1, Z2, ...)</span>
<span class="sd">  axisOrder         String Axis codes in display order, determine axis display order</span>
<span class="sd">                      axisOrder = &lt;sequence&gt;:(X, Y, Z1, Z2, ...)</span>
<span class="sd">                      :return &lt;tuple&gt;:(X, Y, Z1, Z2, ...)</span>
<span class="sd">  positions         Axis centre positions, in display order</span>
<span class="sd">                      positions = &lt;Tuple&gt;</span>
<span class="sd">                      :return &lt;Tuple&gt;:(&lt;float&gt;, ...)</span>
<span class="sd">  widths            Axis display widths, in display order</span>
<span class="sd">                      widths = &lt;Tuple&gt;</span>
<span class="sd">                      :return &lt;Tuple&gt;:(&lt;float&gt;, ...)</span>
<span class="sd">  units             Axis units, in display order</span>
<span class="sd">                      :return &lt;Tuple&gt;</span>
<span class="sd">  spectra           List of the spectra attached to the strip</span>
<span class="sd">                    (whether display is currently turned on or not)</span>
<span class="sd">                      :return &lt;Tuple&gt;:(&lt;Spectrum&gt;, ...)</span>

<span class="sd">  delete            Delete a strip</span>
<span class="sd">  clone             Create new strip that duplicates this one, appending it at the end</span>
<span class="sd">  moveTo            Move strip to index newIndex in orderedStrips</span>
<span class="sd">                      moveTo(newIndex:int)</span>
<span class="sd">                        :param newIndex:&lt;int&gt; new index position</span>
<span class="sd">  resetAxisOrder    Reset display to original axis order</span>
<span class="sd">  findAxis          Find axis</span>
<span class="sd">                      findAxis(axisCode)</span>
<span class="sd">                        :param axisCode:</span>
<span class="sd">                        :return axis</span>
<span class="sd">  displaySpectrum   Display additional spectrum on strip, with spectrum axes ordered according to axisOrder</span>
<span class="sd">                      displaySpectrum(spectrum:Spectrum, axisOrder:Sequence=()</span>
<span class="sd">                        :param spectrum:&lt;Spectrum&gt; additional spectrum to display</span>
<span class="sd">                        :param axisOrder:&lt;Sequence&gt;=() new axis ordering</span>
<span class="sd">  peakIsInPlane     Return whether the peak is in currently displayed planes for strip</span>
<span class="sd">                      peakIsInPlane(peak:Peak)</span>
<span class="sd">                        :param peak:&lt;Peak&gt; peak of interest</span>
<span class="sd">                        :return &lt;bool&gt;</span>
<span class="sd">  peakIsInFlankingPlane   Return whether the peak is in planes flanking currently displayed planes for strip</span>
<span class="sd">                            peakIsInFlankingPlane(peak:Peak)</span>
<span class="sd">                              :param peak:&lt;Peak&gt; peak of interest</span>
<span class="sd">                              :return &lt;bool&gt;</span>
<span class="sd">  peakPickPosition  Pick peak at position for all spectra currently displayed in strip</span>
<span class="sd">                      peakPickPosition(position:List[float])</span>
<span class="sd">                        :param position:&lt;List&gt; coordinates to test</span>
<span class="sd">                        :return &lt;Tuple&gt;:(&lt;Peak&gt;, ...)</span>
<span class="sd">  peakPickRegion    Peak pick all spectra currently displayed in strip in selectedRegion</span>
<span class="sd">                      selectedRegion:List[List[float])</span>
<span class="sd">                        :param selectedRegion:&lt;List&gt;  of &lt;List&gt; of coordinates to test</span>
<span class="sd">                        :return &lt;Tuple&gt;:(&lt;Peak&gt;, ...)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># TODO:ED: complete the above; also port to GuiStrip1d</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrumDisplay</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise Nd spectra object</span>

<span class="sd">    :param spectrumDisplay: spectrumDisplay instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#print(&#39;GuiStripNd&gt;&gt;&#39;, self.spectrumDisplay)</span>
    <span class="n">GuiStrip</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrumDisplay</span><span class="p">,</span> <span class="n">useOpenGL</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># the scene knows which items are in it but they are stored as a list and the below give fast access from API object to QGraphicsItem</span>
    <span class="c1">###self.peakLayerDict = {}  # peakList --&gt; peakLayer</span>
    <span class="c1">###self.peakListViewDict = {}  # peakList --&gt; peakListView</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spectrumActionDict</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># apiDataSource --&gt; toolbar action (i.e. button); used in SpectrumToolBar</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetupZWidgets</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get2dContextMenu</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">invertX</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">invertY</span><span class="p">()</span>
    <span class="c1">###self.region = guiSpectrumDisplay.defaultRegion()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">planeLabel</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">axesSwapped</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># TODO: this should be refactored; together with the &#39;Z-plane&#39; mess: should general, to be used for other dimensions</span>
    <span class="c1"># Adds the plane toolbar to the strip.</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prevZPlane</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextZPlane</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setZPlanePosition</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changePlaneCount</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span> <span class="o">=</span> <span class="n">PlaneToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stripToolBarWidget</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
                                     <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">hPolicy</span><span class="o">=</span><span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="n">hAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">vAlign</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="c1">#self._stripToolBarWidget.addWidget(self.planeToolbar)</span>
    <span class="c1">#self.planeToolBar.hide()</span>
    <span class="c1"># test</span>
    <span class="c1">#PlaneSelectorWidget(qtParent=self._stripToolBarWidget, strip=self, axis=2, grid=(0,1))</span>

    <span class="c1">#self.mouseDragEvent = self._mouseDragEvent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateRegion</span>

  <span class="k">def</span> <span class="nf">_get2dContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Menu</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates and returns the Nd context menu</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">tType</span><span class="p">:</span>
      <span class="n">menu</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">actn</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_spectrumUtilActions</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">isFloatWidget</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>     <span class="c1"># generate new menu</span>

    <span class="n">toolBarItems</span> <span class="o">=</span> <span class="p">[</span>
       <span class="c1"># type,      action name             icon                      tooltip/name                active  checked,    callback,                             method</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;ToolBar&#39;</span><span class="p">,</span>               <span class="s1">&#39;toolbarAction&#39;</span><span class="p">,</span>          <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">toggleToolbar</span><span class="p">,</span>   <span class="s1">&#39;toolbarAction&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;Crosshair&#39;</span><span class="p">,</span>             <span class="s1">&#39;crossHairAction&#39;</span><span class="p">,</span>        <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">_toggleCrossHair</span><span class="p">,</span>                <span class="s1">&#39;crossHairAction&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;H Trace&#39;</span><span class="p">,</span>               <span class="s1">&#39;hTraceAction&#39;</span><span class="p">,</span>           <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">False</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">toggleHorizontalTrace</span><span class="p">,</span>           <span class="s1">&#39;hTraceAction&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;V Trace&#39;</span><span class="p">,</span>               <span class="s1">&#39;vTraceAction&#39;</span><span class="p">,</span>           <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">False</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">toggleVerticalTrace</span><span class="p">,</span>             <span class="s1">&#39;vTraceAction&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;Grid&#39;</span><span class="p">,</span>                  <span class="s1">&#39;gridAction&#39;</span><span class="p">,</span>             <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">toggleGrid</span><span class="p">,</span>                      <span class="s1">&#39;gridAction&#39;</span><span class="p">),</span>

      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Add Contour Level&#39;</span><span class="p">,</span>     <span class="s1">&#39;icons/contour-add&#39;</span><span class="p">,</span>      <span class="s1">&#39;Add One Level&#39;</span><span class="p">,</span>            <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">addContourLevel</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Remove Contour Level&#39;</span><span class="p">,</span>  <span class="s1">&#39;icons/contour-remove&#39;</span><span class="p">,</span>   <span class="s1">&#39;Remove One Level&#39;</span><span class="p">,</span>         <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">removeContourLevel</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Raise Base Level&#39;</span><span class="p">,</span>      <span class="s1">&#39;icons/contour-base-up&#39;</span><span class="p">,</span>  <span class="s1">&#39;Raise Contour Base Level&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">raiseContourBase</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Lower Base Level&#39;</span><span class="p">,</span>      <span class="s1">&#39;icons/contour-base-down&#39;</span><span class="p">,</span><span class="s1">&#39;Lower Contour Base Level&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">lowerContourBase</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Store Zoom&#39;</span><span class="p">,</span>            <span class="s1">&#39;icons/zoom-store&#39;</span><span class="p">,</span>       <span class="s1">&#39;Store Zoom&#39;</span><span class="p">,</span>               <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_storeZoom</span><span class="p">,</span>      <span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Restore Zoom&#39;</span><span class="p">,</span>          <span class="s1">&#39;icons/zoom-restore&#39;</span><span class="p">,</span>     <span class="s1">&#39;Restore Zoom&#39;</span><span class="p">,</span>             <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_restoreZoom</span><span class="p">,</span>    <span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Reset Zoom&#39;</span><span class="p">,</span>            <span class="s1">&#39;icons/zoom-full&#39;</span><span class="p">,</span>        <span class="s1">&#39;Reset Zoom&#39;</span><span class="p">,</span>               <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">resetZoom</span><span class="p">,</span>                       <span class="s1">&#39;&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">,</span> <span class="s1">&#39;Print to File...&#39;</span><span class="p">,</span>      <span class="s1">&#39;icons/print&#39;</span><span class="p">,</span>            <span class="s1">&#39;Print Spectrum Display to File&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">printToFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumDisplay</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>

      <span class="p">(</span><span class="n">tType</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span> <span class="s1">&#39;Navigate To&#39;</span><span class="p">,</span>           <span class="s1">&#39;&#39;</span><span class="p">,</span>                       <span class="s1">&#39;&#39;</span><span class="p">,</span>                         <span class="bp">True</span><span class="p">,</span>   <span class="bp">True</span><span class="p">,</span>       <span class="bp">None</span><span class="p">,</span>                                 <span class="s1">&#39;navigateToMenu&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">aType</span><span class="p">,</span> <span class="n">aName</span><span class="p">,</span> <span class="n">icon</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">checked</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">attrib</span> <span class="ow">in</span> <span class="n">toolBarItems</span><span class="p">:</span>     <span class="c1"># build the menu items/actions</span>
      <span class="c1"># self.contextMenu.navigateToMenu = self.contextMenu.addMenu(&#39;Navigate To&#39;)</span>
      <span class="k">def</span> <span class="nf">tempMethod</span><span class="p">():</span>           <span class="c1"># ejb - how does this work?????</span>
        <span class="k">return</span>
      <span class="k">if</span> <span class="n">aType</span> <span class="o">==</span> <span class="n">tType</span><span class="o">.</span><span class="n">menu</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">aName</span><span class="p">)</span>
        <span class="n">tempMethod</span><span class="o">.</span><span class="n">__doc__</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">tempMethod</span><span class="o">.</span><span class="n">__name__</span><span class="o">=</span><span class="n">attrib</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="p">,</span> <span class="n">tempMethod</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>      <span class="c1"># add to the menu</span>

      <span class="k">elif</span> <span class="n">aType</span> <span class="o">==</span> <span class="n">tType</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
        <span class="c1"># self.gridAction = self.contextMenu.addItem(&quot;Grid&quot;, callback=self.toggleGrid, checkable=True)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">aName</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">checkable</span><span class="o">=</span><span class="n">active</span><span class="p">,</span> <span class="n">checked</span><span class="o">=</span><span class="n">checked</span><span class="p">)</span>
        <span class="n">tempMethod</span><span class="o">.</span><span class="n">__doc__</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">tempMethod</span><span class="o">.</span><span class="n">__name__</span><span class="o">=</span><span class="n">attrib</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tempMethod</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="c1"># add to self</span>

      <span class="k">elif</span> <span class="n">aType</span> <span class="o">==</span> <span class="n">tType</span><span class="o">.</span><span class="n">actn</span><span class="p">:</span>
        <span class="c1"># printAction = self.contextMenu.addAction(&quot;Print to File...&quot;, lambda: self.spectrumDisplay.window.printToFile(self.spectrumDisplay))</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">aName</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="n">ic</span> <span class="o">=</span> <span class="n">Icon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
          <span class="n">action</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spectrumUtilActions</span><span class="p">[</span><span class="n">aName</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>

    <span class="c1"># self.navigateToMenu = self.contextMenu.addMenu(&#39;Navigate To&#39;)</span>
    <span class="c1"># self.spectrumDisplays = self.getSpectrumDisplays()</span>
    <span class="c1"># for spectrumDisplay in self.spectrumDisplays:</span>
    <span class="c1">#   spectrumDisplayAction = self.navigateToMenu.addAction(spectrumDisplay.pid)</span>
    <span class="c1">#   receiver = lambda spectrumDisplay=spectrumDisplay.pid: self.navigateTo(spectrumDisplay)</span>
    <span class="c1">#   self.connect(spectrumDisplayAction, QtCore.SIGNAL(&#39;triggered()&#39;), receiver)</span>
    <span class="c1">#   self.navigateToMenu.addAction(spectrumDisplay)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">crossHairAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossHairIsVisible</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gridAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridIsVisible</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span>

<div class="viewcode-block" id="GuiStripNd.resetZoom"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.resetZoom">[docs]</a>  <span class="k">def</span> <span class="nf">resetZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resets zoom of strip axes to limits of maxima and minima of the limits of the displayed spectra.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>

      <span class="c1"># Get spectrum dimension index matching display X and Y</span>
      <span class="c1"># without using axis codes, as they may not match</span>
      <span class="n">spectrumIndices</span> <span class="o">=</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">_displayOrderSpectrumDimensionIndices</span>
      <span class="n">spectrumLimits</span> <span class="o">=</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrumLimits</span>
      <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrumLimits</span><span class="p">[</span><span class="n">spectrumIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
      <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrumLimits</span><span class="p">[</span><span class="n">spectrumIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
      <span class="c1"># xIndex = spectrumView.spectrum.axisCodes.index(self.axisCodes[0])</span>
      <span class="c1"># yIndex = spectrumView.spectrum.axisCodes.index(self.axisCodes[1])</span>
      <span class="c1"># x.append(spectrumView.spectrum.spectrumLimits[xIndex])</span>
      <span class="c1"># y.append(spectrumView.spectrum.spectrumLimits[yIndex])</span>

    <span class="n">xArray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">yArray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">zoomXArray</span> <span class="o">=</span> <span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">xArray</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xArray</span><span class="p">)])</span>
    <span class="n">zoomYArray</span> <span class="o">=</span> <span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">yArray</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">yArray</span><span class="p">)])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">zoomToRegion</span><span class="p">(</span><span class="n">zoomXArray</span><span class="p">,</span> <span class="n">zoomYArray</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;strip.resetZoom()&quot;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;strip = application.getByGid(&#39;</span><span class="si">%s</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">strip.resetZoom()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zoomXArray</span><span class="p">,</span> <span class="n">zoomYArray</span></div>

<div class="viewcode-block" id="GuiStripNd.resetAxisRange"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.resetAxisRange">[docs]</a>  <span class="k">def</span> <span class="nf">resetAxisRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">axis</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">positionArray</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>

      <span class="c1"># Get spectrum dimension index matching display X or Y</span>
      <span class="c1"># without using axis codes, as they may not match</span>
      <span class="n">spectrumIndices</span> <span class="o">=</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">_displayOrderSpectrumDimensionIndices</span>
      <span class="n">spectrumLimits</span> <span class="o">=</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">spectrumLimits</span>
      <span class="n">positionArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrumLimits</span><span class="p">[</span><span class="n">spectrumIndices</span><span class="p">[</span><span class="n">axis</span><span class="p">]])</span>

    <span class="n">positionArrayFlat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">positionArray</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">zoomArray</span> <span class="o">=</span> <span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">positionArrayFlat</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">positionArrayFlat</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">zoomX</span><span class="p">(</span><span class="o">*</span><span class="n">zoomArray</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">zoomY</span><span class="p">(</span><span class="o">*</span><span class="n">zoomArray</span><span class="p">)</span></div>


  <span class="k">def</span> <span class="nf">_updateRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewBox</span><span class="p">):</span>
    <span class="c1"># this is called when the viewBox is changed on the screen via the mouse</span>

    <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_updateRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewBox</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updateTraces</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_updateTraces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">cursorPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">cursorPosition</span>
    <span class="k">if</span> <span class="n">cursorPosition</span><span class="p">:</span>
      <span class="n">position</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursorPosition</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">position</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
      <span class="n">point</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="n">cursorPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cursorPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewBox</span><span class="o">.</span><span class="n">mapViewToScene</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
      <span class="n">cursorPixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">pixel</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">pixel</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
      <span class="n">updateHTrace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hTraceAction</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
      <span class="n">updateVTrace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vTraceAction</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
        <span class="n">spectrumView</span><span class="o">.</span><span class="n">_updateTrace</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">cursorPixel</span><span class="p">,</span> <span class="n">updateHTrace</span><span class="p">,</span> <span class="n">updateVTrace</span><span class="p">)</span>

<div class="viewcode-block" id="GuiStripNd.toggleHorizontalTrace"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.toggleHorizontalTrace">[docs]</a>  <span class="k">def</span> <span class="nf">toggleHorizontalTrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether or not horizontal trace is displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># self.hTraceAction.setChecked(not self.hTraceAction.isChecked())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updateTraces</span><span class="p">()</span></div>

<div class="viewcode-block" id="GuiStripNd.toggleVerticalTrace"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.toggleVerticalTrace">[docs]</a>  <span class="k">def</span> <span class="nf">toggleVerticalTrace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles whether or not vertical trace is displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># self.vTraceAction.setChecked(not self.vTraceAction.isChecked())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updateTraces</span><span class="p">()</span></div>

  <span class="k">def</span> <span class="nf">_mouseMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positionPixel</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="n">GuiStrip</span><span class="o">.</span><span class="n">_mouseMoved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positionPixel</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_updateTraces</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_setZWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # CCPN INTERNAL - called in _changedBoundDisplayAxisOrdering function of GuiStripDisplayNd.py</span>
<span class="sd">    Sets values for the widgets in the plane toolbar.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">zAxis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
      <span class="n">minZPlaneSize</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="n">minAliasedFrequency</span> <span class="o">=</span> <span class="n">maxAliasedFrequency</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
        <span class="c1"># spectrum = spectrumView.spectrum</span>
        <span class="c1"># zDim = spectrum.axisCodes.index(zAxis.code)</span>

        <span class="c1"># position, width, totalPointCount, minFrequency, maxFrequency, dataDim = (</span>
        <span class="c1">#   spectrumView._getSpectrumViewParams(n+2))</span>
        <span class="n">viewParams</span> <span class="o">=</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">_getSpectrumViewParams</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">minFrequency</span> <span class="o">=</span> <span class="n">viewParams</span><span class="o">.</span><span class="n">minAliasedFrequency</span>
        <span class="k">if</span> <span class="n">minFrequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">minAliasedFrequency</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">minFrequency</span> <span class="o">&lt;</span> <span class="n">minAliasedFrequency</span><span class="p">:</span>
           <span class="n">minAliasedFrequency</span> <span class="o">=</span> <span class="n">minFrequency</span>

        <span class="n">maxFrequency</span> <span class="o">=</span> <span class="n">viewParams</span><span class="o">.</span><span class="n">maxAliasedFrequency</span>
        <span class="k">if</span> <span class="n">maxFrequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">maxAliasedFrequency</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">maxFrequency</span> <span class="o">&lt;</span> <span class="n">maxAliasedFrequency</span><span class="p">:</span>
            <span class="n">maxAliasedFrequency</span> <span class="o">=</span> <span class="n">maxFrequency</span>

        <span class="n">width</span> <span class="o">=</span> <span class="n">viewParams</span><span class="o">.</span><span class="n">valuePerPoint</span>
        <span class="k">if</span> <span class="n">minZPlaneSize</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="n">minZPlaneSize</span><span class="p">:</span>
          <span class="n">minZPlaneSize</span> <span class="o">=</span> <span class="n">width</span>

      <span class="k">if</span> <span class="n">minZPlaneSize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">minZPlaneSize</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># arbitrary</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Necessary, otherwise it does not know what width it should have</span>
        <span class="n">zAxis</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">minZPlaneSize</span>

      <span class="n">planeLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

      <span class="n">planeLabel</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="n">minZPlaneSize</span><span class="p">)</span>

      <span class="c1"># have to do the following in order: maximum, value, minimum</span>
      <span class="c1"># otherwise Qt will set bogus value to guarantee that minimum &lt;= value &lt;= maximum</span>

      <span class="k">if</span> <span class="n">maxAliasedFrequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">planeLabel</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxAliasedFrequency</span><span class="p">)</span>

      <span class="n">planeLabel</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">zAxis</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">minAliasedFrequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">planeLabel</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minAliasedFrequency</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">haveSetupZWidgets</span><span class="p">:</span>
        <span class="c1"># have to set this up here, otherwise the callback is called too soon and messes up the position</span>
        <span class="n">planeLabel</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setZPlanePosition</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">haveSetupZWidgets</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="GuiStripNd.changeZPlane"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.changeZPlane">[docs]</a>  <span class="k">def</span> <span class="nf">changeZPlane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">planeCount</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the position of the z axis of the strip by number of planes or a ppm position, depending</span>
<span class="sd">    on which is specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">zAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">planeLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">planeSize</span> <span class="o">=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">singleStep</span><span class="p">()</span>

    <span class="c1"># below is hack to prevent initial setting of value to 99.99 when dragging spectrum onto blank display</span>
    <span class="k">if</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="mf">99.99</span> <span class="ow">and</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">==</span> <span class="mf">99.99</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="n">planeCount</span><span class="p">:</span>
      <span class="n">delta</span> <span class="o">=</span> <span class="n">planeSize</span> <span class="o">*</span> <span class="n">planeCount</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">zAxis</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="n">delta</span>
      <span class="k">if</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">position</span> <span class="o">&lt;=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
        <span class="n">zAxis</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
      <span class="c1">#planeLabel.setValue(zAxis.position)</span>
    <span class="k">elif</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c1"># should always be the case</span>
      <span class="k">if</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">position</span> <span class="o">&lt;=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
        <span class="n">zAxis</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;strip.changeZPlane(position=</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">position</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;strip = application.getByGid(&#39;</span><span class="si">%s</span><span class="s2">&#39;)</span><span class="se">\n</span><span class="s2">strip.changeZPlane(position=</span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">position</span><span class="p">))</span></div>
        <span class="c1">#planeLabel.setValue(zAxis.position)</span>

      <span class="c1"># else:</span>
      <span class="c1">#   print(&#39;position is outside spectrum bounds&#39;)</span>

  <span class="k">def</span> <span class="nf">_changePlaneCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the number of planes displayed simultaneously.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderedAxes</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">planeLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">zAxis</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">singleStep</span><span class="p">()</span>

<div class="viewcode-block" id="GuiStripNd.nextZPlane"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.nextZPlane">[docs]</a>  <span class="k">def</span> <span class="nf">nextZPlane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Increases z ppm position by one plane</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">changeZPlane</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">planeCount</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 because ppm units are backwards</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;strip.nextZPlane()&quot;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.getByGid(</span><span class="si">%r</span><span class="s2">).nextZPlane()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span></div>

<div class="viewcode-block" id="GuiStripNd.prevZPlane"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.modules.html#ccpn.ui.gui.modules.GuiStripNd.GuiStripNd.prevZPlane">[docs]</a>  <span class="k">def</span> <span class="nf">prevZPlane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decreases z ppm position by one plane</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">changeZPlane</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">planeCount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># -1 because ppm units are backwards</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span><span class="s2">&quot;strip.prevZPlane()&quot;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application.getByGid(</span><span class="si">%r</span><span class="s2">).prevZPlane()&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_setZPlanePosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the value of the z plane position box if the specified value is within the displayable limits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">planeLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planeToolbar</span><span class="o">.</span><span class="n">planeLabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># planeLabel.valueChanged: (&lt;-- isn&#39;t that always true??)</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="c1"># 8/3/2016 Rasmus Fogh. Fixed untested (obvious bug)</span>
    <span class="c1"># if planeLabel.minimum() &lt;= planeLabel.value() &lt;= planeLabel.maximum():</span>

    <span class="k">if</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">planeLabel</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">changeZPlane</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

  <span class="c1"># def setPlaneCount(self, n:int=0, value:int=1):</span>
  <span class="c1">#   &quot;&quot;&quot;</span>
  <span class="c1">#   Sets the number of planes to be displayed simultaneously.</span>
  <span class="c1">#   &quot;&quot;&quot;</span>
  <span class="c1">#   planeCount = self.planeToolbar.planeCounts[n]</span>
  <span class="c1">#   self.changePlaneCount(value=(value/planeCount.oldValue))</span>
  <span class="c1">#   planeCount.oldValue = value</span>

  <span class="k">def</span> <span class="nf">_findPeakListView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peakList</span><span class="p">:</span><span class="n">PeakList</span><span class="p">):</span>
    
    <span class="c1">#peakListView = self.peakListViewDict.get(peakList)</span>
    <span class="c1">#if peakListView:</span>
    <span class="c1">#  return peakListView</span>
      
    <span class="k">for</span> <span class="n">spectrumView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrumViews</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">peakListView</span> <span class="ow">in</span> <span class="n">spectrumView</span><span class="o">.</span><span class="n">peakListViews</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">peakList</span> <span class="ow">is</span> <span class="n">peakListView</span><span class="o">.</span><span class="n">peakList</span><span class="p">:</span>
          <span class="c1">#self.peakListViewDict[peakList] = peakListView</span>
          <span class="k">return</span> <span class="n">peakListView</span>
            
    <span class="k">return</span> <span class="bp">None</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>