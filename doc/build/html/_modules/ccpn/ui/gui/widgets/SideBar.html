<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.ui.gui.widgets.SideBar &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.ui.gui.widgets.SideBar</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module Documentation here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: CCPN $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:32:55 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b3 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: Wayne Boucher $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-03-23 16:50:22 +0000 (Thu, March 23, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>

<span class="kn">from</span> <span class="nn">ccpn.core</span> <span class="kn">import</span> <span class="n">_coreClassMap</span>
<span class="kn">from</span> <span class="nn">ccpn.core.NmrResidue</span> <span class="kn">import</span> <span class="n">NmrResidue</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.AbstractWrapperObject</span> <span class="kn">import</span> <span class="n">AbstractWrapperObject</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib</span> <span class="kn">import</span> <span class="n">Pid</span>
<span class="kn">from</span> <span class="nn">ccpn.core.MultipletList</span> <span class="kn">import</span> <span class="n">MultipletList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Spectrum</span> <span class="kn">import</span> <span class="n">Spectrum</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShiftList</span> <span class="kn">import</span> <span class="n">ChemicalShiftList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.SpectrumGroup</span> <span class="kn">import</span> <span class="n">SpectrumGroup</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Note</span> <span class="kn">import</span> <span class="n">Note</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Sample</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span> <span class="nn">ccpn.core.IntegralList</span> <span class="kn">import</span> <span class="n">IntegralList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.NmrChain</span> <span class="kn">import</span> <span class="n">NmrChain</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Chain</span> <span class="kn">import</span> <span class="n">Chain</span>
<span class="kn">from</span> <span class="nn">ccpn.core.StructureEnsemble</span> <span class="kn">import</span> <span class="n">StructureEnsemble</span>
<span class="kn">from</span> <span class="nn">ccpn.core.RestraintList</span> <span class="kn">import</span> <span class="n">RestraintList</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.guiSettings</span> <span class="kn">import</span> <span class="n">sidebarFont</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.GuiNotifier</span> <span class="kn">import</span> <span class="n">GuiNotifier</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.ChemicalShiftListPopup</span> <span class="kn">import</span> <span class="n">ChemicalShiftListPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.DataSetPopup</span> <span class="kn">import</span> <span class="n">DataSetPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.NmrAtomPopup</span> <span class="kn">import</span> <span class="n">NmrAtomPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.NmrChainPopup</span> <span class="kn">import</span> <span class="n">NmrChainPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.NmrResiduePopup</span> <span class="kn">import</span> <span class="n">NmrResiduePopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.NotesPopup</span> <span class="kn">import</span> <span class="n">NotesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.PeakListPropertiesPopup</span> <span class="kn">import</span> <span class="n">PeakListPropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.IntegralListPropertiesPopup</span> <span class="kn">import</span> <span class="n">IntegralListPropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.MultipletListPropertiesPopup</span> <span class="kn">import</span> <span class="n">MultipletListPropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.RestraintTypePopup</span> <span class="kn">import</span> <span class="n">RestraintTypePopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SampleComponentPropertiesPopup</span> <span class="kn">import</span> <span class="n">EditSampleComponentPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SamplePropertiesPopup</span> <span class="kn">import</span> <span class="n">SamplePropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumGroupEditor</span> <span class="kn">import</span> <span class="n">SpectrumGroupEditor</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SpectrumPropertiesPopup</span> <span class="kn">import</span> <span class="n">SpectrumPropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.StructurePopup</span> <span class="kn">import</span> <span class="n">StructurePopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.SubstancePropertiesPopup</span> <span class="kn">import</span> <span class="n">SubstancePropertiesPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.EditMultipletPopup</span> <span class="kn">import</span> <span class="n">EditMultipletPopup</span>

<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Base</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.DropBase</span> <span class="kn">import</span> <span class="n">DropBase</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.MessageDialog</span> <span class="kn">import</span> <span class="n">showInfo</span><span class="p">,</span> <span class="n">showWarning</span><span class="p">,</span> <span class="n">progressManager</span><span class="p">,</span> <span class="n">showNotImplementedMessage</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Constants</span> <span class="kn">import</span> <span class="n">ccpnmrJsonData</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CreateChainPopup</span> <span class="kn">import</span> <span class="n">CreateChainPopup</span>
<span class="kn">from</span> <span class="nn">ccpn.ui.gui.popups.CreateNmrChainPopup</span> <span class="kn">import</span> <span class="n">CreateNmrChainPopup</span>
<span class="c1"># from ccpn.ui.gui.modules.NotesEditor import NotesEditorModule</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib.Io</span> <span class="kn">import</span> <span class="n">Formats</span> <span class="k">as</span> <span class="n">ioFormats</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Notifiers</span> <span class="kn">import</span> <span class="n">Notifier</span><span class="p">,</span> <span class="n">NotifierBase</span>


<span class="c1"># NB the order matters!</span>
<span class="c1"># NB &#39;SG&#39; must be before &#39;SP&#39;, as SpectrumGroups must be ready before Spectra</span>
<span class="c1"># Also parents must appear before their children</span>

<span class="n">_classNamesInSidebar</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SpectrumGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">,</span> <span class="s1">&#39;IntegralList&#39;</span><span class="p">,</span> <span class="s1">&#39;MultipletList&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Sample&#39;</span><span class="p">,</span> <span class="s1">&#39;SampleComponent&#39;</span><span class="p">,</span> <span class="s1">&#39;Substance&#39;</span><span class="p">,</span> <span class="s1">&#39;Complex&#39;</span><span class="p">,</span> <span class="s1">&#39;Chain&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Residue&#39;</span><span class="p">,</span> <span class="s1">&#39;NmrChain&#39;</span><span class="p">,</span> <span class="s1">&#39;NmrResidue&#39;</span><span class="p">,</span> <span class="s1">&#39;NmrAtom&#39;</span><span class="p">,</span> <span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;StructureEnsemble&#39;</span><span class="p">,</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;DataSet&#39;</span><span class="p">,</span> <span class="s1">&#39;RestraintList&#39;</span><span class="p">,</span> <span class="s1">&#39;Note&#39;</span><span class="p">,</span> <span class="p">]</span>

<span class="n">Pids</span> <span class="o">=</span> <span class="s1">&#39;pids&#39;</span>

<span class="c1"># TODO Add Residue</span>


<span class="c1"># ll = [_coreClassMap[x] for x in _classNamesInSidebar]</span>
<span class="c1"># classesInSideBar = OrderedDict(((x.shortClassName, x) for x in ll))</span>
<span class="n">classesInSideBar</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">shortClassName</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_coreClassMap</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">className</span> <span class="ow">in</span> <span class="n">_classNamesInSidebar</span><span class="p">))</span>
<span class="c1"># classesInSideBar = (&#39;SG&#39;, &#39;SP&#39;, &#39;PL&#39;, &#39;SA&#39;, &#39;SC&#39;, &#39;SU&#39;, &#39;MC&#39;, &#39;NC&#39;, &#39;NR&#39;, &#39;NA&#39;,</span>
<span class="c1">#                     &#39;CL&#39;, &#39;SE&#39;, &#39;MO&#39;, &#39;DS&#39;,</span>
<span class="c1">#                     &#39;RL&#39;, &#39;NO&#39;)</span>

<span class="n">classesInTopLevel</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;SG&#39;</span><span class="p">,</span> <span class="s1">&#39;SP&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;SU&#39;</span><span class="p">,</span> <span class="s1">&#39;MC&#39;</span><span class="p">,</span> <span class="s1">&#39;MX&#39;</span><span class="p">,</span> <span class="s1">&#39;NC&#39;</span><span class="p">,</span> <span class="s1">&#39;CL&#39;</span><span class="p">,</span> <span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;DS&#39;</span><span class="p">,</span> <span class="s1">&#39;NO&#39;</span><span class="p">)</span>

<span class="c1"># NBNB TBD FIXME</span>
<span class="c1"># 1)This function (and the NEW_ITEM_DICT) it uses gets the create_new</span>
<span class="c1"># function from the shortClassName of the PARENT!!!</span>
<span class="c1"># This is the only way to do it if the create_new functions are attributes of the PARENT!!!</span>
<span class="c1">#</span>
<span class="c1"># 2) &lt;New&gt; in makes a new SampleComponent. This is counterintuitive!</span>
<span class="c1"># Anyway, how do you make a new Sample?</span>
<span class="c1"># You use the &lt;New&gt; under sample, this comment is completely inaccurate!</span>
<span class="c1">#</span>
<span class="c1"># Try putting in e.g. &lt;New PeakList&gt;, &lt;New SampleComponent&gt; etc. Done in version 9855.</span>

<span class="n">NEW_ITEM_DICT</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s1">&#39;SP&#39;</span><span class="p">:</span> <span class="s1">&#39;newPeakList&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NC&#39;</span><span class="p">:</span> <span class="s1">&#39;newNmrResidue&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NR&#39;</span><span class="p">:</span> <span class="s1">&#39;newNmrAtom&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DS&#39;</span><span class="p">:</span> <span class="s1">&#39;newRestraintList&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RL&#39;</span><span class="p">:</span> <span class="s1">&#39;newRestraint&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SE&#39;</span><span class="p">:</span> <span class="s1">&#39;newModel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Notes&#39;</span><span class="p">:</span> <span class="s1">&#39;newNote&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StructureEnsembles&#39;</span><span class="p">:</span> <span class="s1">&#39;newStructureEnsemble&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Samples&#39;</span><span class="p">:</span> <span class="s1">&#39;newSample&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NmrChains&#39;</span><span class="p">:</span> <span class="s1">&#39;newNmrChain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Chains&#39;</span><span class="p">:</span> <span class="s1">&#39;newChain&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Substances&#39;</span><span class="p">:</span> <span class="s1">&#39;newSubstance&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ChemicalShiftLists&#39;</span><span class="p">:</span> <span class="s1">&#39;newChemicalShiftList&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DataSets&#39;</span><span class="p">:</span> <span class="s1">&#39;newDataSet&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SpectrumGroups&#39;</span><span class="p">:</span> <span class="s1">&#39;newSpectrumGroup&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Complexes&#39;</span><span class="p">:</span> <span class="s1">&#39;newComplex&#39;</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">_openItemObject</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract routine to activate a module to display objs</span>
<span class="sd">    Builds on OpenObjAction dict, genererated below, which defines the handling for the various</span>
<span class="sd">    obj classes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">in</span> <span class="n">OpenObjAction</span><span class="p">:</span>

                    <span class="c1"># if a spectrum object has already been opened then attach to that spectrumDisplay</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="ow">and</span> <span class="n">spectrumDisplay</span><span class="p">:</span>
                        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">displaySpectrum</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="c1"># process objects to open</span>
                        <span class="n">returnObj</span> <span class="o">=</span> <span class="n">OpenObjAction</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">](</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

                        <span class="c1"># if the first spectrum then set the spectrumDisplay</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
                            <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">returnObj</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="c1"># raise e</span>


<span class="k">def</span> <span class="nf">_openSpectrumDisplay</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">createSpectrumDisplay</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_maximiseRegions</span><span class="p">()</span>
            <span class="c1"># mainWindow.current.strip.plotWidget.autoRange()</span>

    <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>

    <span class="c1"># TODO:LUCA: the mainWindow.createSpectrumDisplay should do the reporting to console and log</span>
    <span class="c1"># This routine can then be ommitted and the call above replaced by the one remaining line</span>
    <span class="n">mainWindow</span><span class="o">.</span><span class="n">pythonConsole</span><span class="o">.</span><span class="n">writeConsoleCommand</span><span class="p">(</span>
            <span class="s2">&quot;application.createSpectrumDisplay(spectrum)&quot;</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">=</span><span class="n">spectrum</span><span class="p">)</span>
    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;spectrum = project.getByPid(</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;application.createSpectrumDisplay(spectrum)&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">spectrumDisplay</span>


<span class="k">def</span> <span class="nf">_openSpectrumGroup</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">spectrumGroup</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;displays spectrumGroup on spectrumDisplay. It creates the display based on the first spectrum of the group.</span>
<span class="sd">    Also hides the spectrumToolBar and shows spectrumGroupToolBar &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrumGroup</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">createSpectrumDisplay</span><span class="p">(</span><span class="n">spectrumGroup</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">spectrumGroup</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>  <span class="c1"># Add the other spectra</span>
            <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">displaySpectrum</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>

        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">isGrouped</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumToolBar</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumGroupToolBar</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">spectrumGroupToolBar</span><span class="o">.</span><span class="n">_addAction</span><span class="p">(</span><span class="n">spectrumGroup</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">sp</span><span class="o">.</span><span class="n">dimensionCount</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spectrumGroup</span><span class="o">.</span><span class="n">spectra</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">_maximiseRegions</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_openSampleSpectra</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add spectra linked to sample and sampleComponent. Particularly used for screening</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">spectrumDisplay</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">createSpectrumDisplay</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">moduleArea</span><span class="o">.</span><span class="n">addModule</span><span class="p">(</span><span class="n">spectrumDisplay</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">displaySpectrum</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sampleComponent</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">sampleComponents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sampleComponent</span><span class="o">.</span><span class="n">substance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="n">sampleComponent</span><span class="o">.</span><span class="n">substance</span><span class="o">.</span><span class="n">referenceSpectra</span><span class="p">:</span>
                    <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">displaySpectrum</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span> <span class="o">=</span> <span class="n">spectrumDisplay</span><span class="o">.</span><span class="n">strips</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dimensionCount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">autoRange</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_openPeakList</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">peakList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showPeakTable</span><span class="p">(</span><span class="n">peakList</span><span class="o">=</span><span class="n">peakList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openMultipletList</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">multipletList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showMultipletTable</span><span class="p">(</span><span class="n">multipletList</span><span class="o">=</span><span class="n">multipletList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openChemicalShiftList</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showChemicalShiftTable</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">=</span><span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openNote</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">note</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showNotesEditor</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openRestraintList</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">restraintList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showRestraintTable</span><span class="p">(</span><span class="n">restraintList</span><span class="o">=</span><span class="n">restraintList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openStructureTable</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">structureEnsemble</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showStructureTable</span><span class="p">(</span><span class="n">structureEnsemble</span><span class="o">=</span><span class="n">structureEnsemble</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openNmrResidueTable</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">nmrChain</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showNmrResidueTable</span><span class="p">(</span><span class="n">nmrChain</span><span class="o">=</span><span class="n">nmrChain</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openResidueTable</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showResidueTable</span><span class="p">(</span><span class="n">chain</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_openIntegralList</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">integralList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
    <span class="n">application</span><span class="o">.</span><span class="n">showIntegralTable</span><span class="p">(</span><span class="n">integralList</span><span class="o">=</span><span class="n">integralList</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="n">relativeTo</span><span class="p">)</span>


<span class="n">OpenObjAction</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Spectrum</span><span class="p">:</span> <span class="n">_openSpectrumDisplay</span><span class="p">,</span>
    <span class="n">PeakList</span><span class="p">:</span> <span class="n">_openPeakList</span><span class="p">,</span>
    <span class="n">MultipletList</span><span class="p">:</span> <span class="n">_openMultipletList</span><span class="p">,</span>
    <span class="n">NmrChain</span><span class="p">:</span> <span class="n">_openNmrResidueTable</span><span class="p">,</span>
    <span class="n">Chain</span><span class="p">:</span> <span class="n">_openResidueTable</span><span class="p">,</span>
    <span class="n">SpectrumGroup</span><span class="p">:</span> <span class="n">_openSpectrumGroup</span><span class="p">,</span>
    <span class="n">Sample</span><span class="p">:</span> <span class="n">_openSampleSpectra</span><span class="p">,</span>
    <span class="n">ChemicalShiftList</span><span class="p">:</span> <span class="n">_openChemicalShiftList</span><span class="p">,</span>
    <span class="n">RestraintList</span><span class="p">:</span> <span class="n">_openRestraintList</span><span class="p">,</span>
    <span class="n">Note</span><span class="p">:</span> <span class="n">_openNote</span><span class="p">,</span>
    <span class="n">IntegralList</span><span class="p">:</span> <span class="n">_openIntegralList</span><span class="p">,</span>
    <span class="n">StructureEnsemble</span><span class="p">:</span> <span class="n">_openStructureTable</span>
    <span class="p">}</span>


<span class="c1">### Flag example code removed in revision 7686</span>


<div class="viewcode-block" id="SideBar"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar">[docs]</a><span class="k">class</span> <span class="nc">SideBar</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="p">,</span> <span class="n">Base</span><span class="p">,</span> <span class="n">NotifierBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multiSelect</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">Base</span><span class="o">.</span><span class="n">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acceptDrops</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">multiSelect</span> <span class="o">=</span> <span class="n">multiSelect</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiSelect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span> <span class="o">=</span> <span class="n">parent</span>  <span class="c1"># ejb - needed for moduleArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">application</span>
        <span class="c1"># self._typeToItem = dd = {}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sidebarBlockingLevel</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">sidebarFont</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setExpandsOnDoubleClick</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InternalMove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mousePressEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mousePressEvent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseReleaseEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouseReleaseEvent</span>
        <span class="c1"># self.mouseMoveEvent = self._mouseMoveEvent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragMoveEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dragMoveEvent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragEnterEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dragEnterEvent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DragDrop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eventFilter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventFilter</span>  <span class="c1"># ejb - doesn&#39;t work</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># ejb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">droppedNotifier</span> <span class="o">=</span> <span class="n">GuiNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">GuiNotifier</span><span class="o">.</span><span class="n">DROPEVENT</span><span class="p">],</span> <span class="p">[</span><span class="n">DropBase</span><span class="o">.</span><span class="n">URLS</span><span class="p">,</span> <span class="n">DropBase</span><span class="o">.</span><span class="n">PIDS</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_processDroppedItems</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemDoubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raiseObjectProperties</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sidebarBlocked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sidebar blocking. If true (non-zero) sidebar updates are blocked.</span>
<span class="sd">        Allows multiple external functions to set blocking without trampling each other</span>
<span class="sd">        Modify with increaseBlocking/decreaseBlocking only&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sidebarBlockingLevel</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="SideBar.increaseSidebarBlocking"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.increaseSidebarBlocking">[docs]</a>    <span class="k">def</span> <span class="nf">increaseSidebarBlocking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;increase level of blocking&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sidebarBlockingLevel</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="SideBar.decreaseSidebarBlocking"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.decreaseSidebarBlocking">[docs]</a>    <span class="k">def</span> <span class="nf">decreaseSidebarBlocking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reduce level of blocking - when level reaches zero, Sidebar is unblocked&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebarBlocked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sidebarBlockingLevel</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Error: cannot decrease blocking below 0&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_populateSidebar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearQTreeWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_typeToItem</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;PR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;SP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Spectra&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;SG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;SpectrumGroups&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newSpectrumGroup</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrumGroupItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSpectrumGroup</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newSpectrumGroup</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSpectrumGroup</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New SpectrumGroup&gt;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">samplesItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;SA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplesItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplesItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samplesItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Samples&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newSample</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samplesItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSample</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newSample</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSample</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New Sample&gt;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">substancesItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;SU&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substancesItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substancesItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substancesItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Substances&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newSubstance</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substancesItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSubstance</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newSubstance</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newSubstance</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New Substance&gt;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chainItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;MC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chainItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chainItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chainItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Chains&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newChainItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chainItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newChainItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newChainItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newChainItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New Chain&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">complexItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;MX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complexItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">complexItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complexItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Complexes&quot;</span><span class="p">)</span>

        <span class="c1"># TODO make COmplexEditor, install it in _createNewObject, and uncomment this</span>
        <span class="c1"># self.newComplex = QtWidgets.QTreeWidgetItem(self.complexItem)</span>
        <span class="c1"># self.newComplex.setFlags(self.newComplex.flags() ^ QtCore.Qt.ItemIsDragEnabled)</span>
        <span class="c1"># self.newComplex.setText(0, &quot;&lt;New Complex&gt;&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nmrChainItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;NC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmrChainItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmrChainItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmrChainItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;NmrChains&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newNmrChainItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmrChainItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newNmrChainItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newNmrChainItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newNmrChainItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New NmrChain&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftListsItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;CL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftListsItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftListsItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftListsItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ChemicalShiftLists&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newChemicalShiftListItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftListsItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newChemicalShiftListItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newChemicalShiftListItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newChemicalShiftListItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New ChemicalShiftList&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structuresItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;SE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structuresItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structuresItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structuresItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;StructureEnsembles&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newStructuresListItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structuresItem</span><span class="p">)</span>  <span class="c1"># ejb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newStructuresListItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newStructuresListItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newStructuresListItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New StructureEnsemble&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataSetsItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;DS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSetsItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSetsItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSetsItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;DataSets&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newDataSetItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSetsItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newDataSetItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newDataSetItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newDataSetItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New DataSet&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">notesItem</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;NO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notesItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notesItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notesItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Notes&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newNoteItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notesItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newNoteItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newNoteItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newNoteItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;New Note&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raiseObjectProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get object from Pid and dispatch call depending on type</span>

<span class="sd">        NBNB TBD How about refactoring so that we have a shortClassName:Popup dictionary?&quot;&quot;&quot;</span>
        <span class="n">dataPid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">dataPid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raisePopup</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&lt;New&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_createNewObject</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Double-click activation not implemented for Pid </span><span class="si">%s</span><span class="s2">, object </span><span class="si">%s</span><span class="s2">&quot;</span>
                                  <span class="o">%</span> <span class="p">(</span><span class="n">dataPid</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>

<div class="viewcode-block" id="SideBar.selectPid"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.selectPid">[docs]</a>    <span class="k">def</span> <span class="nf">selectPid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>  <span class="c1">#not sure why this returns a list!</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_processDroppedItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s2">&quot;Handle the dropped urls&quot;</span>
        <span class="c1"># CCPN INTERNAL. Called also from module area and GuiStrip. They should have same behaviours</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urls&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt; dropped: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

            <span class="n">dataType</span><span class="p">,</span> <span class="n">subType</span><span class="p">,</span> <span class="n">usePath</span> <span class="o">=</span> <span class="n">ioFormats</span><span class="o">.</span><span class="n">analyseUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataType</span> <span class="o">==</span> <span class="s1">&#39;Project&#39;</span> <span class="ow">and</span> <span class="n">subType</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ioFormats</span><span class="o">.</span><span class="n">CCPN</span><span class="p">,</span>
                                                     <span class="n">ioFormats</span><span class="o">.</span><span class="n">NEF</span><span class="p">,</span>
                                                     <span class="n">ioFormats</span><span class="o">.</span><span class="n">NMRSTAR</span><span class="p">,</span>
                                                     <span class="n">ioFormats</span><span class="o">.</span><span class="n">SPARKY</span><span class="p">):</span>

                <span class="n">okToContinue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="o">.</span><span class="n">_queryCloseProject</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Load </span><span class="si">%s</span><span class="s1"> project&#39;</span> <span class="o">%</span> <span class="n">subType</span><span class="p">,</span>
                                                                  <span class="n">phrase</span><span class="o">=</span><span class="s1">&#39;create a new&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">okToContinue</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">progressManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="s1">&#39;Loading project... &#39;</span> <span class="o">+</span> <span class="n">url</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">loadProject</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
                            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;loadProject Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
                            <span class="n">obj</span> <span class="o">=</span> <span class="bp">None</span>

                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Project</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">obj</span><span class="o">.</span><span class="n">_mainWindow</span><span class="o">.</span><span class="n">sideBar</span><span class="o">.</span><span class="n">fillSideBar</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                                <span class="n">obj</span><span class="o">.</span><span class="n">_mainWindow</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setActiveWindow</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_mainWindow</span><span class="p">)</span>

                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
                                <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># with progressManager(self.mainWindow, &#39;Loading data... &#39; + url):</span>
                <span class="k">try</span><span class="p">:</span>  <span class="c1">#  Why do we need this try?</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                        <span class="n">objs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
                    <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;loadData Error: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>
            <span class="c1"># #   try:</span>

            <span class="c1"># except Exception as es:</span>
            <span class="c1">#   getLogger().warning(&#39;loadData Error: %s&#39; % str(es))</span>

            <span class="c1"># if objects is not None:</span>
            <span class="c1">#   # TODO:ED added here to make new instances of project visible, they are created hidden to look cleaner</span>
            <span class="c1">#   for obj in objects:</span>

            <span class="c1"># if objects is None or len(objects) == 0:</span>
            <span class="c1">#   showWarning(&#39;Invalid File&#39;, &#39;Cannot handle &quot;%s&quot;&#39; % url)</span>
        <span class="k">return</span> <span class="n">objs</span>

<div class="viewcode-block" id="SideBar.setProject"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.setProject">[docs]</a>    <span class="k">def</span> <span class="nf">setProject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the specified project as a class attribute so it can be accessed from elsewhere</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registerNotifiers</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_registerNotifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Register notifiers to maintain sidebar</span>
        <span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">classesInSideBar</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">className</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">className</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                               <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">DELETE</span><span class="p">],</span>
                                               <span class="n">className</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">_removeItem</span><span class="p">,</span>
                                               <span class="n">onceOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">className</span> <span class="o">!=</span> <span class="s1">&#39;NmrResidue&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                                   <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">CREATE</span><span class="p">],</span>
                                                   <span class="n">className</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                                   <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">RENAME</span><span class="p">],</span>
                                                   <span class="n">className</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">_renameItem</span><span class="p">,</span>
                                                   <span class="n">onceOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">CREATE</span><span class="p">],</span>
                                           <span class="s1">&#39;NmrResidue&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_refreshParentNmrChain</span><span class="p">,</span>
                                           <span class="n">onceOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">RENAME</span><span class="p">],</span>
                                           <span class="s1">&#39;NmrResidue&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_renameNmrResidueItem</span><span class="p">,</span>
                                           <span class="n">onceOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setNotifier</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                                           <span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">CHANGE</span><span class="p">,</span> <span class="n">Notifier</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span> <span class="n">Notifier</span><span class="o">.</span><span class="n">DELETE</span><span class="p">],</span>
                                           <span class="s1">&#39;SpectrumGroup&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_refreshSidebarSpectra</span><span class="p">))</span>

        <span class="c1"># TODO:ED Add similar set of notifiers, and similar function for Complex/Chain</span>

    <span class="k">def</span> <span class="nf">_unregisterNotifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">notifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifierList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">notifier</span><span class="p">:</span>
                <span class="n">notifier</span><span class="o">.</span><span class="n">unRegister</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_refreshSidebarSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1"># dummy:Project):</span>
        <span class="sd">&quot;&quot;&quot;Reset spectra in sidebar - to be called from notifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sideBarState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveExpandedState</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
            <span class="c1"># self._removeItem( self.project, spectrum)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_removeItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">spectrum</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">spectrum</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">peakLists</span> <span class="o">+</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">integralLists</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">obj</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restoreExpandedState</span><span class="p">(</span><span class="n">sideBarState</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_createSpectrumGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="bp">None</span> <span class="ow">or</span> <span class="p">[]):</span>
        <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">addNew</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra</span><span class="p">)</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_refreshParentNmrChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1">#nmrResidue:NmrResidue, oldPid:Pid=None):     # ejb - catch oldName</span>
        <span class="sd">&quot;&quot;&quot;Reset NmrChain sidebar - needed when NmrResidue is created or renamed to trigger re-sort</span>

<span class="sd">        Replaces normal _createItem notifier for NmrResidues&quot;&quot;&quot;</span>

        <span class="n">nmrResidue</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">]</span>
        <span class="c1"># oldPid = data[Notifier.OLDPID]</span>

        <span class="n">sideBarState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveExpandedState</span><span class="p">()</span>

        <span class="n">nmrChain</span> <span class="o">=</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">_parent</span>

        <span class="c1"># Remove NmrChain item and contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_removeItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">nmrChain</span><span class="p">})</span>

        <span class="c1"># Create NmrResidue items again - this gives them in correctly sorted order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">nmrChain</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="n">nmrChain</span><span class="o">.</span><span class="n">nmrResidues</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">nr</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">nr</span><span class="o">.</span><span class="n">nmrAtoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">nmrAtom</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restoreExpandedState</span><span class="p">(</span><span class="n">sideBarState</span><span class="p">)</span>

        <span class="c1"># nmrChain = nmrResidue._parent     # ejb - just insert the 1 item</span>
        <span class="c1"># for nr in nmrChain.nmrResidues:</span>
        <span class="c1">#   if (nr.pid == nmrResidue.pid):</span>
        <span class="c1">#     self._createItem(nr)</span>
        <span class="c1">#</span>
        <span class="c1"># newPid = nmrChain.pid                   # ejb - expand the tree again from nmrChain</span>
        <span class="c1"># for item in self._findItems(newPid):</span>
        <span class="c1">#   item.setExpanded(True)</span>

    <span class="k">def</span> <span class="nf">_addItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">,</span> <span class="n">pid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a QTreeWidgetItem as a child of the item specified, which corresponds to the data object</span>
<span class="sd">        passed in.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">newItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDropEnabled</span><span class="p">))</span>
        <span class="n">newItem</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>
        <span class="n">newItem</span><span class="o">.</span><span class="n">mousePressEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressEvent</span>
        <span class="k">return</span> <span class="n">newItem</span>

    <span class="c1">#</span>
    <span class="c1"># def renameItem(self, pid):</span>
    <span class="c1">#   # item = FindItem</span>
    <span class="c1">#   pass</span>

<div class="viewcode-block" id="SideBar.processText"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.processText">[docs]</a>    <span class="k">def</span> <span class="nf">processText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">newNote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">newNote</span><span class="p">()</span>
        <span class="n">newNote</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span></div>

    <span class="k">def</span> <span class="nf">_deleteItemObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the specified item from the sidebar and deletes it from the project.</span>
<span class="sd">        NB, the clean-up of the side bar is done through notifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">undoBlockManager</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">undoBlockManager</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
                                <span class="c1"># need to delete all peakLists and integralLists first, treat as single undo</span>
                            <span class="k">for</span> <span class="n">peakList</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">peakLists</span><span class="p">:</span>
                                <span class="n">peakList</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">integralList</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">integralLists</span><span class="p">:</span>
                                <span class="n">integralList</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">multipletList</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">multipletLists</span><span class="p">:</span>
                                <span class="n">multipletList</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                                <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># just delete the object</span>
                                <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">es</span><span class="p">))</span>

        <span class="c1">#  Force redrawing</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.lib.OpenGL.CcpnOpenGL</span> <span class="kn">import</span> <span class="n">GLNotifier</span>

        <span class="n">GLSignals</span> <span class="o">=</span> <span class="n">GLNotifier</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">GLSignals</span><span class="o">.</span><span class="n">emitEvent</span><span class="p">(</span><span class="n">triggers</span><span class="o">=</span><span class="p">[</span><span class="n">GLNotifier</span><span class="o">.</span><span class="n">GLALLPEAKS</span><span class="p">,</span> <span class="n">GLNotifier</span><span class="o">.</span><span class="n">GLALLINTEGRALS</span><span class="p">,</span> <span class="n">GLNotifier</span><span class="o">.</span><span class="n">GLALLMULTIPLETS</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_cloneObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clones the specified objects&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_createItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1">#obj:AbstractWrapperObject):</span>
        <span class="sd">&quot;&quot;&quot;Create a new sidebar item from a new object.</span>
<span class="sd">        Called by notifier when a new object is created or undeleted (so need to check for duplicates).</span>
<span class="sd">        NB Obj may be of a type that does not have an item&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AbstractWrapperObject</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">shortClassName</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_parent</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_project</span>

        <span class="k">if</span> <span class="n">shortClassName</span> <span class="ow">in</span> <span class="n">classesInSideBar</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="n">project</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span>
                    <span class="c1"># Spectrum - special behaviour - put them under SpectrumGroups, if any</span>
                    <span class="n">spectrumGroups</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">spectrumGroups</span>
                    <span class="k">if</span> <span class="n">spectrumGroups</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">spectrumGroups</span><span class="p">:</span>

                            <span class="c1"># # ejb - search for the spectrumGroup, if not there then create it</span>
                            <span class="c1"># sglist = self._findItems(str(sg.pid))</span>
                            <span class="c1"># if not sglist:</span>
                            <span class="c1">#   # have not found the group</span>
                            <span class="c1">#   newTempSpectrumGroup = QtWidgets.QTreeWidgetItem(self.spectrumGroupItem)</span>
                            <span class="c1">#   newTempSpectrumGroup.setFlags(</span>
                            <span class="c1">#     newTempSpectrumGroup.flags() ^ QtCore.Qt.ItemIsDragEnabled)</span>
                            <span class="c1">#   newTempSpectrumGroup.setText(0, str(sg.pid))</span>
                            <span class="c1">#</span>
                            <span class="c1">#   # sglist = self._findItems(&#39;SpectrumGroups&#39;)</span>
                            <span class="c1">#   # for sgitem in self._findItems(&#39;SpectrumGroups&#39;):</span>
                            <span class="c1">#   #   newSpectrumGroup = QtWidgets.QTreeWidgetItem(sgitem)</span>
                            <span class="c1">#   #   newSpectrumGroup.setFlags(</span>
                            <span class="c1">#   #     newSpectrumGroup.flags() ^ QtCore.Qt.ItemIsDragEnabled)</span>
                            <span class="c1">#   #   newSpectrumGroup.setText(0, str(sg.pid))</span>
                            <span class="c1">#</span>
                            <span class="c1"># # now carry on and insert the new groups</span>

                            <span class="k">for</span> <span class="n">sgitem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">pid</span><span class="p">)):</span>  <span class="c1"># add &#39;&lt;new spectrumGroup&gt;&#39;</span>
                                <span class="n">newItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addItem</span><span class="p">(</span><span class="n">sgitem</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                                <span class="n">newObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                                <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                                <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="n">classesInSideBar</span><span class="p">[</span><span class="n">shortClassName</span><span class="p">]</span><span class="o">.</span><span class="n">className</span><span class="p">)</span>

                        <span class="c1"># return</span>

                <span class="n">itemParent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeToItem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shortClassName</span><span class="p">)</span>
                <span class="n">newItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addItem</span><span class="p">(</span><span class="n">itemParent</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
                <span class="c1"># itemParent.sortChildren(0, QtCore.Qt.AscendingOrder)</span>
                <span class="k">if</span> <span class="n">shortClassName</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;NC&#39;</span><span class="p">,</span> <span class="s1">&#39;DS&#39;</span><span class="p">]:</span>
                    <span class="n">newObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                    <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                    <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="n">classesInSideBar</span><span class="p">[</span><span class="n">shortClassName</span><span class="p">]</span><span class="o">.</span><span class="n">_childClasses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">className</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span>
                    <span class="n">newPeakListObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                    <span class="n">newPeakListObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newPeakListObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                    <span class="n">newPeakListObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New PeakList&gt;&quot;</span><span class="p">)</span>

                    <span class="n">newMultipletListObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                    <span class="n">newMultipletListObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newMultipletListObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                    <span class="n">newMultipletListObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New MultipletList&gt;&quot;</span><span class="p">)</span>

                    <span class="n">newIntegralListObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                    <span class="n">newIntegralListObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newIntegralListObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                    <span class="n">newIntegralListObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New IntegralList&gt;&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">itemParent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">pid</span><span class="p">):</span>
                    <span class="n">newItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addItem</span><span class="p">(</span><span class="n">itemParent</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;NR&#39;</span><span class="p">:</span>
                        <span class="n">newObjectItem</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">newItem</span><span class="p">)</span>
                        <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">newObjectItem</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span><span class="p">)</span>
                        <span class="n">newObjectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&lt;New NmrAtom&gt;&quot;</span><span class="p">)</span>
                    <span class="c1"># for i in range(itemParent.childCount()):</span>
                    <span class="c1">#   itemParent.child(i).sortChildren(0, QtCore.Qt.AscendingOrder)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Object type is not in sidebar</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_itemObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">))]</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">classesInSideBar</span><span class="p">:</span>
                    <span class="n">objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_itemObjects</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">objects</span>

    <span class="k">def</span> <span class="nf">_renameItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1">#obj:AbstractWrapperObject, oldPid:str):</span>
        <span class="sd">&quot;&quot;&quot;rename item(s) from previous pid oldPid to current object pid&quot;&quot;&quot;</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">]</span>
        <span class="n">oldPid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OLDPID</span><span class="p">]</span>

        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveExpandedState</span><span class="p">()</span>

        <span class="kn">import</span> <span class="nn">sip</span>

        <span class="n">newPid</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pid</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="n">oldPid</span><span class="p">):</span>
            <span class="c1"># item.setData(0, QtCore.Qt.DisplayRole, str(obj.pid))    # ejb - rename instead of delete</span>

            <span class="k">if</span> <span class="n">Pid</span><span class="o">.</span><span class="n">IDSEP</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oldPid</span> <span class="ow">or</span> <span class="n">oldPid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">PREFIXSEP</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_id</span> <span class="o">+</span> <span class="n">Pid</span><span class="o">.</span><span class="n">IDSEP</span><span class="p">):</span>
                <span class="c1"># Parent unchanged, just rename</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newPid</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># parent has changed - we must move and rename the entire item tree.</span>
                <span class="c1"># NB this is relevant for NmrAtom (NmrResidue is handled elsewhere)</span>
                <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itemObjects</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="c1"># print(objects, &#39;$$$&#39;)</span>
                <span class="n">sip</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>  <span class="c1"># this also removes child items</span>

                <span class="c1"># NB the first object cannot be found from its pid (as it has already been renamed)</span>
                <span class="c1"># So we do it this way</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">obj</span><span class="p">})</span>
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">xx</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restoreExpandedState</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getExpanded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the name of expanded item to the data list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_setExpanded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the expanded flag if item is in data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_traverseNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Traverse the child elements of the sideBar</span>
<span class="sd">        :param item: item to traverse</span>
<span class="sd">        :param func: function to perform on this element</span>
<span class="sd">        :param data: optional data storage to pass to &lt;func&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># process this element</span>
        <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># find the other children</span>
        <span class="n">childCount</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">childNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">childCount</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traverseNode</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">childNum</span><span class="p">),</span> <span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_traverseTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Traverse the top elements of the Sidebar</span>
<span class="sd">        :param func: function to perform on all elements of the tree</span>
<span class="sd">        :param data: optional data storage to pass to &lt;func&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">itemNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topCount</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">itemNum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traverseNode</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_blockSideBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;block all updates/signals/notifiers on the sidebar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebarBlocked</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;sideBar block&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUpdatesEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBlankingAllNotifiers</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unblockSideBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;unblock all updates/signals/notifiers on the sidebar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidebarBlocked</span><span class="p">:</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;sideBar unblock&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBlankingAllNotifiers</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUpdatesEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_saveExpandedState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self._unregisterNotifiers()</span>
        <span class="n">sideBarState</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_blockSideBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverseTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getExpanded</span><span class="p">,</span> <span class="n">sideBarState</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sideBarState</span>

    <span class="k">def</span> <span class="nf">_restoreExpandedState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemList</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fillSideBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="c1"># self._registerNotifiers()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traverseTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setExpanded</span><span class="p">,</span> <span class="n">itemList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unblockSideBar</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_renameNmrResidueItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1">#obj:NmrResidue, oldPid:str):</span>
        <span class="sd">&quot;&quot;&quot;rename NmrResidue(s) from previous pid oldPid to current object pid&quot;&quot;&quot;</span>

        <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saveExpandedState</span><span class="p">()</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">]</span>
        <span class="n">oldPid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OLDPID</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">oldPid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">PREFIXSEP</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_id</span> <span class="o">+</span> <span class="n">Pid</span><span class="o">.</span><span class="n">IDSEP</span><span class="p">):</span>
            <span class="c1"># Parent has changed - remove items from old location</span>
            <span class="kn">import</span> <span class="nn">sip</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="n">oldPid</span><span class="p">):</span>
                <span class="n">sip</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>  <span class="c1"># this also removes child items</span>

        <span class="c1">#    # item.setData(0, QtCore.Qt.DisplayRole, str(obj.pid))    # ejb - rename instead of delete</span>
        <span class="c1"># else:</span>
        <span class="c1">#   pass        # ejb - here just for a breakpoint</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refreshParentNmrChain</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">obj</span><span class="p">,</span> <span class="n">Notifier</span><span class="o">.</span><span class="n">OLDPID</span><span class="p">:</span> <span class="n">oldPid</span><span class="p">})</span>  <span class="c1">#obj, oldPid)</span>

        <span class="c1"># for item in self._findItems(oldPid):</span>
        <span class="c1">#   item.setData(0, QtCore.Qt.DisplayRole, str(obj.pid))    # ejb - rename instead of delete</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_restoreExpandedState</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_removeItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>  <span class="c1"># wrapperObject:AbstractWrapperObject):</span>
        <span class="sd">&quot;&quot;&quot;Removes sidebar item(s) for object with pid objPid, but does NOT delete the object.</span>
<span class="sd">        Called when objects are deleted.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sip</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findItems</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">pid</span><span class="p">):</span>
            <span class="n">sip</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_findItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objPid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1">#QtGui.QTreeWidgetItem</span>
        <span class="sd">&quot;&quot;&quot;Find items that match objPid - returns empty list if no matches&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">objPid</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">classesInSideBar</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findItems</span><span class="p">(</span><span class="n">objPid</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MatchExactly</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MatchRecursive</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="SideBar.setProjectName"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.setProjectName">[docs]</a>    <span class="k">def</span> <span class="nf">setProjectName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (re)set project name in sidebar header.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">projectItem</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_clearQTreeWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="c1"># clear contents of the sidebar and rebuild</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTreeWidgetItemIterator</span><span class="o">.</span><span class="n">All</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">():</span>
            <span class="n">iterator</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">.</span><span class="n">takeChildren</span><span class="p">()</span>
            <span class="n">iterator</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">takeTopLevelItem</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

<div class="viewcode-block" id="SideBar.fillSideBar"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.fillSideBar">[docs]</a>    <span class="k">def</span> <span class="nf">fillSideBar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills the sidebar with the relevant data from the project.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># disable updating/redrawing of the sideBar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blockSideBar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_populateSidebar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setProjectName</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

        <span class="n">listOrder</span> <span class="o">=</span> <span class="p">[</span><span class="n">ky</span> <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="n">classesInSideBar</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">tempKy</span> <span class="o">=</span> <span class="n">listOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">listOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">listOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">listOrder</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempKy</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ky</span> <span class="ow">in</span> <span class="n">listOrder</span><span class="p">:</span>
            <span class="n">new_dict</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span> <span class="o">=</span> <span class="n">classesInSideBar</span><span class="p">[</span><span class="n">ky</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">className</span><span class="p">,</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># ejb - classesInSideBar.items()</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">_pluralLinkName</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_createItem</span><span class="p">({</span><span class="n">Notifier</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">obj</span><span class="p">})</span>
            <span class="c1"># dd = pid2Obj.get(className)</span>
            <span class="c1"># if dd:</span>
            <span class="c1">#   for obj in sorted(dd.values()):</span>
            <span class="c1">#     self._createItem(obj)</span>

        <span class="c1"># re-enable updating/redrawing of the sideBar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unblockSideBar</span><span class="p">()</span></div>

    <span class="c1">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
    <span class="c1"># mouse events</span>

    <span class="k">def</span> <span class="nf">_eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">SideBar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">eventFilter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dragEnterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">enter</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># if event.mimeData().hasFormat(ccpnmrJsonData):</span>
        <span class="c1">#   data = event.mimeData().data(ccpnmrJsonData)</span>
        <span class="c1">#   if &#39;test&#39; in data:</span>
        <span class="c1">#     print (&#39;&gt;&gt;&gt;_dragEnterEvent has ccpnmrJsonData&#39;)</span>
        <span class="c1">#   else:</span>
        <span class="c1">#     print (&#39;&gt;&gt;&gt;_dragEnterEvent empty&#39;)</span>
        <span class="c1"># else:</span>
        <span class="c1">#   print(&#39;&gt;&gt;&gt;_dragEnterEvent ---&#39;)</span>
        <span class="c1"># super(SideBar, self).dragEnterEvent(event)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasUrls</span><span class="p">():</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">objFromPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">objFromPid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">pids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">objFromPid</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>

            <span class="n">itemData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;pids&#39;</span><span class="p">:</span> <span class="n">pids</span><span class="p">})</span>

            <span class="c1"># ejb - added so that itemData works with PyQt5</span>
            <span class="n">tempData</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">()</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QDataStream</span><span class="p">(</span><span class="n">tempData</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QIODevice</span><span class="o">.</span><span class="n">WriteOnly</span><span class="p">)</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">writeQString</span><span class="p">(</span><span class="n">itemData</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">ccpnmrJsonData</span><span class="p">,</span> <span class="n">tempData</span><span class="p">)</span>

            <span class="c1"># event.mimeData().setData(ccpnmrJsonData, itemData)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">itemData</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="c1"># def _startDrag(self, dropActions):</span>
    <span class="c1">#   item = self.currentItem()</span>
    <span class="c1">#   icon = item.icon()</span>
    <span class="c1">#   data = QByteArray()</span>
    <span class="c1">#   stream = QDataStream(data, QIODevice.WriteOnly)</span>
    <span class="c1">#   stream &lt;&lt; item.text() &lt;&lt; icon</span>
    <span class="c1">#   mimeData = QMimeData()</span>
    <span class="c1">#   mimeData.setData(&quot;application/x-icon-and-text&quot;, data)</span>
    <span class="c1">#   drag = QDrag(self)</span>
    <span class="c1">#   drag.setMimeData(mimeData)</span>
    <span class="c1">#   pixmap = icon.pixmap(24,24)</span>
    <span class="c1">#   drag.setHotSpot(QPoint(12,12))</span>
    <span class="c1">#   drag.setPixmap(pixmap)</span>
    <span class="c1">#   if drag.start(Qt.MoveAction) == Qt.moveAction:</span>
    <span class="c1">#     self.takeItem(self.row(item))</span>

    <span class="k">def</span> <span class="nf">_dragMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMouseEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Required function to enable dragging and dropping within the sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># super(SideBar, self).dragMoveEvent(event)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="c1"># def dragLeaveEvent(self, event):</span>
    <span class="c1">#   # print (&#39;&gt;&gt;&gt;dragLeaveEvent %s&#39; % str(event.type()))</span>
    <span class="c1">#   super(SideBar, self).dragLeaveEvent(event)</span>
    <span class="c1">#   # event.accept()</span>

    <span class="k">def</span> <span class="nf">_mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-implementation of the mouse press event so right click can be used to delete items from the</span>
<span class="sd">        sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if event.button() == QtCore.Qt.LeftButton:</span>
        <span class="c1">#   pids = []</span>
        <span class="c1">#   for item in self.selectedItems():</span>
        <span class="c1">#     if item is not None:</span>
        <span class="c1">#       objFromPid = self.project.getByPid(item.data(0, QtCore.Qt.DisplayRole))</span>
        <span class="c1">#       if objFromPid is not None:</span>
        <span class="c1">#         pids.append(objFromPid.pid)</span>
        <span class="c1">#</span>
        <span class="c1">#   itemData = json.dumps({&#39;pids&#39;:pids, &#39;test&#39;:&#39;thisDrag&#39;})</span>
        <span class="c1">#   mimeData = QtCore.QMimeData()</span>
        <span class="c1">#   mimeData.setData(ccpnmrJsonData, itemData)</span>
        <span class="c1">#   mimeData.setText(itemData)</span>
        <span class="c1">#</span>
        <span class="c1">#   drag = QtGui.QDrag(self)</span>
        <span class="c1">#   drag.setMimeData(mimeData)</span>
        <span class="c1">#   dropAction = drag.exec_(QtCore.Qt.CopyAction | QtCore.Qt.MoveAction, QtCore.Qt.CopyAction)</span>

        <span class="c1"># if event.button() == QtCore.Qt.RightButton:</span>
        <span class="c1">#   self._raiseContextMenu(event)</span>
        <span class="c1">#   event.accept()</span>
        <span class="c1"># else:</span>
        <span class="c1"># item = self.itemAt(event.pos())</span>
        <span class="c1"># if item:</span>
        <span class="c1">#   text = item.text(0)</span>
        <span class="c1">#   if &#39;:&#39; in text:</span>
        <span class="c1">#</span>
        <span class="c1">#     itemData = json.dumps({&#39;pids&#39;:[text]})</span>
        <span class="c1">#     mimeData = QtCore.QMimeData()</span>
        <span class="c1">#     mimeData.setData(ccpnmrJsonData, itemData)</span>
        <span class="c1">#     # mimeData.setText(itemData)</span>
        <span class="c1">#     # pixmap = QtGui.QPixmap.grabWidget(item)</span>
        <span class="c1">#     # pixmap = QtGui.QPixmap(item)</span>
        <span class="c1">#     # item.render(pixmap)</span>
        <span class="c1">#</span>
        <span class="c1">#     drag = QtGui.QDrag(self)</span>
        <span class="c1">#     drag.setMimeData(mimeData)</span>
        <span class="c1">#     # drag.setPixmap(pixmap)</span>
        <span class="c1">#</span>
        <span class="c1">#     dropAction = drag.exec_(QtCore.Qt.CopyAction | QtCore.Qt.MoveAction, QtCore.Qt.CopyAction)</span>
        <span class="c1">#   else:</span>
        <span class="c1">#     super(SideBar, self).mousePressEvent(event)</span>

        <span class="c1"># else:</span>
        <span class="c1"># if self.multiSelect:</span>
        <span class="c1">#   self.setSelectionMode(QtGui.QAbstractItemView.ExtendedSelection)</span>

        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SideBar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-implementation of the mouse press event so right click can be used to delete items from the</span>
<span class="sd">        sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raiseContextMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>  <span class="c1"># ejb - moved the context menu to button release</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raiseContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMouseEvent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and raises a context menu enabling items to be deleted from the sidebar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.ui.gui.widgets.Menu</span> <span class="kn">import</span> <span class="n">Menu</span>

        <span class="n">contextMenu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">isFloatWidget</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

        <span class="c1"># contextMenu.addAction(&#39;Delete&#39;, partial(self.removeItem, item))</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">objFromPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">objFromPid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">objFromPid</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">openableObjs</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">OpenObjAction</span><span class="o">.</span><span class="n">keys</span><span class="p">()))]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">openableObjs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">contextMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Open as a module&#39;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">_openItemObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">openableObjs</span><span class="p">))</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">openableObjs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">contextMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Make SpectrumGroup From Selected&#39;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_createSpectrumGroup</span><span class="p">,</span> <span class="n">spectra</span><span class="p">))</span>

            <span class="n">contextMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deleteItemObject</span><span class="p">,</span> <span class="n">objs</span><span class="p">))</span>
            <span class="n">canBeCloned</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;clone&#39;</span><span class="p">):</span>  <span class="c1"># TODO: possibly should check that is a method...</span>
                    <span class="n">canBeCloned</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">canBeCloned</span><span class="p">:</span>
                <span class="n">contextMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Clone&#39;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cloneObject</span><span class="p">,</span> <span class="n">objs</span><span class="p">))</span>
            <span class="n">contextMenu</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">globalPos</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">event</span><span class="o">.</span><span class="n">globalPos</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">contextMenu</span><span class="o">.</span><span class="k">exec</span><span class="p">()</span>

    <span class="c1">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<div class="viewcode-block" id="SideBar.raisePopup"><a class="viewcode-back" href="../../../../../ccpn/ccpn.ui.gui.widgets.html#ccpn.ui.gui.widgets.SideBar.SideBar.raisePopup">[docs]</a>    <span class="k">def</span> <span class="nf">raisePopup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1"># TODO move in a dict</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SP&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumPropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;PL&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">PeakListPropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">peakList</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;IL&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">IntegralListPropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">integralList</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;ML&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">MultipletListPropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">multipletList</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SG&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">spectrumGroup</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SA&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">SamplePropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SC&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">EditSampleComponentPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">sampleComponent</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SU&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">SubstancePropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">substance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="c1"># popup.raise_()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;NC&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">NmrChainPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">nmrChain</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;NR&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">NmrResiduePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">nmrResidue</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">NmrAtomPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;CL&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">ChemicalShiftListPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SE&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">StructurePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

            <span class="c1"># if self.mainWindow:</span>
            <span class="c1">#   from ccpn.ui.gui.modules.StructureTable import StructureTableModule</span>
            <span class="c1">#</span>
            <span class="c1">#   self.structureTableModule = StructureTableModule(self.mainWindow, itemPid=obj.pid)</span>
            <span class="c1">#   self.mainWindow.moduleArea.addModule(self.structureTableModule, position=&#39;bottom&#39;,</span>
            <span class="c1">#                                   relativeTo=self.mainWindow.moduleArea)</span>
            <span class="c1">#   self.mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showStructureTable()&quot;)</span>
            <span class="c1">#   self.project._logger.info(&quot;application.showStructureTable()&quot;)</span>
            <span class="c1">#</span>
            <span class="c1"># else:</span>
            <span class="c1">#   showInfo(&#39;No mainWindow?&#39;, &#39;&#39;)</span>

        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;MC&#39;</span><span class="p">:</span>
            <span class="c1">#to be decided when we design structure</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;MD&#39;</span><span class="p">:</span>
            <span class="c1">#to be decided when we design structure</span>
            <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;DS&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">DataSetPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">dataSet</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>

            <span class="c1"># ejb - test DataSet</span>
            <span class="c1"># if self.mainWindow:</span>
            <span class="c1">#</span>
            <span class="c1">#   # Use StructureTable for the moment</span>
            <span class="c1">#</span>
            <span class="c1">#   if obj.title is &#39;ensembleCCPN&#39;:</span>
            <span class="c1">#     from ccpn.ui.gui.modules.StructureTable import StructureTableModule</span>
            <span class="c1">#</span>
            <span class="c1">#     self.structureTableModule = StructureTableModule(self.mainWindow, itemPid=obj.pid)</span>
            <span class="c1">#     self.mainWindow.moduleArea.addModule(self.structureTableModule, position=&#39;bottom&#39;,</span>
            <span class="c1">#                                     relativeTo=self.mainWindow.moduleArea)</span>
            <span class="c1">#     self.mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showDataSetStructureTable()&quot;)</span>
            <span class="c1">#     self.project._logger.info(&quot;application.showDataSetStructureTable()&quot;)</span>
            <span class="c1">#   else:</span>
            <span class="c1">#     showInfo(&#39;Not implemented yet!&#39;,</span>
            <span class="c1">#              &#39;This function has not been implemented in the current version&#39;,</span>
            <span class="c1">#              colourScheme=self.colourScheme)</span>


        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span>
            <span class="c1">#to be decided when we design structure</span>
            <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;RE&#39;</span><span class="p">:</span>
            <span class="c1">#to be decided when we design structure</span>
            <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span>
        <span class="c1"># elif obj.shortClassName == &#39;IL&#39;:</span>
        <span class="c1">#   # to be decided when we design structure</span>
        <span class="c1">#</span>
        <span class="c1">#   # popup = IntegralListPopup(parent=self.mainWindow, mainWindow=self.mainWindow, integralList=obj)   # ejb - temp</span>
        <span class="c1">#   # popup.exec_()</span>
        <span class="c1">#   # popup.raise_()</span>
        <span class="c1">#</span>
        <span class="c1">#   showInfo(&#39;Not implemented yet!&#39;,</span>
        <span class="c1">#            &#39;This function has not been implemented in the current version&#39;)</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;NO&#39;</span><span class="p">:</span>
            <span class="n">popup</span> <span class="o">=</span> <span class="n">NotesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

            <span class="c1"># if self._application.ui.mainWindow is not None:</span>
            <span class="c1">#   mainWindow = self._application.ui.mainWindow</span>
            <span class="c1"># else:</span>
            <span class="c1">#   mainWindow = self._application._mainWindow</span>
            <span class="c1"># self.notesEditor = NotesEditor(mainWindow.moduleArea, self.project,</span>
            <span class="c1">#                                name=&#39;Notes Editor&#39;, note=obj)</span>

            <span class="c1"># #FIXME:ED should be a popup or consistency</span>
            <span class="c1"># if self.mainWindow:</span>
            <span class="c1">#   self.notesEditor = NotesEditor(mainWindow=self.mainWindow, name=&#39;Notes Editor&#39;, note=obj)</span>
            <span class="c1">#   self.mainWindow.moduleArea.addModule(self.notesEditor, position=&#39;bottom&#39;,</span>
            <span class="c1">#                                   relativeTo=self.mainWindow.moduleArea)</span>
            <span class="c1">#   self.mainWindow.pythonConsole.writeConsoleCommand(&quot;application.showNotesEditor()&quot;)</span>
            <span class="c1">#   self.project._logger.info(&quot;application.showNotesEditor()&quot;)</span>
            <span class="c1"># else:</span>
            <span class="c1">#   showInfo(&#39;No mainWindow?&#39;, &#39;&#39;, colourScheme=self.colourScheme)</span>

    <span class="k">def</span> <span class="nf">_createNewObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new object starting from the &lt;New&gt; item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&lt;New IntegralList&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;New PeakList&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;New MultipletList&gt;&quot;</span><span class="p">,</span> <span class="p">]:</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&lt;New PeakList&gt;&quot;</span><span class="p">:</span>
                <span class="n">spectrum</span><span class="o">.</span><span class="n">newPeakList</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&lt;New IntegralList&gt;&quot;</span><span class="p">:</span>
                <span class="n">spectrum</span><span class="o">.</span><span class="n">newIntegralList</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&lt;New MultipletList&gt;&quot;</span><span class="p">:</span>
                <span class="n">spectrum</span><span class="o">.</span><span class="n">newMultipletList</span><span class="p">()</span>

            <span class="c1"># item.parent().sortChildren(0, QtCore.Qt.AscendingOrder)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">itemParent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

            <span class="n">funcName</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">itemParent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># Top level object - parent is project</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Chains&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">CreateChainPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Substances&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">SubstancePropertiesPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span>
                                                     <span class="n">newSubstance</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># ejb - application=self.application,</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="c1"># popup.raise_()        # included setModal(True) in the above as was not modal???</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;SpectrumGroups&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">SpectrumGroupEditor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">addNew</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;NmrChains&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">CreateNmrChainPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">itemParent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
                    <span class="n">funcName</span> <span class="o">=</span> <span class="n">NEW_ITEM_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Lower level object - get parent from parentItem</span>
                <span class="k">if</span> <span class="n">itemParent</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;DS&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">RestraintTypePopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                    <span class="n">restraintType</span> <span class="o">=</span> <span class="n">popup</span><span class="o">.</span><span class="n">restraintType</span>
                    <span class="k">if</span> <span class="n">restraintType</span><span class="p">:</span>

                        <span class="c1"># ejb - added here because not sure whether to put it in the popup yet</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">ff</span> <span class="o">=</span> <span class="n">NEW_ITEM_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemParent</span><span class="o">.</span><span class="n">shortClassName</span><span class="p">)</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">itemParent</span><span class="p">,</span> <span class="n">ff</span><span class="p">)(</span><span class="n">restraintType</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
                            <span class="n">showWarning</span><span class="p">(</span><span class="s1">&#39;Restraints&#39;</span><span class="p">,</span> <span class="s1">&#39;Error modifying restraint type&#39;</span><span class="p">)</span>

                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">itemParent</span><span class="o">.</span><span class="n">shortClassName</span> <span class="o">==</span> <span class="s1">&#39;SA&#39;</span><span class="p">:</span>
                    <span class="n">popup</span> <span class="o">=</span> <span class="n">EditSampleComponentPopup</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">mainWindow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">itemParent</span><span class="p">,</span> <span class="n">newSampleComponent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
                    <span class="n">popup</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">funcName</span> <span class="o">=</span> <span class="n">NEW_ITEM_DICT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemParent</span><span class="o">.</span><span class="n">shortClassName</span><span class="p">)</span>

                <span class="c1"># for i in range(item.childCount()):</span>

            <span class="k">if</span> <span class="n">funcName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">newItem</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">itemParent</span><span class="p">,</span> <span class="n">funcName</span><span class="p">)()</span>
                <span class="c1"># if funcName == &#39;newNmrResidue&#39;:</span>
                <span class="c1">#   newItem.parent().sortChildren(0, QtCore.Qt.AscendingOrder)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">showInfo</span><span class="p">(</span><span class="s1">&#39;Not implemented yet!&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;This function has not been implemented in the current version&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>