<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpn.core.Peak &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.core.Peak</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (www.ccpn.ac.uk) 2014 - $Date: 2016-12-08 13:37:51 +0000 (Thu, 08 Dec 2016) $&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="s2">&quot;Wayne Boucher, Rasmus H Fogh, Simon P Skinner, Geerten W Vuister&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN license. See www.ccpn.ac.uk/license&quot;</span>
              <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for license text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from www.ccpn.ac.uk/license&quot;</span>
                <span class="s2">&quot; or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification:</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: wb104 $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2016-12-08 13:37:51 +0000 (Thu, 08 Dec 2016) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 10058 $&quot;</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Undo</span>
<span class="kn">from</span> <span class="nn">ccpn.util</span> <span class="kn">import</span> <span class="n">Common</span> <span class="k">as</span> <span class="n">commonUtil</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.AbstractWrapperObject</span> <span class="kn">import</span> <span class="n">AbstractWrapperObject</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.SpectrumReference</span> <span class="kn">import</span> <span class="n">SpectrumReference</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.ccp.nmr</span> <span class="kn">import</span> <span class="n">Nmr</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">modelUtil</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>

<div class="viewcode-block" id="Peak"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak">[docs]</a><span class="k">class</span> <span class="nc">Peak</span><span class="p">(</span><span class="n">AbstractWrapperObject</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Peak object, holding position, intensity, and assignment information</span>

<span class="sd">  Measurements that require more than one NmrAtom for an individual assignment</span>
<span class="sd">  (such as  splittings, J-couplings, MQ dimensions, reduced-dimensionality</span>
<span class="sd">  experiments etc.) are not supported (yet). Assignments can be viewed and set</span>
<span class="sd">  either as a list of assignments for each dimension (dimensionNmrAtoms) or as a</span>
<span class="sd">  list of all possible assignment combinations (assignedNmrAtoms)&quot;&quot;&quot;</span>
  
  <span class="c1">#: Short class name, for PID.</span>
  <span class="n">shortClassName</span> <span class="o">=</span> <span class="s1">&#39;PK&#39;</span>
  <span class="c1"># Attribute it necessary as subclasses must use superclass className</span>
  <span class="n">className</span> <span class="o">=</span> <span class="s1">&#39;Peak&#39;</span>

  <span class="n">_parentClass</span> <span class="o">=</span> <span class="n">PeakList</span>

  <span class="c1">#: Name of plural link to instances of class</span>
  <span class="n">_pluralLinkName</span> <span class="o">=</span> <span class="s1">&#39;peaks&#39;</span>
  
  <span class="c1">#: List of child classes.</span>
  <span class="n">_childClasses</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1"># Qualified name of matching API class</span>
  <span class="n">_apiClassQualifiedName</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">Peak</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
  

  <span class="c1"># CCPN properties  </span>
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">_apiPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">Peak</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; API peaks matching Peak&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
    
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;id string - serial number converted to string&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">serial</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">serial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;serial number of Peak, used in Pid and to identify the Peak. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">serial</span>
    
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PeakList</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;PeakList containing Peak.&quot;&quot;&quot;</span>
    <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">peakList</span><span class="p">]</span>
  
  <span class="n">peakList</span> <span class="o">=</span> <span class="n">_parent</span>
  
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;height of Peak&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">height</span>
    
  <span class="nd">@height.setter</span>
  <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">heightError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;height error of Peak&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">heightError</span>

  <span class="nd">@heightError.setter</span>
  <span class="k">def</span> <span class="nf">heightError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">heightError</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;volume of Peak&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">volume</span>

  <span class="nd">@volume.setter</span>
  <span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">volumeError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;volume error of Peak&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">volumeError</span>

  <span class="nd">@volumeError.setter</span>
  <span class="k">def</span> <span class="nf">volumeError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">volumeError</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">figureOfMerit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;figureOfMerit of Peak, between 0.0 and 1.0 inclusive.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">figOfMerit</span>

  <span class="nd">@figureOfMerit.setter</span>
  <span class="k">def</span> <span class="nf">figureOfMerit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">figOfMerit</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak text annotation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">annotation</span>
    
  <span class="nd">@annotation.setter</span>
  <span class="k">def</span> <span class="nf">annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Free-form text comment&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">details</span>

  <span class="nd">@comment.setter</span>
  <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="n">value</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">axisCodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Spectrum axis codes in dimension order matching position.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak position in ppm (or other relevant unit) in dimension order.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">())</span>

  <span class="nd">@position.setter</span>
  <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()):</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">realValue</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">positionError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak position error in ppm (or other relevant unit).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">valueError</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">())</span>

  <span class="nd">@positionError.setter</span>
  <span class="k">def</span> <span class="nf">positionError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()):</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">valueError</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">pointPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak position in points.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">())</span>

  <span class="nd">@pointPosition.setter</span>
  <span class="k">def</span> <span class="nf">pointPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()):</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">boxWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;The full width of the peak footprint in points for each dimension,</span>
<span class="sd">    i.e. the width of the area that should be considered for integration, fitting, etc. .&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">boxWidth</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">())</span>

  <span class="nd">@boxWidths.setter</span>
  <span class="k">def</span> <span class="nf">boxWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()):</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">boxWidth</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">lineWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Full-width-half-height of peak/multiplet for each dimension, in Hz. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lineWidth</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">())</span>

  <span class="nd">@lineWidths.setter</span>
  <span class="k">def</span> <span class="nf">lineWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()):</span>
      <span class="n">peakDim</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dimensionNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak dimension assignment - a tuple of tuples with the assigned NmrAtoms for each dimension.</span>
<span class="sd">    One of two alternative views on the Peak assignment.</span>

<span class="sd">    Example, for a 13C HSQC:</span>
<span class="sd">      ((&lt;NA:A.127.LEU.HA&gt;, &lt;NA:A.127.LEU.HBX&gt;, &lt;NA:A.127.LEU.HBY&gt;, &lt;NA:A.127.LEU.HG&gt;,</span>

<span class="sd">       (&lt;NA:A.127.LEU.CA&gt;, &lt;NA:A.127.LEU.CB&gt;)</span>
<span class="sd">       )</span>

<span class="sd">    Assignments as a list of individual combinations is given in &#39;assignedNmrAtoms&#39;.</span>
<span class="sd">    Note that by setting dimensionAssignments you tel the program that all combinations are</span>
<span class="sd">    possible - in the example that all four protons could be bound to either of the carbons</span>

<span class="sd">    To (re)set the assignment for a single dimension, use the Peak.assignDimension method. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">peakDim</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">():</span>

      <span class="n">mainPeakDimContribs</span> <span class="o">=</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">mainPeakDimContribs</span>
      <span class="c1"># Done this way as a quick way of sorting the values</span>
      <span class="n">mainPeakDimContribs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">sortedPeakDimContribs</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mainPeakDimContribs</span><span class="p">]</span>

      <span class="n">data2Obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span>
      <span class="n">dimResults</span> <span class="o">=</span> <span class="p">[</span><span class="n">data2Obj</span><span class="p">[</span><span class="n">pdc</span><span class="o">.</span><span class="n">resonance</span><span class="p">]</span> <span class="k">for</span> <span class="n">pdc</span> <span class="ow">in</span> <span class="n">mainPeakDimContribs</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pdc</span><span class="p">,</span> <span class="s1">&#39;resonance&#39;</span><span class="p">)]</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dimResults</span><span class="p">)))</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

  <span class="nd">@dimensionNmrAtoms.setter</span>
  <span class="k">def</span> <span class="nf">dimensionNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>

    <span class="n">apiPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
    <span class="n">dimResonances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">atoms</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dimResonances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

      <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dimensionNmrAtoms cannot be set to a sequence of strings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dimensionNmrAtoms must be set to a sequence of list/tuples&quot;</span><span class="p">)</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">)</span>
        <span class="n">dimResonances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_wrappedData</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atoms</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">))</span>

    <span class="n">apiPeak</span><span class="o">.</span><span class="n">assignByDimensions</span><span class="p">(</span><span class="n">dimResonances</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">assignedNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Peak assignment - a tuple of tuples of NmrAtom combinations.</span>
<span class="sd">    (e.g. a tuple of triplets for a 3D spectrum).</span>
<span class="sd">    One of two alternative views on the Peak assignment.</span>
<span class="sd">    Missing assignments are entered as None.</span>

<span class="sd">    Example, for 13H HSQC::</span>
<span class="sd">      ((&lt;NA:A.127.LEU.HA&gt;, &lt;NA:A.127.LEU.CA&gt;),</span>

<span class="sd">      (&lt;NA:A.127.LEU.HBX&gt;, &lt;NA:A.127.LEU.CB&gt;),</span>

<span class="sd">      (&lt;NA:A.127.LEU.HBY&gt;, &lt;NA:A.127.LEU.CB&gt;),</span>

<span class="sd">      (&lt;NA:A.127.LEU.HG&gt;, None),)</span>

<span class="sd">    To add a single assignment tuple, use the Peak.addAssignment method</span>

<span class="sd">    See also dimensionNmrAtoms, which gives assignments per dimension.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data2Obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span>
    <span class="n">apiPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
    <span class="n">peakDims</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()</span>
    <span class="n">mainPeakDimContribs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mainPeakDimContribs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;serial&#39;</span><span class="p">))</span>
                           <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">peakDims</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">peakContrib</span> <span class="ow">in</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">sortedPeakContribs</span><span class="p">():</span>
      <span class="n">allAtoms</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">peakDimContribs</span> <span class="o">=</span> <span class="n">peakContrib</span><span class="o">.</span><span class="n">peakDimContribs</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peakDims</span><span class="p">):</span>
        <span class="n">nmrAtoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">resonance</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mainPeakDimContribs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">peakDimContribs</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;resonance&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nmrAtoms</span><span class="p">:</span>
          <span class="n">nmrAtoms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">allAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nmrAtoms</span><span class="p">)</span>

      <span class="c1"># NB this gives a list of tuples</span>
      <span class="c1"># Remove all-NOne tuples</span>
      <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">allAtoms</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tt</span><span class="p">))</span>
      <span class="c1"># result += itertools.product(*allAtoms)</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>


  <span class="nd">@assignedNmrAtoms.setter</span>
  <span class="k">def</span> <span class="nf">assignedNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">):</span>

    <span class="n">apiPeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
    <span class="n">peakDims</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()</span>
    <span class="n">dimensionCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">peakDims</span><span class="p">)</span>

    <span class="c1"># get resonance, all tuples and per dimension</span>
    <span class="n">resonances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
      <span class="n">ll</span> <span class="o">=</span> <span class="n">dimensionCount</span><span class="o">*</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span>
      <span class="n">resonances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">atom</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="n">ll</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">_wrappedData</span>

    <span class="c1"># set assignments</span>
    <span class="n">apiPeak</span><span class="o">.</span><span class="n">assignByContributions</span><span class="p">(</span><span class="n">resonances</span><span class="p">)</span>

<div class="viewcode-block" id="Peak.addAssignment"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.addAssignment">[docs]</a>  <span class="k">def</span> <span class="nf">addAssignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;NmrAtom&#39;</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;Add a peak assignment - a list of one NmrAtom or Pid for each dimension&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Length of assignment value </span><span class="si">%s</span><span class="s2"> does not match peak dimensionality </span><span class="si">%s</span><span class="s2"> &quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span><span class="p">))</span>

    <span class="c1"># Convert to tuple and check for non-existing pids</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No NmrAtom matching string pid </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">ll</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">assignedNmrAtoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assignedNmrAtoms</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">assignedNmrAtoms</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Attempt to add already existing Peak Assignment: </span><span class="si">%s</span><span class="s2"> - ignored&quot;</span>
                                    <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">assignedNmrAtoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">assignedNmrAtoms</span> <span class="o">=</span> <span class="n">assignedNmrAtoms</span></div>

<div class="viewcode-block" id="Peak.assignDimension"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.assignDimension">[docs]</a>  <span class="k">def</span> <span class="nf">assignDimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisCode</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">],</span>
                                                      <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">]]]</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Assign dimension with axisCode to value (NmrAtom, or Pid or sequence of either, or None)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">axisCodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">axisCodes</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">index</span> <span class="o">=</span> <span class="n">axisCodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axisCode</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axisCode </span><span class="si">%s</span><span class="s2"> not recognised&quot;</span> <span class="o">%</span> <span class="n">axisCode</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
      <span class="n">value</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="n">dimensionNmrAtoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensionNmrAtoms</span><span class="p">)</span>
    <span class="n">dimensionNmrAtoms</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dimensionNmrAtoms</span> <span class="o">=</span> <span class="n">dimensionNmrAtoms</span></div>

  <span class="c1"># Utility functions</span>

<div class="viewcode-block" id="Peak.isPartlyAssigned"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.isPartlyAssigned">[docs]</a>  <span class="k">def</span> <span class="nf">isPartlyAssigned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Whether peak is partly assigned&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensionNmrAtoms</span><span class="p">)</span></div>

<div class="viewcode-block" id="Peak.isFullyAssigned"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.isFullyAssigned">[docs]</a>  <span class="k">def</span> <span class="nf">isFullyAssigned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Whether peak is fully assigned&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensionNmrAtoms</span><span class="p">)</span></div>

<div class="viewcode-block" id="Peak.copyTo"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.copyTo">[docs]</a>  <span class="k">def</span> <span class="nf">copyTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetPeakList</span><span class="p">:</span><span class="n">PeakList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Peak&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Make (and return) a copy of the Peak in targetPeakList&quot;&quot;&quot;</span>

    <span class="n">singleValueTags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;heightError&#39;</span><span class="p">,</span> <span class="s1">&#39;volumeError&#39;</span><span class="p">,</span> <span class="s1">&#39;figureOfMerit&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">]</span>
    <span class="n">dimensionValueTags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="s1">&#39;positionError&#39;</span><span class="p">,</span> <span class="s1">&#39;boxWidths&#39;</span><span class="p">,</span> <span class="s1">&#39;lineWidths&#39;</span><span class="p">,</span> <span class="p">]</span>

    <span class="n">peakList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
    <span class="n">dimensionCount</span> <span class="o">=</span> <span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span>

    <span class="k">if</span> <span class="n">dimensionCount</span> <span class="o">!=</span> <span class="n">targetPeakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot copy </span><span class="si">%s</span><span class="s2">D </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">D </span><span class="si">%s</span><span class="s2">&quot;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">dimensionCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">longPid</span><span class="p">,</span>
                          <span class="n">targetPeakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">dimensionCount</span><span class="p">,</span> <span class="n">targetPeakList</span><span class="o">.</span><span class="n">longPid</span><span class="p">))</span>

    <span class="n">dimensionMapping</span> <span class="o">=</span> <span class="n">commonUtil</span><span class="o">.</span><span class="n">_axisCodeMapIndices</span><span class="p">(</span><span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">,</span>
                                                      <span class="n">targetPeakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dimensionMapping</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> axisCodes </span><span class="si">%s</span><span class="s2"> not compatible with target axisCodes </span><span class="si">%s</span><span class="s2">&quot;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">,</span> <span class="n">targetPeakList</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">))</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">((</span><span class="n">tag</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">singleValueTags</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">dimensionValueTags</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="n">params</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">dimensionMapping</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimensionCount</span><span class="p">)]</span>
    <span class="n">newPeak</span> <span class="o">=</span> <span class="n">targetPeakList</span><span class="o">.</span><span class="n">newPeak</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="n">assignments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">assignment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignedNmrAtoms</span><span class="p">:</span>
      <span class="n">assignments</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">assignment</span><span class="p">[</span><span class="n">dimensionMapping</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimensionCount</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">assignments</span><span class="p">:</span>
      <span class="n">newPeak</span><span class="o">.</span><span class="n">assignedNmrAtoms</span> <span class="o">=</span> <span class="n">assignments</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">newPeak</span></div>

<div class="viewcode-block" id="Peak.reorderValues"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.Peak.Peak.reorderValues">[docs]</a>  <span class="k">def</span> <span class="nf">reorderValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">newAxisCodeOrder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reorder values in spectrum dimension order to newAxisCodeOrder</span>
<span class="sd">    by matching newAxisCodeOrder to spectrum axis code order&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">commonUtil</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">axisCodes</span><span class="p">,</span> <span class="n">newAxisCodeOrder</span><span class="p">)</span></div>

  <span class="c1"># Implementation functions</span>

  <span class="nd">@classmethod</span>
  <span class="k">def</span> <span class="nf">_getAllWrappedData</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">PeakList</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Nmr</span><span class="o">.</span><span class="n">Peak</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;get wrappedData (Peaks) for all Peak children of parent PeakList&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">peaks</span></div>

  <span class="c1"># def __str__(self):</span>
  <span class="c1">#   &quot;&quot;&quot;Readable string representation&quot;&quot;&quot;</span>
  <span class="c1">#   # format the position list</span>
  <span class="c1">#   pstring = &#39;&#39;</span>
  <span class="c1">#   for p in self.position:</span>
  <span class="c1">#     pstring += &#39;%.3f,&#39; % p</span>
  <span class="c1">#</span>
  <span class="c1">#   if self.height is None:</span>
  <span class="c1">#     return &quot;&lt;%s; position:[%s]&gt;&quot; % (self.pid, pstring[:-1])</span>
  <span class="c1">#   else:</span>
  <span class="c1">#     return &quot;&lt;%s; position:[%s], height:%.1e&gt;&quot; % (self.pid, pstring[:-1], self.height)</span>

<span class="c1"># Connections to parents:</span>
<span class="k">def</span> <span class="nf">_newPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">PeakList</span><span class="p">,</span><span class="n">height</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">volume</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">heightError</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">volumeError</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">figureOfMerit</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">annotation</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">position</span><span class="p">:</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(),</span> <span class="n">positionError</span><span class="p">:</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">pointPosition</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">boxWidths</span><span class="p">:</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">lineWidths</span><span class="p">:</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">serial</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Peak</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Create new Peak within peakList</span>

<span class="sd">  NB you must create the peak before you can assign it. The assignment attributes are:</span>

<span class="sd">  - assignedNmrAtoms - A tuple of all (e.g.) assignment triplets for a 3D spectrum</span>

<span class="sd">  - dimensionNmrAtoms - A tuple of tuples of assignments, one for each dimension</span>

<span class="sd">  See the Peak class for details&quot;&quot;&quot;</span>

  <span class="n">defaults</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span>
    <span class="p">((</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;heightError&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;volumeError&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
     <span class="p">(</span><span class="s1">&#39;figureOfMerit&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="p">()),</span>
      <span class="p">(</span><span class="s1">&#39;positionError&#39;</span><span class="p">,</span> <span class="p">()),(</span><span class="s1">&#39;pointPosition&#39;</span><span class="p">,</span> <span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;boxWidths&#39;</span><span class="p">,</span> <span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;lineWidths&#39;</span><span class="p">,</span> <span class="p">()),</span>
     <span class="p">(</span><span class="s1">&#39;serial&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">)</span>
  <span class="p">)</span>

  <span class="n">undo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_undo</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">_startFunctionCommandBlock</span><span class="p">(</span><span class="s1">&#39;newPeak&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">defaults</span><span class="o">=</span><span class="n">defaults</span><span class="p">,</span>
                                  <span class="n">parName</span><span class="o">=</span><span class="s1">&#39;newPeak&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">blankNotification</span><span class="p">()</span>
  <span class="n">undo</span><span class="o">.</span><span class="n">increaseBlocking</span><span class="p">()</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">apiPeakList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apiPeakList</span>
    <span class="n">apiPeak</span> <span class="o">=</span> <span class="n">apiPeakList</span><span class="o">.</span><span class="n">newPeak</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span>
                                  <span class="n">heightError</span><span class="o">=</span><span class="n">heightError</span><span class="p">,</span> <span class="n">volumeError</span><span class="o">=</span><span class="n">volumeError</span><span class="p">,</span>
                                  <span class="n">figOfMerit</span><span class="o">=</span><span class="n">figureOfMerit</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apiPeak</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">serial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">modelUtil</span><span class="o">.</span><span class="n">resetSerial</span><span class="p">(</span><span class="n">apiPeak</span><span class="p">,</span> <span class="n">serial</span><span class="p">,</span> <span class="s1">&#39;peaks&#39;</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not reset serial of </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2"> - keeping original value&quot;</span>
                                     <span class="o">%</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">serial</span><span class="p">))</span>
    <span class="c1"># set peak position</span>
    <span class="c1"># NBNB TBD currently unused parameters could be added, and will have to come in here as well</span>
    <span class="n">apiPeakDims</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">sortedPeakDims</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">position</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">):</span>
        <span class="n">peakDim</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">pointPosition</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">):</span>
        <span class="n">peakDim</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">pointPosition</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">positionError</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">):</span>
        <span class="n">peakDim</span><span class="o">.</span><span class="n">valueError</span> <span class="o">=</span> <span class="n">positionError</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">boxWidths</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">):</span>
        <span class="n">peakDim</span><span class="o">.</span><span class="n">boxWidth</span> <span class="o">=</span> <span class="n">boxWidths</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lineWidths</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">peakDim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">):</span>
        <span class="n">peakDim</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="n">lineWidths</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

  <span class="k">finally</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_appBase</span><span class="o">.</span><span class="n">_endCommandBlock</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">unblankNotification</span><span class="p">()</span>
    <span class="n">undo</span><span class="o">.</span><span class="n">decreaseBlocking</span><span class="p">()</span>

  <span class="n">apiObjectsCreated</span> <span class="o">=</span> <span class="p">[</span><span class="n">apiPeak</span><span class="p">]</span>
  <span class="n">apiObjectsCreated</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">apiPeakDims</span><span class="p">)</span>
  <span class="n">undo</span><span class="o">.</span><span class="n">newItem</span><span class="p">(</span><span class="n">Undo</span><span class="o">.</span><span class="n">_deleteAllApiObjects</span><span class="p">,</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_unDelete</span><span class="p">,</span>
               <span class="n">undoArgs</span><span class="o">=</span><span class="p">(</span><span class="n">apiObjectsCreated</span><span class="p">,),</span>
               <span class="n">redoArgs</span><span class="o">=</span><span class="p">(</span><span class="n">apiObjectsCreated</span><span class="p">,</span>  <span class="p">(</span><span class="n">apiPeak</span><span class="o">.</span><span class="n">topObject</span><span class="p">,)))</span>


  <span class="c1"># DO creation notifications</span>
  <span class="k">if</span> <span class="n">serial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_finaliseAction</span><span class="p">(</span><span class="s1">&#39;rename&#39;</span><span class="p">)</span>
  <span class="n">result</span><span class="o">.</span><span class="n">_finaliseAction</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">result</span>

<span class="n">PeakList</span><span class="o">.</span><span class="n">newPeak</span> <span class="o">=</span> <span class="n">_newPeak</span>
<span class="k">del</span> <span class="n">_newPeak</span>

<span class="c1"># Additional Notifiers:</span>
<span class="c1">#</span>
<span class="c1"># NB These API notifiers will be called for API peaks - which match both Peaks and Integrals</span>
<span class="n">className</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">PeakDim</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
<span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
  <span class="p">(</span><span class="s1">&#39;_notifyRelatedApiObject&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;pathToObject&#39;</span><span class="p">:</span><span class="s1">&#39;peak&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="s1">&#39;change&#39;</span><span class="p">},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">AbstractPeakDimContrib</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">getNonAbstractSubtypes</span><span class="p">():</span>
  <span class="n">className</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
  <span class="c1"># NB - relies on PeakDimContrib.peakDim.peak still working for deleted peak. Should work.</span>
  <span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">(</span>
      <span class="p">(</span><span class="s1">&#39;_notifyRelatedApiObject&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;pathToObject&#39;</span><span class="p">:</span><span class="s1">&#39;peakDim.peak&#39;</span><span class="p">,</span>  <span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="s1">&#39;change&#39;</span><span class="p">},</span>
       <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;postInit&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;_notifyRelatedApiObject&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;pathToObject&#39;</span><span class="p">:</span><span class="s1">&#39;peakDim.peak&#39;</span><span class="p">,</span>  <span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="s1">&#39;change&#39;</span><span class="p">},</span>
       <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">),</span>
    <span class="p">)</span>
  <span class="p">)</span>

<span class="c1"># Notify Peaks change when SpectrumReference changes</span>
<span class="c1"># (That means DataDimRef referencing information)</span>
<span class="n">SpectrumReference</span><span class="o">.</span><span class="n">_setupCoreNotifier</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="n">AbstractWrapperObject</span><span class="o">.</span><span class="n">_finaliseRelatedObject</span><span class="p">,</span>
                          <span class="p">{</span><span class="s1">&#39;pathToObject&#39;</span><span class="p">:</span><span class="s1">&#39;spectrum.peaks&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="s1">&#39;change&#39;</span><span class="p">})</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>